(this["webpackJsonpmatx-react-pro"]=this["webpackJsonpmatx-react-pro"]||[]).push([[72,196],{214:function(e,t,r){"use strict";r.r(t),r.d(t,"createSymbolSchema",(function(){return o}));var n=r(5),i=r(157),a=r(166);function s(e){var t;return"line-marker"===e.type?{type:"line-marker",color:null===(t=e.color)||void 0===t?void 0:t.toJSON(),placement:e.placement,style:e.style}:e.constructor.fromJSON(e.toJSON()).toJSON()}function u(e){return Object(a.j)(e)}function o(e,t,r){if(!e)return null;switch(e.type){case"simple-fill":case"picture-fill":return function(e,t,r){var o=Object(a.g)(i.d.FILL,t),l=r?u(o):o,c=e.clone(),f=c.outline,p=Object(a.k)(t.symbologyType);p||(c.outline=null);var d=Object(n.a)({materialKey:l,hash:c.hash()},s(c));if(p)return d;var h=[];if(h.push(d),f){var y=Object(a.g)(i.d.LINE,Object(n.a)(Object(n.a)({},t),{},{isOutline:!0})),b=Object(n.a)({materialKey:r?u(y):y,hash:f.hash()},s(f));h.push(b)}return{type:"composite-symbol",layers:h,hash:h.reduce((function(e,t){return t.hash+e}),"")}}(e,t,r);case"simple-marker":case"picture-marker":return function(e,t,r){var o=Object(a.g)(i.d.MARKER,t),l=r?u(o):o,c=s(e);return Object(n.a)(Object(n.a)({materialKey:l,hash:e.hash()},c),{},{angle:e.angle,maxVVSize:t.maxVVSize})}(e,t,r);case"simple-line":return function(e,t,r){var o=Object(a.k)(t.symbologyType)?i.e.DEFAULT:t.symbologyType,l=Object(a.g)(i.d.LINE,Object(n.a)(Object(n.a)({},t),{},{symbologyType:o})),c=r?u(l):l,f=e.clone(),p=f.marker;f.marker=null;var d=[];if(d.push(Object(n.a)({materialKey:c,hash:f.hash()},s(f))),p){var h,y=Object(a.g)(i.d.MARKER,t),b=r?u(y):y;p.color=null!==(h=p.color)&&void 0!==h?h:f.color,d.push(Object(n.a)({materialKey:b,hash:p.hash(),lineWidth:f.width},s(p)))}return{type:"composite-symbol",layers:d,hash:d.reduce((function(e,t){return t.hash+e}),"")}}(e,t,r);case"text":return function(e,t,r){var o=Object(a.g)(i.d.TEXT,t),l=r?u(o):o,c=s(e);return Object(n.a)(Object(n.a)({materialKey:l,hash:e.hash()},c),{},{angle:e.angle,maxVVSize:t.maxVVSize})}(e,t,r);case"label":return function(e,t,r){var s=e.toJSON(),o=Object(a.g)(i.d.LABEL,Object(n.a)(Object(n.a)({},t),{},{placement:s.labelPlacement}));return Object(n.a)(Object(n.a)({materialKey:r?u(o):o,hash:e.hash()},s),{},{labelPlacement:s.labelPlacement})}(e,t,r);case"cim":return{type:"cim",rendererKey:t.vvFlags,data:e.data,maxVVSize:t.maxVVSize};case"CIMSymbolReference":return{type:"cim",rendererKey:t.vvFlags,data:e,maxVVSize:t.maxVVSize};case"web-style":return Object(n.a)(Object(n.a)({},s(e)),{},{type:"web-style",hash:e.hash(),rendererKey:t.vvFlags,maxVVSize:t.maxVVSize});default:throw new Error("symbol not supported ".concat(e.type))}}},232:function(e,t,r){"use strict";r.d(t,"a",(function(){return I})),r.d(t,"b",(function(){return F}));var n=r(155),i=r(154),a=r.n(i),s=r(292),u=r(60),o=r(142),l=r(143),c=r(157),f=r(166),p={marker:c.d.MARKER,fill:c.d.FILL,line:c.d.LINE,text:c.d.TEXT},d=function(){function e(t,r,n,i){Object(o.a)(this,e);var a={minScale:null===r||void 0===r?void 0:r.minScale,maxScale:null===r||void 0===r?void 0:r.maxScale},s=function(e){return e.minScale||e.maxScale?e.minScale+"-"+e.maxScale:""}(a);this.layers=t,this.data=r,this.hash=this._createHash()+s,this.rendererKey=n;var l,d={isOutline:!1,placement:null,symbologyType:c.e.DEFAULT,vvFlags:n},h=Object(u.a)(t);try{for(h.s();!(l=h.n()).done;){var y=l.value,b=p[y.type];d.isOutline="line"===y.type&&y.isOutline,y.materialKey=Object(f.g)(b,d),y.maxVVSize=i,y.scaleInfo=a,y.templateHash+=s}}catch(v){h.e(v)}finally{h.f()}}return Object(l.a)(e,[{key:"type",get:function(){return"expanded-cim"}},{key:"_createHash",value:function(){var e,t="",r=Object(u.a)(this.layers);try{for(r.s();!(e=r.n()).done;){t+=e.value.templateHash}}catch(n){r.e(n)}finally{r.f()}return t}}]),e}();var h=r(291),y=r(159),b=r(146),v=r(162),m=r(183),g=r(276),O=r(287),j=r(407);function x(e,t,r){return k.apply(this,arguments)}function k(){return(k=Object(n.a)(a.a.mark((function e(t,r,n){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.name){e.next=2;break}throw new y.a("style-symbol-reference-name-missing","Missing name in style symbol reference");case 2:if(!t.styleName||"Esri2DPointSymbolsStyle"!==t.styleName){e.next=4;break}return e.abrupt("return",w(t,n));case 4:return e.prev=4,e.t0=S,e.next=8,Object(j.b)(t,r,n);case 8:return e.t1=e.sent,e.t2=t.name,e.t3=r,e.t4=n,e.abrupt("return",(0,e.t0)(e.t1,e.t2,e.t3,e.t4));case 15:return e.prev=15,e.t5=e.catch(4),e.abrupt("return",(Object(v.p)(e.t5),null));case 18:case"end":return e.stop()}}),e,null,[[4,15]])})))).apply(this,arguments)}function w(e,t){return _.apply(this,arguments)}function _(){return(_=Object(n.a)(a.a.mark((function e(t,r){var n,i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=j.a.replace(/\{SymbolName\}/gi,t.name),e.prev=1,e.next=4,Object(j.d)(n,r);case 4:return i=e.sent,e.abrupt("return",Object(j.c)(i.data));case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",(Object(v.p)(e.t0),null));case 11:case"end":return e.stop()}}),e,null,[[1,8]])})))).apply(this,arguments)}function S(e,t,r,n){return E.apply(this,arguments)}function E(){return(E=Object(n.a)(a.a.mark((function e(t,r,n,i){var s,u,o,l,c;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=t.data,u={portal:n&&Object(b.k)(n.portal)?n.portal:g.a.getDefault(),url:Object(m.M)(t.baseUrl),origin:"portal-item"},o=s.items.find((function(e){return e.name===r}))){e.next=3;break}throw new y.a("symbolstyleutils:symbol-name-not-found","The symbol name '".concat(r,"' could not be found"),{symbolName:r});case 3:return l=Object(O.c)(Object(j.e)(o,"cimRef"),u),Object(h.b)()&&(l=Object(h.a)(l)),e.prev=5,e.next=8,Object(j.d)(l,i);case 8:return c=e.sent,e.abrupt("return",Object(j.c)(c.data));case 12:return e.prev=12,e.t0=e.catch(5),e.abrupt("return",(Object(v.p)(e.t0),null));case 15:case"end":return e.stop()}}),e,null,[[5,12]])})))).apply(this,arguments)}var R=function(){var e=Object(n.a)(a.a.mark((function e(t,r,n){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=d,e.next=3,Object(s.b)(t.data,r,n);case 3:return e.t1=e.sent,e.t2=t.data,e.t3=t.rendererKey,e.t4=t.maxVVSize,e.abrupt("return",new e.t0(e.t1,e.t2,e.t3,e.t4));case 8:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),F=function(){var e=Object(n.a)(a.a.mark((function e(t,r,n,i){var s;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",null);case 2:if("cim"!==t.type){e.next=4;break}return e.abrupt("return",R(t,r,n));case 4:if("web-style"!==t.type){e.next=12;break}return e.next=7,x(t,null,i);case 7:return e.t0=e.sent,e.t1=t.rendererKey,e.t2=t.maxVVSize,s={type:"cim",data:e.t0,rendererKey:e.t1,maxVVSize:e.t2},e.abrupt("return",R(s,r,n));case 12:return e.abrupt("return",t);case 13:case"end":return e.stop()}}),e)})));return function(t,r,n,i){return e.apply(this,arguments)}}();function I(e){if(!e)return null;var t=e.type,r=e.cim,n=e.url,i={cim:r,type:t,mosaicHash:e.materialHash,url:n,size:null,dashTemplate:null,path:null,text:null,fontName:null,animatedSymbolProperties:null};switch(t){case"marker":i.size=e.size,i.path=e.path,i.animatedSymbolProperties=e.animatedSymbolProperties;break;case"line":i.dashTemplate=e.dashTemplate;break;case"text":i.text=e.text,i.fontName=e.fontName}return i}},259:function(e,t,r){"use strict";r.d(t,"a",(function(){return h})),r.d(t,"b",(function(){return d})),r.d(t,"c",(function(){return g})),r.d(t,"d",(function(){return m})),r.d(t,"e",(function(){return y})),r.d(t,"f",(function(){return v})),r.d(t,"g",(function(){return b})),r.d(t,"h",(function(){return O}));var n=r(14),i=r(221),a=r(146),s=r(167),u=r(217),o=r(180),l=r(182),c=r(218),f=r(158),p=r(233),d=512,h=50;function y(e,t){var r=Object(l.e)(t);if(!r)return null;var i=Object(n.a)(r.valid,2),a=i[0],s=i[1];return e[2]>s?[Object(o.g)([e[0],e[1],s,e[3]]),Object(o.g)([a,e[1],a+e[2]-s,e[3]])]:e[0]<a?[Object(o.g)([a,e[1],e[2],e[3]]),Object(o.g)([s-(a-e[0]),e[1],s,e[3]])]:null}function b(e){return"text"===e||"esriTS"===e}function v(e){return"simple-marker"===e||"picture-marker"===e||"esriSMS"===e||"esriPMS"===e}function m(e){switch(Object(a.q)(e.geometry).type){case"point":case"multipoint":return 0;case"polyline":return 1;case"polygon":case"extent":return 2}return 0}function g(e,t,r){var n,a,u;if(!r||0===r.glyphMosaicItems.length)return e;var o=Object(i.a)(t.text)[1],l=r.glyphMosaicItems,d=Object(p.a)(l,o,{scale:Object(s.c)(t.font.size)/f.u,angle:null!==(n=t.angle)&&void 0!==n?n:0,xOffset:null!==(a=t.xoffset)&&void 0!==a?a:0,yOffset:null!==(u=t.yoffset)&&void 0!==u?u:0,hAlign:Object(c.e)(t.horizontalAlignment||"center"),vAlign:Object(c.g)(t.verticalAlignment||"baseline"),maxLineWidth:Math.max(32,Math.min(t.lineWidth||512,512)),lineHeight:f.x*Math.max(.25,Math.min(t.lineHeight||1,4)),decoration:t.font.decoration||"none",isCIM:!1}).bounds;return e[0]=Object(s.c)(d.x-d.halfWidth),e[1]=Object(s.c)(d.y-d.halfHeight),e[2]=Object(s.c)(d.width),e[3]=Object(s.c)(d.height),e}function O(e){if(!e)return null;var t=e.xmin,r=e.ymin,n=e.xmax,i=e.ymax,a=e.spatialReference;return new u.a({rings:[[[t,r],[t,i],[n,i],[n,r],[t,r]]],spatialReference:a})}},262:function(e,t,r){"use strict";r.d(t,"a",(function(){return m}));var n=r(142),i=r(143),a=r(144),s=r(145),u=r(148),o=r(181),l=r(252),c=r(215),f=r(277),p=r(156),d=r(146),h=r(283),y=r(151),b=(r(152),r(147),r(150),r(149)),v=function(e){Object(a.a)(r,e);var t=Object(s.a)(r);function r(e){var i;return Object(n.a)(this,r),(i=t.call(this,e)).layer=null,i.parent=null,i}return Object(i.a)(r,[{key:"initialize",value:function(){var e=this;this.when().catch((function(t){if("layerview:create-error"!==t.name){var r=e.layer&&e.layer.id||"no id",n=e.layer&&e.layer.title||"no title";p.a.getLogger(e.declaredClass).error("#resolve()","Failed to resolve layer view (layer title: '".concat(n,"', id: '").concat(r,"')"),t)}}))}},{key:"fullOpacity",get:function(){return Object(d.r)(this.get("layer.opacity"),1)*Object(d.r)(this.get("parent.fullOpacity"),1)}},{key:"suspended",get:function(){return!this.canResume()}},{key:"suspendInfo",get:function(){return this.getSuspendInfo()}},{key:"legendEnabled",get:function(){var e;return!this.suspended&&!0===(null===(e=this.layer)||void 0===e?void 0:e.legendEnabled)}},{key:"updating",get:function(){var e;return!((null===(e=this.updatingHandles)||void 0===e||!e.updating)&&!this.isUpdating())}},{key:"updatingProgress",get:function(){return this.updating?0:1}},{key:"visible",get:function(){var e;return!0===(null===(e=this.layer)||void 0===e?void 0:e.visible)},set:function(e){void 0!==e?this._override("visible",e):this._clearOverride("visible")}},{key:"canResume",value:function(){var e,t,r;return this.visible&&(null===(e=this.layer)||void 0===e?void 0:e.loaded)&&!(null!==(t=this.parent)&&void 0!==t&&t.suspended)&&(null===(r=this.view)||void 0===r?void 0:r.ready)||!1}},{key:"getSuspendInfo",value:function(){var e=this.parent&&this.parent.suspended?this.parent.suspendInfo:{};return this.view&&this.view.ready||(e.viewNotReady=!0),this.layer&&this.layer.loaded||(e.layerNotLoaded=!0),this.visible||(e.layerInvisible=!0),e}},{key:"isUpdating",value:function(){return!1}}]),r}(Object(c.b)(Object(f.a)(Object(h.b)(l.a.EventedMixin(o.a)))));Object(u.a)([Object(y.b)()],v.prototype,"fullOpacity",null),Object(u.a)([Object(y.b)()],v.prototype,"layer",void 0),Object(u.a)([Object(y.b)()],v.prototype,"parent",void 0),Object(u.a)([Object(y.b)({readOnly:!0})],v.prototype,"suspended",null),Object(u.a)([Object(y.b)({readOnly:!0})],v.prototype,"suspendInfo",null),Object(u.a)([Object(y.b)({readOnly:!0})],v.prototype,"legendEnabled",null),Object(u.a)([Object(y.b)({type:Boolean,readOnly:!0})],v.prototype,"updating",null),Object(u.a)([Object(y.b)({readOnly:!0})],v.prototype,"updatingProgress",null),Object(u.a)([Object(y.b)()],v.prototype,"visible",null),Object(u.a)([Object(y.b)()],v.prototype,"view",void 0);var m=v=Object(u.a)([Object(b.a)("esri.views.layers.LayerView")],v)},264:function(e,t,r){"use strict";r.d(t,"a",(function(){return z}));var n,i=r(142),a=r(143),s=r(164),u=r(163),o=r(144),l=r(145),c=r(148),f=r(194),p=r(294),d=r(159),h=r(175),y=r(151),b=(r(152),r(147),r(150),r(149)),v=r(258),m=r(160),g=(r(156),r(234),function(e){Object(o.a)(r,e);var t=Object(l.a)(r);function r(){return Object(i.a)(this,r),t.apply(this,arguments)}return Object(a.a)(r)}(m.a)),O=g=Object(c.a)([Object(b.a)("esri.views.layers.support.ClipArea")],g),j=n=function(e){Object(o.a)(r,e);var t=Object(l.a)(r);function r(){var e;return Object(i.a)(this,r),(e=t.apply(this,arguments)).type="rect",e.left=null,e.right=null,e.top=null,e.bottom=null,e}return Object(a.a)(r,[{key:"clone",value:function(){return new n({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}},{key:"version",get:function(){return(this._get("version")||0)+1}}]),r}(O);Object(c.a)([Object(y.b)({type:[Number,String],json:{write:!0}})],j.prototype,"left",void 0),Object(c.a)([Object(y.b)({type:[Number,String],json:{write:!0}})],j.prototype,"right",void 0),Object(c.a)([Object(y.b)({type:[Number,String],json:{write:!0}})],j.prototype,"top",void 0),Object(c.a)([Object(y.b)({type:[Number,String],json:{write:!0}})],j.prototype,"bottom",void 0),Object(c.a)([Object(y.b)({readOnly:!0})],j.prototype,"version",null);var x,k=j=n=Object(c.a)([Object(b.a)("esri.views.layers.support.ClipRect")],j),w=(r(177),r(249)),_=r(168),S=r(176),E=r(217),R={base:w.a,key:"type",typeMap:{extent:S.a,polygon:E.a}},F=x=function(e){Object(o.a)(r,e);var t=Object(l.a)(r);function r(){var e;return Object(i.a)(this,r),(e=t.apply(this,arguments)).type="geometry",e.geometry=null,e}return Object(a.a)(r,[{key:"version",get:function(){return(this._get("version")||0)+1}},{key:"clone",value:function(){return new x({geometry:this.geometry.clone()})}}]),r}(O);Object(c.a)([Object(y.b)({types:R,json:{read:_.a,write:!0}})],F.prototype,"geometry",void 0),Object(c.a)([Object(y.b)({readOnly:!0})],F.prototype,"version",null);var I=F=x=Object(c.a)([Object(b.a)("esri.views.layers.support.Geometry")],F),T=function(e){Object(o.a)(r,e);var t=Object(l.a)(r);function r(){var e;return Object(i.a)(this,r),(e=t.apply(this,arguments)).type="path",e.path=[],e}return Object(a.a)(r,[{key:"version",get:function(){return(this._get("version")||0)+1}}]),r}(O);Object(c.a)([Object(y.b)({type:[[[Number]]],json:{write:!0}})],T.prototype,"path",void 0),Object(c.a)([Object(y.b)({readOnly:!0})],T.prototype,"version",null);var V=T=Object(c.a)([Object(b.a)("esri.views.layers.support.Path")],T),q=f.a.ofType({key:"type",base:O,typeMap:{rect:k,path:V,geometry:I}}),z=function(e){var t=function(e){Object(o.a)(r,e);var t=Object(l.a)(r);function r(){var e;return Object(i.a)(this,r),(e=t.apply(this,arguments)).attached=!1,e.clips=new q,e.lastUpdateId=-1,e.moving=!1,e.updateRequested=!1,e}return Object(a.a)(r,[{key:"initialize",value:function(){var e,t,r,n,i=this,a=null===(e=null===(t=this.view)||void 0===t?void 0:t.spatialReferenceLocked)||void 0===e||e;(null===(r=this.view)||void 0===r?void 0:r.spatialReference)&&a&&!this.spatialReferenceSupported?this.addResolvingPromise(Promise.reject(new d.a("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new v.a),this.container.fadeTransitionEnabled=!0,this.container.opacity=0,this.container.clips=this.clips,this.handles.add([Object(h.e)((function(){return i.suspended}),(function(e){i.container&&(i.container.visible=!e),i.view&&!e&&i.updateRequested&&i.view.requestUpdate()}),h.d),Object(h.e)((function(){var e,t;return null!==(e=null===(t=i.layer)||void 0===t?void 0:t.opacity)&&void 0!==e?e:1}),(function(e){i.container&&(i.container.opacity=e)}),h.d),Object(h.e)((function(){return i.layer&&"blendMode"in i.layer?i.layer.blendMode:"normal"}),(function(e){i.container&&(i.container.blendMode=e)}),h.d),Object(h.e)((function(){return i.layer&&"effect"in i.layer?i.layer.effect:null}),(function(e){i.container&&(i.container.effect=e)}),h.d),Object(h.b)((function(){return i.clips}),"change",(function(){i.container&&(i.container.clips=i.clips)}))]),null!==(n=this.view)&&void 0!==n&&n.whenLayerView?this.view.whenLayerView(this.layer).then((function(e){e===i&&i.processAttach()}),(function(){})):this.when().then((function(){i.processAttach()}),(function(){})))}},{key:"destroy",value:function(){this.processDetach(),this.updateRequested=!1}},{key:"spatialReferenceSupported",get:function(){var e,t=null===(e=this.view)||void 0===e?void 0:e.spatialReference;return null==t||this.supportsSpatialReference(t)}},{key:"updating",get:function(){var e;return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!(null===(e=this.updatingHandles)||void 0===e||!e.updating))}},{key:"visibleAtCurrentScale",get:function(){return this.isVisibleAtScale(this.view.scale)}},{key:"processAttach",value:function(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,this.requestUpdate())}},{key:"processDetach",value:function(){this.attached&&(this.attached=!1,this.detach(),this.updateRequested=!1)}},{key:"isVisibleAtScale",value:function(e){var t=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;if(!t)return!0;var r=t.minScale,n=t.maxScale;return(0===r||e<=r)&&(0===n||e>=n)}},{key:"requestUpdate",value:function(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())}},{key:"processUpdate",value:function(e){!this.isFulfilled()||this.isResolved()?(this._set("updateParameters",e),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(e))):this.updateRequested=!1}},{key:"hitTest",value:function(e,t){return Promise.resolve(null)}},{key:"supportsSpatialReference",value:function(e){return!0}},{key:"canResume",value:function(){return!!this.spatialReferenceSupported&&!!Object(s.a)(Object(u.a)(r.prototype),"canResume",this).call(this)&&this.visibleAtCurrentScale}},{key:"getSuspendInfo",value:function(){var e=Object(s.a)(Object(u.a)(r.prototype),"getSuspendInfo",this).call(this),t=!this.spatialReferenceSupported,n=this.visibleAtCurrentScale;return t&&(e.spatialReferenceNotSupported=t),n&&(e.outsideScaleRange=n),e}}]),r}(e);return Object(c.a)([Object(y.b)()],t.prototype,"attached",void 0),Object(c.a)([Object(y.b)({type:q,set:function(e){var t=Object(p.b)(e,this._get("clips"),q);this._set("clips",t)}})],t.prototype,"clips",void 0),Object(c.a)([Object(y.b)()],t.prototype,"container",void 0),Object(c.a)([Object(y.b)()],t.prototype,"moving",void 0),Object(c.a)([Object(y.b)({readOnly:!0})],t.prototype,"spatialReferenceSupported",null),Object(c.a)([Object(y.b)({readOnly:!0})],t.prototype,"updateParameters",void 0),Object(c.a)([Object(y.b)()],t.prototype,"updateRequested",void 0),Object(c.a)([Object(y.b)()],t.prototype,"updating",null),Object(c.a)([Object(y.b)()],t.prototype,"view",void 0),Object(c.a)([Object(y.b)({readOnly:!0})],t.prototype,"visibleAtCurrentScale",null),t=Object(c.a)([Object(b.a)("esri.views.2d.layers.LayerView2D")],t)}},270:function(e,t,r){"use strict";r.d(t,"a",(function(){return j})),r.d(t,"b",(function(){return m})),r.d(t,"c",(function(){return l})),r.d(t,"d",(function(){return x})),r.d(t,"e",(function(){return k})),r.d(t,"f",(function(){return w})),r.d(t,"g",(function(){return _}));var n=r(14),i=r(146),a=r(168);var s=function(e,t,r){return[t,r]},u=function(e,t,r){return[t,r,e[2]]},o=function(e,t,r){return[t,r,e[2],e[3]]};function l(e){return e?{originPosition:"upper-left"===e.originPosition?"upperLeft":"lower-left"===e.originPosition?"lowerLeft":e.originPosition,scale:e.tolerance?[e.tolerance,e.tolerance]:[1,1],translate:Object(i.k)(e.extent)?[e.extent.xmin,e.extent.ymax]:[0,0]}:null}function c(e,t){var r=e.scale,n=e.translate;return Math.round((t-n[0])/r[0])}function f(e,t){var r=e.scale,n=e.translate;return Math.round((n[1]-t)/r[1])}function p(e,t,r){for(var n,i,a,s,u=[],o=0;o<r.length;o++){var l=r[o];o>0?(a=c(e,l[0]),s=f(e,l[1]),a===n&&s===i||(u.push(t(l,a-n,s-i)),n=a,i=s)):(n=c(e,l[0]),i=f(e,l[1]),u.push(t(l,n,i)))}return u.length>0?u:null}function d(e,t){var r=e.scale,n=e.translate;return t*r[0]+n[0]}function h(e,t){var r=e.scale;return e.translate[1]-t*r[1]}function y(e,t,r){var i=new Array(r.length);if(!r.length)return i;var a=Object(n.a)(e.scale,2),s=a[0],u=a[1],o=d(e,r[0][0]),l=h(e,r[0][1]);i[0]=t(r[0],o,l);for(var c=1;c<r.length;c++){var f=r[c];o+=f[0]*s,l-=f[1]*u,i[c]=t(f,o,l)}return i}function b(e,t,r){for(var n=new Array(r.length),i=0;i<r.length;i++)n[i]=y(e,t,r[i]);return n}function v(e,t,r,n,i){return t.points=function(e,t,r,n){return p(e,r?n?o:u:n?u:s,t)}(e,r.points,n,i),t}function m(e,t,r,n,i){return t.x=c(e,r.x),t.y=f(e,r.y),t!==r&&(n&&(t.z=r.z),i&&(t.m=r.m)),t}function g(e,t,r,n,i){var a=function(e,t,r,n){for(var i=[],a=r?n?o:u:n?u:s,l=0;l<t.length;l++){var c=p(e,a,t[l]);c&&c.length>=3&&i.push(c)}return i.length?i:null}(e,r.rings,n,i);return a?(t.rings=a,t):null}function O(e,t,r,n,i){var a=function(e,t,r,n){for(var i=[],a=r?n?o:u:n?u:s,l=0;l<t.length;l++){var c=p(e,a,t[l]);c&&c.length>=2&&i.push(c)}return i.length?i:null}(e,r.paths,n,i);return a?(t.paths=a,t):null}function j(e,t){return e&&t?Object(a.f)(t)?m(e,{},t,!1,!1):Object(a.h)(t)?O(e,{},t,!1,!1):Object(a.g)(t)?g(e,{},t,!1,!1):Object(a.e)(t)?v(e,{},t,!1,!1):Object(a.d)(t)?function(e,t,r,n,i){return t.xmin=c(e,r.xmin),t.ymin=f(e,r.ymin),t.xmax=c(e,r.xmax),t.ymax=f(e,r.ymax),t!==r&&(n&&(t.zmin=r.zmin,t.zmax=r.zmax),i&&(t.mmin=r.mmin,t.mmax=r.mmax)),t}(e,{},t,!1,!1):null:null}function x(e,t,r,n,a){return Object(i.k)(r)&&(t.points=function(e,t,r,n){return y(e,r?n?o:u:n?u:s,t)}(e,r.points,n,a)),t}function k(e,t,r,n,a){return Object(i.j)(r)||(t.x=d(e,r.x),t.y=h(e,r.y),t!==r&&(n&&(t.z=r.z),a&&(t.m=r.m))),t}function w(e,t,r,n,a){return Object(i.k)(r)&&(t.rings=function(e,t,r,n){return b(e,r?n?o:u:n?u:s,t)}(e,r.rings,n,a)),t}function _(e,t,r,n,a){return Object(i.k)(r)&&(t.paths=function(e,t,r,n){return b(e,r?n?o:u:n?u:s,t)}(e,r.paths,n,a)),t}},279:function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var n=r(159),i=r(156),a=r(157),s=r(165),u=i.a.getLogger("esri.views.2d.engine.webgl");function o(e){return Object(s.v)(e.minDataValue)&&Object(s.v)(e.maxDataValue)&&null!=e.minSize&&null!=e.maxSize?a.f.SIZE_MINMAX_VALUE:(e.expression&&"view.scale"===e.expression||e.valueExpression&&"$view.scale"===e.valueExpression)&&Array.isArray(e.stops)?a.f.SIZE_SCALE_STOPS:(null!=e.field||e.expression&&"view.scale"!==e.expression||e.valueExpression&&"$view.scale"!==e.valueExpression)&&(Array.isArray(e.stops)||"levels"in e&&e.levels)?a.f.SIZE_FIELD_STOPS:(null!=e.field||e.expression&&"view.scale"!==e.expression||e.valueExpression&&"$view.scale"!==e.valueExpression)&&null!=e.valueUnit?a.f.SIZE_UNIT_VALUE:(u.error(new n.a("mapview-bad-type","Found invalid size VisualVariable",e)),a.f.NONE)}},291:function(e,t,r){"use strict";function n(e){return e=e||globalThis.location.hostname,l.some((function(t){var r;return null!=(null===(r=e)||void 0===r?void 0:r.match(t))}))}function i(e,t){return e&&(t=t||globalThis.location.hostname)?null!=t.match(a)||null!=t.match(u)?e.replace("static.arcgis.com","staticdev.arcgis.com"):null!=t.match(s)||null!=t.match(o)?e.replace("static.arcgis.com","staticqa.arcgis.com"):e:e}r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return n}));var a=/^devext.arcgis.com$/,s=/^qaext.arcgis.com$/,u=/^[\w-]*\.mapsdevext.arcgis.com$/,o=/^[\w-]*\.mapsqa.arcgis.com$/,l=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local.esri.com$/,a,s,/^jsapps.esri.com$/,u,o]},293:function(e,t,r){"use strict";r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return i}));r(60);var n=new(r(200).a)({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch",mesh:"mesh"});function i(e){return n.toJSON(e)}function a(e){var t=e.rasterInfo,r=t.bandCount,n=t.attributeTable,i=t.colormap,a=t.pixelType;return 1===r&&(null!=n||null!=i||"u8"===a||"s8"===a)}},303:function(e,t,r){"use strict";r.d(t,"a",(function(){return b})),r.d(t,"b",(function(){return v})),r.d(t,"c",(function(){return f})),r.d(t,"d",(function(){return p}));var n=r(16),i=r(427),a=r(159),s=r(147),u=r(156),o=r(167),l=r(269),c=u.a.getLogger("esri.views.2d.layers.features.support.rendererUtils"),f=function(e){if(!("visualVariables"in e)||!e.visualVariables||!e.visualVariables.length)return e;var t=e.clone(),r=t.visualVariables.map((function(e){return d(e)?h(e):e}));return t.visualVariables=r,t};function p(e){return e.map((function(e){return d(e)?h(e.clone()):e}))}function d(e){return("size"===e.type||"color"===e.type||"opacity"===e.type)&&null!=e.stops}function h(e){return e.stops=function(e,t){return t.length<=8?t:(c.warn("Found ".concat(t.length," Visual Variable stops, but MapView only supports ").concat(8,". Displayed stops will be simplified.")),t.length>16?function(e,t){for(var r=Object(i.a)(t),n=r[0],a=r.slice(1),s=a.pop(),u=a[0].value,l=a[a.length-1].value,c=(l-u)/6,f=[],p=u;p<l;p+=c){for(var d=0;p>=a[d].value;)d++;var h=a[d],b=t[d-1],v=p-b.value,m=h.value===b.value?1:v/(h.value-b.value);if("color"===e){var g=a[d],O=t[d-1],j=g.color.clone();j.r=y(O.color.r,j.r,m),j.g=y(O.color.g,j.g,m),j.b=y(O.color.b,j.b,m),j.a=y(O.color.a,j.a,m),f.push({value:p,color:j,label:g.label})}else if("size"===e){var x=a[d],k=t[d-1],w=Object(o.e)(x.size),_=y(Object(o.e)(k.size),w,m);f.push({value:p,size:_,label:x.label})}else{var S=a[d],E=y(t[d-1].opacity,S.opacity,m);f.push({value:p,opacity:E,label:S.label})}}return[n].concat(f,[s])}(e,t):function(e){for(var t=Object(i.a)(e),r=t[0],a=t.slice(1),s=a.pop();a.length>6;){for(var u=0,o=0,l=1;l<a.length;l++){var c=a[l-1],f=a[l],p=Math.abs(f.value-c.value);p>o&&(o=p,u=l)}a.splice(u,1)}return[r].concat(Object(n.a)(a),[s])}(t))}(e.type,e.stops),e}function y(e,t,r){return(1-r)*e+r*t}function b(){if(Object(s.a)("heatmap-force-raster"))return"raster";var e=Object(l.a)("2d"),t=e.supportsTextureFloat,r=e.supportsTextureHalfFloat,n=e.supportsColorBufferFloat,i=e.supportsColorBufferFloatBlend,a=e.supportsColorBufferHalfFloat;return t&&n&&i||r&&a?"symbol":Object(s.a)("heatmap-allow-raster-fallback")?"raster":"none"}function v(e){if(!e)return!0;switch(e.type){case"dot-density":if(!Object(l.a)("2d").supportsTextureFloat)return c.error(new a.a("webgl-missing-extension","Missing WebGL extension OES_Texture_Float which is required for DotDensity")),!1;break;case"heatmap":var t=b();if("none"===t||"raster"===t&&!Object(s.a)("heatmap-force-raster")){var r=Object(l.a)("2d"),n=["supportsTextureFloat","supportsTextureHalfFloat","supportsColorBufferFloat","supportsColorBufferFloatBlend","supportsColorBufferHalfFloat"].filter((function(e){return!r[e]})).join(", ");if("none"===t)return c.errorOnce(new a.a("webgl-missing-extension","Missing WebGL".concat(r.type," requirements for Heatmap: ").concat(n))),!1;"raster"===t&&c.warnOnce("Missing WebGL".concat(r.type," requirements for accelerated Heatmap: ").concat(n,". Feature support may be limited."))}}return!0}},318:function(e,t,r){"use strict";r.d(t,"a",(function(){return V})),r.d(t,"b",(function(){return I})),r.d(t,"c",(function(){return E})),r.d(t,"d",(function(){return R})),r.d(t,"e",(function(){return T}));var n,i=r(7),a=r(5),s=r(60),u=r(159),o=r(147),l=r(156),c=r(146),f=r(327),p=r(305),d=r(430),h=r(142),y=r(143),b=r(144),v=r(145),m=r(148),g=r(161),O=r(151),j=(r(150),r(149)),x=r(192),k=r(403),w=n=function(e){Object(b.a)(r,e);var t=Object(v.a)(r);function r(){return Object(h.a)(this,r),t.apply(this,arguments)}return Object(y.a)(r,[{key:"writeLevels",value:function(e,t,r){for(var n in e){var i=this.levels[n];return void(t.stops=i)}}},{key:"clone",value:function(){return new n({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:Object(k.e)(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:Object(k.e)(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops&&this.stops.map((function(e){return e.clone()})),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions&&this.legendOptions.clone(),levels:Object(g.a)(this.levels)})}}]),r}(p.a);Object(m.a)([Object(O.b)()],w.prototype,"levels",void 0),Object(m.a)([Object(x.a)("levels")],w.prototype,"writeLevels",null),w=n=Object(m.a)([Object(j.a)("esri.views.2d.engine.LevelDependentSizeVariable")],w);var _=l.a.getLogger("esri.views.2d.layers.support.clusterUtils");o.a.add("esri-cluster-arcade-enabled",!0);var S=Object(o.a)("esri-cluster-arcade-enabled"),E=function(e,t,r,n){var i=t.clone();if(!T(i))return i;if(r.fields){var a,u=Object(s.a)(r.fields);try{for(u.s();!(a=u.n()).done;){var o=a.value;V(e,o)}}catch(p){u.e(p)}finally{u.f()}}if("visualVariables"in i){var l=(i.visualVariables||[]).filter((function(e){return"$view.scale"!==e.valueExpression})),f=R(l);l.forEach((function(t){"rotation"===t.type?t.field?t.field=z(e,t.field,"avg_angle"):t.valueExpression&&(t.field=q(e,t.valueExpression,"avg_angle"),t.valueExpression=null):t.normalizationField?(t.field=z(e,t.field,"norm",t.normalizationField),t.normalizationField=null):t.field?t.field=z(e,t.field,"avg"):(t.field=q(e,t.valueExpression,"avg"),t.valueExpression=null)})),Object(c.j)(f)&&!F(l)&&(l.push(I(r,n)),i.dynamicClusterSize=!0),i.visualVariables=l}switch(i.type){case"simple":break;case"unique-value":i.field?i.field=z(e,i.field,"mode"):i.valueExpression&&(i.field=q(e,i.valueExpression,"mode"),i.valueExpression=null);break;case"class-breaks":i.normalizationField?(i.field=z(e,i.field,"norm",i.normalizationField),i.normalizationField=null):i.field?i.field=z(e,i.field,"avg"):(i.field=q(e,i.valueExpression,"avg"),i.valueExpression=null)}return i},R=function(e){var t,r=Object(s.a)(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;if("size"===n.type)return n}}catch(i){r.e(i)}finally{r.f()}return null},F=function(e){var t,r=Object(s.a)(e);try{for(r.s();!(t=r.n()).done;){if("cluster_count"===t.value.field)return!0}}catch(n){r.e(n)}finally{r.f()}return!1},I=function(e,t){var r=[new d.a({value:0,size:0}),new d.a({value:1})];if(Object(c.j)(t))return new p.a({field:"cluster_count",stops:[].concat(r,[new d.a({value:2,size:0})])});var n=Object.keys(t).reduce((function(n,s){return Object(a.a)(Object(a.a)({},n),{},Object(i.a)({},s,[].concat(r,[new d.a({value:Math.max(2,t[s].minValue),size:e.clusterMinSize}),new d.a({value:Math.max(3,t[s].maxValue),size:e.clusterMaxSize})])))}),{});return new w({field:"cluster_count",levels:n})},T=function(e){var t=function(t){return _.error(new u.a("Unsupported-renderer",t,{renderer:e}))};if("unique-value"===e.type){if(e.field2||e.field3)return t("FeatureReductionCluster does not support multi-field UniqueValueRenderers"),!1}else if("class-breaks"===e.type){if(e.normalizationField){var r=e.normalizationType;if("field"!==r)return t("FeatureReductionCluster does not support a normalizationType of ".concat(r)),!1}}else if("simple"!==e.type)return t("FeatureReductionCluster does not support renderers of type ".concat(e.type)),!1;if(!S){if("valueExpression"in e&&e.valueExpression)return t("FeatureReductionCluster does not currently support renderer.valueExpression. Support will be added in a future release"),!1;if(("visualVariables"in e&&e.visualVariables||[]).some((function(e){return!(!("valueExpression"in e)||!e.valueExpression)})))return t("FeatureReductionCluster does not currently support visualVariables with a valueExpression. Support will be added in a future release"),!1}return!0};function V(e,t){var r=t.name,n=t.outStatistic,i=n.onStatisticField,a=n.onStatisticValueExpression,s=n.statisticType;if(a){var o=Object(f.a)(a.toLowerCase());e.push({name:r,outStatistic:{onStatisticField:o,onStatisticValueExpression:a,statisticType:s}})}else i?e.push({name:r,outStatistic:{onStatisticField:i,statisticType:s}}):_.error(new u.a("mapview-unsupported-field","Unable to handle field",{field:t}))}function q(e,t,r){var n=Object(f.a)(t),i="mode"===r?"cluster_type_".concat(n):"cluster_avg_".concat(n);return e.some((function(e){return e.name===i}))||e.push({name:i,outStatistic:{onStatisticField:n,onStatisticValueExpression:t,statisticType:r}}),i}function z(e,t,r,n){if("cluster_count"===t||e.some((function(e){return e.name===t})))return t;var i=function(e,t,r){switch(e){case"avg":case"avg_angle":return"cluster_avg_".concat(t);case"mode":return"cluster_type_".concat(t);case"norm":var n=r,i=t.toLowerCase()+",norm:field,"+n.toLowerCase();return"cluster_avg_"+Object(f.a)(i)}}(r,t,n);return e.some((function(e){return e.name===i}))||("norm"===r?e.push({name:i,outStatistic:{onStatisticField:t,onStatisticNormalizationField:n,statisticType:r}}):e.push({name:i,outStatistic:{onStatisticField:t,statisticType:r}})),i}},327:function(e,t,r){"use strict";r.d(t,"a",(function(){return y})),r.d(t,"b",(function(){return n}));var n={Base64:0,Hex:1,String:2,Raw:3};function i(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function a(e){for(var t=[],r=0,n=8*e.length;r<n;r+=8)t[r>>5]|=(255&e.charCodeAt(r/8))<<r%32;return t}function s(e){for(var t=[],r=0,n=32*e.length;r<n;r+=8)t.push(String.fromCharCode(e[r>>5]>>>r%32&255));return t.join("")}function u(e){for(var t="0123456789abcdef",r=[],n=0,i=4*e.length;n<i;n++)r.push(t.charAt(e[n>>2]>>n%4*8+4&15)+t.charAt(e[n>>2]>>n%4*8&15));return r.join("")}function o(e){for(var t=[],r=0,n=4*e.length;r<n;r+=3)for(var i=(e[r>>2]>>r%4*8&255)<<16|(e[r+1>>2]>>(r+1)%4*8&255)<<8|e[r+2>>2]>>(r+2)%4*8&255,a=0;a<4;a++)8*r+6*a>32*e.length?t.push("="):t.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(i>>6*(3-a)&63));return t.join("")}function l(e,t,r,n,a,s){return i(function(e,t){return e<<t|e>>>32-t}(i(i(t,e),i(n,s)),a),r)}function c(e,t,r,n,i,a,s){return l(t&r|~t&n,e,t,i,a,s)}function f(e,t,r,n,i,a,s){return l(t&n|r&~n,e,t,i,a,s)}function p(e,t,r,n,i,a,s){return l(t^r^n,e,t,i,a,s)}function d(e,t,r,n,i,a,s){return l(r^(t|~n),e,t,i,a,s)}function h(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var r=1732584193,n=-271733879,a=-1732584194,s=271733878,u=0;u<e.length;u+=16){var o=r,l=n,h=a,y=s;r=c(r,n,a,s,e[u+0],7,-680876936),s=c(s,r,n,a,e[u+1],12,-389564586),a=c(a,s,r,n,e[u+2],17,606105819),n=c(n,a,s,r,e[u+3],22,-1044525330),r=c(r,n,a,s,e[u+4],7,-176418897),s=c(s,r,n,a,e[u+5],12,1200080426),a=c(a,s,r,n,e[u+6],17,-1473231341),n=c(n,a,s,r,e[u+7],22,-45705983),r=c(r,n,a,s,e[u+8],7,1770035416),s=c(s,r,n,a,e[u+9],12,-1958414417),a=c(a,s,r,n,e[u+10],17,-42063),n=c(n,a,s,r,e[u+11],22,-1990404162),r=c(r,n,a,s,e[u+12],7,1804603682),s=c(s,r,n,a,e[u+13],12,-40341101),a=c(a,s,r,n,e[u+14],17,-1502002290),r=f(r,n=c(n,a,s,r,e[u+15],22,1236535329),a,s,e[u+1],5,-165796510),s=f(s,r,n,a,e[u+6],9,-1069501632),a=f(a,s,r,n,e[u+11],14,643717713),n=f(n,a,s,r,e[u+0],20,-373897302),r=f(r,n,a,s,e[u+5],5,-701558691),s=f(s,r,n,a,e[u+10],9,38016083),a=f(a,s,r,n,e[u+15],14,-660478335),n=f(n,a,s,r,e[u+4],20,-405537848),r=f(r,n,a,s,e[u+9],5,568446438),s=f(s,r,n,a,e[u+14],9,-1019803690),a=f(a,s,r,n,e[u+3],14,-187363961),n=f(n,a,s,r,e[u+8],20,1163531501),r=f(r,n,a,s,e[u+13],5,-1444681467),s=f(s,r,n,a,e[u+2],9,-51403784),a=f(a,s,r,n,e[u+7],14,1735328473),r=p(r,n=f(n,a,s,r,e[u+12],20,-1926607734),a,s,e[u+5],4,-378558),s=p(s,r,n,a,e[u+8],11,-2022574463),a=p(a,s,r,n,e[u+11],16,1839030562),n=p(n,a,s,r,e[u+14],23,-35309556),r=p(r,n,a,s,e[u+1],4,-1530992060),s=p(s,r,n,a,e[u+4],11,1272893353),a=p(a,s,r,n,e[u+7],16,-155497632),n=p(n,a,s,r,e[u+10],23,-1094730640),r=p(r,n,a,s,e[u+13],4,681279174),s=p(s,r,n,a,e[u+0],11,-358537222),a=p(a,s,r,n,e[u+3],16,-722521979),n=p(n,a,s,r,e[u+6],23,76029189),r=p(r,n,a,s,e[u+9],4,-640364487),s=p(s,r,n,a,e[u+12],11,-421815835),a=p(a,s,r,n,e[u+15],16,530742520),r=d(r,n=p(n,a,s,r,e[u+2],23,-995338651),a,s,e[u+0],6,-198630844),s=d(s,r,n,a,e[u+7],10,1126891415),a=d(a,s,r,n,e[u+14],15,-1416354905),n=d(n,a,s,r,e[u+5],21,-57434055),r=d(r,n,a,s,e[u+12],6,1700485571),s=d(s,r,n,a,e[u+3],10,-1894986606),a=d(a,s,r,n,e[u+10],15,-1051523),n=d(n,a,s,r,e[u+1],21,-2054922799),r=d(r,n,a,s,e[u+8],6,1873313359),s=d(s,r,n,a,e[u+15],10,-30611744),a=d(a,s,r,n,e[u+6],15,-1560198380),n=d(n,a,s,r,e[u+13],21,1309151649),r=d(r,n,a,s,e[u+4],6,-145523070),s=d(s,r,n,a,e[u+11],10,-1120210379),a=d(a,s,r,n,e[u+2],15,718787259),n=d(n,a,s,r,e[u+9],21,-343485551),r=i(r,o),n=i(n,l),a=i(a,h),s=i(s,y)}return[r,n,a,s]}function y(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.Hex,r=t||n.Base64,i=h(a(e),8*e.length);switch(r){case n.Raw:return i;case n.Hex:return u(i);case n.String:return s(i);case n.Base64:return o(i)}}},343:function(e,t,r){"use strict";r.d(t,"a",(function(){return B})),r.d(t,"b",(function(){return I})),r.d(t,"c",(function(){return R}));var n=r(16),i=r(5),a=r(60),s=r(159),u=r(147),o=r(161),l=r(156),c=r(146),f=r(167),p=r(388),d=r(157),h=r(165),y=r(191),b=r(279);var v=r(214),m=(r(155),r(154),r(235),r(251)),g=r(158);r(259),r(232);function O(e){if(!("visualVariables"in e))return 0;if(!e.hasVisualVariables("size"))return 0;var t=e.getVisualVariablesForType("size");if(!t[0])return 0;var r=t[0];if("outline"===r.target)return 0;if("stops"===r.transformationType)return r.stops.map((function(e){return e.size})).reduce(j,0);if("clamped-linear"===r.transformationType){var n,i;return n="number"==typeof r.maxSize?r.maxSize:r.maxSize.stops.map((function(e){return e.size})).reduce(j,0),i="number"==typeof r.minSize?r.minSize:r.minSize.stops.map((function(e){return e.size})).reduce(j,0),Math.max(n,i)}return"real-world-size"===r.transformationType?30:void 0}g.f.metrics,new m.a(0,0,24,24);function j(e,t){return Math.max(e,t)}var x=r(303),k=r(318),w=r(293),_=l.a.getLogger("esri.views.2d.layers.features.schemaUtils"),S="ValidationError",E={esriGeometryPoint:["above-right","above-center","above-left","center-center","center-left","center-right","below-center","below-left","below-right"],esriGeometryPolygon:["always-horizontal"],esriGeometryPolyline:["center-along"],esriGeometryMultipoint:null};function R(e){var t=0,r=0,n=d.e.DEFAULT;if(Object(c.k)(e)){if(r=O(e),"visualVariables"in e&&(t=function(e){if(!e)return d.f.NONE;var t,r=0,n=Object(a.a)(e);try{for(n.s();!(t=n.n()).done;){var i=t.value;if("size"===i.type){var s=Object(b.a)(i);r|=s,"outline"===i.target&&(r|=s<<4)}else"color"===i.type?r|=d.f.COLOR:"opacity"===i.type?r|=d.f.OPACITY:"rotation"===i.type&&(r|=d.f.ROTATION)}}catch(u){n.e(u)}finally{n.f()}return r}(e.visualVariables||[]),"dot-density"===e.type&&(n=d.e.DOT_DENSITY)),"heatmap"===e.type&&(n=d.e.HEATMAP),"dictionary"===e.type)return{maxVVSize:r,vvFlags:t,symbologyType:d.e.DEFAULT};if("pie-chart"===e.type)return{maxVVSize:r,vvFlags:t,symbologyType:d.e.PIE_CHART};if(n!==d.e.DOT_DENSITY&&n!==d.e.HEATMAP){var i=e.getSymbols();"backgroundFillSymbol"in e&&e.backgroundFillSymbol&&i.push(e.backgroundFillSymbol);var s,u=!0,o=!0,l=Object(a.a)(i);try{for(l.s();!(s=l.n()).done;){var f=s.value;if("cim"===f.type&&(o=!1),"simple-fill"===f.type||"picture-fill"===f.type){var p=f.outline,h=p&&"none"!==p.style&&"solid"!==p.style,y="simple-fill"===f.type&&"none"!==f.style&&"solid"!==f.style,v="picture-fill"===f.type||y||h;h&&(u=!1),v&&(o=!1)}}}catch(m){l.e(m)}finally{l.f()}u?n=o?d.e.OUTLINE_FILL_SIMPLE:d.e.OUTLINE_FILL:o&&(n=d.e.SIMPLE)}}return{vvFlags:t,maxVVSize:r,symbologyType:n}}function F(e,t){var r=Object(o.a)(e);return r.some((function(e){return function(e,t){var r=e.labelPlacement,n=E[t];if(!e.symbol)return _.warn("No ILabelClass symbol specified."),!0;if(!n)return _.error(new s.a("mapview-labeling:unsupported-geometry-type","Unable to create labels for Feature Layer, ".concat(t," is not supported"))),!0;if(!n.includes(r)){var i=n[0];r&&_.warn("Found invalid label placement type ".concat(r," for ").concat(t,". Defaulting to ").concat(i)),e.labelPlacement=i}return!1}(e,t)}))?[]:r}function I(e){return Object(u.a)("esri-2d-update-debug")&&console.debug("Created new schema",T(e,!0)),T(e)}function T(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{var r,n,i=N(e,t),a=H(e),s={};i.map((function(t){return V(s,e,t)}));var u=Object(c.k)(e.subtypeCode)?"".concat(e.subtypeField," = ").concat(e.subtypeCode):null,o=Object(p.b)(e.definitionExpression,u);return{source:{definitionExpression:o,fields:e.fields.map((function(e){return e.toJSON()})),gdbVersion:e.gdbVersion,historicMoment:null===(r=e.historicMoment)||void 0===r?void 0:r.getTime(),outFields:e.availableFields,pixelBuffer:e.pixelBuffer,spatialReference:e.spatialReference.toJSON(),timeExtent:null===(n=e.timeExtent)||void 0===n?void 0:n.toJSON(),customParameters:e.customParameters},attributes:{fields:{},indexCount:0},processors:i,tileRenderer:a,targets:s}}catch(l){if(l.fieldName===S)return _.error(l),null;throw l}}function V(e,t,r){switch(r.target){case"feature":return void C(e,z(t),r);case"aggregate":if(!("featureReduction"in t))return;var n=t.featureReduction;switch(n.type){case"selection":throw new s.a(S,"Mapview does not support `selection` reduction type",n);case"binning":return C(e,z(t),r),void function(e,t,r){e.aggregate||(e.aggregate={name:"aggregate",type:"bin",filters:null,input:"feature",params:{fixedBinLevel:t.fixedBinLevel},attributes:{}}),q(e.aggregate,r.attributes.fields)}(e,n,r);case"cluster":return C(e,z(t),r),void function(e,t,r){e.aggregate||(e.aggregate={name:"aggregate",type:"cluster",input:"feature",filters:null,attributes:{},params:{clusterRadius:Object(f.c)(t.clusterRadius/2),clusterPixelBuffer:64*Math.ceil(Object(f.c)(t.clusterMaxSize)/64),fields:r.aggregateFields}}),q(e.aggregate,r.attributes.fields)}(e,n,r)}}}function q(e,t){for(var r in t){var n=t[r];if(n.target===e.name){var i=e.attributes[r];i?(i.context.mesh=i.context.mesh||n.context.mesh,i.context.storage=i.context.storage||n.context.storage):e.attributes[r]=n}}return e}function z(e){var t,r,n,i,a;return[null!==(t=null===(r=Object(c.q)(e.filter))||void 0===r?void 0:r.toJSON())&&void 0!==t?t:null,null!==(n=null===(i=Object(c.q)(null===(a=Object(c.q)(e.featureEffect))||void 0===a?void 0:a.filter))||void 0===i?void 0:i.toJSON())&&void 0!==n?n:null]}function C(e,t,r){return e.feature||(e.feature={name:"feature",input:"source",filters:t,attributes:{}}),q(e.feature,r.attributes.fields),e}function P(e,t){return t.field?U(e,Object(i.a)(Object(i.a)({},t),{},{type:"field",field:t.field})):t.valueExpression?U(e,Object(i.a)(Object(i.a)({},t),{},{type:"expression",valueExpression:t.valueExpression})):{field:null,fieldIndex:null}}function U(e,t){switch(t.type){case"expression":var r=t.valueExpression;if(!e.fields[r]){var n=e.indexCount++;e.fields[r]=Object(i.a)(Object(i.a)({},t),{},{name:r,fieldIndex:n})}return{fieldIndex:e.fields[r].fieldIndex};case"label-expression":var a=JSON.stringify(t.label);if(!e.fields[a]){var s=e.indexCount++;e.fields[a]=Object(i.a)(Object(i.a)({},t),{},{name:a,fieldIndex:s})}return{fieldIndex:e.fields[a].fieldIndex};case"field":var u=t.field;return"aggregate"===t.target&&e.fields[u]||(e.fields[u]=Object(i.a)(Object(i.a)({},t),{},{name:u})),{field:u};case"statistic":return e.fields[t.name]=Object(i.a)({},t),{field:t.name}}}function N(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=new Array,n=0;return r.push(M(e,n++,t)),r}function L(e,t,r,n,a){var s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],u=U(t,{type:"label-expression",target:n,context:{mesh:!0},resultType:"string",label:{labelExpression:r.labelExpression,labelExpressionInfo:r.labelExpressionInfo?{expression:r.labelExpressionInfo.expression}:null,symbol:!!r.symbol,where:r.where}}),o=u.fieldIndex,l=R(e);return Object(i.a)(Object(i.a)({},Object(v.createSymbolSchema)(r,l,s)),{},{fieldIndex:o,target:n,index:a})}function A(e,t,r){var n="featureReduction"in t&&t.featureReduction;if(!n)return{fields:[],labels:[],matcher:null,rendererOverride:null};var i=[],u=null,o=Object(w.b)(t.geometryType),l=[],c=null;if(n)switch(n.type){case"selection":throw new s.a(S,"Mapview does not support `selection` reduction type",n);case"cluster":case"binning":if("cluster"===n.type?o="esriGeometryPoint":"binning"===n.type&&(o="esriGeometryPolygon"),n.renderer){var f,p=Object(a.a)(n.fields);try{for(p.s();!(f=p.n()).done;){var d=f.value;Object(k.a)(i,d)}}catch(y){p.e(y)}finally{p.f()}c=n.renderer,u=B(null,"aggregate",n.renderer,r),l=n&&n.labelsVisible&&n.labelingInfo||[]}else if("cluster"===n.type){if(c=Object(k.c)(i,t.renderer,n,null),n.symbol){var h=R(c);u={type:"simple",symbol:Object(v.createSymbolSchema)(n.symbol,h,r),symbologyType:h.symbologyType}}l=n&&n.labelsVisible&&n.labelingInfo||[]}}return function(e,t){var r,n={mesh:!0,storage:!0},i=Object(a.a)(t);try{for(i.s();!(r=i.n()).done;){var s=r.value,u=s.name,o=s.outStatistic,l=o.statisticType,c=o.onStatisticField,f=null,p=null,d=null,h="numeric",b="feature";"onStatisticValueExpression"in o?p=U(e,{type:"expression",target:b,valueExpression:o.onStatisticValueExpression,resultType:h}).fieldIndex:"onStatisticNormalizationField"in o?(f=U(e,{type:"field",target:b,field:c,resultType:h}).field,d=o.onStatisticNormalizationField):f=U(e,{type:"field",target:b,field:c,resultType:h}).field,U(e,{type:"statistic",target:"aggregate",name:u,context:n,inField:f,inNormalizationField:d,inFieldIndex:p,statisticType:l})}}catch(y){i.e(y)}finally{i.f()}}(e,i),{labels:F(l,"binning"===n.type?"esriGeometryPolygon":o),matcher:u,fields:i,rendererOverride:c}}function M(e,t){var r,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],u={indexCount:0,fields:{}},o="featureReduction"in e&&e.featureReduction?"aggregate":"feature";if("sublayers"in e){var l=function(){var t,r={type:"subtype",subtypeField:e.subtypeField,renderers:{},symbologyType:d.e.DEFAULT},n={type:"subtype",mapping:{},target:"feature"},l={type:"subtype",classes:{}},f={type:"symbol",target:"feature",aggregateFields:[],attributes:u,storage:n,mesh:{matcher:r,aggregateMatcher:null,labels:l,sortKey:null}},p=new Set,h=0,y=Object(a.a)(e.sublayers);try{var b=function(){var e=t.value,a=e.renderer,f=e.subtypeCode,d=e.labelingInfo,y=e.labelsVisible,b=B(u,o,a,i),v=J(u,o,a),m=y&&d;if("visualVariables"in a&&a.visualVariables&&a.visualVariables.length)throw new s.a(S,"Visual variables are currently not supported for subtype layers");if("dictionary"===b.type)throw new s.a(S,"Dictionary renderer is not supported in subtype layers");if("subtype"===b.type)throw new s.a(S,"Nested subtype renderers is not supported");if(Object(c.k)(v)&&"subtype"===v.type)throw new s.a(S,"Nested subtype storage is not supported");if(Object(c.k)(v)&&Object(c.k)(v.attributeMapping))throw new s.a(S,"Non-visual-variable attributes are not supported in subtype layers");if("heatmap"===b.type)throw new s.a(S,"Heatmaps are not supported in subtype layers");if("pie-chart"===b.type)throw new s.a(S,"Pie-charts are not supported in subtype layers");if(p.has(f))throw new s.a(S,"Subtype codes for sublayers must be unique");p.add(f),r.renderers[f]=b,n.mapping[f]=v,m&&(l.classes[f]=m.map((function(e){return L(a,u,e,"feature",h++,i)})))};for(y.s();!(t=y.n()).done;)b()}catch(v){y.e(v)}finally{y.f()}return{v:f}}();if("object"===typeof l)return l.v}if("heatmap"===e.renderer.type&&"raster"===Object(x.a)()){var f=e.renderer,p=f.radius,h=f.fieldOffset,y=f.field;return{type:"heatmap",aggregateFields:[],attributes:u,target:o,storage:null,mesh:{radius:p,fieldOffset:h,field:P(u,{target:o,field:y,resultType:"numeric"}).field}}}var b=A(u,e,i),v=Object(w.b)(e.geometryType),m=null!==(r=b.rendererOverride)&&void 0!==r?r:e.renderer,g=B(u,o,m,i),O=J(u,o,m),j=D(u,e.orderBy),k=F(e.labelsVisible&&e.labelingInfo||[],v),_=0,E=[].concat(Object(n.a)(k.map((function(e){return L(m,u,e,"feature",_++,i)}))),Object(n.a)(b.labels.map((function(e){return L(m,u,e,"aggregate",_++,i)}))));return{type:"symbol",target:o,attributes:u,aggregateFields:b.fields,storage:O,mesh:{matcher:g,labels:{type:"simple",classes:E},aggregateMatcher:b.matcher,sortKey:j}}}function H(e){var t;return"heatmap"===(null===(t=e.renderer)||void 0===t?void 0:t.type)&&"raster"===Object(x.a)()?{type:"heatmap"}:{type:"symbol"}}function D(e,t){if(Object(c.j)(t)||!t.length)return null;t.length>1&&_.warn("Layer rendering currently only supports ordering by 1 orderByInfo, but found ".concat(t.length,". All but the first will be discarded"));var r=t[0],n="ascending"===r.order?"asc":"desc";return r.field?{field:r.field,order:n}:r.valueExpression?{fieldIndex:U(e,{type:"expression",target:"feature",valueExpression:r.valueExpression,resultType:"numeric"}).fieldIndex,order:n}:(_.error(new s.a(S,"Expected to find a field or valueExpression for OrderByInfo",r)),null)}function J(e,t,r){var n;switch(r.type){case"simple":case"class-breaks":case"unique-value":case"dictionary":n={visualVariables:!0,attributes:null};break;default:n=Object(y.c)(r).getStorageSpec(r)}return function(e,t,r,n){if(Object(c.j)(r))return null;var i=r.visualVariables,a=r.attributes,s=null;i&&"visualVariables"in n&&(s=function(e,t,r){if(!r||!r.length)return[];var n={storage:!0},i="numeric";return Object(x.d)(r).map((function(r){var a,s=Object(h.p)(r.type),u=P(e,{target:t,valueExpression:r.valueExpression,field:r.field,context:n,resultType:i}),o=u.field,l=u.fieldIndex;switch(r.type){case"size":return"$view.scale"===r.valueExpression?null:{type:"size",binding:s,field:o,fieldIndex:l,normalizationField:P(e,{target:t,field:r.normalizationField,context:n,resultType:i}).field,valueRepresentation:null!==(a=r.valueRepresentation)&&void 0!==a?a:null};case"color":return{type:"color",binding:s,field:o,fieldIndex:l,normalizationField:P(e,{target:t,field:r.normalizationField,context:n,resultType:i}).field};case"opacity":return{type:"opacity",binding:s,field:o,fieldIndex:l,normalizationField:P(e,{target:t,field:r.normalizationField,context:n,resultType:i}).field};case"rotation":return{type:"rotation",binding:s,field:o,fieldIndex:l}}})).filter((function(e){return e}))}(e,t,n.visualVariables));var u=Object(c.k)(s)?4:0,o=null;return Object(c.k)(a)&&(o=a.map((function(r,n){var i=P(e,{valueExpression:r.valueExpression,field:r.field,resultType:"numeric",target:t}),a=i.field,s=i.fieldIndex;return{binding:n+u,field:a,fieldIndex:s}}))),{type:"simple",target:t,attributeMapping:o,vvMapping:s}}(e,t,n,r)}function B(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=Object(c.r)(e,{indexCount:0,fields:{}});switch(r.type){case"simple":case"dot-density":return G(i,r,n);case"class-breaks":return Q(i,t,r,n);case"unique-value":return W(i,t,r,n);case"dictionary":return $(i,r,n);case"heatmap":return Z(i,r,n);case"pie-chart":return K(i,r,n)}}function G(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=t.getSymbols(),i=n.length?n[0]:null,a=R(t);return{type:"simple",symbol:Object(v.createSymbolSchema)(i,a,r),symbologyType:a.symbologyType}}function K(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=t.getSymbols(),i=n[0],a=n.length>1?n[1]:null,s=R(t);return{type:"pie-chart",markerSymbol:Object(v.createSymbolSchema)(i,s,r),fillSymbol:Object(v.createSymbolSchema)(a,s,r),symbologyType:s.symbologyType}}function Q(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i={mesh:!0,use:"renderer.field"},a=r.backgroundFillSymbol,s=P(e,{target:t,field:r.field,valueExpression:r.valueExpression,resultType:"numeric",context:i}),u=s.field,o=s.fieldIndex,l=r.normalizationType,c="log"===l?"esriNormalizeByLog":"percent-of-total"===l?"esriNormalizeByPercentOfTotal":"field"===l?"esriNormalizeByField":null,f=R(r),p=r.classBreakInfos.map((function(e){return{symbol:Object(v.createSymbolSchema)(e.symbol,f,n),min:e.minValue,max:e.maxValue}})).sort((function(e,t){return e.min-t.min}));return{type:"interval",attributes:e.fields,field:u,fieldIndex:o,backgroundFillSymbol:Object(v.createSymbolSchema)(a,f,n),defaultSymbol:Object(v.createSymbolSchema)(r.defaultSymbol,f,n),intervals:p,normalizationField:r.normalizationField,normalizationTotal:r.normalizationTotal,normalizationType:c,isMaxInclusive:r.isMaxInclusive,symbologyType:f.symbologyType}}function W(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],u=[],o=r.backgroundFillSymbol,l={target:t,context:{mesh:!0},resultType:"string"};if(r.field&&"string"!=typeof r.field)throw new s.a(S,"Expected renderer.field to be a string",r);var c,f=P(e,Object(i.a)(Object(i.a)({},l),{},{field:r.field,valueExpression:r.valueExpression})),p=f.field,d=f.fieldIndex,h=R(r),y=Object(a.a)(r.uniqueValueInfos);try{for(y.s();!(c=y.n()).done;){var b=c.value;u.push({value:""+b.value,symbol:Object(v.createSymbolSchema)(b.symbol,h,n)})}}catch(m){y.e(m)}finally{y.f()}return{type:"map",attributes:e.fields,field:p,fieldIndex:d,field2:P(e,Object(i.a)(Object(i.a)({},l),{},{field:r.field2})).field,field3:P(e,Object(i.a)(Object(i.a)({},l),{},{field:r.field3})).field,fieldDelimiter:r.fieldDelimiter,backgroundFillSymbol:Object(v.createSymbolSchema)(o,h),defaultSymbol:Object(v.createSymbolSchema)(r.defaultSymbol,h),map:u,symbologyType:h.symbologyType}}function $(e,t){var r=R(t);return{type:"dictionary",config:t.config,fieldMap:t.fieldMap,scaleExpression:t.scaleExpression,url:t.url,symbolOptions:r,symbologyType:r.symbologyType}}function Z(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=t.getSymbols(),i=n.length?n[0]:null,a=R(t);return{type:"heatmap",symbol:Object(v.createSymbolSchema)(i,a,r),symbologyType:a.symbologyType}}},354:function(e,t,r){"use strict";r.d(t,"a",(function(){return d}));var n=r(142),i=r(143),a=r(144),s=r(145),u=r(148),o=r(156),l=r(162),c=r(175),f=r(151),p=(r(152),r(147),r(150),r(149)),d=function(e){var t=function(e){Object(a.a)(r,e);var t=Object(s.a)(r);function r(){return Object(n.a)(this,r),t.apply(this,arguments)}return Object(i.a)(r,[{key:"initialize",value:function(){var e=this;this.handles.add(Object(c.b)((function(){return e.layer}),"refresh",(function(t){e.doRefresh(t.dataChanged).catch((function(t){Object(l.j)(t)||o.a.getLogger(e.declaredClass).error(t)}))})),"RefreshableLayerView")}}]),r}(e);return Object(u.a)([Object(f.b)()],t.prototype,"layer",void 0),t=Object(u.a)([Object(p.a)("esri.layers.mixins.RefreshableLayerView")],t)}},433:function(e,t,r){"use strict";function n(e){var t,r=e.layer;return"floorInfo"in r&&null!==(t=r.floorInfo)&&void 0!==t&&t.floorField&&"floors"in e.view?a(e.view.floors,r.floorInfo.floorField):null}function i(e,t){var r;return"floorInfo"in t&&null!==(r=t.floorInfo)&&void 0!==r&&r.floorField?a(e,t.floorInfo.floorField):null}function a(e,t){if(null===e||void 0===e||!e.length)return null;var r=e.filter((function(e){return""!==e})).map((function(e){return"'".concat(e,"'")}));return r.push("''"),"".concat(t," IN (").concat(r.join(","),") OR ").concat(t," IS NULL")}r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return i}))},434:function(e,t,r){"use strict";r.d(t,"a",(function(){return f})),r.d(t,"b",(function(){return l}));var n=r(16),i=r(155),a=r(154),s=r.n(a),u=r(146),o=r(238);function l(e){return c.apply(this,arguments)}function c(){return c=Object(i.a)(s.a.mark((function e(t){var r,i,a,l,c,f,p,d,h,y=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=y.length>1&&void 0!==y[1]?y[1]:t.popupTemplate,!Object(u.j)(r)){e.next=3;break}return e.abrupt("return",[]);case 3:return e.next=5,r.getRequiredFields(t.fieldsIndex);case 5:if(i=e.sent,a=r.lastEditInfoEnabled,l=t.objectIdField,c=t.typeIdField,f=t.globalIdField,p=t.relationships,!i.includes("*")){e.next=13;break}return e.abrupt("return",["*"]);case 13:if(!a){e.next=19;break}return e.next=16,Object(o.n)(t);case 16:e.t0=e.sent,e.next=20;break;case 19:e.t0=[];case 20:return d=e.t0,h=Object(o.j)(t.fieldsIndex,[].concat(Object(n.a)(i),Object(n.a)(d))),e.abrupt("return",(c&&h.push(c),h&&l&&t.fieldsIndex.has(l)&&!h.includes(l)&&h.push(l),h&&f&&t.fieldsIndex.has(f)&&!h.includes(f)&&h.push(f),p&&p.forEach((function(e){var r=e.keyField;h&&r&&t.fieldsIndex.has(r)&&!h.includes(r)&&h.push(r)})),h));case 23:case"end":return e.stop()}}),e)}))),c.apply(this,arguments)}function f(e,t){return e.popupTemplate?e.popupTemplate:Object(u.k)(t)&&t.defaultPopupTemplateEnabled&&Object(u.k)(e.defaultPopupTemplate)?e.defaultPopupTemplate:null}},600:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return Oe}));var n=r(60),i=r(5),a=r(16),s=r(155),u=r(142),o=r(143),l=r(144),c=r(145),f=r(154),p=r.n(f),d=r(148),h=r(220),y=r(151),b=(r(152),r(147)),v=(r(150),r(149)),m=function(e){Object(l.a)(r,e);var t=Object(c.a)(r);function r(){var e;return Object(u.a)(this,r),(e=t.apply(this,arguments)).isAggregate=!0,e}return Object(o.a)(r,[{key:"getEffectivePopupTemplate",value:function(){if(this.popupTemplate)return this.popupTemplate;var e=this.sourceLayer&&this.sourceLayer.featureReduction;return e&&"popupTemplate"in e&&e.popupEnabled?e.popupTemplate:null}},{key:"getObjectId",value:function(){return this.objectId}}]),r}(h.a);Object(d.a)([Object(y.b)({type:Boolean})],m.prototype,"isAggregate",void 0),Object(d.a)([Object(y.b)({type:[String,Number],json:{read:!0}})],m.prototype,"objectId",void 0);var g=m=Object(d.a)([Object(v.a)("esri.AggregateGraphic")],m),O=(r(177),r(194)),j=r(159),x=r(161),k=r(156),w=r(146),_=r(162),S=r(175),E=r(181),R=r(646),F=function(e){Object(l.a)(r,e);var t=Object(c.a)(r);function r(e){var n;return Object(u.a)(this,r),(n=t.call(this,e))._filter=null,n.duration=Object(b.a)("mapview-transitions-duration"),n._excludedEffectView=new R.a(e),n._includedEffectView=new R.a(e),n}return Object(o.a)(r,[{key:"excludedEffects",get:function(){return this._excludedEffectView.effects}},{key:"featureEffect",set:function(e){this._get("featureEffect")!==e&&this._transitionTo(e)}},{key:"filter",get:function(){var e;return this._filter||(null===(e=Object(w.q)(this.featureEffect))||void 0===e?void 0:e.filter)||null}},{key:"hasEffects",get:function(){return this._excludedEffectView.hasEffects||this._includedEffectView.hasEffects}},{key:"includedEffects",get:function(){return this._includedEffectView.effects}},{key:"scale",set:function(e){this._set("scale",e),this._excludedEffectView.scale=e,this._includedEffectView.scale=e}},{key:"transitioning",get:function(){return this._excludedEffectView.transitioning||this._includedEffectView.transitioning}},{key:"transitionStep",value:function(e,t){this._set("scale",t),this.transitioning?(this._includedEffectView.transitionStep(e,t),this._excludedEffectView.transitionStep(e,t),this.transitioning||(this._filter=null)):(this._excludedEffectView.scale=t,this._includedEffectView.scale=t)}},{key:"end",value:function(){this._includedEffectView.end(),this._excludedEffectView.end(),this._filter=null}},{key:"_transitionTo",value:function(e){var t=this._get("featureEffect"),r=Object(w.q)(e),n=Object(w.q)(null===r||void 0===r?void 0:r.includedEffect),i=Object(w.q)(null===r||void 0===r?void 0:r.excludedEffect),a=this._includedEffectView.canTransitionTo(n)&&this._excludedEffectView.canTransitionTo(i);this._includedEffectView.effect=n,this._excludedEffectView.effect=i,this._set("featureEffect",r),this._filter=(null===r||void 0===r?void 0:r.filter)||(null===t||void 0===t?void 0:t.filter)||null,a||this.end()}}]),r}(E.a);Object(d.a)([Object(y.b)()],F.prototype,"_filter",void 0),Object(d.a)([Object(y.b)()],F.prototype,"_excludedEffectView",void 0),Object(d.a)([Object(y.b)()],F.prototype,"_includedEffectView",void 0),Object(d.a)([Object(y.b)()],F.prototype,"duration",void 0),Object(d.a)([Object(y.b)()],F.prototype,"excludedEffects",null),Object(d.a)([Object(y.b)()],F.prototype,"featureEffect",null),Object(d.a)([Object(y.b)()],F.prototype,"filter",null),Object(d.a)([Object(y.b)()],F.prototype,"hasEffects",null),Object(d.a)([Object(y.b)()],F.prototype,"includedEffects",null),Object(d.a)([Object(y.b)({value:0})],F.prototype,"scale",null),Object(d.a)([Object(y.b)()],F.prototype,"transitioning",null);var I=F=Object(d.a)([Object(v.a)("esri.layers.effects.FeatureEffectView")],F),T=r(482),V=r(288),q=r(254),z=r(158),C=r(264),P=r(343);function U(e,t){return N.apply(this,arguments)}function N(){return(N=Object(s.a)(p.a.mark((function e(t,n){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",null);case 2:e.t0=t.type,e.next="symbol"===e.t0?5:"heatmap"===e.t0?10:15;break;case 5:return e.next=7,Promise.all([r.e(2),r.e(10),r.e(15),r.e(28),r.e(80)]).then(r.bind(null,1356));case 7:return e.t1=e.sent.default,e.t2=n,e.abrupt("return",new e.t1(e.t2));case 10:return e.next=12,Promise.all([r.e(2),r.e(10),r.e(15),r.e(28),r.e(100)]).then(r.bind(null,1390));case 12:return e.t3=e.sent.default,e.t4=n,e.abrupt("return",new e.t3(e.t4));case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var L=r(303),A=r(318),M=r(498);function H(e){return e.some((function(e){return e.globalId}))}function D(e){return e.filter((function(e){return!e.error})).map((function(e){var t;return null!==(t=e.objectId)&&void 0!==t?t:e.globalId}))}function J(e,t){var r,i=new Set(e),a=Object(n.a)(t.values());try{for(a.s();!(r=a.n()).done;){var s=r.value;i.add(s)}}catch(u){a.e(u)}finally{a.f()}return i}function B(e,t){var r,i=new Set(e),a=Object(n.a)(t.values());try{for(a.s();!(r=a.n()).done;){var s=r.value;i.delete(s)}}catch(u){a.e(u)}finally{a.f()}return i}var G=function(e){Object(l.a)(r,e);var t=Object(c.a)(r);function r(e){var n;return Object(u.a)(this,r),(n=t.call(this,e))._hasGlobalIds=!1,n}return Object(o.a)(r,[{key:"normalizeCtorArgs",value:function(e){return this._queueProcessor=new M.a({concurrency:1,process:e.process}),{}}},{key:"destroy",value:function(){this.clear()}},{key:"updating",get:function(){return this._queueProcessor.length>0}},{key:"clear",value:function(){this._queueProcessor.clear()}},{key:"push",value:function(e){var t=this,r=this._queueProcessor,i=r.last();switch(e.type){case"update":case"refresh":if((null===i||void 0===i?void 0:i.type)===e.type)return;r.push(e).finally((function(){return t.notifyChange("updating")}));break;case"edit":var a="processed-edit"===(null===i||void 0===i?void 0:i.type)?i:null;a&&r.popLast();var s,u=this._mergeEdits(a,e),o=Object(n.a)(u);try{for(o.s();!(s=o.n()).done;){var l=s.value;r.push(l).finally((function(){return t.notifyChange("updating")}))}}catch(c){o.e(c)}finally{o.f()}}this.notifyChange("updating")}},{key:"_mergeEdits",value:function(e,t){var r,n,i=t.edits,s=i.addedFeatures,u=i.deletedFeatures,o=i.updatedFeatures;if(this._hasGlobalIds=this._hasGlobalIds||H(s)||H(o)||H(u),this._hasGlobalIds)return[e,{type:"processed-edit",edits:{addOrModified:[].concat(Object(a.a)(s),Object(a.a)(o)),removed:u}}];var l=new Set(D(null!==(r=null===e||void 0===e?void 0:e.edits.addOrModified)&&void 0!==r?r:[])),c=new Set(D(null!==(n=null===e||void 0===e?void 0:e.edits.removed)&&void 0!==n?n:[])),f=new Set([].concat(Object(a.a)(D(s)),Object(a.a)(D(o)))),p=new Set(D(u));return[{type:"processed-edit",edits:{addOrModified:Array.from(J(B(l,p),f)).map((function(e){return{objectId:e}})),removed:Array.from(J(B(c,f),p)).map((function(e){return{objectId:e}}))}}]}}]),r}(E.a);Object(d.a)([Object(y.b)({readOnly:!0})],G.prototype,"updating",null);var K=G=Object(d.a)([Object(v.a)("esri.views.2d.layers.support.FeatureCommandQueue")],G),Q=r(283),W=r(423);function $(e){return Array.isArray(e)}var Z=function(e){Object(l.a)(r,e);var t=Object(c.a)(r);function r(e){var n;return Object(u.a)(this,r),(n=t.call(this,e))._startupResolver=Object(_.d)(),n.isReady=!1,n}return Object(o.a)(r,[{key:"initialize",value:function(){this._controller=new AbortController,this.addResolvingPromise(this._startWorker(this._controller.signal))}},{key:"destroy",value:function(){this._controller.abort(),this._connection&&this._connection.close()}},{key:"tileRenderer",set:function(e){this.client.tileRenderer=e}},{key:"closed",get:function(){return this._connection.closed}},{key:"startup",value:function(){var e=Object(s.a)(p.a.mark((function e(t,r,n,i){var a,s,u;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.when();case 2:return a=this._controller.signal,s=$(n.source)?{transferList:n.source,signal:a}:void 0,u={service:n,config:r,tileInfo:t.tileInfo.toJSON(),tiles:i},e.next=5,this._connection.invoke("startup",u,s);case 5:this._startupResolver.resolve(),this._set("isReady",!0);case 7:case"end":return e.stop()}}),e,this)})));return function(t,r,n,i){return e.apply(this,arguments)}}()},{key:"updateTiles",value:function(){var e=Object(s.a)(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",Object(_.i)(this._connection.invoke("updateTiles",t)));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"update",value:function(){var e=Object(s.a)(p.a.mark((function e(t){var r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={config:t},e.next=3,this._startupResolver.promise;case 3:return e.abrupt("return",this._connection.invoke("update",r));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"applyUpdate",value:function(){var e=Object(s.a)(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("applyUpdate",t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setHighlight",value:function(){var e=Object(s.a)(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",Object(_.i)(this._connection.invoke("controller.setHighlight",t)));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"stop",value:function(){var e=Object(s.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:if(this.closed){e.next=4;break}return e.abrupt("return",Object(_.i)(this._connection.invoke("stop")));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"refresh",value:function(){var e=Object(s.a)(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",Object(_.i)(this._connection.invoke("controller.refresh",t)));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"querySummaryStatistics",value:function(){var e=Object(s.a)(p.a.mark((function e(t,r,n){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.querySummaryStatistics",{query:t.toJSON(),params:r},n));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"queryUniqueValues",value:function(){var e=Object(s.a)(p.a.mark((function e(t,r,n){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.queryUniqueValues",{query:t.toJSON(),params:r},n));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"queryClassBreaks",value:function(){var e=Object(s.a)(p.a.mark((function e(t,r,n){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.queryClassBreaks",{query:t.toJSON(),params:r},n));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"queryHistogram",value:function(){var e=Object(s.a)(p.a.mark((function e(t,r,n){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.queryHistogram",{query:t.toJSON(),params:r},n));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"queryFeatures",value:function(){var e=Object(s.a)(p.a.mark((function e(t,r){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.queryFeatures",t.toJSON(),r));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryVisibleFeatures",value:function(){var e=Object(s.a)(p.a.mark((function e(t,r){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.queryVisibleFeatures",t.toJSON(),r));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryObjectIds",value:function(){var e=Object(s.a)(p.a.mark((function e(t,r){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.queryObjectIds",t.toJSON(),r));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryFeatureCount",value:function(){var e=Object(s.a)(p.a.mark((function e(t,r){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.queryFeatureCount",t.toJSON(),r));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryExtent",value:function(){var e=Object(s.a)(p.a.mark((function e(t,r){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._connection.invoke("controller.queryExtent",t.toJSON(),r));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryLatestObservations",value:function(){var e=Object(s.a)(p.a.mark((function e(t,r){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.queryLatestObservations",t.toJSON(),r));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryStatistics",value:function(){var e=Object(s.a)(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.queryStatistics",t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getObjectId",value:function(){var e=Object(s.a)(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.getObjectId",t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDisplayId",value:function(){var e=Object(s.a)(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.getDisplayId",t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getFeatures",value:function(){var e=Object(s.a)(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.getFeatures",t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getAggregates",value:function(){var e=Object(s.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.getAggregates"));case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getAggregateValueRanges",value:function(){var e=Object(s.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.getAggregateValueRanges"));case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"mapValidDisplayIds",value:function(){var e=Object(s.a)(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.mapValidDisplayIds",t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onEdits",value:function(){var e=Object(s.a)(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",Object(_.i)(this._connection.invoke("controller.onEdits",t)));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"enableEvent",value:function(){var e=Object(s.a)(p.a.mark((function e(t,r){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",Object(_.i)(this._connection.invoke("controller.enableEvent",{name:t,value:r})));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"pauseStream",value:function(){return Object(_.i)(this._connection.invoke("controller.pauseStream"))}},{key:"resumeStream",value:function(){return Object(_.i)(this._connection.invoke("controller.resumeStream"))}},{key:"_startWorker",value:function(){var e=Object(s.a)(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(W.b)("Pipeline",{client:this.client,strategy:"dedicated",signal:t});case 3:this._connection=e.sent,e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),Object(_.q)(e.t0);case 9:case"end":return e.stop()}}),e,this,[[0,6]])})));return function(t){return e.apply(this,arguments)}}()}]),r}(Q.a);Object(d.a)([Object(y.b)()],Z.prototype,"isReady",void 0),Object(d.a)([Object(y.b)()],Z.prototype,"client",void 0),Object(d.a)([Object(y.b)()],Z.prototype,"tileRenderer",null);var X=Z=Object(d.a)([Object(v.a)("esri.views.2d.layers.support.FeatureLayerProxy")],Z),Y=r(293),ee=r(499),te=r(241),re=function(){function e(t){Object(u.a)(this,e),this._tiles=new Map,this.buffer=0,this.acquireTile=t.acquireTile,this.releaseTile=t.releaseTile,this.tileInfoView=t.tileInfoView,this.buffer=t.buffer}return Object(o.a)(e,[{key:"destroy",value:function(){}},{key:"clear",value:function(){var e=this;this._tiles.forEach((function(t){return e._releaseTile(t)}))}},{key:"tileKeys",value:function(){var e=[];return this._tiles.forEach((function(t,r){return e.push(r)})),e}},{key:"update",value:function(e){var t,r=this,i=this.tileInfoView.getTileCoverage(e.state,this.buffer,"closest"),a=i.spans,s=i.lodInfo,u=s.level,o=[],l=[],c=new Set,f=new Set,p=Object(n.a)(a);try{for(p.s();!(t=p.n()).done;)for(var d=t.value,h=d.row,y=d.colFrom,b=d.colTo,v=y;v<=b;v++){var m=te.a.getId(u,h,s.normalizeCol(v),s.getWorldForColumn(v)),g=this._getOrAcquireTile(o,m);c.add(m),g.isReady?g.visible=!0:f.add(g.key)}}catch(O){p.e(O)}finally{p.f()}return f.forEach((function(e){return r._addPlaceholders(c,e)})),this._tiles.forEach((function(e){c.has(e.key.id)||(l.push(e.key.id),r._releaseTile(e))})),ee.a.pool.release(i),{hasMissingTiles:f.size>0,added:o,removed:l}}},{key:"_getOrAcquireTile",value:function(e,t){if(!this._tiles.has(t)){var r=this.acquireTile(new te.a(t));e.push(t),this._tiles.set(t,r),r.visible=!1}return this._tiles.get(t)}},{key:"_getTile",value:function(e){return this._tiles.get(e)}},{key:"_releaseTile",value:function(e){this._tiles.delete(e.key.id),this.releaseTile(e)}},{key:"_addPlaceholders",value:function(e,t){var r=this._addPlaceholderChildren(e,t);Math.abs(1-r)<1e-6||this._addPlaceholderParent(e,t)||(this._getTile(t.id).visible=!0)}},{key:"_addPlaceholderChildren",value:function(e,t){var r=this,n=0;return this._tiles.forEach((function(i){n+=r._addPlaceholderChild(e,i,t)})),n}},{key:"_addPlaceholderChild",value:function(e,t,r){return t.key.level<=r.level||!t.hasData||!r.contains(t.key)?0:(t.visible=!0,e.add(t.key.id),1/(1<<2*(t.key.level-r.level)))}},{key:"_addPlaceholderParent",value:function(e,t){for(var r=t.getParentKey(),n=0,i=null;Object(w.k)(r);){if(e.has(r.id))return!0;var a=this._getTile(r.id);if(null!==a&&void 0!==a&&a.isReady)return a.visible=!0,e.add(a.key.id),!0;null!==a&&void 0!==a&&a.hasData&&a.patchCount>n&&(n=a.patchCount,i=a),r=r.getParentKey()}return!!i&&(i.visible=!0,e.add(i.key.id),!0)}}]),e}(),ne=r(164),ie=r(163),ae=r(540),se=r(260),ue=r(622),oe=r(238),le=r(433),ce=r(261),fe=r(434),pe=k.a.getLogger("esri.views.layers.FeatureLayerView"),de=r(262),he=r(354),ye=r(269),be=r(176);function ve(e){return e&&"openPorts"in e}var me=k.a.getLogger("esri.views.2d.layers.FeatureLayerView2D"),ge=function(e){Object(l.a)(r,e);var t=Object(c.a)(r);function r(){var e;return Object(u.a)(this,r),(e=t.apply(this,arguments))._pipelineIsUpdating=!0,e._commandsQueue=new K({process:function(t){switch(t.type){case"processed-edit":return e._doEdit(t);case"refresh":return e._doRefresh(t.dataChanged);case"update":return e._doUpdate()}}}),e._visibilityOverrides=new Set,e._highlightIds=new Map,e._updateHighlight=Object(_.f)(Object(s.a)(p.a.mark((function t(){return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e._proxy.setHighlight(Array.from(e._highlightIds.keys())));case 1:case"end":return t.stop()}}),t)})))),e._uploadsLocked=!1,e._needsClusterSizeUpdate=!1,e.featureEffectView=new I,e._lastDefinitionExpression=null,e}return Object(o.a)(r,[{key:"destroy",value:function(){var e;Object(w.b)(this._updateClusterSizeTask,(function(e){return e.remove()})),null!==(e=this._proxy)&&void 0!==e&&e.destroy(),this._commandsQueue.destroy()}},{key:"initialize",value:function(){var e=this;this.addResolvingPromise(Promise.all([this._initProxy(),this._initServiceOptions()])),this.handles.add([this.on("valueRangesChanged",(function(t){e._set("_aggregateValueRanges",t.valueRanges)})),Object(S.e)((function(){return e.featureEffect}),(function(t){e.featureEffectView.featureEffect=t}),{initial:!0,sync:!0})])}},{key:"_initProxy",value:function(){var e=Object(s.a)(p.a.mark((function e(){var t,r,n,i;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!("isTable"in(t=this.layer))||!t.isTable){e.next=3;break}throw new j.a("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:this.layer});case 3:if(r="feature"===t.type||"subtype-group"===t.type,n="capabilities"in t&&t.capabilities.operations.supportsQuery,!r||n){e.next=6;break}throw new j.a("featurelayerview:query-not-supported","layer view requires a layer with query capability",{layer:t});case 6:return this._proxy&&this._proxy.destroy(),i=this._createClientOptions(),e.abrupt("return",(this._set("_proxy",new X({client:i})),this._proxy.when()));case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_initServiceOptions",value:function(){var e=Object(s.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,this._createServiceOptions();case 3:return e.t1=e.sent,e.t0._set.call(e.t0,"_serviceOptions",e.t1),e.abrupt("return",this._serviceOptions);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"orderByFields",get:function(){return"stream"!==this._serviceOptions.type&&this._serviceOptions.orderByFields}},{key:"labelsVisible",get:function(){var e="subtype-group"===this.layer.type?this.layer.sublayers.items:[this.layer];return!this.suspended&&e.some((function(e){return e.labelingInfo&&e.labelsVisible}))}},{key:"queryMode",get:function(){return this._serviceOptions.type}},{key:"renderingConfigHash",get:function(){if(!this.layer)return null;var e=this.availableFields,t=this.layer,r=this.view.floors,n=t.definitionExpression,i="subtype-group"!==this.layer.type&&this.layer.labelsVisible&&this.layer.labelingInfo,a="renderer"in t&&t.renderer,s="feature"===t.type?t.gdbVersion:void 0,u="feature"===t.type&&t.historicMoment?t.historicMoment.getTime():void 0,o=this.timeExtent,l="customParameters"in t?JSON.stringify(t.customParameters):void 0,c="apiKey"in t?t.apiKey:void 0,f="stream"===t.type?"".concat(JSON.stringify(t.geometryDefinition)).concat(t.definitionExpression):null,p=JSON.stringify(this.clips),d=t.featureReduction&&t.featureReduction.toJSON(),h="orderBy"in this.layer&&JSON.stringify(this.layer.orderBy),y="sublayers"in this.layer&&this.layer.sublayers.items.reduce((function(e,t){return e+"".concat(t.visible?1:0,".").concat(JSON.stringify(t.renderer),".").concat(t.labelsVisible,"\n.").concat(JSON.stringify(t.labelingInfo))}),""),b="subtypeCode"in this.layer&&this.layer.subtypeCode;return JSON.stringify({orderBy:h,sublayerHash:y,subtypeCode:b,filterHash:Object(w.k)(this.filter)&&this.filter.toJSON(),effectHash:Object(w.k)(this.featureEffect)&&this.featureEffect.toJSON(),streamFilter:f,gdbVersion:s,definitionExpression:n,historicMoment:u,availableFields:e,renderer:a,labelingInfo:i,timeExtent:o,floors:r,clipsHash:p,featureReduction:d,customParameters:l,apiKey:c})}},{key:"highlight",value:function(e){var t,r,n=this;return e instanceof h.a?r=[e.getObjectId()]:"number"==typeof e||"string"==typeof e?r=[e]:Array.isArray(e)&&e.length>0?r="number"==typeof e[0]||"string"==typeof e[0]?e:e.map((function(e){return null===e||void 0===e?void 0:e.getObjectId()})):O.a.isCollection(e)&&e.length>0&&(r=e.map((function(e){return null===e||void 0===e?void 0:e.getObjectId()})).toArray()),r=null===(t=r)||void 0===t?void 0:t.filter((function(e){return null!=e})),r&&r.length?(this._addHighlight(r),{remove:function(){return n._removeHighlight(r)}}):{remove:function(){}}}},{key:"hasHighlight",value:function(){return!!this._highlightIds.size}},{key:"hitTest",value:function(){var e=Object(s.a)(p.a.mark((function e(t,r){var n,i,s,u,o=this;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.tileRenderer){e.next=2;break}return e.abrupt("return",null);case 2:return e.next=4,this.tileRenderer.hitTest(r);case 4:if(0!==(n=e.sent).length){e.next=7;break}return e.abrupt("return",null);case 7:return e.next=9,this._proxy.getFeatures(n);case 9:return i=e.sent,s=i.features,u=i.aggregates,e.abrupt("return",[].concat(Object(a.a)(u.map((function(e){return o._createGraphicHit(t,g.fromJSON(e))}))),Object(a.a)(s.map((function(e){return o._createGraphicHit(t,h.a.fromJSON(e))})))));case 13:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryAggregates",value:function(){var e=Object(s.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._proxy.getAggregates();case 2:return e.abrupt("return",e.sent.map((function(e){return g.fromJSON(e)})));case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"queryStatistics",value:function(){return this._proxy.queryStatistics()}},{key:"querySummaryStatistics",value:function(){var e=Object(s.a)(p.a.mark((function e(t,r,n){var a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Object(i.a)(Object(i.a)({},r),{},{scale:this.view.scale}),e.abrupt("return",this._proxy.querySummaryStatistics(this._cleanUpQuery(t),a,n));case 2:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"queryUniqueValues",value:function(){var e=Object(s.a)(p.a.mark((function e(t,r,n){var a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Object(i.a)(Object(i.a)({},r),{},{scale:this.view.scale}),e.abrupt("return",this._proxy.queryUniqueValues(this._cleanUpQuery(t),a,n));case 2:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"queryClassBreaks",value:function(){var e=Object(s.a)(p.a.mark((function e(t,r,n){var a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Object(i.a)(Object(i.a)({},r),{},{scale:this.view.scale}),e.abrupt("return",this._proxy.queryClassBreaks(this._cleanUpQuery(t),a,n));case 2:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"queryHistogram",value:function(){var e=Object(s.a)(p.a.mark((function e(t,r,n){var a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Object(i.a)(Object(i.a)({},r),{},{scale:this.view.scale}),e.abrupt("return",this._proxy.queryHistogram(this._cleanUpQuery(t),a,n));case 2:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"queryFeatures",value:function(e,t){var r=this;return this.queryFeaturesJSON(e,t).then((function(e){var t=V.default.fromJSON(e);return t.features.forEach((function(e){return r._setLayersForFeature(e)})),t}))}},{key:"queryVisibleFeatures",value:function(e,t){var r=this;return this._proxy.queryVisibleFeatures(this._cleanUpQuery(e),t).then((function(e){var t=V.default.fromJSON(e);return t.features.forEach((function(e){return r._setLayersForFeature(e)})),t}))}},{key:"queryFeaturesJSON",value:function(e,t){return this._proxy.queryFeatures(this._cleanUpQuery(e),t)}},{key:"queryObjectIds",value:function(e,t){return this._proxy.queryObjectIds(this._cleanUpQuery(e),t)}},{key:"queryFeatureCount",value:function(e,t){return this._proxy.queryFeatureCount(this._cleanUpQuery(e),t)}},{key:"queryExtent",value:function(e,t){return this._proxy.queryExtent(this._cleanUpQuery(e),t).then((function(e){return{count:e.count,extent:be.a.fromJSON(e.extent)}}))}},{key:"setVisibility",value:function(e,t){t?this._visibilityOverrides.delete(e):this._visibilityOverrides.add(e),this._update()}},{key:"update",value:function(e){if(this._tileStrategy&&this.tileRenderer){var t=this._tileStrategy.update(e),r=t.hasMissingTiles,n=t.added,i=t.removed;(n.length||i.length)&&this._proxy.updateTiles({added:n,removed:i}),r&&this.requestUpdate(),this.notifyChange("updating")}}},{key:"attach",value:function(){var e=this;this.view.timeline.record("".concat(this.layer.title," (FeatureLayer) Attach")),this._tileStrategy=new re({acquireTile:function(t){return e._acquireTile(t)},releaseTile:function(t){return e._releaseTile(t)},tileInfoView:this.view.featuresTilingScheme,buffer:0}),this.handles.add(Object(S.e)((function(){return e.renderingConfigHash}),(function(){return e._update()}),S.a),"attach"),"stream"!==this.layer.type&&this.handles.add(this.layer.on("edits",(function(t){return e._edit(t)})),"attach")}},{key:"detach",value:function(){var e;this._commandsQueue.clear(),null!==(e=this._proxy)&&void 0!==e&&e.stop(),this.container.removeAllChildren(),this.handles.remove("attach"),this.tileRenderer&&(this.tileRenderer.uninstall(this.container),this.tileRenderer=null),this._tileStrategy&&(this._tileStrategy.destroy(),this._tileStrategy=null),this._tileRendererHash=null}},{key:"moveStart",value:function(){this.requestUpdate()}},{key:"viewChange",value:function(){this.requestUpdate()}},{key:"moveEnd",value:function(){this.requestUpdate()}},{key:"isUpdating",value:function(){var e,t="renderer"in this.layer&&null!=this.layer.renderer,r=this._commandsQueue.updating,n=null!=this._updatingRequiredFieldsPromise,i=!this._proxy||!this._proxy.isReady,a=this._pipelineIsUpdating,s=null==this.tileRenderer||(null===(e=this.tileRenderer)||void 0===e?void 0:e.updating),u=t&&(r||n||i||a||s);return Object(b.a)("esri-2d-log-updating")&&console.log("Updating FLV2D: ".concat(u,"\n  -> hasRenderer ").concat(t,"\n  -> hasPendingCommand ").concat(r,"\n  -> updatingRequiredFields ").concat(n,"\n  -> updatingProxy ").concat(i,"\n  -> updatingPipeline ").concat(a,"\n  -> updatingTileRenderer ").concat(s,"\n")),u}},{key:"_createClientOptions",value:function(){var e=this;return{setUpdating:function(t){e._set("_pipelineIsUpdating",t)},emitEvent:function(t){e.emit(t.name,t.event)}}}},{key:"_detectQueryMode",value:function(){var e=Object(s.a)(p.a.mark((function e(t){var r,n,i,a,s,u,o,l,c,f,d,h,y,v;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n="path"in t,i="editingInfo"in this.layer&&(null===(r=this.layer.editingInfo)||void 0===r?void 0:r.lastEditDate),a=!!this.layer.refreshInterval,s=!i&&a,!n||"feature"!==this.layer.type&&"subtype-group"!==this.layer.type||"point"!==this.layer.geometryType||!this.layer.capabilities.query.supportsPagination||this.layer.capabilities.operations.supportsEditing||s||!Object(b.a)("featurelayer-snapshot-enabled")){e.next=16;break}return e.prev=2,e.next=5,this.layer.queryFeatureCount();case 5:if(!((u=e.sent)<=Object(b.a)("featurelayer-snapshot-point-min-threshold"))){e.next=8;break}return e.abrupt("return",{mode:"snapshot",featureCount:u});case 8:if(o=Object(b.a)("featurelayer-snapshot-point-max-threshold"),l=Object(b.a)("featurelayer-snapshot-point-coverage"),c=this.view.extent,f=Object(w.q)(this.layer.fullExtent),d=null===f||void 0===f?void 0:f.clone().intersection(c),h=Object(w.k)(d)?d.width*d.height:0,y=(null===f||void 0===f?void 0:f.width)*(null===f||void 0===f?void 0:f.height),v=0===y?0:h/y,!(u<=o&&v>=l)){e.next=11;break}return e.abrupt("return",{mode:"snapshot",featureCount:u});case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(2),me.warn("mapview-feature-layer","Encountered an error when querying for featureCount",{error:e.t0});case 16:return e.abrupt("return",{mode:"on-demand"});case 17:case"end":return e.stop()}}),e,this,[[2,13]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_createServiceOptions",value:function(){var e=Object(s.a)(p.a.mark((function e(){var t,r,n,i,a,s,u,o,l,c,f,d,h,y,b,v,m,g;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("stream"!==(r=this.layer).type){e.next=3;break}return e.abrupt("return",null);case 3:if(n=r.capabilities,i=r.objectIdField,a=r.fields.map((function(e){return e.toJSON()})),s=Object(w.k)(r.fullExtent)&&r.fullExtent.toJSON(),u=Object(Y.b)(r.geometryType),o=r.timeInfo&&r.timeInfo.toJSON()||null,l=r.spatialReference?r.spatialReference.toJSON():null,c="feature"===r.type?r.globalIdField:null,"ogc-feature"!==r.type){e.next=8;break}f=r.source.getFeatureDefinition(),e.next=15;break;case 8:if(!ve(r.source)){e.next=14;break}return e.next=11,r.source.openPorts();case 11:f=e.sent,e.next=15;break;case 14:r.parsedUrl&&(f=Object(x.a)(r.parsedUrl),"dynamicDataSource"in r&&r.dynamicDataSource&&(f.query={layer:JSON.stringify({source:r.dynamicDataSource})}));case 15:return d="datesInUnknownTimezone"in this.layer&&this.layer.datesInUnknownTimezone,h=null!==(t="subtypeField"in this.layer&&this.layer.subtypeField)&&void 0!==t?t:null,e.next=19,this._detectQueryMode(f);case 19:return y=e.sent,b=y.mode,v=y.featureCount,m=this.layer.objectIdField,"feature"===this.layer.type&&Object(w.k)(this.layer.orderBy)&&this.layer.orderBy.length&&(g=!this.layer.orderBy[0].valueExpression&&this.layer.orderBy[0].field)&&(m=g),e.abrupt("return",{type:b,timeReferenceUnknownClient:d,subtypeField:h,featureCount:v,globalIdField:c,maxRecordCount:n.query.maxRecordCount,tileMaxRecordCount:n.query.tileMaxRecordCount,capabilities:n,fields:a,fullExtent:s,geometryType:u,objectIdField:i,source:f,timeInfo:o,spatialReference:l,orderByFields:m});case 25:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_createMemoryServiceOptions",value:function(){var e=Object(s.a)(p.a.mark((function e(t){var r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.openPorts();case 2:return r=e.sent,e.abrupt("return",Object(i.a)(Object(i.a)({},this._createServiceOptions()),{},{type:"memory",source:r}));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_cleanUpQuery",value:function(e){var t=q.a.from(e)||this.createQuery();return t.outSpatialReference||(t.outSpatialReference=this.view.spatialReference),t}},{key:"_update",value:function(){var e=Object(s.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._commandsQueue.push({type:"update"}));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_edit",value:function(){var e=Object(s.a)(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.suspended){e.next=2;break}return e.abrupt("return",void this._clearTiles());case 2:return e.abrupt("return",this._validateEdit(t)?this._commandsQueue.push({type:"edit",edits:t}):void 0);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"doRefresh",value:function(){var e=Object(s.a)(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._tileStrategy.tileKeys().length){e.next=2;break}return e.abrupt("return",this.suspended&&t?void this._clearTiles():this._commandsQueue.push({type:"refresh",dataChanged:t}));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_clearTiles",value:function(){this._tileStrategy.tileKeys().length&&(this._proxy.updateTiles({added:[],removed:this._tileStrategy.tileKeys()}),this._tileStrategy.clear(),this.requestUpdate(),this._commandsQueue.clear(),this._update())}},{key:"_validateEdit",value:function(e){var t="globalIdField"in this.layer&&this.layer.globalIdField,r=e.deletedFeatures.some((function(e){return-1===e.objectId||!e.objectId})),n=t&&this.availableFields.includes(t);return r&&!n?(me.error(new j.a("mapview-apply-edits","Editing the specified service requires the layer's globalIdField, ".concat(t," to be included the layer's outFields for updates to be reflected on the map"))),null):e}},{key:"_doUpdate",value:function(){var e=Object(s.a)(p.a.mark((function e(){var t,r,n,i,a,s,u,o,l,c,f,d,h;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!this.destroyed&&this._hasRequiredSupport(this.layer)&&this._tileStrategy){e.next=3;break}return e.abrupt("return");case 3:return t=this.featureEffectView,r=this.filter,e.next=6,this._updateRequiredFields();case 6:if(n=this._getEffectiveRenderer(),i=n.renderer,this._set("_effectiveRenderer",i),a=this._createSchemaConfig(),s=this._createConfiguration(a,r,t.filter),u=this._lastDefinitionExpression!==s.schema.source.definitionExpression,this._lastDefinitionExpression=s.schema.source.definitionExpression,o=s.schema.tileRenderer,l=this._createTileRendererHash(o),"snapshot"===this._serviceOptions.type&&(s.schema.source.featureCount=this._serviceOptions.featureCount),l===this._tileRendererHash){e.next=41;break}return e.next=14,this._initTileRenderer(o,i);case 14:if("stream"!==(c=this.layer).type){e.next=21;break}return e.next=18,this._initServiceOptions();case 18:e.t0=e.sent,e.next=22;break;case 21:e.t0=this._serviceOptions;case 22:if(f=e.t0,this.tileRenderer.onConfigUpdate(i),e.t1="stream"!==c.type&&ve(c.source),!e.t1){e.next=29;break}return e.next=28,c.source.openPorts();case 28:f.source=e.sent;case 29:return d={added:this._tileStrategy.tileKeys(),removed:[]},e.next=32,this._proxy.startup(this.view.featuresTilingScheme,s,f,d);case 32:if(e.t2=this.hasHighlight(),!e.t2){e.next=36;break}return e.next=36,this._proxy.setHighlight(Array.from(this._highlightIds.keys()));case 36:return e.next=38,this._onceTilesUpdated();case 38:this.tileRenderer.onConfigUpdate(i),e.next=59;break;case 41:if(e.t3="snapshot"===this._serviceOptions.type&&u,!e.t3){e.next=46;break}return e.next=45,this.layer.queryFeatureCount();case 45:s.schema.source.featureCount=e.sent;case 46:return e.next=48,this._proxy.update(s);case 48:return((h=e.sent).mesh||h.targets.aggregate)&&this._lockGPUUploads(),e.prev=50,e.next=53,this._proxy.applyUpdate(h);case 53:e.next=58;break;case 55:e.prev=55,e.t4=e.catch(50),Object(_.j)(e.t4)||me.error(e.t4);case 58:(h.mesh||h.targets.aggregate)&&this._unlockGPUUploads(),this.tileRenderer.onConfigUpdate(i),this._updateClusterSizeVariable(),this._forceAttributeTextureUpload();case 59:this._tileRendererHash=l,this.tileRenderer.invalidateLabels(),this.requestUpdate(),e.next=64;break;case 62:e.prev=62,e.t5=e.catch(0);case 64:case"end":return e.stop()}}),e,this,[[0,62],[50,55]])})));return function(){return e.apply(this,arguments)}}()},{key:"_doEdit",value:function(){var e=Object(s.a)(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._proxy.onEdits(t);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),Object(_.j)(e.t0);case 8:case"end":return e.stop()}}),e,this,[[0,5]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_doRefresh",value:function(){var e=Object(s.a)(p.a.mark((function e(t){var r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._lockGPUUploads(),e.prev=1,e.next=4,this._proxy.refresh(t);case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(1),Object(_.j)(e.t0);case 9:this._unlockGPUUploads(),(null===(r=this.layer)||void 0===r?void 0:r.featureReduction)&&this._updateClusterSizeVariable();case 10:case"end":return e.stop()}}),e,this,[[1,6]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_updateClusterSizeVariable",value:function(){this._needsClusterSizeUpdate&&(this.tileRenderer.onConfigUpdate(this._effectiveRenderer),this._needsClusterSizeUpdate=!1)}},{key:"_createUpdateClusterSizeTask",value:function(e,t){var r=this;return Object(S.e)((function(){return r._aggregateValueRanges}),(function(n){r._updateClusterEffectiveRendererSizeVariable(e,t,n),r._needsClusterSizeUpdate=!0,r._uploadsLocked||r._updateClusterSizeVariable()}))}},{key:"_updateClusterEffectiveRendererSizeVariable",value:function(){var e=Object(s.a)(p.a.mark((function e(t,r,n){var i,a,s;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.dynamicClusterSize&&"visualVariables"in t&&t.visualVariables&&(i=Object(A.d)(t.visualVariables),Object(w.k)(i)&&"cluster_count"===i.field&&(a=t.visualVariables.indexOf(i),t.visualVariables[a]=Object(A.b)(r,n),(s=t.clone()).dynamicClusterSize=!0,this._set("_effectiveRenderer",s)));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_getEffectiveRenderer",value:function(){var e="renderer"in this.layer&&this.layer.renderer,t=this.layer.featureReduction;if(Object(w.k)(this._updateClusterSizeTask)&&(this._updateClusterSizeTask.remove(),this._updateClusterSizeTask=null),t&&"renderer"in t&&t.renderer){var r,i,a=[],s=Object(n.a)(null!==(r=t.fields)&&void 0!==r?r:[]);try{for(s.s();!(i=s.n()).done;){var u=i.value;Object(A.a)(a,u)}}catch(f){s.e(f)}finally{s.f()}return{renderer:t.renderer,aggregateFields:a,featureReduction:t}}if(t&&"cluster"===t.type&&Object(A.e)(e)){var o=t,l=[],c=Object(A.c)(l,e,o,this._aggregateValueRanges);return Object(w.b)(this._updateClusterSizeTask,(function(e){return e.remove()})),this._updateClusterSizeTask=this._createUpdateClusterSizeTask(c,o),{renderer:c,aggregateFields:l,featureReduction:t}}return{renderer:e,aggregateFields:[],featureReduction:null}}},{key:"_acquireTile",value:function(e){var t=this,r=this.tileRenderer.acquireTile(e);return r.once("attach",(function(){t.requestUpdate()})),r}},{key:"_releaseTile",value:function(e){this.tileRenderer.releaseTile(e)}},{key:"_initTileRenderer",value:function(){var e=Object(s.a)(p.a.mark((function e(t,r){var n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,U(t,{layerView:this,tileInfoView:this.view.featuresTilingScheme,layer:this.layer});case 2:return n=e.sent,e.abrupt("return",(this.tileRenderer&&(this._tileStrategy.clear(),this.tileRenderer.uninstall(this.container),this.tileRenderer.destroy(),this.tileRenderer=null),this.destroyed?null:(this._proxy.tileRenderer=n,this._set("tileRenderer",n),this.tileRenderer.install(this.container),this.tileRenderer.onConfigUpdate(r),this.requestUpdate(),this.tileRenderer)));case 4:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_createTileRendererHash",value:function(e){return"".concat(e.type)}},{key:"hasFilter",get:function(){var e=!!("floorInfo"in this.layer&&this.layer.floorInfo&&this.view.floors&&this.view.floors.length);return!!this.filter||e||!!this._visibilityOverrides.size||!!this.timeExtent}},{key:"_injectOverrides",value:function(e){var t=Object(w.k)(e)?e.timeExtent:null,r=Object(w.k)(this.timeExtent)&&Object(w.k)(t)?this.timeExtent.intersection(t):this.timeExtent||t,n=null,i="floorInfo"in this.layer&&this.layer.floorInfo;if(i){var a=Object(w.k)(e)&&e.where;n=this._addFloorFilterClause(a)}if(!this._visibilityOverrides.size&&!r&&!i)return Object(w.k)(e)?e.toJSON():null;(e=Object(w.k)(e)&&e.clone()||new T.a).timeExtent=r,n&&(e.where=n);var s=e.toJSON();return s.hiddenIds=Array.from(this._visibilityOverrides),s}},{key:"_addFloorFilterClause",value:function(e){var t=this.layer,r=e||"";if("floorInfo"in t&&t.floorInfo){var n,i=this.view.floors;if(!i||!i.length)return r;(null===(n=t.floorInfo.viewAllLevelIds)||void 0===n?void 0:n.length)&&(i=t.floorInfo.viewAllLevelIds);var a=i.filter((function(e){return""!==e})).map((function(e){return"'"+e+"'"}));a.push("''");var s=t.floorInfo.floorField,u="("+s+" IN ({ids}) OR "+s+" IS NULL)";if(u=u.replace("{ids}",a.join(", ")),Object(w.k)(r)&&r.includes(s)){var o=new RegExp("AND \\("+s+".*NULL\\)","g");r=r.replace(o,""),o=new RegExp("\\("+s+".*NULL\\)","g"),r=(r=r.replace(o,"")).replace(/\s+/g," ").trim()}r=""!==r?"("+r+") AND "+u:u}return""!==r?r:null}},{key:"_createConfiguration",value:function(e,t,r){var n="feature"===this.layer.type&&this.layer.historicMoment?this.layer.historicMoment.getTime():void 0,i="feature"===this.layer.type?this.layer.gdbVersion:void 0,a=new Array(z.y),s=this._injectOverrides(t);a[0]=s,a[1]=Object(w.k)(r)?r.toJSON():null;var u=Object(P.b)(e);if(Object(w.j)(u))return null;var o=Object(ye.a)("2d");return{availableFields:this.availableFields,gdbVersion:i,historicMoment:n,devicePixelRatio:window.devicePixelRatio||1,filters:a,schema:u,supportsTextureFloat:o.supportsTextureFloat,maxTextureSize:o.maxTextureSize}}},{key:"_hasRequiredSupport",value:function(e){return!("renderer"in e)||Object(L.b)(e.renderer)}},{key:"_onceTilesUpdated",value:function(){var e=this;return this.requestUpdate(),Object(S.g)((function(){return!e._pipelineIsUpdating}))}},{key:"_lockGPUUploads",value:function(){this.tileRenderer&&(this._uploadsLocked=!0,this.tileRenderer.lockGPUUploads())}},{key:"_unlockGPUUploads",value:function(){this.tileRenderer&&(this._uploadsLocked=!1,this.tileRenderer.unlockGPUUploads())}},{key:"_forceAttributeTextureUpload",value:function(){this.tileRenderer&&this.tileRenderer.forceAttributeTextureUpload()}},{key:"_createSchemaConfig",value:function(){var e="feature"===this.layer.type?this.layer.historicMoment:null,t="feature"===this.layer.type?this.layer.gdbVersion:null;return{renderer:"renderer"in this.layer&&this.layer.renderer,spatialReference:this.layer.spatialReference,timeExtent:this.layer.timeExtent,definitionExpression:this.layer.definitionExpression,featureReduction:this.layer.featureReduction,fields:this.layer.fields,geometryType:this.layer.geometryType,historicMoment:e,labelsVisible:"labelsVisible"in this.layer&&this.layer.labelsVisible,labelingInfo:"labelingInfo"in this.layer&&this.layer.labelingInfo,availableFields:this.availableFields,featureEffect:this.featureEffect,filter:this.filter,gdbVersion:t,pixelBuffer:0,orderBy:"orderBy"in this.layer&&this.layer.orderBy?this.layer.orderBy:null,customParameters:Object(i.a)(Object(i.a)({},"customParameters"in this.layer?this.layer.customParameters:void 0),{},{token:"apiKey"in this.layer?this.layer.apiKey:void 0}),subtypeCode:"subtypeCode"in this.layer?this.layer.subtypeCode:void 0,subtypeField:"subtypeField"in this.layer?this.layer.subtypeField:void 0}}},{key:"_addHighlight",value:function(e){var t,r=Object(n.a)(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;if(this._highlightIds.has(i)){var a=this._highlightIds.get(i);this._highlightIds.set(i,a+1)}else this._highlightIds.set(i,1)}}catch(s){r.e(s)}finally{r.f()}this._updateHighlight().catch((function(e){Object(_.j)(e)||me.error(e)}))}},{key:"_removeHighlight",value:function(e){var t,r=Object(n.a)(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;if(this._highlightIds.has(i)){var a=this._highlightIds.get(i)-1;0===a?this._highlightIds.delete(i):this._highlightIds.set(i,a)}}}catch(s){r.e(s)}finally{r.f()}this._updateHighlight().catch((function(e){Object(_.j)(e)||me.error(e)}))}},{key:"_setLayersForFeature",value:function(e){var t=this.layer;e.layer=t,e.sourceLayer=t}},{key:"_createGraphicHit",value:function(e,t){return this._setLayersForFeature(t),Object(w.k)(t.geometry)&&(t.geometry.spatialReference=this.view.spatialReference),{type:"graphic",graphic:t,layer:this.layer,mapPoint:e}}}]),r}(function(e){var t=function(e){Object(l.a)(r,e);var t=Object(c.a)(r);function r(){var e;Object(u.a)(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(e=t.call.apply(t,[this].concat(i)))._updatingRequiredFieldsPromise=null,e.filter=null,e.timeExtent=null,e.layer=null,e.requiredFields=[],e.view=null,e}return Object(o.a)(r,[{key:"initialize",value:function(){var e=this;this.handles.add([Object(S.e)((function(){var t,r=e.layer;return[null===r||void 0===r||null===(t=r.elevationInfo)||void 0===t?void 0:t.featureExpressionInfo,null===r||void 0===r?void 0:r.displayField,null===r||void 0===r?void 0:r.timeInfo,r&&"renderer"in r&&r.renderer,r&&"labelingInfo"in r&&r.labelingInfo,r&&"floorInfo"in r&&r.floorInfo,e.filter,e.featureEffect,e.timeExtent]}),(function(){return e._handleRequiredFieldsChange()}),S.d),Object(S.b)((function(){var t;return null===(t=e.view)||void 0===t?void 0:t.floors}),"change",(function(){return e._handleRequiredFieldsChange()})),Object(S.b)((function(){var t=e.layer;return t&&"sublayers"in t&&t.sublayers}),"change",(function(){return e._handleRequiredFieldsChange()}))])}},{key:"availableFields",get:function(){var e=this.layer,t=this.layer.fieldsIndex,r=this.requiredFields;return"outFields"in e&&e.outFields?Object(oe.j)(t,[].concat(Object(a.a)(Object(oe.u)(t,e.outFields)),Object(a.a)(r))):Object(oe.j)(t,r)}},{key:"effect",get:function(){return Object(ae.c)(pe,"effect",{replacement:"featureEffect",version:"4.22"}),this.featureEffect},set:function(e){Object(ae.c)(pe,"effect",{replacement:"featureEffect",version:"4.22"}),this.featureEffect=e}},{key:"featureEffect",get:function(){return this.layer&&"featureEffect"in this.layer?this.layer.featureEffect:null},set:function(e){void 0!==e?this._override("featureEffect",e):this._clearOverride("featureEffect")}},{key:"maximumNumberOfFeatures",get:function(){return 0},set:function(e){pe.error("#maximumNumberOfFeatures=","Setting maximum number of features is not supported")}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return!1}},{key:"highlight",value:function(e){throw new Error("missing implementation")}},{key:"createQuery",value:function(){var e={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference},t=Object(w.k)(this.filter)?this.filter.createQuery(e):new q.a(e);if("feature"===this.layer.type){var r=Object(le.a)(this);Object(w.k)(r)&&(t.where=t.where?"(".concat(t.where,") AND (").concat(r,")"):r)}return Object(w.k)(this.timeExtent)&&(t.timeExtent=Object(w.k)(t.timeExtent)?t.timeExtent.intersection(this.timeExtent):this.timeExtent.clone()),t}},{key:"queryFeatures",value:function(e,t){throw new Error("missing implementation")}},{key:"queryObjectIds",value:function(e,t){throw new Error("missing implementation")}},{key:"queryFeatureCount",value:function(e,t){throw new Error("missing implementation")}},{key:"queryExtent",value:function(e,t){throw new Error("missing implementation")}},{key:"fetchPopupFeatures",value:function(){var e=Object(s.a)(p.a.mark((function e(t,r){var n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=this.validateFetchPopupFeatures(r))){e.next=3;break}throw n;case 3:return e.abrupt("return",this.fetchClientPopupFeatures(r));case 4:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_loadArcadeModules",value:function(e){if(e.get("expressionInfos.length")||Array.isArray(e.content)&&e.content.some((function(e){return"expression"===e.type})))return Object(ce.e)()}},{key:"_handleRequiredFieldsChange",value:function(){var e=this,t=this._updateRequiredFields();this._set("_updatingRequiredFieldsPromise",t),t.then((function(){e._updatingRequiredFieldsPromise===t&&e._set("_updatingRequiredFieldsPromise",null)}))}},{key:"_updateRequiredFields",value:function(){var e=Object(s.a)(p.a.mark((function e(){var t,r,i,a,s,u,o,l,c,f,d,h,y,b,v;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.layer&&this.view){e.next=2;break}return e.abrupt("return");case 2:return t="3d"===this.view.type,r=this.layer,i=this.layer,a=i.fieldsIndex,s=i.objectIdField,u="renderer"in r&&r.renderer,o="orderBy"in r&&r.orderBy,l=r.featureReduction,c=new Set,e.next=13,Object(_.g)([u?u.collectRequiredFields(c,a):null,Object(oe.g)(c,r),t?Object(oe.b)(c,r):null,Object(w.k)(this.filter)?Object(oe.f)(c,r,this.filter):null,Object(w.k)(this.featureEffect)?Object(oe.f)(c,r,this.featureEffect.filter):null,l?Object(oe.c)(c,r,l):null,o?Object(oe.h)(c,r,o):null]);case 13:if(f=e.sent,r.timeInfo&&this.timeExtent&&Object(oe.e)(c,r.fieldsIndex,[r.timeInfo.startField,r.timeInfo.endField]),"feature"===r.type&&r.floorInfo&&Object(oe.e)(c,r.fieldsIndex,[r.floorInfo.floorField]),"subtype-group"!==r.type){e.next=19;break}return Object(oe.d)(c,a,r.subtypeField),d=r.sublayers.map((function(e){var t;return Promise.all([null===(t=e.renderer)||void 0===t?void 0:t.collectRequiredFields(c,a),Object(oe.g)(c,e)])})),e.next=19,Object(_.g)(d);case 19:h=Object(n.a)(f);try{for(h.s();!(y=h.n()).done;)(b=y.value).error&&pe.error(b.error)}catch(p){h.e(p)}finally{h.f()}Object(oe.d)(c,a,s),t&&"displayField"in r&&r.displayField&&Object(oe.d)(c,a,r.displayField),v=Array.from(c).sort(),this._set("requiredFields",v);case 24:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"validateFetchPopupFeatures",value:function(e){if(Object(w.j)(e))return null;var t,r=Object(n.a)(e.clientGraphics);try{for(r.s();!(t=r.n()).done;){var i=t.value,a=i.layer;if("popupEnabled"in a&&!a.popupEnabled)return new j.a("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:a});if(i.isAggregate){if(!(a.featureReduction&&"popupTemplate"in a.featureReduction&&a.featureReduction.popupEnabled&&a.featureReduction.popupTemplate))return new j.a("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:a})}else if("popupTemplate"in a&&!Object(fe.a)(a,e))return new j.a("featurelayerview:fetchPopupFeatures","Layer does not define a popup template",{layer:a})}}catch(s){r.e(s)}finally{r.f()}}},{key:"fetchClientPopupFeatures",value:function(){var e=Object(s.a)(p.a.mark((function e(t){var r,i,a,s,u,o,l,c,f,d,h,y,b,v;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=Object(w.k)(t)?t.clientGraphics:null)&&0!==r.length){e.next=3;break}return e.abrupt("return",[]);case 3:return i=new Array(r.length),a=new Map,e.next=7,this.createPopupQuery(t);case 7:s=e.sent,u=0;case 9:if(!(u<r.length)){e.next=27;break}if(!(o=r[u]).isAggregate){e.next=14;break}return i[u]=o,e.abrupt("continue",24);case 14:if("popupEnabled"in(l=o.layer)){e.next=17;break}return e.abrupt("continue",24);case 17:if(c=Object(oe.u)(this.layer.fieldsIndex,s.outFields),f=Object(fe.a)(l,t),!Object(w.j)(f)){e.next=20;break}return e.abrupt("continue",24);case 20:return e.next=22,this._loadArcadeModules(f);case 22:(d=e.sent)&&d.arcadeUtils.hasGeometryOperations(f)||!Object(oe.i)(c,o)?a.set(o.getObjectId(),u):i[u]=o;case 24:u++,e.next=9;break;case 27:if("stream"!==this.layer.type&&0!==a.size){e.next=29;break}return e.abrupt("return",i.filter(Boolean));case 29:return s.objectIds=Array.from(a.keys()),e.prev=30,e.next=33,this.layer.queryFeatures(s);case 33:h=e.sent,y=Object(n.a)(h.features);try{for(y.s();!(b=y.n()).done;)v=b.value,i[a.get(v.getObjectId())]=v}catch(p){y.e(p)}finally{y.f()}e.next=40;break;case 38:e.prev=38,e.t0=e.catch(30);case 40:return e.abrupt("return",i.filter(Boolean));case 41:case"end":return e.stop()}}),e,this,[[30,38]])})));return function(t){return e.apply(this,arguments)}}()},{key:"createPopupQuery",value:function(){var e=Object(s.a)(p.a.mark((function e(t){var r,i,a,s,u,o,l,c,f,d,h,y,b,v,m;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=this.layer.createQuery(),i=new Set,a=!1,s=Object(w.k)(t)&&t.clientGraphics?t.clientGraphics.map((function(e){return e.layer})):[this.layer],u=Object(n.a)(s),e.prev=4,u.s();case 6:if((o=u.n()).done){e.next=25;break}if("popupEnabled"in(l=o.value)){e.next=10;break}return e.abrupt("continue",23);case 10:if(c=Object(fe.a)(l,t),!Object(w.j)(c)){e.next=13;break}return e.abrupt("continue",23);case 13:return e.next=15,this._loadArcadeModules(c);case 15:return f=e.sent,d=f&&f.arcadeUtils.hasGeometryOperations(c),a=!("point"!==this.layer.geometryType&&!d),e.next=20,Object(fe.b)(this.layer,c);case 20:h=e.sent,y=Object(n.a)(h);try{for(y.s();!(b=y.n()).done;)v=b.value,i.add(v)}catch(p){y.e(p)}finally{y.f()}case 23:e.next=6;break;case 25:e.next=30;break;case 27:e.prev=27,e.t0=e.catch(4),u.e(e.t0);case 30:return e.prev=30,u.f(),e.finish(30);case 33:return r.returnGeometry=a,r.returnZ=a,r.returnM=a,r.outFields=Array.from(i),r.outSpatialReference=this.view.spatialReference,"feature"===this.layer.type&&(m=Object(le.a)(this),Object(w.k)(m)&&(r.where=r.where?"(".concat(r.where,") AND (").concat(m,")"):m)),e.abrupt("return",r);case 35:case"end":return e.stop()}}),e,this,[[4,27,30,33]])})));return function(t){return e.apply(this,arguments)}}()},{key:"canResume",value:function(){return!!Object(ne.a)(Object(ie.a)(r.prototype),"canResume",this).call(this)&&(!Object(w.k)(this.timeExtent)||!this.timeExtent.isEmpty)}}]),r}(e);return Object(d.a)([Object(y.b)()],t.prototype,"_updatingRequiredFieldsPromise",void 0),Object(d.a)([Object(y.b)({readOnly:!0})],t.prototype,"availableFields",null),Object(d.a)([Object(y.b)()],t.prototype,"effect",null),Object(d.a)([Object(y.b)({type:ue.a})],t.prototype,"featureEffect",null),Object(d.a)([Object(y.b)({type:T.a})],t.prototype,"filter",void 0),Object(d.a)([Object(y.b)(se.a)],t.prototype,"timeExtent",void 0),Object(d.a)([Object(y.b)()],t.prototype,"layer",void 0),Object(d.a)([Object(y.b)({type:Number})],t.prototype,"maximumNumberOfFeatures",null),Object(d.a)([Object(y.b)({readOnly:!0,type:Boolean})],t.prototype,"maximumNumberOfFeaturesExceeded",null),Object(d.a)([Object(y.b)({readOnly:!0})],t.prototype,"requiredFields",void 0),Object(d.a)([Object(y.b)()],t.prototype,"suspended",void 0),Object(d.a)([Object(y.b)()],t.prototype,"view",void 0),t=Object(d.a)([Object(v.a)("esri.views.layers.FeatureLayerView")],t),t}(Object(he.a)(Object(C.a)(de.a))));Object(d.a)([Object(y.b)()],ge.prototype,"_serviceOptions",void 0),Object(d.a)([Object(y.b)()],ge.prototype,"_proxy",void 0),Object(d.a)([Object(y.b)()],ge.prototype,"_pipelineIsUpdating",void 0),Object(d.a)([Object(y.b)()],ge.prototype,"_effectiveRenderer",void 0),Object(d.a)([Object(y.b)()],ge.prototype,"_aggregateValueRanges",void 0),Object(d.a)([Object(y.b)()],ge.prototype,"_commandsQueue",void 0),Object(d.a)([Object(y.b)()],ge.prototype,"featureEffectView",void 0),Object(d.a)([Object(y.b)()],ge.prototype,"labelsVisible",null),Object(d.a)([Object(y.b)({readOnly:!0})],ge.prototype,"queryMode",null),Object(d.a)([Object(y.b)()],ge.prototype,"renderingConfigHash",null),Object(d.a)([Object(y.b)()],ge.prototype,"tileRenderer",void 0),Object(d.a)([Object(y.b)()],ge.prototype,"updating",void 0);var Oe=ge=Object(d.a)([Object(v.a)("esri.views.2d.layers.FeatureLayerView2D")],ge)}}]);
//# sourceMappingURL=72.d06ca7cb.chunk.js.map