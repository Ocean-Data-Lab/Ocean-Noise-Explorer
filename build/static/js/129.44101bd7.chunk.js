(this["webpackJsonpmatx-react-pro"]=this["webpackJsonpmatx-react-pro"]||[]).push([[129],{1328:function(e,t,a){"use strict";a.r(t),a.d(t,"registerFunctions",(function(){return W}));var n=a(60),r=a(155),i=a(154),c=a.n(i),s=a(631),l=a(412),u=a(521),o=a(1041),f=a(1224),b=a(624),d=a(548),p=a(338),m=a(1043),y=a(885),h=a(887),x=a(1045),O=a(889),j=a(1046),g=a(888),v=a(375),k=a(526),w=a(847),F=a(162),I=a(433),E=a(404),D=a(356);function N(e,t,a,n){if(1===n.length){if(Object(p.N)(n[0]))return Object(w.a)(e,n[0],-1);if(Object(p.P)(n[0]))return Object(w.a)(e,n[0].toArray(),-1)}return Object(w.a)(e,n,-1)}function A(e,t,a){return S.apply(this,arguments)}function S(){return(S=Object(r.a)(c.a.mark((function e(t,a,n){var r,i,s,l,u,o;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((r=t.getVariables()).length>0)){e.next=17;break}i=[],s=0;case 4:if(!(s<r.length)){e.next=14;break}return l={name:r[s]},e.t0=i,e.next=9,a.evaluateIdentifier(n,l);case 9:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 11:s++,e.next=4;break;case 14:for(u={},o=0;o<r.length;o++)u[r[o]]=i[o];return e.abrupt("return",(t.parameters=u,t));case 17:return e.abrupt("return",t);case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;for(var n in e)if(n.toLowerCase()===t.toLowerCase())return e[n];return a}function C(e){if(null===e)return null;var t={type:T(e,"type",""),name:T(e,"name","")};if("range"===t.type)t.range=T(e,"range",[]);else{t.codedValues=[];var a,r=Object(n.a)(T(e,"codedValues",[]));try{for(r.s();!(a=r.n()).done;){var i=a.value;t.codedValues.push({name:T(i,"name",""),code:T(i,"code",null)})}}catch(c){r.e(c)}finally{r.f()}}return t}function R(e){if(null===e)return null;var t={},a=T(e,"wkt",null);null!==a&&(t.wkt=a);var n=T(e,"wkid",null);return null!==n&&(t.wkid=n),t}function L(e){if(null===e)return null;var t={hasZ:T(e,"hasz",!1),hasM:T(e,"hasm",!1)},a=T(e,"spatialreference",null);a&&(t.spatialReference=R(a));var n=T(e,"x",null);if(null!==n)return t.x=n,t.y=T(e,"y",null),t;var r=T(e,"rings",null);if(null!==r)return t.rings=r,t;var i=T(e,"paths",null);if(null!==i)return t.paths=i,t;var c=T(e,"points",null);if(null!==c)return t.points=c,t;for(var s=0,l=["xmin","xmax","ymin","ymax","zmin","zmax","mmin","mmax"];s<l.length;s++){var u=l[s],o=T(e,u,null);null!==o&&(t[u]=o)}return t}function P(e){return!!e.layerDefinition&&!!e.featureSet&&!1!==function(e,t){var a,r=Object(n.a)(t);try{for(r.s();!(a=r.n()).done;)if(a.value===e)return!0}catch(i){r.e(i)}finally{r.f()}return!1}(e.layerDefinition.geometryType,["","esriGeometryPoint","esriGeometryPolyline","esriGeometryPolygon","esriGeometryMultipoint","esriGeometryEnvelope"])&&null!==e.layerDefinition.objectIdField&&""!==e.layerDefinition.objectIdField&&!1!==Object(p.N)(e.layerDefinition.fields)&&!1!==Object(p.N)(e.featureSet.features)}function W(e){"async"===e.mode&&(e.functions.getuser=function(t,a){return e.standardFunctionAsync(t,a,function(){var e=Object(r.a)(c.a.mark((function e(a,n,r){var i,u,o,b,d,m,y,h,x,O,j,g,v,k,w,F,I;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(p.R)(r,1,2),i=Object(p.d)(r[1],""),u=!0===i,i=!0===i||!1===i?"":Object(p.J)(i),!(r[0]instanceof s.a)){e.next=13;break}return o=null,t.services&&t.services.portal&&(o=t.services.portal),o=Object(f.getPortal)(r[0],o),e.next=7,Object(f.lookupUser)(o,i,u);case 7:if(!(b=e.sent)){e.next=12;break}for(d=JSON.parse(JSON.stringify(b)),m=0,y=["lastLogin","created","modified"];m<y.length;m++)void 0!==d[h=y[m]]&&null!==d[h]&&(d[h]=new Date(d[h]));return e.abrupt("return",l.a.convertObjectToArcadeDictionary(d));case 12:case 28:case 38:return e.abrupt("return",null);case 13:if(x=null,Object(p.ab)(r[0])&&(x=r[0]),!x){e.next=39;break}if(u=!1,!i){e.next=17;break}return e.abrupt("return",null);case 17:return e.next=19,x.load();case 19:return e.next=21,x.getOwningSystemUrl();case 21:if(O=e.sent){e.next=29;break}if(i){e.next=28;break}return e.next=26,x.getIdentityUser();case 26:return j=e.sent,e.abrupt("return",j?l.a.convertObjectToArcadeDictionary({username:j}):null);case 29:return g=null,t.services&&t.services.portal&&(g=t.services.portal),g=Object(f.getPortal)(new s.a(O),g),e.next=33,Object(f.lookupUser)(g,i,u);case 33:if(!(v=e.sent)){e.next=38;break}for(k=JSON.parse(JSON.stringify(v)),w=0,F=["lastLogin","created","modified"];w<F.length;w++)void 0!==k[I=F[w]]&&null!==k[I]&&(k[I]=new Date(k[I]));return e.abrupt("return",l.a.convertObjectToArcadeDictionary(k));case 39:throw new Error("Invalid Parameter");case 40:case"end":return e.stop()}}),e)})));return function(t,a,n){return e.apply(this,arguments)}}())},e.signatures.push({name:"getuser",min:"1",max:"2"}),e.functions.featuresetbyid=function(t,a){return e.standardFunctionAsync(t,a,(function(e,t,a){if(Object(p.R)(a,2,4),a[0]instanceof o.a){var n=Object(p.J)(a[1]),r=Object(p.d)(a[2],null),i=Object(p.I)(Object(p.d)(a[3],!0));if(null===r&&(r=["*"]),!1===Object(p.N)(r))throw new Error("Invalid Parameter");return a[0].featureSetById(n,i,r)}throw new Error("Invalid Parameter")}))},e.signatures.push({name:"featuresetbyid",min:"2",max:"4"}),e.functions.getfeatureset=function(t,a){return e.standardFunctionAsync(t,a,(function(e,a,n){if(Object(p.R)(n,1,2),Object(p.U)(n[0])){var r=Object(p.d)(n[1],"datasource");return null===r&&(r="datasource"),r=Object(p.J)(r).toLowerCase(),Object(f.convertToFeatureSet)(n[0].fullSchema(),r,t.lrucache,t.interceptor,t.spatialReference)}throw new Error("Invalid Parameter")}))},e.signatures.push({name:"getfeatureset",min:"1",max:"2"}),e.functions.featuresetbyportalitem=function(t,a){return e.standardFunctionAsync(t,a,(function(e,a,n){if(Object(p.R)(n,2,5),null===n[0])throw new Error("Portal is required");if(n[0]instanceof s.a){var r=Object(p.J)(n[1]),i=Object(p.J)(n[2]),c=Object(p.d)(n[3],null),l=Object(p.I)(Object(p.d)(n[4],!0));if(null===c&&(c=["*"]),!1===Object(p.N)(c))throw new Error("Invalid Parameter");var u=null;return t.services&&t.services.portal&&(u=t.services.portal),u=Object(f.getPortal)(n[0],u),Object(f.constructFeatureSetFromPortalItem)(r,i,t.spatialReference,c,l,u,t.lrucache,t.interceptor)}if(!1===Object(p.D)(n[0]))throw new Error("Portal is required");var o=Object(p.J)(n[0]),b=Object(p.J)(n[1]),d=Object(p.d)(n[2],null),m=Object(p.I)(Object(p.d)(n[3],!0));if(null===d&&(d=["*"]),!1===Object(p.N)(d))throw new Error("Invalid Parameter");if(t.services&&t.services.portal)return Object(f.constructFeatureSetFromPortalItem)(o,b,t.spatialReference,d,m,t.services.portal,t.lrucache,t.interceptor);throw new Error("Portal is required")}))},e.signatures.push({name:"featuresetbyportalitem",min:"2",max:"5"}),e.functions.featuresetbyname=function(t,a){return e.standardFunctionAsync(t,a,(function(e,t,a){if(Object(p.R)(a,2,4),a[0]instanceof o.a){var n=Object(p.J)(a[1]),r=Object(p.d)(a[2],null),i=Object(p.I)(Object(p.d)(a[3],!0));if(null===r&&(r=["*"]),!1===Object(p.N)(r))throw new Error("Invalid Parameter");return a[0].featureSetByName(n,i,r)}throw new Error("Invalid Parameter")}))},e.signatures.push({name:"featuresetbyname",min:"2",max:"4"}),e.functions.featureset=function(t,a){return e.standardFunction(t,a,(function(e,a,r){Object(p.R)(r,1,1);var i=r[0],c={layerDefinition:{geometryType:"",objectIdField:"",globalIdField:"",typeIdField:"",fields:[]},featureSet:{geometryType:"",features:[]}};if(Object(p.D)(i))void 0!==(i=JSON.parse(i)).layerDefinition?(c.layerDefinition=i.layerDefinition,c.featureSet=i.featureSet,i.layerDefinition.spatialReference&&(c.layerDefinition.spatialReference=i.layerDefinition.spatialReference)):(c.featureSet.features=i.features,c.featureSet.geometryType=i.geometryType,c.layerDefinition.geometryType=c.featureSet.geometryType,c.layerDefinition.objectIdField=i.objectIdFieldName,c.layerDefinition.typeIdField=i.typeIdFieldName,c.layerDefinition.globalIdField=i.globalIdFieldName,c.layerDefinition.fields=i.fields,i.spatialReference&&(c.layerDefinition.spatialReference=i.spatialReference));else{if(!(r[0]instanceof l.a))throw new Error("Invalid Parameter");var s=T(i=JSON.parse(r[0].castToText()),"layerdefinition");if(null!==s){c.layerDefinition.geometryType=T(s,"geometrytype",""),c.featureSet.geometryType=c.layerDefinition.geometryType,c.layerDefinition.globalIdField=T(s,"globalidfield",""),c.layerDefinition.objectIdField=T(s,"objectidfield",""),c.layerDefinition.typeIdField=T(s,"typeidfield","");var u=T(s,"spatialreference",null);u&&(c.layerDefinition.spatialReference=R(u));var o,f=Object(n.a)(T(s,"fields",[]));try{for(f.s();!(o=f.n()).done;){var b=o.value,d={name:T(b,"name",""),alias:T(b,"alias",""),type:T(b,"type",""),nullable:T(b,"nullable",!0),editable:T(b,"editable",!0),length:T(b,"length",null),domain:C(T(b,"domain"))};c.layerDefinition.fields.push(d)}}catch(q){f.e(q)}finally{f.f()}var m=T(i,"featureset",null);if(m){var y,h={},x=Object(n.a)(c.layerDefinition.fields);try{for(x.s();!(y=x.n()).done;){var O=y.value;h[O.name.toLowerCase()]=O.name}}catch(q){x.e(q)}finally{x.f()}var g,v=Object(n.a)(T(m,"features",[]));try{for(v.s();!(g=v.n()).done;){var k=g.value,w={},F=T(k,"attributes",{});for(var I in F)w[h[I.toLowerCase()]]=F[I];c.featureSet.features.push({attributes:w,geometry:L(T(k,"geometry",null))})}}catch(q){v.e(q)}finally{v.f()}}}else{c.layerDefinition.geometryType=T(i,"geometrytype",""),c.featureSet.geometryType=c.layerDefinition.geometryType,c.layerDefinition.objectIdField=T(i,"objectidfieldname",""),c.layerDefinition.typeIdField=T(i,"typeidfieldname","");var E=T(i,"spatialreference",null);E&&(c.layerDefinition.spatialReference=R(E));var D,N=Object(n.a)(T(i,"fields",[]));try{for(N.s();!(D=N.n()).done;){var A=D.value,S={name:T(A,"name",""),alias:T(A,"alias",""),type:T(A,"type",""),nullable:T(A,"nullable",!0),editable:T(A,"editable",!0),length:T(A,"length",null),domain:C(T(A,"domain"))};c.layerDefinition.fields.push(S)}}catch(q){N.e(q)}finally{N.f()}var W,M={},J=Object(n.a)(c.layerDefinition.fields);try{for(J.s();!(W=J.n()).done;){var H=W.value;M[H.name.toLowerCase()]=H.name}}catch(q){J.e(q)}finally{J.f()}var G,B=Object(n.a)(T(i,"features",[]));try{for(B.s();!(G=B.n()).done;){var V=G.value,z={},U=T(V,"attributes",{});for(var _ in U)z[M[_.toLowerCase()]]=U[_];c.featureSet.features.push({attributes:z,geometry:L(T(V,"geometry",null))})}}catch(q){B.e(q)}finally{B.f()}}}if(!1===P(c))throw new Error("Invalid Parameter");return j.a.create(c,t.spatialReference)}))},e.signatures.push({name:"featureset",min:"1",max:"1"}),e.functions.filter=function(t,a){return e.standardFunctionAsync(t,a,function(){var a=Object(r.a)(c.a.mark((function a(r,i,s){var l,u,o,f,m,h,x,O,j,g,v,k,w,E,D;return c.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(Object(p.R)(s,2,2),!Object(p.N)(s[0])&&!Object(p.P)(s[0])){a.next=44;break}if(l=[],(u=s[0])instanceof d.a&&(u=u.toArray()),o=null,!(s[1]instanceof b.a)){a.next=9;break}o=e.arcadeCustomFunctionHandler(s[1]),a.next=16;break;case 9:if(!(s[1]instanceof p.o)){a.next=13;break}o=function(){for(var e=arguments.length,a=new Array(e),n=0;n<e;n++)a[n]=arguments[n];return s[1].fn(t,{preparsed:!0,arguments:a})},a.next=16;break;case 13:if(s[1]instanceof p.t){a.next=15;break}throw new Error("Invalid Parameter");case 15:o=function(){var e;if(arguments.length!==s[1].paramCount)throw new Error("Invalid parameters");return(e=s[1]).fn.apply(e,arguments)};case 16:f=Object(n.a)(u),a.prev=17,f.s();case 19:if((m=f.n()).done){a.next=35;break}if(h=m.value,x=o(h),!Object(F.l)(x)){a.next=32;break}return a.t0=!0,a.next=26,x;case 26:if(a.t1=a.sent,a.t2=a.t0===a.t1,!a.t2){a.next=30;break}l.push(h);case 30:a.next=33;break;case 32:!0===x&&l.push(h);case 33:a.next=19;break;case 35:a.next=40;break;case 37:a.prev=37,a.t3=a.catch(17),f.e(a.t3);case 40:return a.prev=40,f.f(),a.finish(40);case 43:return a.abrupt("return",l);case 44:if(!Object(p.ab)(s[0])){a.next=67;break}return a.next=47,s[0].load();case 47:if(O=a.sent,j=I.WhereClause.create(s[1],O.getFieldsIndex()),!((g=j.getVariables()).length>0)){a.next=66;break}v=[],k=0;case 53:if(!(k<g.length)){a.next=63;break}return w={name:g[k]},a.t4=v,a.next=58,e.evaluateIdentifier(t,w);case 58:a.t5=a.sent,a.t4.push.call(a.t4,a.t5);case 60:k++,a.next=53;break;case 63:for(E={},D=0;D<g.length;D++)E[g[D]]=v[D];return a.abrupt("return",(j.parameters=E,new y.a({parentfeatureset:s[0],whereclause:j})));case 66:return a.abrupt("return",new y.a({parentfeatureset:s[0],whereclause:j}));case 67:throw new Error("Filter cannot accept this parameter type");case 68:case"end":return a.stop()}}),a,null,[[17,37,40,43]])})));return function(e,t,n){return a.apply(this,arguments)}}())},e.signatures.push({name:"filter",min:"2",max:"2"}),e.functions.orderby=function(t,a){return e.standardFunctionAsync(t,a,function(){var e=Object(r.a)(c.a.mark((function e(t,a,n){var r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(p.R)(n,2,2),!Object(p.ab)(n[0])){e.next=3;break}return r=new g.a(n[1]),e.abrupt("return",new h.a({parentfeatureset:n[0],orderbyclause:r}));case 3:throw new Error("Order cannot accept this parameter type");case 4:case"end":return e.stop()}}),e)})));return function(t,a,n){return e.apply(this,arguments)}}())},e.signatures.push({name:"orderby",min:"2",max:"2"}),e.functions.top=function(t,a){return e.standardFunctionAsync(t,a,function(){var e=Object(r.a)(c.a.mark((function e(t,a,n){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(p.R)(n,2,2),!Object(p.ab)(n[0])){e.next=2;break}return e.abrupt("return",new x.a({parentfeatureset:n[0],topnum:n[1]}));case 2:if(!Object(p.N)(n[0])){e.next=4;break}return e.abrupt("return",Object(p.H)(n[1])>=n[0].length?n[0].slice(0):n[0].slice(0,Object(p.H)(n[1])));case 4:if(!Object(p.P)(n[0])){e.next=6;break}return e.abrupt("return",Object(p.H)(n[1])>=n[0].length()?n[0].slice(0):n[0].slice(0,Object(p.H)(n[1])));case 6:throw new Error("Top cannot accept this parameter type");case 7:case"end":return e.stop()}}),e)})));return function(t,a,n){return e.apply(this,arguments)}}())},e.signatures.push({name:"top",min:"2",max:"2"}),e.functions.first=function(t,a){return e.standardFunctionAsync(t,a,function(){var e=Object(r.a)(c.a.mark((function e(t,a,n){var r,i;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(p.R)(n,1,1),!Object(p.ab)(n[0])){e.next=8;break}return e.next=3,n[0].first(t.abortSignal);case 3:if(null===(r=e.sent)){e.next=7;break}return i=u.a.createFromGraphicLikeObject(r.geometry,r.attributes,n[0]),e.abrupt("return",(i._underlyingGraphic=r,i));case 7:return e.abrupt("return",r);case 8:return e.abrupt("return",Object(p.N)(n[0])?0===n[0].length?null:n[0][0]:Object(p.P)(n[0])?0===n[0].length()?null:n[0].get(0):null);case 9:case"end":return e.stop()}}),e)})));return function(t,a,n){return e.apply(this,arguments)}}())},e.signatures.push({name:"first",min:"1",max:"1"}),e.functions.attachments=function(t,a){return e.standardFunctionAsync(t,a,function(){var e=Object(r.a)(c.a.mark((function e(a,n,r){var i,s,u;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(p.R)(r,1,2),i={minsize:-1,maxsize:-1,types:null,returnMetadata:!1},!(r.length>1)){e.next=9;break}if(!(r[1]instanceof l.a)){e.next=7;break}r[1].hasField("minsize")&&(i.minsize=Object(p.H)(r[1].field("minsize"))),r[1].hasField("metadata")&&(i.returnMetadata=Object(p.I)(r[1].field("metadata"))),r[1].hasField("maxsize")&&(i.maxsize=Object(p.H)(r[1].field("maxsize"))),r[1].hasField("types")&&(s=Object(p.z)(r[1].field("types"),!1)).length>0&&(i.types=s),e.next=9;break;case 7:if(null===r[1]){e.next=9;break}throw new Error("Invalid Parameter");case 9:if(!Object(p.U)(r[0])){e.next=25;break}if((u=r[0]._layer)instanceof E.default&&(u=Object(f.constructFeatureSet)(u,t.spatialReference,["*"],!0,t.lrucache,t.interceptor)),null!==u){e.next=16;break}e.t0=[],e.next=24;break;case 16:if(!1!==Object(p.ab)(u)){e.next=20;break}e.t1=[],e.next=23;break;case 20:return e.next=22,u.load();case 22:e.t1=u.queryAttachments(r[0].field(u.objectIdField),i.minsize,i.maxsize,i.types,i.returnMetadata);case 23:e.t0=e.t1;case 24:return e.abrupt("return",e.t0);case 25:if(null!==r[0]){e.next=27;break}return e.abrupt("return",[]);case 27:throw new Error("Invalid Parameter");case 28:case"end":return e.stop()}}),e)})));return function(t,a,n){return e.apply(this,arguments)}}())},e.signatures.push({name:"attachments",min:"1",max:"2"}),e.functions.featuresetbyrelationshipname=function(t,a){return e.standardFunctionAsync(t,a,function(){var e=Object(r.a)(c.a.mark((function e(a,n,r){var i,s,l,u,o,b,d,m,y,h,x,j;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(p.R)(r,2,4),i=r[0],s=Object(p.J)(r[1]),l=Object(p.d)(r[2],null),u=Object(p.I)(Object(p.d)(r[3],!0)),null===l&&(l=["*"]),!1!==Object(p.N)(l)){e.next=6;break}throw new Error("Invalid Parameter");case 6:if(null!==r[0]){e.next=8;break}return e.abrupt("return",null);case 8:if(Object(p.U)(r[0])){e.next=10;break}throw new Error("Invalid Parameter");case 10:if((o=i._layer)instanceof E.default&&(o=Object(f.constructFeatureSet)(o,t.spatialReference,["*"],!0,t.lrucache,t.interceptor)),null!==o){e.next=13;break}return e.abrupt("return",null);case 13:if(!1!==Object(p.ab)(o)){e.next=15;break}return e.abrupt("return",null);case 15:return e.next=17,o.load();case 17:if(o=e.sent,b=o.relationshipMetaData().filter((function(e){return e.name===s})),0!==b.length){e.next=21;break}return e.abrupt("return",null);case 21:if(!(void 0!==b[0].relationshipTableId&&null!==b[0].relationshipTableId&&b[0].relationshipTableId>-1)){e.next=23;break}return e.abrupt("return",Object(f.constructFeatureSetFromRelationship)(o,b[0],i.field(o.objectIdField),o.spatialReference,l,u,t.lrucache,t.interceptor));case 23:if(d=o.serviceUrl()){e.next=26;break}return e.abrupt("return",null);case 26:return d="/"===d.charAt(d.length-1)?d+b[0].relatedTableId.toString():d+"/"+b[0].relatedTableId.toString(),e.next=29,Object(f.constructFeatureSetFromUrl)(d,o.spatialReference,l,u,t.lrucache,t.interceptor);case 29:return m=e.sent,e.next=32,m.load();case 32:if(y=(y=m.relationshipMetaData()).filter((function(e){return e.id===b[0].id})),!1!==i.hasField(b[0].keyField)&&null!==i.field(b[0].keyField)){e.next=41;break}return e.next=36,o.getFeatureByObjectId(i.field(o.objectIdField),[b[0].keyField]);case 36:if(!(h=e.sent)){e.next=40;break}return x=I.WhereClause.create(y[0].keyField+"= @id",m.getFieldsIndex()),e.abrupt("return",(x.parameters={id:h.attributes[b[0].keyField]},m.filter(x)));case 40:return e.abrupt("return",new O.a({parentfeatureset:m}));case 41:return j=I.WhereClause.create(y[0].keyField+"= @id",m.getFieldsIndex()),e.abrupt("return",(j.parameters={id:i.field(b[0].keyField)},m.filter(j)));case 43:case"end":return e.stop()}}),e)})));return function(t,a,n){return e.apply(this,arguments)}}())},e.signatures.push({name:"featuresetbyrelationshipname",min:"2",max:"4"}),e.functions.featuresetbyassociation=function(t,a){return e.standardFunctionAsync(t,a,function(){var e=Object(r.a)(c.a.mark((function e(a,r,i){var s,l,u,o,b,d,y,h,x,O,j,g,k,w,F,N,A,S,T,C,R,L,P,W,M,J,H,G,B,V,z,U,_,q,K,Y,Z,Q,X;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(p.R)(i,2,3),s=i[0],l=Object(p.J)(Object(p.d)(i[1],"")).toLowerCase(),u=Object(p.D)(i[2])?Object(p.J)(i[2]):null,null!==i[0]){e.next=4;break}return e.abrupt("return",null);case 4:if(Object(p.U)(i[0])){e.next=6;break}throw new Error("Invalid Parameter");case 6:if((o=s._layer)instanceof E.default&&(o=Object(f.constructFeatureSet)(o,t.spatialReference,["*"],!0,t.lrucache,t.interceptor)),null!==o){e.next=9;break}return e.abrupt("return",null);case 9:if(!1!==Object(p.ab)(o)){e.next=11;break}return e.abrupt("return",null);case 11:return e.next=13,o.load();case 13:return b=o.serviceUrl(),e.next=16,Object(f.constructAssociationMetaDataFeatureSetFromUrl)(b,t.spatialReference);case 16:if(d=e.sent,y=null,h=null,x=!1,null!==u&&""!==u&&void 0!==u){O=Object(n.a)(d.terminals);try{for(O.s();!(j=O.n()).done;)(g=j.value).terminalName===u&&(h=g.terminalId)}catch(a){O.e(a)}finally{O.f()}null===h&&(x=!0)}k=d.associations.getFieldsIndex(),w=k.get("TOGLOBALID").name,F=k.get("FROMGLOBALID").name,N=k.get("TOTERMINALID").name,A=k.get("FROMTERMINALID").name,S=k.get("FROMNETWORKSOURCEID").name,T=k.get("TONETWORKSOURCEID").name,C=k.get("ASSOCIATIONTYPE").name,R=k.get("ISCONTENTVISIBLE").name,L=k.get("OBJECTID").name,P=Object(n.a)(o.fields),e.prev=21,P.s();case 23:if((W=P.n()).done){e.next=30;break}if("global-id"!==(M=W.value).type){e.next=28;break}return y=s.field(M.name),e.abrupt("break",30);case 28:e.next=23;break;case 30:e.next=35;break;case 32:e.prev=32,e.t0=e.catch(21),P.e(e.t0);case 35:return e.prev=35,P.f(),e.finish(35);case 38:for(U in J=null,H=new m.d(new D.a({name:"percentalong",alias:"percentalong",type:"double"}),I.WhereClause.create("0",d.associations.getFieldsIndex())),G=new m.d(new D.a({name:"side",alias:"side",type:"string"}),I.WhereClause.create("''",d.associations.getFieldsIndex())),B="globalid",V="globalId",z={},d.lkp)z[U]=d.lkp[U].sourceId;_=new m.e(new D.a({name:"classname",alias:"classname",type:"string"}),null,z),q="",e.t1=l,e.next="midspan"===e.t1?46:"junctionedge"===e.t1?50:"connected"===e.t1?54:"container"===e.t1?59:"content"===e.t1?60:"structure"===e.t1?62:"attached"===e.t1?64:66;break;case 46:return q="((".concat(w,"='").concat(y,"') OR ( ").concat(F,"='").concat(y,"')) AND (").concat(C," IN (5))"),_.codefield=I.WhereClause.create("CASE WHEN (".concat(w,"='").concat(y,"') THEN ").concat(S," ELSE ").concat(T," END"),d.associations.getFieldsIndex()),(K=Object(v.c)(m.a.findField(d.associations.fields,F))).name=B,K.alias=B,J=new m.d(K,I.WhereClause.create("CASE WHEN (".concat(F,"='").concat(y,"') THEN ").concat(w," ELSE ").concat(F," END"),d.associations.getFieldsIndex())),H=d.unVersion>=4?new m.c(m.a.findField(d.associations.fields,k.get("PERCENTALONG").name)):new m.d(new D.a({name:"percentalong",alias:"percentalong",type:"double"}),I.WhereClause.create("0",d.associations.getFieldsIndex())),e.abrupt("break",67);case 50:return q="((".concat(w,"='").concat(y,"') OR ( ").concat(F,"='").concat(y,"')) AND (").concat(C," IN (4,6))"),_.codefield=I.WhereClause.create("CASE WHEN (".concat(w,"='").concat(y,"') THEN ").concat(S," ELSE ").concat(T," END"),d.associations.getFieldsIndex()),(Y=Object(v.c)(m.a.findField(d.associations.fields,F))).name=B,Y.alias=B,J=new m.d(Y,I.WhereClause.create("CASE WHEN (".concat(F,"='").concat(y,"') THEN ").concat(w," ELSE ").concat(F," END"),d.associations.getFieldsIndex())),G=new m.d(new D.a({name:"side",alias:"side",type:"string"}),I.WhereClause.create("CASE WHEN (".concat(C,"=4) THEN 'from' ELSE 'to' END"),d.associations.getFieldsIndex())),e.abrupt("break",67);case 54:return Z="".concat(w,"='@T'"),Q="".concat(F,"='@T'"),null!==h&&(Z+=" AND ".concat(N,"=@A"),Q+=" AND ".concat(A,"=@A")),q="(("+Z+") OR ("+Q+"))",q=Object(p.n)(q,"@T",y),Z=Object(p.n)(Z,"@T",y),null!==h&&(Z=Object(p.n)(Z,"@A",h.toString()),q=Object(p.n)(q,"@A",h.toString())),_.codefield=I.WhereClause.create("CASE WHEN "+Z+" THEN ".concat(S," ELSE ").concat(T," END"),d.associations.getFieldsIndex()),(X=Object(v.c)(m.a.findField(d.associations.fields,F))).name=B,X.alias=B,J=new m.d(X,I.WhereClause.create("CASE WHEN "+Z+" THEN ".concat(F," ELSE ").concat(w," END"),d.associations.getFieldsIndex())),e.abrupt("break",67);case 59:q="".concat(w,"='").concat(y,"' AND ").concat(C," = 2"),null!==h&&(q+=" AND ".concat(N," = ")+h.toString()),_.codefield=S,q="( "+q+" )",J=new m.b(m.a.findField(d.associations.fields,F),B,B);case 60:return q="(".concat(F,"='").concat(y,"' AND ").concat(C," = 2)"),null!==h&&(q+=" AND ".concat(A," = ")+h.toString()),_.codefield=T,q="( "+q+" )",J=new m.b(m.a.findField(d.associations.fields,w),B,B),e.abrupt("break",67);case 62:return q="(".concat(w,"='").concat(y,"' AND ").concat(C," = 3)"),null!==h&&(q+=" AND ".concat(N," = ")+h.toString()),_.codefield=S,q="( "+q+" )",J=new m.b(m.a.findField(d.associations.fields,F),B,V),e.abrupt("break",67);case 64:return q="(".concat(F,"='").concat(y,"' AND ").concat(C," = 3)"),null!==h&&(q+=" AND ".concat(A," = ")+h.toString()),_.codefield=T,q="( "+q+" )",J=new m.b(m.a.findField(d.associations.fields,w),B,V),e.abrupt("break",67);case 66:throw new Error("Invalid Parameter");case 67:return x&&(q="1 <> 1"),e.abrupt("return",new m.a({parentfeatureset:d.associations,adaptedFields:[new m.c(m.a.findField(d.associations.fields,L)),new m.c(m.a.findField(d.associations.fields,R)),J,G,_,H],extraFilter:q?I.WhereClause.create(q,d.associations.getFieldsIndex()):null}));case 69:case"end":return e.stop()}}),e,null,[[21,32,35,38]])})));return function(t,a,n){return e.apply(this,arguments)}}())},e.signatures.push({name:"featuresetbyassociation",min:"2",max:"6"}),e.functions.groupby=function(t,a){return e.standardFunctionAsync(t,a,function(){var a=Object(r.a)(c.a.mark((function a(r,i,s){var u,o,f,b,d,m,y,h,x,O,j,g,v,w,F,E,D,N,S,T,C,R,L,P,W,M,J,H,G,B,V,z,U,_,q,K,Y,Z;return c.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(Object(p.R)(s,3,3),Object(p.ab)(s[0])){a.next=2;break}throw new Error("Illegal Value: GroupBy");case 2:return a.next=4,s[0].load();case 4:if(u=a.sent,o=[],f=[],b=!1,d=[],!Object(p.D)(s[1])){a.next=12;break}d.push(s[1]),a.next=23;break;case 12:if(!(s[1]instanceof l.a)){a.next=16;break}d.push(s[1]),a.next=23;break;case 16:if(!Object(p.N)(s[1])){a.next=20;break}d=s[1],a.next=23;break;case 20:if(Object(p.P)(s[1])){a.next=22;break}throw new Error("Illegal Value: GroupBy");case 22:d=s[1].toArray();case 23:m=Object(n.a)(d),a.prev=24,m.s();case 26:if((y=m.n()).done){a.next=41;break}if(h=y.value,!Object(p.D)(h)){a.next=33;break}x=I.WhereClause.create(Object(p.J)(h),u.getFieldsIndex()),O=!0===Object(k.c)(x)?Object(p.J)(h):"%%%%FIELDNAME",o.push({name:O,expression:x}),"%%%%FIELDNAME"===O&&(b=!0),a.next=39;break;case 33:if(h instanceof l.a){a.next=35;break}throw new Error("Illegal Value: GroupBy");case 35:if(j=h.hasField("name")?h.field("name"):"%%%%FIELDNAME",g=h.hasField("expression")?h.field("expression"):"","%%%%FIELDNAME"===j&&(b=!0),j){a.next=38;break}throw new Error("Illegal Value: GroupBy");case 38:o.push({name:j,expression:I.WhereClause.create(g||j,u.getFieldsIndex())});case 39:a.next=26;break;case 41:a.next=46;break;case 43:a.prev=43,a.t0=a.catch(24),m.e(a.t0);case 46:return a.prev=46,m.f(),a.finish(46);case 49:if(d=[],!Object(p.D)(s[2])){a.next=53;break}d.push(s[2]),a.next=64;break;case 53:if(!Object(p.N)(s[2])){a.next=57;break}d=s[2],a.next=64;break;case 57:if(!Object(p.P)(s[2])){a.next=61;break}d=s[2].toArray(),a.next=64;break;case 61:if(s[2]instanceof l.a){a.next=63;break}throw new Error("Illegal Value: GroupBy");case 63:d.push(s[2]);case 64:v=Object(n.a)(d),a.prev=65,v.s();case 67:if((w=v.n()).done){a.next=77;break}if((F=w.value)instanceof l.a){a.next=71;break}throw new Error("Illegal Value: GroupBy");case 71:if(E=F.hasField("name")?F.field("name"):"",D=F.hasField("statistic")?F.field("statistic"):"",N=F.hasField("expression")?F.field("expression"):"",E&&D&&N){a.next=74;break}throw new Error("Illegal Value: GroupBy");case 74:f.push({name:E,statistic:D.toLowerCase(),expression:I.WhereClause.create(N,u.getFieldsIndex())});case 75:a.next=67;break;case 77:a.next=82;break;case 79:a.prev=79,a.t1=a.catch(65),v.e(a.t1);case 82:return a.prev=82,v.f(),a.finish(82);case 85:if(b){S={},T=Object(n.a)(u.fields);try{for(T.s();!(C=T.n()).done;)R=C.value,S[R.name.toLowerCase()]=1}catch(r){T.e(r)}finally{T.f()}L=Object(n.a)(o);try{for(L.s();!(P=L.n()).done;)"%%%%FIELDNAME"!==(W=P.value).name&&(S[W.name.toLowerCase()]=1)}catch(r){L.e(r)}finally{L.f()}M=Object(n.a)(f);try{for(M.s();!(J=M.n()).done;)"%%%%FIELDNAME"!==(H=J.value).name&&(S[H.name.toLowerCase()]=1)}catch(r){M.e(r)}finally{M.f()}G=0,B=Object(n.a)(o);try{for(B.s();!(V=B.n()).done;)if("%%%%FIELDNAME"===(z=V.value).name){for(;1===S["field_"+G.toString()];)G++;S["field_"+G.toString()]=1,z.name="FIELD_"+G.toString()}}catch(r){B.e(r)}finally{B.f()}}U=0,_=o;case 87:if(!(U<_.length)){a.next=94;break}return q=_[U],a.next=91,A(q.expression,e,t);case 91:U++,a.next=87;break;case 94:K=0,Y=f;case 95:if(!(K<Y.length)){a.next=102;break}return Z=Y[K],a.next=99,A(Z.expression,e,t);case 99:K++,a.next=95;break;case 102:return a.abrupt("return",s[0].groupby(o,f));case 103:case"end":return a.stop()}}),a,null,[[24,43,46,49],[65,79,82,85]])})));return function(e,t,n){return a.apply(this,arguments)}}())},e.signatures.push({name:"groupby",min:"3",max:"3"}),e.functions.distinct=function(t,a){return e.standardFunctionAsync(t,a,function(){var a=Object(r.a)(c.a.mark((function a(r,i,s){var u,o,f,b,d,m,y,h,x,O,j,g,v,w,F,E,D,S,T,C,R,L,P,W,M;return c.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(!Object(p.ab)(s[0])){a.next=59;break}return Object(p.R)(s,2,2),a.next=4,s[0].load();case 4:if(u=a.sent,o=[],f=[],!Object(p.D)(s[1])){a.next=11;break}f.push(s[1]),a.next=22;break;case 11:if(!(s[1]instanceof l.a)){a.next=15;break}f.push(s[1]),a.next=22;break;case 15:if(!Object(p.N)(s[1])){a.next=19;break}f=s[1],a.next=22;break;case 19:if(Object(p.P)(s[1])){a.next=21;break}throw new Error("Illegal Value: GroupBy");case 21:f=s[1].toArray();case 22:b=!1,d=Object(n.a)(f),a.prev=24,d.s();case 26:if((m=d.n()).done){a.next=41;break}if(y=m.value,!Object(p.D)(y)){a.next=33;break}h=I.WhereClause.create(Object(p.J)(y),u.getFieldsIndex()),x=!0===Object(k.c)(h)?Object(p.J)(y):"%%%%FIELDNAME",o.push({name:x,expression:h}),"%%%%FIELDNAME"===x&&(b=!0),a.next=39;break;case 33:if(y instanceof l.a){a.next=35;break}throw new Error("Illegal Value: GroupBy");case 35:if(O=y.hasField("name")?y.field("name"):"%%%%FIELDNAME",j=y.hasField("expression")?y.field("expression"):"","%%%%FIELDNAME"===O&&(b=!0),O){a.next=38;break}throw new Error("Illegal Value: GroupBy");case 38:o.push({name:O,expression:I.WhereClause.create(j||O,u.getFieldsIndex())});case 39:a.next=26;break;case 41:a.next=46;break;case 43:a.prev=43,a.t0=a.catch(24),d.e(a.t0);case 46:return a.prev=46,d.f(),a.finish(46);case 49:if(b){g={},v=Object(n.a)(u.fields);try{for(v.s();!(w=v.n()).done;)F=w.value,g[F.name.toLowerCase()]=1}catch(r){v.e(r)}finally{v.f()}E=Object(n.a)(o);try{for(E.s();!(D=E.n()).done;)"%%%%FIELDNAME"!==(S=D.value).name&&(g[S.name.toLowerCase()]=1)}catch(r){E.e(r)}finally{E.f()}T=0,C=Object(n.a)(o);try{for(C.s();!(R=C.n()).done;)if("%%%%FIELDNAME"===(L=R.value).name){for(;1===g["field_"+T.toString()];)T++;g["field_"+T.toString()]=1,L.name="FIELD_"+T.toString()}}catch(r){C.e(r)}finally{C.f()}}P=0,W=o;case 51:if(!(P<W.length)){a.next=58;break}return M=W[P],a.next=55,A(M.expression,e,t);case 55:P++,a.next=51;break;case 58:return a.abrupt("return",s[0].groupby(o,[]));case 59:return a.abrupt("return",N("distinct",0,0,s));case 60:case"end":return a.stop()}}),a,null,[[24,43,46,49]])})));return function(e,t,n){return a.apply(this,arguments)}}())})}}}]);