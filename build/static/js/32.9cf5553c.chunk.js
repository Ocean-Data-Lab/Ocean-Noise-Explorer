(this["webpackJsonpmatx-react-pro"]=this["webpackJsonpmatx-react-pro"]||[]).push([[32],{1041:function(e,t,r){"use strict";r.d(t,"a",(function(){return l}));var a=r(155),n=r(142),i=r(143),s=r(154),u=r.n(s),l=function(){function e(){Object(n.a)(this,e),this.declaredRootClass="esri.arcade.featureSetCollection",this._layerById={},this._layerByName={}}return Object(i.a)(e,[{key:"add",value:function(e,t,r){this._layerById[t]=r,this._layerByName[e]=r}},{key:"featureSetByName",value:function(){var e=Object(a.a)(u.a.mark((function e(t){var r=arguments;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return!(r.length>1&&void 0!==r[1])||r[1],r.length>2&&void 0!==r[2]?r[2]:["*"],e.abrupt("return",void 0===this._layerByName[t]?null:this._layerByName[t]);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"featureSetById",value:function(){var e=Object(a.a)(u.a.mark((function e(t){var r=arguments;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return!(r.length>1&&void 0!==r[1])||r[1],r.length>2&&void 0!==r[2]?r[2]:["*"],e.abrupt("return",void 0===this._layerById[t]?null:this._layerById[t]);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"castToText",value:function(){return"object, FeatureSetCollection"}}]),e}()},1043:function(e,t,r){"use strict";r.d(t,"a",(function(){return F})),r.d(t,"b",(function(){return k})),r.d(t,"c",(function(){return m})),r.d(t,"d",(function(){return x})),r.d(t,"e",(function(){return w}));var a=r(155),n=r(60),i=r(144),s=r(145),u=r(142),l=r(143),o=r(154),c=r.n(o),d=r(220),h=r(728),f=r(473),p=r(470),y=r(375),b=r(526),_=r(433),v=r(185),g=function(){function e(t){Object(u.a)(this,e),this.field=t,this.sqlRewritable=!1}return Object(l.a)(e,[{key:"postInitialization",value:function(e,t){}}]),e}(),m=function(e){Object(i.a)(r,e);var t=Object(s.a)(r);function r(e){var a;return Object(u.a)(this,r),(a=t.call(this,e)).sqlRewritable=!0,a}return Object(l.a)(r,[{key:"extractValue",value:function(e){return e.attributes[this.field.name]}},{key:"rewriteSql",value:function(e){return{rewritten:this.sqlRewritable,where:e}}}]),r}(g),k=function(e){Object(i.a)(r,e);var t=Object(s.a)(r);function r(e,a,n){var i;return Object(u.a)(this,r),(i=t.call(this,Object(y.c)(e))).originalField=e,i.sqlRewritable=!0,i.field.name=a,i.field.alias=n,i}return Object(l.a)(r,[{key:"rewriteSql",value:function(e,t){return{rewritten:this.sqlRewritable,where:Object(b.g)(e,this.field.name,this.originalField.name,t.getFieldsIndex())}}},{key:"extractValue",value:function(e){return e.attributes[this.originalField.name]}}]),r}(g),w=function(e){Object(i.a)(r,e);var t=Object(s.a)(r);function r(e,a,n){var i;for(var s in Object(u.a)(this,r),(i=t.call(this,e)).codefield=a,i.lkp=n,i.reverseLkp={},n)i.reverseLkp[n[s]]=s;return i.sqlRewritable=!0,i}return Object(l.a)(r,[{key:"rewriteSql",value:function(e,t){var a=this.evaluateNodeToWhereClause(e.parseTree,y.a.Standardised,this.field.name,this.codefield instanceof _.WhereClause?Object(b.i)(this.codefield,y.a.Standardised):this.codefield,e.parameters);return a.includes(r.BADNESS)?{rewritten:!1,where:e}:{rewritten:this.sqlRewritable,where:_.WhereClause.create(a,t._parent.getFieldsIndex())}}},{key:"evaluateNodeToWhereClause",value:function(e,t){var a,i,s,u,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,c=arguments.length>4?arguments[4]:void 0;switch(e.type){case"interval":return Object(b.b)(this.evaluateNodeToWhereClause(e.value,t,l,o,c),e.qualifier,e.op);case"case-expression":var d=" CASE ";"simple"===e.format&&(d+=this.evaluateNodeToWhereClause(e.operand,t,l,r.BADNESS,c));for(var h=0;h<e.clauses.length;h++)d+=" WHEN "+this.evaluateNodeToWhereClause(e.clauses[h].operand,t,l,r.BADNESS,c)+" THEN "+this.evaluateNodeToWhereClause(e.clauses[h].value,t,l,r.BADNESS,c);return null!==e.else&&(d+=" ELSE "+this.evaluateNodeToWhereClause(e.else,t,l,r.BADNESS,c)),d+=" END ";case"parameter":var f=c[e.value.toLowerCase()];if("string"==typeof f)return"'"+c[e.value.toLowerCase()].toString().replace(/'/g,"''")+"'";if(f instanceof Date)return Object(b.d)(f,t);if(f instanceof Array){for(var p=[],y=0;y<f.length;y++)"string"==typeof f[y]?p.push("'"+f[y].toString().replace(/'/g,"''")+"'"):f[y]instanceof Date?p.push(Object(b.d)(f[y],t)):p.push(f[y].toString());return p}return f.toString();case"expression-list":i=[];var _,v=Object(n.a)(e.value);try{for(v.s();!(_=v.n()).done;){var g=_.value;i.push(this.evaluateNodeToWhereClause(g,t,l,o,c))}}catch(R){v.e(R)}finally{v.f()}return i;case"unary-expression":return" ( NOT "+this.evaluateNodeToWhereClause(e.expr,t,l,r.BADNESS,c)+" ) ";case"binary-expression":switch(e.operator){case"AND":return" ("+this.evaluateNodeToWhereClause(e.left,t,l,o,c)+" AND "+this.evaluateNodeToWhereClause(e.right,t,l,o,c)+") ";case"OR":return" ("+this.evaluateNodeToWhereClause(e.left,t,l,o,c)+" OR "+this.evaluateNodeToWhereClause(e.right,t,l,o,c)+") ";case"IS":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return" ("+this.evaluateNodeToWhereClause(e.left,t,l,o,c)+" IS NULL )";case"ISNOT":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return" ("+this.evaluateNodeToWhereClause(e.left,t,l,o,c)+" IS NOT NULL )";case"IN":if(a=[],"expression-list"===e.right.type){if("column-reference"===e.left.type&&e.left.column.toUpperCase()===this.field.name.toUpperCase()){var m,k=[],w=!0,x=Object(n.a)(e.right.value);try{for(x.s();!(m=x.n()).done;){var F=m.value;if("string"!==F.type){w=!1;break}if(void 0===this.lkp[F.value]){w=!1;break}k.push(this.lkp[F.value].toString())}}catch(R){x.e(R)}finally{x.f()}if(w)return" ("+this.evaluateNodeToWhereClause(e.left,t,l,o,c)+" IN ("+k.join(",")+")) "}return a=this.evaluateNodeToWhereClause(e.right,t,l,o,c)," ("+this.evaluateNodeToWhereClause(e.left,t,l,o,c)+" IN ("+a.join(",")+")) "}return(u=this.evaluateNodeToWhereClause(e.right,t,l,o,c))instanceof Array?" ("+this.evaluateNodeToWhereClause(e.left,t,l,o,c)+" IN ("+u.join(",")+")) ":" ("+this.evaluateNodeToWhereClause(e.left,t,l,o,c)+" IN ("+u+")) ";case"NOT IN":if(a=[],"expression-list"===e.right.type){if("column-reference"===e.left.type&&e.left.column.toUpperCase()===this.field.name.toUpperCase()){var S,O=[],j=!0,I=Object(n.a)(e.right.value);try{for(I.s();!(S=I.n()).done;){var C=S.value;if("string"!==C.type){j=!1;break}if(void 0===this.lkp[C.value]){j=!1;break}O.push(this.lkp[C.value].toString())}}catch(R){I.e(R)}finally{I.f()}if(j)return" ("+this.evaluateNodeToWhereClause(e.left,t,l,o,c)+" NOT IN ("+O.join(",")+")) "}return a=this.evaluateNodeToWhereClause(e.right,t,l,o,c)," ("+this.evaluateNodeToWhereClause(e.left,t,l,o,c)+" NOT IN ("+a.join(",")+")) "}return(u=this.evaluateNodeToWhereClause(e.right,t,l,o,c))instanceof Array?" ("+this.evaluateNodeToWhereClause(e.left,t,l,o,c)+" NOT IN ("+u.join(",")+")) ":" ("+this.evaluateNodeToWhereClause(e.left,t,l,o,c)+" NOT IN ("+u+")) ";case"BETWEEN":return s=this.evaluateNodeToWhereClause(e.right,t,l,r.BADNESS,c)," ("+this.evaluateNodeToWhereClause(e.left,t,l,r.BADNESS,c)+" BETWEEN "+s[0]+" AND "+s[1]+" ) ";case"NOTBETWEEN":return s=this.evaluateNodeToWhereClause(e.right,t,l,r.BADNESS,c)," ("+this.evaluateNodeToWhereClause(e.left,t,l,r.BADNESS,c)+" NOT BETWEEN "+s[0]+" AND "+s[1]+" ) ";case"LIKE":return""!==e.escape?" ("+this.evaluateNodeToWhereClause(e.left,t,l,r.BADNESS,c)+" LIKE "+this.evaluateNodeToWhereClause(e.right,t,l,r.BADNESS,c)+" ESCAPE '"+e.escape+"') ":" ("+this.evaluateNodeToWhereClause(e.left,t,l,r.BADNESS,c)+" LIKE "+this.evaluateNodeToWhereClause(e.right,t,l,r.BADNESS,c)+") ";case"NOT LIKE":return""!==e.escape?" ("+this.evaluateNodeToWhereClause(e.left,t,l,r.BADNESS,c)+" NOT LIKE "+this.evaluateNodeToWhereClause(e.right,t,l,r.BADNESS,c)+" ESCAPE '"+e.escape+"') ":" ("+this.evaluateNodeToWhereClause(e.left,t,l,r.BADNESS,c)+" NOT LIKE "+this.evaluateNodeToWhereClause(e.right,t,l,r.BADNESS,c)+") ";case"<>":case"=":if("column-reference"===e.left.type&&"string"===e.right.type){if(e.left.column.toUpperCase()===this.field.name.toUpperCase()&&void 0!==this.lkp[e.right.value.toString()])return" ("+o+" "+e.operator+" "+this.lkp[e.right.value.toString()].toString()+") "}else if("column-reference"===e.right.type&&"string"===e.left.type&&e.right.column.toUpperCase()===this.field.name.toUpperCase())return" ("+this.lkp[e.right.value.toString()].toString()+" "+e.operator+" "+o+") ";return" ("+this.evaluateNodeToWhereClause(e.left,t,l,r.BADNESS,c)+" "+e.operator+" "+this.evaluateNodeToWhereClause(e.right,t,l,r.BADNESS,c)+") ";case"<":case">":case">=":case"<=":case"*":case"-":case"+":case"/":return" ("+this.evaluateNodeToWhereClause(e.left,t,l,r.BADNESS,c)+" "+e.operator+" "+this.evaluateNodeToWhereClause(e.right,t,l,r.BADNESS,c)+") "}case"null":return"null";case"boolean":return!0===e.value?"1":"0";case"string":return"'"+e.value.toString().replace(/'/g,"''")+"'";case"timestamp":case"date":return Object(b.d)(e.value,t);case"number":return e.value.toString();case"current-time":return Object(b.e)("date"===e.mode,t);case"column-reference":return l&&l.toLowerCase()===e.column.toLowerCase()?"("+o+")":e.column;case"function":var D=this.evaluateNodeToWhereClause(e.args,t,l,r.BADNESS,c);return Object(b.k)(e.name,D,t)}throw new Error("Unsupported sql syntax "+e.type)}},{key:"extractValue",value:function(e){return this.codefield instanceof _.WhereClause?this.reverseLkp[this.codefield.calculateValueCompiled(e)]:this.reverseLkp[e.attributes[this.codefield]]}}]),r}(g);w.BADNESS="_!!!_BAD_LKP_!!!!";var x=function(e){Object(i.a)(r,e);var t=Object(s.a)(r);function r(e,a){var n;return Object(u.a)(this,r),(n=t.call(this,e)).sql=a,n}return Object(l.a)(r,[{key:"rewriteSql",value:function(e,t){return{rewritten:!0,where:Object(b.g)(e,this.field.name,Object(b.i)(this.sql,y.a.Standardised),t.getFieldsIndex())}}},{key:"extractValue",value:function(e){return this.sql.calculateValueCompiled(e)}}]),r}(g),F=function(e){Object(i.a)(r,e);var t=Object(s.a)(r);function r(e){var a;return Object(u.a)(this,r),(a=t.call(this,e))._calcFunc=null,a.declaredClass="esri.arcade.featureset.actions.Adapted",a.adaptedFields=null,a._extraFilter=null,a._extraFilter=e.extraFilter,a._parent=e.parentfeatureset,a._maxProcessing=30,a.adaptedFields=e.adaptedFields,a}return Object(l.a)(r,[{key:"_initialiseFeatureSet",value:function(){null!==this._parent?(this.geometryType=this._parent.geometryType,this.objectIdField=this._parent.objectIdField,this.globalIdField=this._parent.globalIdField,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField=this._parent.typeIdField,this.types=this._parent.types):(this.spatialReference=new v.a({wkid:4326}),this.objectIdField="",this.globalIdField="",this.geometryType=y.m.point,this.typeIdField="",this.types=null),this.fields=[];var e,t=Object(n.a)(this.adaptedFields);try{for(t.s();!(e=t.n()).done;){var r=e.value;r.postInitialization(this,this._parent),this.fields.push(r.field)}}catch(a){t.e(a)}finally{t.f()}}},{key:"_getSet",value:function(){var e=Object(a.a)(c.a.mark((function e(t){var r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==this._wset){e.next=17;break}return e.next=3,this._ensureLoaded();case 3:if(r=null,!this._extraFilter){e.next=10;break}return e.next=7,this._getFilteredSet("",null,null,null,t);case 7:e.t0=e.sent,e.next=13;break;case 10:return e.next=12,this._parent._getSet(t);case 12:e.t0=e.sent;case 13:return r=e.t0,this._checkCancelled(t),this._wset=new p.a(r._candidates.slice(0),r._known.slice(0),r._ordered,this._clonePageDefinition(r.pagesDefinition)),e.abrupt("return",this._wset);case 17:return e.abrupt("return",this._wset);case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_isInFeatureSet",value:function(e){return this._parent._isInFeatureSet(e)}},{key:"_getFeatures",value:function(){var e=Object(a.a)(c.a.mark((function e(t,r,a,i){var s,u,l,o,f,y,b,_,v,g,m,k,w,x,F;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=[],-1!==r&&void 0===this._featureCache[r]&&s.push(r),u=this._maxQueryRate(),!0!==this._checkIfNeedToExpandKnownPage(t,u)){e.next=7;break}return e.next=6,this._expandPagedSet(t,u,0,0,i);case 6:return e.abrupt("return",this._getFeatures(t,r,a,i));case 7:for(l=0,o=t._lastFetchedIndex;o<t._known.length&&(++l<=a&&(t._lastFetchedIndex+=1),!(void 0===this._featureCache[t._known[o]]&&(t._known[o]!==r&&s.push(t._known[o]),s.length>=u)));o++);if(0!==s.length){e.next=11;break}return e.abrupt("return","success");case 11:return t=new p.a([],s,t._ordered,null),f=Math.min(s.length,a),e.next=15,this._parent._getFeatures(t,-1,f,i);case 15:for(this._checkCancelled(i),y=[],b=0;b<f;b++)void 0!==(_=this._parent._featureFromCache(s[b]))&&y.push({geometry:_.geometry,attributes:_.attributes,id:s[b]});for(v=0,g=y;v<g.length;v++){m=g[v],k=[],w=Object(n.a)(this.adaptedFields);try{for(w.s();!(x=w.n()).done;)F=x.value,k[F.field.name]=F.extractValue(m)}catch(c){w.e(c)}finally{w.f()}this._featureCache[m.id]=new d.a({attributes:k,geometry:Object(h.a)(m.geometry)})}return e.abrupt("return","success");case 20:case"end":return e.stop()}}),e,this)})));return function(t,r,a,n){return e.apply(this,arguments)}}()},{key:"_fetchAndRefineFeatures",value:function(){var e=Object(a.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Fetch and Refine should not be called in this featureset");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"_getFilteredSet",value:function(){var e=Object(a.a)(c.a.mark((function e(t,r,a,i,s){var u,l,o,d,h,f,y,_;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u=!1,l=this._reformulateWithoutAdaptions(a),u=l.cannot,a=l.where,o=!1,null===i){e.next=28;break}o=!0,d=[],h=Object(n.a)(this.adaptedFields),e.prev=8,h.s();case 10:if((f=h.n()).done){e.next=19;break}if((y=f.value)instanceof m||!0!==i.scanForField(y.field.name)){e.next=17;break}if(y instanceof k){e.next=16;break}return i=null,o=!1,e.abrupt("break",19);case 16:d.push({field:y.field.name,newfield:y.originalField.name});case 17:e.next=10;break;case 19:e.next=24;break;case 21:e.prev=21,e.t0=e.catch(8),h.e(e.t0);case 24:return e.prev=24,h.f(),e.finish(24);case 27:i&&d.length>0&&(i=i.replaceFields(d));case 28:return null!==a?null!==this._extraFilter&&(a=Object(b.a)(this._extraFilter,a)):a=this._extraFilter,e.next=31,this._ensureLoaded();case 31:return e.next=33,this._parent._getFilteredSet(t,r,a,i,s);case 33:return _=e.sent,e.abrupt("return",(this._checkCancelled(s),!0===u?new p.a(_._candidates.slice(0).concat(_._known.slice(0)),[],!0===o&&_._ordered,this._clonePageDefinition(_.pagesDefinition)):new p.a(_._candidates.slice(0),_._known.slice(0),!0===o&&_._ordered,this._clonePageDefinition(_.pagesDefinition))));case 35:case"end":return e.stop()}}),e,this,[[8,21,24,27]])})));return function(t,r,a,n,i){return e.apply(this,arguments)}}()},{key:"_reformulateWithoutAdaptions",value:function(e){var t={cannot:!1,where:e};if(null!==e){var r,a=Object(n.a)(this.adaptedFields);try{for(a.s();!(r=a.n()).done;){var i=r.value;if(!0===Object(b.h)(e,i.field.name)){var s=i.rewriteSql(e,this);if(!0!==s.rewritten){t.cannot=!0,t.where=null;break}t.where=s.where}}}catch(u){a.e(u)}finally{a.f()}}return t}},{key:"_stat",value:function(){var e=Object(a.a)(c.a.mark((function e(t,r,a,n,i,s,u){var l,o,d;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l=!1,o=this._reformulateWithoutAdaptions(r),l=o.cannot,r=o.where,o=this._reformulateWithoutAdaptions(i),l=l||o.cannot,null!==(i=o.where)?null!==this._extraFilter&&(i=Object(b.a)(this._extraFilter,i)):i=this._extraFilter,!0!==l){e.next=3;break}return e.abrupt("return",null===i&&""===a&&null===n?this._manualStat(t,r,s,u):{calculated:!1});case 3:return e.next=5,this._parent._stat(t,r,a,n,i,s,u);case 5:return d=e.sent,e.abrupt("return",!1===d.calculated?null===i&&""===a&&null===n?this._manualStat(t,r,s,u):{calculated:!1}:d);case 7:case"end":return e.stop()}}),e,this)})));return function(t,r,a,n,i,s,u){return e.apply(this,arguments)}}()},{key:"_canDoAggregates",value:function(){var e=Object(a.a)(c.a.mark((function e(t,r,a,i,s){var u,l,o,d,h,f,p,y,_,v;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==this._parent){e.next=2;break}return e.abrupt("return",!1);case 2:u=0;case 3:if(!(u<t.length)){e.next=24;break}l=Object(n.a)(this.adaptedFields),e.prev=5,l.s();case 7:if((o=l.n()).done){e.next=13;break}if(d=o.value,t[u].toLowerCase()!==d.field.name.toLowerCase()||d instanceof m){e.next=11;break}return e.abrupt("return",!1);case 11:e.next=7;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(5),l.e(e.t0);case 18:return e.prev=18,l.f(),e.finish(18);case 21:u++,e.next=3;break;case 24:h=[],f=0;case 26:if(!(f<r.length)){e.next=40;break}if(null===(p=r[f]).workingexpr){e.next=36;break}if(!(y=this._reformulateWithoutAdaptions(p.workingexpr)).cannot){e.next=32;break}return e.abrupt("return",!1);case 32:(_=p.clone()).workingexpr=y.where,h.push(_),e.next=37;break;case 36:h.push(p);case 37:f++,e.next=26;break;case 40:return v=this._reformulateWithoutAdaptions(s),e.abrupt("return",!v.cannot&&(null!==(s=v.where)?null!==this._extraFilter&&(s=Object(b.a)(this._extraFilter,s)):s=this._extraFilter,this._parent._canDoAggregates(t,h,a,i,s)));case 42:case"end":return e.stop()}}),e,this,[[5,15,18,21]])})));return function(t,r,a,n,i){return e.apply(this,arguments)}}()},{key:"_getAggregatePagesDataSourceDefinition",value:function(){var e=Object(a.a)(c.a.mark((function e(t,r,a,n,i,s,u){var l,o,d,h,f,p;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==this._parent){e.next=2;break}throw new Error("Should never be called");case 2:l=[],o=0;case 4:if(!(o<r.length)){e.next=18;break}if(null===(d=r[o]).workingexpr){e.next=14;break}if(!(h=this._reformulateWithoutAdaptions(d.workingexpr)).cannot){e.next=10;break}throw new Error("Should never be called");case 10:(f=d.clone()).workingexpr=h.where,l.push(f),e.next=15;break;case 14:l.push(d);case 15:o++,e.next=4;break;case 18:if(!(p=this._reformulateWithoutAdaptions(i)).cannot){e.next=21;break}throw new Error("Should never be called");case 21:return e.abrupt("return",(null!==(i=p.where)?null!==this._extraFilter&&(i=Object(b.a)(this._extraFilter,i)):i=this._extraFilter,this._parent._getAggregatePagesDataSourceDefinition(t,l,a,n,i,s,u)));case 22:case"end":return e.stop()}}),e,this)})));return function(t,r,a,n,i,s,u){return e.apply(this,arguments)}}()}],[{key:"findField",value:function(e,t){var r,a=Object(n.a)(e);try{for(a.s();!(r=a.n()).done;){var i=r.value;if(i.name.toLowerCase()===t.toString().toLowerCase())return i}}catch(s){a.e(s)}finally{a.f()}return null}}]),r}(f.a)},1045:function(e,t,r){"use strict";r.d(t,"a",(function(){return f}));var a=r(155),n=r(142),i=r(143),s=r(144),u=r(145),l=r(154),o=r.n(l),c=r(473),d=r(470),h=r(375),f=function(e){Object(s.a)(r,e);var t=Object(u.a)(r);function r(e){var a;return Object(n.a)(this,r),(a=t.call(this,e))._topnum=0,a.declaredClass="esri.arcade.featureset.actions.Top",a._countedin=0,a._maxProcessing=100,a._topnum=e.topnum,a._parent=e.parentfeatureset,a}return Object(i.a)(r,[{key:"_getSet",value:function(){var e=Object(a.a)(o.a.mark((function e(t){var r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==this._wset){e.next=7;break}return e.next=3,this._ensureLoaded();case 3:return e.next=5,this._parent._getSet(t);case 5:return r=e.sent,e.abrupt("return",(this._wset=new d.a(r._candidates.slice(0),r._known.slice(0),!1,this._clonePageDefinition(r.pagesDefinition)),this._setKnownLength(this._wset)>this._topnum&&(this._wset._known=this._wset._known.slice(0,this._topnum)),this._setKnownLength(this._wset)>=this._topnum&&(this._wset._candidates=[]),this._wset));case 7:return e.abrupt("return",this._wset);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_setKnownLength",value:function(e){return e._known.length>0&&"GETPAGES"===e._known[e._known.length-1]?e._known.length-1:e._known.length}},{key:"_isInFeatureSet",value:function(e){var t=this._parent._isInFeatureSet(e);if(t===h.b.NotInFeatureSet)return t;var r=this._idstates[e];return r===h.b.InFeatureSet||r===h.b.NotInFeatureSet?r:t===h.b.InFeatureSet&&void 0===r?this._countedin<this._topnum?(this._idstates[e]=h.b.InFeatureSet,this._countedin++,h.b.InFeatureSet):(this._idstates[e]=h.b.NotInFeatureSet,h.b.NotInFeatureSet):h.b.Unknown}},{key:"_expandPagedSet",value:function(){var e=Object(a.a)(o.a.mark((function e(t,r,a,n,i){var s,u;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==this._parent){e.next=2;break}throw new Error("Parent Paging not implemented");case 2:if(r>this._topnum&&(r=this._topnum),!(this._countedin>=this._topnum&&t.pagesDefinition.internal.set.length<=t.pagesDefinition.resultOffset)){e.next=5;break}return s=t._known.length,e.abrupt("return",(s>0&&"GETPAGES"===t._known[s-1]&&(t._known.length=s-1),(s=t._candidates.length)>0&&"GETPAGES"===t._candidates[s-1]&&(t._candidates.length=s-1),"success"));case 5:return e.next=7,this._parent._expandPagedSet(t,r,a,n,i);case 7:return u=e.sent,e.abrupt("return",(this._setKnownLength(t)>this._topnum&&(t._known.length=this._topnum),this._setKnownLength(t)>=this._topnum&&(t._candidates.length=0),u));case 9:case"end":return e.stop()}}),e,this)})));return function(t,r,a,n,i){return e.apply(this,arguments)}}()},{key:"_getFeatures",value:function(){var e=Object(a.a)(o.a.mark((function e(t,r,a,n){var i,s,u,l,c,h,f,p;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=[],s=this._maxQueryRate(),!0!==this._checkIfNeedToExpandKnownPage(t,s)){e.next=5;break}return e.next=4,this._expandPagedSet(t,s,0,0,n);case 4:return e.abrupt("return",this._getFeatures(t,r,a,n));case 5:for(-1!==r&&void 0===this._featureCache[r]&&i.push(r),u=0,l=t._lastFetchedIndex;l<t._known.length&&(++u<=a&&(t._lastFetchedIndex+=1),!(void 0===this._featureCache[t._known[l]]&&(t._known[l]!==r&&i.push(t._known[l]),i.length>s)));l++);if(0!==i.length){e.next=10;break}return e.abrupt("return","success");case 10:return c=new d.a([],i,!1,null),h=Math.min(i.length,a),e.next=13,this._parent._getFeatures(c,-1,h,n);case 13:for(f=0;f<h;f++)void 0!==(p=this._parent._featureFromCache(i[f]))&&(this._featureCache[i[f]]=p);return e.abrupt("return","success");case 15:case"end":return e.stop()}}),e,this)})));return function(t,r,a,n){return e.apply(this,arguments)}}()},{key:"_getFilteredSet",value:function(){var e=Object(a.a)(o.a.mark((function e(t,r,a,n,i){var s;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ensureLoaded();case 2:return e.next=4,this._getSet(i);case 4:return s=e.sent,e.abrupt("return",new d.a(s._candidates.slice(0).concat(s._known.slice(0)),[],!1,this._clonePageDefinition(s.pagesDefinition)));case 6:case"end":return e.stop()}}),e,this)})));return function(t,r,a,n,i){return e.apply(this,arguments)}}()},{key:"_refineKnowns",value:function(e,t){for(var r=0,a=null,n=[],i=0;i<e._candidates.length;i++){var s=this._isInFeatureSet(e._candidates[i]);if(s===h.b.InFeatureSet){if(e._known.push(e._candidates[i]),r+=1,null===a?a={start:i,end:i}:a.end===i-1?a.end=i:(n.push(a),a={start:i,end:i}),e._known.length>=this._topnum)break}else if(s===h.b.NotInFeatureSet)null===a?a={start:i,end:i}:a.end===i-1?a.end=i:(n.push(a),a={start:i,end:i}),r+=1;else if(s===h.b.Unknown)break;if(r>=t)break}null!==a&&n.push(a);for(var u=n.length-1;u>=0;u--)e._candidates.splice(n[u].start,n[u].end-n[u].start+1);this._setKnownLength(e)>this._topnum&&(e._known=e._known.slice(0,this._topnum)),this._setKnownLength(e)>=this._topnum&&(e._candidates=[])}},{key:"_stat",value:function(){var e=Object(a.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{calculated:!1});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"_canDoAggregates",value:function(){var e=Object(a.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!1);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}],[{key:"registerAction",value:function(){c.a._featuresetFunctions.top=function(e){return new r({parentfeatureset:this,topnum:e})}}}]),r}(c.a)},1046:function(e,t,r){"use strict";r.d(t,"a",(function(){return k}));var a=r(60),n=r(155),i=r(142),s=r(143),u=r(144),l=r(145),o=r(154),c=r.n(o),d=r(220),h=r(473),f=r(470),p=r(375),y=r(526),b=r(249),_=r(404),v=r(620),g=r(356),m=r(254),k=function(e){Object(u.a)(r,e);var t=Object(l.a)(r);function r(e){var a;return Object(i.a)(this,r),(a=t.call(this,e)).declaredClass="esri.arcade.featureset.sources.FeatureLayerMemory",a._removeGeometry=!1,a._overrideFields=null,a._forceIsTable=!1,e.spatialReference&&(a.spatialReference=e.spatialReference),a._transparent=!0,a._maxProcessing=1e3,a._layer=e.layer,a._wset=null,!0===e.isTable&&(a._forceIsTable=!0),void 0!==e.outFields&&(a._overrideFields=e.outFields),void 0!==e.includeGeometry&&(a._removeGeometry=!1===e.includeGeometry),a}return Object(s.a)(r,[{key:"_maxQueryRate",value:function(){return p.f}},{key:"end",value:function(){return this._layer}},{key:"optimisePagingFeatureQueries",value:function(){}},{key:"loadImpl",value:function(){var e=Object(n.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!0!==this._layer.loaded){e.next=4;break}e.t0=(this._initialiseFeatureSet(),this),e.next=8;break;case 4:return e.next=6,this._layer.load();case 6:this._initialiseFeatureSet(),e.t0=this;case 8:return e.abrupt("return",e.t0);case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"gdbVersion",get:function(){return""}},{key:"_initialiseFeatureSet",value:function(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this._layer.geometryType,this.fields=this._layer.fields.slice(0),this._layer.outFields)if(1===this._layer.outFields.length&&"*"===this._layer.outFields[0]);else{var e,t=[],r=Object(a.a)(this.fields);try{for(r.s();!(e=r.n()).done;){var n=e.value;if("oid"===n.type)t.push(n);else{var i,s=Object(a.a)(this._layer.outFields);try{for(s.s();!(i=s.n()).done;){if(i.value.toLowerCase()===n.name.toLowerCase()){t.push(n);break}}}catch(v){s.e(v)}finally{s.f()}}}}catch(v){r.e(v)}finally{r.f()}this.fields=t}if(null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{var u,l=[],o=[],c=Object(a.a)(this.fields);try{for(c.s();!(u=c.n()).done;){var d=u.value;if("oid"===d.type)l.push(d),o.push(d.name);else{var h,f=Object(a.a)(this._overrideFields);try{for(f.s();!(h=f.n()).done;){if(h.value.toLowerCase()===d.name.toLowerCase()){l.push(d),o.push(d.name);break}}}catch(v){f.e(v)}finally{f.f()}}}}catch(v){c.e(v)}finally{c.f()}this.fields=l,this._overrideFields=o}this.objectIdField=this._layer.objectIdField;var y,b=Object(a.a)(this.fields);try{for(b.s();!(y=b.n()).done;){var _=y.value;"global-id"===_.type&&(this.globalIdField=_.name)}}catch(v){b.e(v)}finally{b.f()}this.hasM=this._layer.supportsM,this.hasZ=this._layer.supportsZ,this._databaseType=p.a.Standardised,this.typeIdField=this._layer.typeIdField,this.types=this._layer.types}},{key:"isTable",value:function(){return this._forceIsTable||this._layer.isTable||"table"===this._layer.type||!this._layer.geometryType}},{key:"_isInFeatureSet",value:function(){return p.b.InFeatureSet}},{key:"_candidateIdTransform",value:function(e){return e}},{key:"_getSet",value:function(){var e=Object(n.a)(c.a.mark((function e(t){var r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==this._wset){e.next=7;break}return e.next=3,this._ensureLoaded();case 3:return e.next=5,this._getFilteredSet("",null,null,null,t);case 5:return r=e.sent,e.abrupt("return",(this._wset=r,r));case 7:return e.abrupt("return",this._wset);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_changeFeature",value:function(e){var t,r={},n=Object(a.a)(this.fields);try{for(n.s();!(t=n.n()).done;){var i=t.value;r[i.name]=e.attributes[i.name]}}catch(s){n.e(s)}finally{n.f()}return new d.a({geometry:!0===this._removeGeometry?null:e.geometry,attributes:r})}},{key:"_getFilteredSet",value:function(){var e=Object(n.a)(c.a.mark((function e(t,r,a,n,i){var s,u,l,o,d,h=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s="",u=!1,null!==n&&(s=n.constructClause(),u=!0),!this.isTable()||!r||null===t||""===t){e.next=3;break}return e.abrupt("return",new f.a([],[],!0,null));case 3:return(l=new m.a).where=null===a?null===r?"1=1":"":Object(y.i)(a,p.a.Standardised),l.spatialRelationship=this._makeRelationshipEnum(t),l.outSpatialReference=this.spatialReference,l.orderByFields=""!==s?s.split(","):null,l.geometry=null===r?null:r,l.returnGeometry=!0,l.relationParameter=this._makeRelationshipParam(t),e.next=7,this._layer.queryFeatures(l);case 7:if(null!==(o=e.sent)){e.next=10;break}return e.abrupt("return",new f.a([],[],u,null));case 10:return this._checkCancelled(i),d=[],o.features.forEach((function(e){var t=e.attributes[h._layer.objectIdField];d.push(t),h._featureCache[t]=h._changeFeature(e)})),e.abrupt("return",new f.a([],d,u,null));case 14:case"end":return e.stop()}}),e,this)})));return function(t,r,a,n,i){return e.apply(this,arguments)}}()},{key:"_makeRelationshipEnum",value:function(e){if(e.includes("esriSpatialRelRelation"))return"relation";switch(e){case"esriSpatialRelRelation":return"relation";case"esriSpatialRelIntersects":return"intersects";case"esriSpatialRelContains":return"contains";case"esriSpatialRelOverlaps":return"overlaps";case"esriSpatialRelWithin":return"within";case"esriSpatialRelTouches":return"touches";case"esriSpatialRelCrosses":return"crosses";case"esriSpatialRelEnvelopeIntersects":return"envelope-intersects"}return e}},{key:"_makeRelationshipParam",value:function(e){return e.includes("esriSpatialRelRelation")?e.split(":")[1]:""}},{key:"_queryAllFeatures",value:function(){var e=Object(n.a)(c.a.mark((function e(){var t,r,a,n,i=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._wset){e.next=2;break}return e.abrupt("return",this._wset);case 2:return(t=new m.a).where="1=1",e.next=6,this._ensureLoaded();case 6:if(!this._layer.source||!this._layer.source.items){e.next=9;break}return r=[],e.abrupt("return",(this._layer.source.items.forEach((function(e){var t=e.attributes[i._layer.objectIdField];r.push(t),i._featureCache[t]=i._changeFeature(e)})),this._wset=new f.a([],r,!1,null),this._wset));case 9:return e.next=11,this._layer.queryFeatures(t);case 11:return a=e.sent,n=[],e.abrupt("return",(a.features.forEach((function(e){var t=e.attributes[i._layer.objectIdField];n.push(t),i._featureCache[t]=i._changeFeature(e)})),this._wset=new f.a([],n,!1,null),this._wset));case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_getFeatures",value:function(){var e=Object(n.a)(c.a.mark((function e(t,r,a){var n,i;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=[],-1!==r&&void 0===this._featureCache[r]&&n.push(r),i=t._lastFetchedIndex;i<t._known.length&&(t._lastFetchedIndex+=1,!(void 0===this._featureCache[t._known[i]]&&(t._known[i]!==r&&n.push(t._known[i]),n.length>a)));i++);if(0!==n.length){e.next=5;break}return e.abrupt("return","success");case 5:throw new Error("Unaccounted for Features. Not in Feature Collection");case 6:case"end":return e.stop()}}),e,this)})));return function(t,r,a){return e.apply(this,arguments)}}()},{key:"_refineSetBlock",value:function(){var e=Object(n.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"_stat",value:function(){var e=Object(n.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{calculated:!1});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"_canDoAggregates",value:function(){var e=Object(n.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!1);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"relationshipMetaData",value:function(){return[]}},{key:"nativeCapabilities",value:function(){return{title:this._layer.title,canQueryRelated:!1,source:this,capabilities:this._layer.capabilities,databaseType:this._databaseType,requestStandardised:!0}}},{key:"queryAttachments",value:function(){var e=Object(n.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",[]);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"getFeatureByObjectId",value:function(){var e=Object(n.a)(c.a.mark((function e(t){var r,a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=new m.a).where=this.objectIdField+"="+t.toString(),e.next=4,this._layer.queryFeatures(r);case 4:return a=e.sent,e.abrupt("return",1===a.features.length?a.features[0]:null);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getOwningSystemUrl",value:function(){var e=Object(n.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return","");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"getIdentityUser",value:function(){var e=Object(n.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return","");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}],[{key:"_cloneAttr",value:function(e){var t={};for(var r in e)t[r]=e[r];return t}},{key:"create",value:function(e,t){var n=e.layerDefinition.objectIdField,i=e.layerDefinition.typeIdField?e.layerDefinition.typeIdField:"",s=[];if(e.layerDefinition.types){var u,l=Object(a.a)(e.layerDefinition.types);try{for(l.s();!(u=l.n()).done;){var o=u.value;s.push(v.a.fromJSON(o))}}catch(q){l.e(q)}finally{l.f()}}var c=e.layerDefinition.geometryType;void 0===c&&(c=e.featureSet.geometryType||"");var d=e.featureSet.features,h=t.toJSON();if(""===n||void 0===n){var f,p=!1,y=Object(a.a)(e.layerDefinition.fields);try{for(y.s();!(f=y.n()).done;){var m=f.value;if("oid"===m.type||"esriFieldTypeOID"===m.type){n=m.name,p=!0;break}}}catch(q){y.e(q)}finally{y.f()}if(!1===p){for(var k="FID",w=!0,x=0;w;){var F,S=!0,O=Object(a.a)(e.layerDefinition.fields);try{for(O.s();!(F=O.n()).done;){if(F.value.name===k){S=!1;break}}}catch(q){O.e(q)}finally{O.f()}!0===S?w=!1:k="FID"+(++x).toString()}e.layerDefinition.fields.push({type:"esriFieldTypeOID",name:k,alias:k});for(var j=[],I=0;I<d.length;I++)j.push({geometry:e.featureSet.features[I].geometry,attributes:e.featureSet.features[I].attributes?this._cloneAttr(e.featureSet.features[I].attributes):{}}),j[I].attributes[k]=I;d=j,n=k}}var C,D=[],R=Object(a.a)(e.layerDefinition.fields);try{for(R.s();!(C=R.n()).done;){var T=C.value;T instanceof g.a?D.push(T):D.push(g.a.fromJSON(T))}}catch(q){R.e(q)}finally{R.f()}var N=c;switch(N){case"esriGeometryPoint":N="point";break;case"esriGeometryPolyline":N="polyline";break;case"esriGeometryPolygon":N="polygon";break;case"esriGeometryExtent":N="extent";break;case"esriGeometryMultipoint":N="multipoint"}var E,A=Object(a.a)(d);try{for(A.s();!(E=A.n()).done;){var L=E.value;L.geometry&&L.geometry instanceof b.a==0&&(L.geometry.type=N,void 0===L.geometry.spatialReference&&(L.geometry.spatialReference=h))}}catch(q){A.e(q)}finally{A.f()}var P={outFields:["*"],source:d,fields:D,types:s,typeIdField:i,objectIdField:n,spatialReference:t};return P.geometryType=N||"point",new r({layer:new _.default(P),spatialReference:t,isTable:null===N||""===N})}}]),r}(h.a)},1224:function(e,t,r){"use strict";r.r(t),r.d(t,"constructAssociationMetaDataFeatureSetFromUrl",(function(){return pe})),r.d(t,"constructFeatureSet",(function(){return ue})),r.d(t,"constructFeatureSetFromPortalItem",(function(){return Oe})),r.d(t,"constructFeatureSetFromRelationship",(function(){return be})),r.d(t,"constructFeatureSetFromUrl",(function(){return ie})),r.d(t,"convertToFeatureSet",(function(){return Se})),r.d(t,"createFeatureSetCollectionFromMap",(function(){return me})),r.d(t,"createFeatureSetCollectionFromService",(function(){return ke})),r.d(t,"getPortal",(function(){return we})),r.d(t,"initialiseMetaDataCache",(function(){return re})),r.d(t,"lookupUser",(function(){return xe}));var a=r(60),n=r(5),i=r(142),s=r(143),u=r(144),l=r(145),o=r(155),c=r(154),d=r.n(c),h=r(342),f=r(186),p=r(1041),y=r(885),b=r(220),_=r(338),v=r(1043),g=r(887),m=r(473),k=r(470),w=r(888),x=r(375),F=r(526),S=r(886),O=r(433);var j=function(){function e(){Object(i.a)(this,e)}return Object(s.a)(e,[{key:"clone",value:function(){var t=new e;return t.field=this.field,t.tofieldname=this.tofieldname,t.typeofstat=this.typeofstat,t.workingexpr=this.workingexpr,t}},{key:"toStatisticsName",value:function(){switch(this.typeofstat.toUpperCase()){case"MIN":return"min";case"MAX":return"max";case"SUM":return"sum";case"COUNT":default:return"count";case"VAR":return"var";case"STDDEV":return"stddev";case"AVG":return"avg"}}}],[{key:"parseStatField",value:function(t,r,a){var n=new e;n.field=t;var i=O.WhereClause.create(r,a),s=function(e){if("function"===e.parseTree.type){if(0===e.parseTree.args.value.length)return{name:e.parseTree.name,expr:null};if(e.parseTree.args.value.length>1)throw new Error("Statistic does not have 1 or 0 Parameters");var t=O.WhereClause.create(Object(F.j)(e.parseTree.args.value[0],x.a.Standardised,e.parameters),e.fieldsIndex);return{name:e.parseTree.name,expr:t}}return null}(i);if(null===s)throw new Error("Invalid Statistic Function");var u=s.name.toUpperCase().trim();if("MIN"===u){if(n.typeofstat="MIN",n.workingexpr=s.expr,null===i)throw new Error("Invalid Statistic Function Parameters")}else if("MAX"===u){if(n.typeofstat="MAX",n.workingexpr=s.expr,null===i)throw new Error("Invalid Statistic Function Parameters")}else if("COUNT"===u)n.typeofstat="COUNT",n.workingexpr=s.expr;else if("STDEV"===u){if(n.typeofstat="STDDEV",n.workingexpr=s.expr,null===i)throw new Error("Invalid Statistic Function Parameters")}else if("SUM"===u){if(n.typeofstat="SUM",n.workingexpr=s.expr,null===i)throw new Error("Invalid Statistic Function Parameters")}else if("MEAN"===u){if(n.typeofstat="AVG",n.workingexpr=s.expr,null===i)throw new Error("Invalid Statistic Function Parameters")}else if("AVG"===u){if(n.typeofstat="AVG",n.workingexpr=s.expr,null===i)throw new Error("Invalid Statistic Function Parameters")}else{if("VAR"!==u)throw new Error("Invalid Statistic Function");if(n.typeofstat="VAR",n.workingexpr=s.expr,null===i)throw new Error("Invalid Statistic Function Parameters")}return n}}]),e}(),I=r(326),C=r(185),D=r(356),R=r(329);function T(e){if(!e)return"COUNT";switch(e.toLowerCase()){case"max":return"MAX";case"var":case"variance":return"VAR";case"avg":case"average":case"mean":return"AVG";case"min":return"MIN";case"sum":return"SUM";case"stdev":case"stddev":return"STDDEV";case"count":return"COUNT"}return"COUNT"}var N=function(e){Object(u.a)(r,e);var t=Object(l.a)(r);function r(e){var a;return Object(i.a)(this,r),(a=t.call(this,e))._decodedStatsfield=[],a._decodedGroupbyfield=[],a._candosimplegroupby=!0,a.phsyicalgroupbyfields=[],a.objectIdField="ROW__ID",a._internalObjectIdField="ROW__ID",a._adaptedFields=[],a.declaredClass="esri.arcade.featureset.actions.Aggregate",a._uniqueIds=1,a._maxQuery=10,a._maxProcessing=10,a._parent=e.parentfeatureset,a._config=e,a}return Object(s.a)(r,[{key:"isTable",value:function(){return!0}},{key:"_getSet",value:function(){var e=Object(o.a)(d.a.mark((function e(t){var r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==this._wset){e.next=5;break}return e.next=3,this._getFilteredSet("",null,null,null,t);case 3:return r=e.sent,e.abrupt("return",(this._wset=r,this._wset));case 5:return e.abrupt("return",this._wset);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_isInFeatureSet",value:function(){return x.b.InFeatureSet}},{key:"_nextUniqueName",value:function(e){for(;1===e["T"+this._uniqueIds.toString()];)this._uniqueIds++;var t="T"+this._uniqueIds.toString();return e[t]=1,t}},{key:"_convertToEsriFieldType",value:function(e){return e}},{key:"_initialiseFeatureSet",value:function(){var e={},t=!1,r=1,n=this._parent?this._parent.getFieldsIndex():new R.a([]);for(this.objectIdField="ROW__ID",this.globalIdField="";!1===t;){for(var i=!1,s=0;s<this._config.groupbyfields.length;s++)if(this._config.groupbyfields[s].name.toLowerCase()===this.objectIdField.toLowerCase()){i=!0;break}if(!1===i)for(var u=0;u<this._config.statsfields.length;u++)if(this._config.statsfields[u].name.toLowerCase()===this.objectIdField.toLowerCase()){i=!0;break}!1===i?t=!0:(this.objectIdField="ROW__ID"+r.toString(),r++)}var l,o=Object(a.a)(this._config.statsfields);try{for(o.s();!(l=o.n()).done;){var c=l.value,d=new j;d.field=c.name,d.tofieldname=c.name,d.workingexpr=c.expression instanceof O.WhereClause?c.expression:O.WhereClause.create(c.expression,n),d.typeofstat=T(c.statistic),this._decodedStatsfield.push(d)}}catch(W){o.e(W)}finally{o.f()}this._decodedGroupbyfield=[];var h,f=Object(a.a)(this._config.groupbyfields);try{for(f.s();!(h=f.n()).done;){var p=h.value,y={name:p.name,singlefield:null,tofieldname:p.name,expression:p.expression instanceof O.WhereClause?p.expression:O.WhereClause.create(p.expression,n)};this._decodedGroupbyfield.push(y)}}catch(W){f.e(W)}finally{f.f()}if(null!==this._parent){this.geometryType=this._parent.geometryType,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField="";var b,_=Object(a.a)(this._parent.fields);try{for(_.s();!(b=_.n()).done;){e[b.value.name.toUpperCase()]=1}}catch(W){_.e(W)}finally{_.f()}this.types=null}else this.geometryType=x.m.point,this.typeIdField="",this.types=null,this.spatialReference=new C.a({wkid:4326});this.fields=[];var g=new j;g.field=this._nextUniqueName(e),g.tofieldname=this.objectIdField,g.workingexpr=O.WhereClause.create(this._parent.objectIdField,this._parent.getFieldsIndex()),g.typeofstat="MIN",this._decodedStatsfield.push(g);var m,k=Object(a.a)(this._decodedGroupbyfield);try{for(k.s();!(m=k.n()).done;){var w=m.value,S=new D.a;if(w.name=this._nextUniqueName(e),S.name=w.tofieldname,S.alias=S.name,Object(F.c)(w.expression)){var I=this._parent.getField(Object(F.i)(w.expression,x.a.Standardised));if(!I)throw new Error("Field is not present for Aggregation");w.name=I.name,w.singlefield=I.name,this.phsyicalgroupbyfields.push(I.name),S.type=I.type}else{S.type=this._convertToEsriFieldType(Object(F.f)(w.expression,this._parent.fields));var N=new D.a;N.name=w.name,N.alias=N.name,this.phsyicalgroupbyfields.push(w.name),this._adaptedFields.push(new v.d(N,w.expression)),this._candosimplegroupby=!1}this.fields.push(S)}}catch(W){k.e(W)}finally{k.f()}if(this._adaptedFields.length>0){var E,A=Object(a.a)(this._parent.fields);try{for(A.s();!(E=A.n()).done;){var L=E.value;this._adaptedFields.push(new v.c(L))}}catch(W){A.e(W)}finally{A.f()}}for(var P=0;P<this._decodedStatsfield.length;P++){var q=new D.a,G=null,B=this._decodedStatsfield[P];B.field=this._nextUniqueName(e),B.tofieldname===this.objectIdField&&(this._internalObjectIdField=B.field),q.name=B.tofieldname,q.alias=q.name;var U=null!==B.workingexpr&&Object(F.c)(B.workingexpr)?Object(F.i)(B.workingexpr,x.a.Standardised):"";switch(this._decodedStatsfield[P].typeofstat){case"SUM":if(""!==U){if(!(G=this._parent.getField(U)))throw new Error("Field is not present for Aggregation");q.type=G.type}else q.type="double";break;case"MIN":case"MAX":if(""!==U){if(!(G=this._parent.getField(U)))throw new Error("Field is not present for Aggregation");q.type=G.type}else q.type="double";break;case"COUNT":q.type="integer";break;case"STDDEV":case"VAR":case"AVG":if(""!==U&&!(G=this._parent.getField(U)))throw new Error("Field is not present for Aggregation");q.type="double"}this.fields.push(q)}}},{key:"_canDoAggregates",value:function(){var e=Object(o.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!1);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"_getFeatures",value:function(){var e=Object(o.a)(d.a.mark((function e(t,r,a,n){var i;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(-1!==r&&this._featureCache[r],i=this._maxQuery,!0!==this._checkIfNeedToExpandKnownPage(t,i)){e.next=8;break}return e.next=5,this._expandPagedSet(t,i,0,0,n);case 5:e.t0=this._getFeatures(t,r,a,n),e.next=9;break;case 8:e.t0="success";case 9:return e.abrupt("return",e.t0);case 10:case"end":return e.stop()}}),e,this)})));return function(t,r,a,n){return e.apply(this,arguments)}}()},{key:"_getFilteredSet",value:function(){var e=Object(o.a)(d.a.mark((function e(t,r,n,i,s){var u,l,o,c,h,f,p,b,_,m,x,S,O;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""===t){e.next=2;break}return e.abrupt("return",new k.a([],[],!0,null));case 2:return u=null,l={ordered:!1,nowhereclause:!1},e.next=6,this._ensureLoaded();case 6:if(null===n){e.next=15;break}o=0;case 8:if(!(o<this._decodedStatsfield.length)){e.next=15;break}if(!0!==Object(F.h)(n,this._decodedStatsfield[o].tofieldname)){e.next=12;break}return l.nowhereclause=!0,n=null,e.abrupt("break",15);case 12:o++,e.next=8;break;case 15:if(null===i){e.next=44;break}l.ordered=!0,c=0;case 18:if(!(c<this._decodedStatsfield.length)){e.next=25;break}if(!0!==i.scanForField(this._decodedStatsfield[c].tofieldname)){e.next=22;break}return i=null,l.ordered=!1,e.abrupt("break",25);case 22:c++,e.next=18;break;case 25:if(null===i){e.next=44;break}h=Object(a.a)(this._decodedGroupbyfield),e.prev=27,h.s();case 29:if((f=h.n()).done){e.next=36;break}if(null!==(p=f.value).singlefield||!0!==i.scanForField(p.tofieldname)){e.next=34;break}return i=null,l.ordered=!1,e.abrupt("break",36);case 34:e.next=29;break;case 36:e.next=41;break;case 38:e.prev=38,e.t0=e.catch(27),h.e(e.t0);case 41:return e.prev=41,h.f(),e.finish(41);case 44:if(e.t1=!1!==this._candosimplegroupby,!e.t1){e.next=49;break}return e.next=48,this._parent._canDoAggregates(this.phsyicalgroupbyfields,this._decodedStatsfield,"",null,null);case 48:e.t1=e.sent;case 49:if(!e.t1){e.next=58;break}return b=null,n&&(b=this._reformulateWhereClauseWithoutGroupByFields(n)),_=null,i&&(_=this._reformulateOrderClauseWithoutGroupByFields(i)),e.next=56,this._parent._getAggregatePagesDataSourceDefinition(this.phsyicalgroupbyfields,this._decodedStatsfield,"",null,b,_,this._internalObjectIdField);case 56:return m=e.sent,e.abrupt("return",(this._checkCancelled(s),u=!0===l.nowhereclause?new k.a(m._candidates.slice(0).concat(m._known.slice(0)),[],!0===l.ordered&&m._ordered,this._clonePageDefinition(m.pagesDefinition)):new k.a(m._candidates.slice(0),m._known.slice(0),!0===l.ordered&&m._ordered,this._clonePageDefinition(m.pagesDefinition))));case 58:return x=this._parent,this._adaptedFields.length>0&&(x=new v.a({parentfeatureset:this._parent,adaptedFields:this._adaptedFields,extraFilter:null})),!0===l.nowhereclause?u=new k.a(["GETPAGES"],[],!1,{aggregatefeaturesetpagedefinition:!0,resultOffset:0,resultRecordCount:this._maxQuery,internal:{fullyResolved:!1,workingItem:null,type:"manual",iterator:null,set:[],subfeatureset:new g.a({parentfeatureset:x,orderbyclause:new w.a(this.phsyicalgroupbyfields.join(",")+","+this._parent.objectIdField+" ASC")})}}):(S=x,null!==n&&(O=null,n&&(O=this._reformulateWhereClauseWithoutGroupByFields(n)),S=new y.a({parentfeatureset:S,whereclause:O})),u=new k.a(["GETPAGES"],[],!1,{aggregatefeaturesetpagedefinition:!0,resultOffset:0,resultRecordCount:this._maxQuery,internal:{fullyResolved:!1,workingItem:null,type:"manual",iterator:null,set:[],subfeatureset:new g.a({parentfeatureset:S,orderbyclause:new w.a(this.phsyicalgroupbyfields.join(",")+","+this._parent.objectIdField+" ASC")})}})),e.abrupt("return",u);case 61:case"end":return e.stop()}}),e,this,[[27,38,41,44]])})));return function(t,r,a,n,i){return e.apply(this,arguments)}}()},{key:"_reformulateWhereClauseWithoutStatsFields",value:function(e){var t,r=Object(a.a)(this._decodedStatsfield);try{for(r.s();!(t=r.n()).done;){var n=t.value;e=Object(F.g)(e,n.tofieldname,Object(F.i)(n.workingexpr,x.a.Standardised),this._parent.getFieldsIndex())}}catch(i){r.e(i)}finally{r.f()}return e}},{key:"_reformulateWhereClauseWithoutGroupByFields",value:function(e){var t,r=Object(a.a)(this._decodedGroupbyfield);try{for(r.s();!(t=r.n()).done;){var n=t.value;n.tofieldname!==n.name&&(e=Object(F.g)(e,n.tofieldname,Object(F.i)(n.expression,x.a.Standardised),this._parent.getFieldsIndex()))}}catch(i){r.e(i)}finally{r.f()}return e}},{key:"_reformulateOrderClauseWithoutGroupByFields",value:function(e){var t,r=[],n=Object(a.a)(this._decodedGroupbyfield);try{for(n.s();!(t=n.n()).done;){var i=t.value;i.tofieldname!==i.name&&r.push({field:i.tofieldname,newfield:i.name})}}catch(s){n.e(s)}finally{n.f()}return r.length>0?e.replaceFields(r):e}},{key:"_clonePageDefinition",value:function(e){return null===e?null:!0===e.aggregatefeaturesetpagedefinition?{aggregatefeaturesetpagedefinition:!0,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,internal:e.internal}:this._parent._clonePageDefinition(e)}},{key:"_refineSetBlock",value:function(){var e=Object(o.a)(d.a.mark((function e(t,r,a){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!0!==this._checkIfNeedToExpandCandidatePage(t,this._maxQuery)){e.next=4;break}return e.next=3,this._expandPagedSet(t,this._maxQuery,0,0,a);case 3:return e.abrupt("return",this._refineSetBlock(t,r,a));case 4:return this._checkCancelled(a),t._candidates.length,this._refineKnowns(t,r),t._candidates.length,e.abrupt("return",(t._candidates.length,t));case 9:case"end":return e.stop()}}),e,this)})));return function(t,r,a){return e.apply(this,arguments)}}()},{key:"_expandPagedSet",value:function(e,t,r,a,n){return this._expandPagedSetFeatureSet(e,t,r,a,n)}},{key:"_getPhysicalPage",value:function(){var e=Object(o.a)(d.a.mark((function e(t,r,n){var i,s,u,l,o,c,h,f,p,y,_;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!0!==t.pagesDefinition.aggregatefeaturesetpagedefinition){e.next=2;break}return e.abrupt("return",this._sequentialGetPhysicalItem(t,t.pagesDefinition.resultRecordCount,n,[]));case 2:return e.next=4,this._getAgregagtePhysicalPage(t,r,n);case 4:i=e.sent,s=Object(a.a)(i);try{for(s.s();!(u=s.n()).done;){l=u.value,o={geometry:l.geometry,attributes:{}},c=Object(a.a)(this._decodedGroupbyfield);try{for(c.s();!(h=c.n()).done;)f=h.value,o.attributes[f.tofieldname]=l.attributes[f.name]}catch(d){c.e(d)}finally{c.f()}p=Object(a.a)(this._decodedStatsfield);try{for(p.s();!(y=p.n()).done;)_=y.value,o.attributes[_.tofieldname]=l.attributes[_.field]}catch(d){p.e(d)}finally{p.f()}this._featureCache[o.attributes[this.objectIdField]]=new b.a(o)}}catch(d){s.e(d)}finally{s.f()}return e.abrupt("return",i.length);case 8:case"end":return e.stop()}}),e,this)})));return function(t,r,a){return e.apply(this,arguments)}}()},{key:"_sequentialGetPhysicalItem",value:function(e,t,r,a){var n=this;return new Promise((function(i,s){null===e.pagesDefinition.internal.iterator&&(e.pagesDefinition.internal.iterator=e.pagesDefinition.internal.subfeatureset.iterator(r)),!0===e.pagesDefinition.internal.fullyResolved||0===t?i(a.length):n._nextAggregateItem(e,t,r,a,(function(s){null===s?i(a.length):(t-=1,i(n._sequentialGetPhysicalItem(e,t,r,a)))}),s)}))}},{key:"_nextAggregateItem",value:function(e,t,r,a,n,i){var s=this;try{Object(_.y)(e.pagesDefinition.internal.iterator.next()).then((function(u){if(null===u)if(null!==e.pagesDefinition.internal.workingItem){var l=s._calculateAndAppendAggregateItem(e.pagesDefinition.internal.workingItem);a.push(l),e.pagesDefinition.internal.workingItem=null,e.pagesDefinition.internal.set.push(l.attributes[s.objectIdField]),e.pagesDefinition.internal.fullyResolved=!0,n(null)}else e.pagesDefinition.internal.fullyResolved=!0,n(null);else{var o=s._generateAggregateHash(u);if(null===e.pagesDefinition.internal.workingItem)e.pagesDefinition.internal.workingItem={features:[u],id:o};else{if(o!==e.pagesDefinition.internal.workingItem.id){var c=s._calculateAndAppendAggregateItem(e.pagesDefinition.internal.workingItem);return a.push(c),e.pagesDefinition.internal.workingItem=null,e.pagesDefinition.internal.set.push(c.attributes[s.objectIdField]),t-=1,e.pagesDefinition.internal.workingItem={features:[u],id:o},void n(c)}e.pagesDefinition.internal.workingItem.features.push(u)}s._nextAggregateItem(e,t,r,a,n,i)}}),i)}catch(u){i(u)}}},{key:"_calculateFieldStat",value:function(e,t,r){for(var a=[],n=0;n<e.features.length;n++)if(null!==t.workingexpr){var i=t.workingexpr.calculateValue(e.features[n]);null!==i&&a.push(i)}else a.push(null);switch(t.typeofstat){case"MIN":r.attributes[t.tofieldname]=Object(S.a)("min",a,-1);break;case"MAX":r.attributes[t.tofieldname]=Object(S.a)("max",a,-1);break;case"SUM":r.attributes[t.tofieldname]=Object(S.a)("sum",a,-1);break;case"COUNT":r.attributes[t.tofieldname]=a.length;break;case"VAR":r.attributes[t.tofieldname]=Object(S.a)("var",a,-1);break;case"STDDEV":r.attributes[t.tofieldname]=Object(S.a)("stddev",a,-1);break;case"AVG":r.attributes[t.tofieldname]=Object(S.a)("avg",a,-1)}return!0}},{key:"_calculateAndAppendAggregateItem",value:function(e){var t,r={attributes:{},geometry:null},n=Object(a.a)(this._decodedGroupbyfield);try{for(n.s();!(t=n.n()).done;){var i=t.value,s=i.singlefield?e.features[0].attributes[i.singlefield]:i.expression.calculateValue(e.features[0]);r.attributes[i.tofieldname]=s}}catch(h){n.e(h)}finally{n.f()}var u,l=Object(a.a)(this._decodedStatsfield);try{for(l.s();!(u=l.n()).done;){var o=u.value;this._calculateFieldStat(e,o,r)}}catch(h){l.e(h)}finally{l.f()}for(var c=[],d=0;d<this._decodedStatsfield.length;d++)c.push(this._calculateFieldStat(e,this._decodedStatsfield[d],r));return this._featureCache[r.attributes[this.objectIdField]]=new b.a({attributes:r.attributes,geometry:r.geometry}),r}},{key:"_generateAggregateHash",value:function(e){var t,r="",n=Object(a.a)(this._decodedGroupbyfield);try{for(n.s();!(t=n.n()).done;){var i=t.value,s=i.singlefield?e.attributes[i.singlefield]:i.expression.calculateValue(e);r+=null==s?":":":"+s.toString()}}catch(u){n.e(u)}finally{n.f()}return Object(I.a)(r,I.b.String)}},{key:"_stat",value:function(){var e=Object(o.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{calculated:!1});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"getFeatureByObjectId",value:function(){var e=Object(o.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}],[{key:"registerAction",value:function(){m.a._featuresetFunctions.groupby=function(e,t){return new r({parentfeatureset:this,groupbyfields:e,statsfields:t})}}}]),r}(m.a),E=r(1044),A=r(1045),L=r(632),P=r(168),q=r(404),G=r(188),B=(r(159),r(147),r(156),r(529),r(722)),U=(r(152),r(183),r(250),r(182),r(410)),W=r(288),M=r(254),Q=(r(669),r(575),r(629)),V=(r(177),r(630)),J=r(545),K=(r(285),r(530),r(833)),z=r(821),Z=r(412),H=function(e){Object(u.a)(r,e);var t=Object(l.a)(r);function r(e){var a;return Object(i.a)(this,r),(a=t.call(this,e)).declaredClass="esri.arcade.featureset.sources.FeatureLayerDynamic",a._removeGeometry=!1,a._overrideFields=null,a.formulaCredential=null,a._pageJustIds=!1,a._requestStandardised=!1,a._useDefinitionExpression=!0,e.spatialReference&&(a.spatialReference=e.spatialReference),a._transparent=!0,a._maxProcessing=1e3,a._layer=e.layer,a._wset=null,void 0!==e.outFields&&(a._overrideFields=e.outFields),void 0!==e.includeGeometry&&(a._removeGeometry=!1===e.includeGeometry),a}return Object(s.a)(r,[{key:"_maxQueryRate",value:function(){return x.f}},{key:"end",value:function(){return this._layer}},{key:"optimisePagingFeatureQueries",value:function(e){this._pageJustIds=e}},{key:"convertQueryToLruCacheKey",value:function(e){var t=Object(x.p)(e.toJSON());return Object(I.a)(t,I.b.String)}},{key:"loadImpl",value:function(){var e=Object(o.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!0!==this._layer.loaded){e.next=4;break}e.t0=(this._initialiseFeatureSet(),this),e.next=8;break;case 4:return e.next=6,this._layer.load();case 6:this._initialiseFeatureSet(),e.t0=this;case 8:return e.abrupt("return",e.t0);case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_initialiseFeatureSet",value:function(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this._layer.geometryType,this.fields=this._layer.fields.slice(0),this._layer.outFields)if(1===this._layer.outFields.length&&"*"===this._layer.outFields[0]);else{var e,t=[],r=Object(a.a)(this.fields);try{for(r.s();!(e=r.n()).done;){var n=e.value;if("oid"===n.type)t.push(n);else{var i,s=Object(a.a)(this._layer.outFields);try{for(s.s();!(i=s.n()).done;){if(i.value.toLowerCase()===n.name.toLowerCase()){t.push(n);break}}}catch(v){s.e(v)}finally{s.f()}}}}catch(v){r.e(v)}finally{r.f()}this.fields=t}if(null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{var u,l=[],o=[],c=Object(a.a)(this.fields);try{for(c.s();!(u=c.n()).done;){var d=u.value;if("oid"===d.type)l.push(d),o.push(d.name);else{var h,f=Object(a.a)(this._overrideFields);try{for(f.s();!(h=f.n()).done;){if(h.value.toLowerCase()===d.name.toLowerCase()){l.push(d),o.push(d.name);break}}}catch(v){f.e(v)}finally{f.f()}}}}catch(v){c.e(v)}finally{c.f()}this.fields=l,this._overrideFields=o}if(this._layer.source&&this._layer.source.sourceJSON){var p=this._layer.source.sourceJSON.currentVersion;!0===this._layer.source.sourceJSON.useStandardizedQueries?(this._databaseType=x.a.StandardisedNoInterval,null!=p&&p>=10.61&&(this._databaseType=x.a.Standardised)):null!=p&&(p>=10.5&&(this._databaseType=x.a.StandardisedNoInterval,this._requestStandardised=!0),p>=10.61&&(this._databaseType=x.a.Standardised))}this.objectIdField=this._layer.objectIdField;var y,b=Object(a.a)(this.fields);try{for(b.s();!(y=b.n()).done;){var _=y.value;"global-id"===_.type&&(this.globalIdField=_.name)}}catch(v){b.e(v)}finally{b.f()}this.hasM=this._layer.supportsM,this.hasZ=this._layer.supportsZ,this.typeIdField=this._layer.typeIdField,this.types=this._layer.types}},{key:"_isInFeatureSet",value:function(){return x.b.InFeatureSet}},{key:"_refineSetBlock",value:function(){var e=Object(o.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"_candidateIdTransform",value:function(e){return e}},{key:"_getSet",value:function(){var e=Object(o.a)(d.a.mark((function e(t){var r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==this._wset){e.next=7;break}return e.next=3,this._ensureLoaded();case 3:return e.next=5,this._getFilteredSet("",null,null,null,t);case 5:return r=e.sent,e.abrupt("return",(this._wset=r,r));case 7:return e.abrupt("return",this._wset);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_runDatabaseProbe",value:function(){var e=Object(o.a)(d.a.mark((function e(t){var r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ensureLoaded();case 2:return(r=new M.a).where=t.replace("OBJECTID",this._layer.objectIdField),e.prev=4,e.next=7,this._layer.queryObjectIds(r);case 7:return e.abrupt("return",!0);case 10:return e.prev=10,e.t0=e.catch(4),e.abrupt("return",!1);case 13:case"end":return e.stop()}}),e,this,[[4,10]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_canUsePagination",value:function(){return!(!this._layer.capabilities||!this._layer.capabilities.query||!0!==this._layer.capabilities.query.supportsPagination)}},{key:"_cacheableFeatureSetSourceKey",value:function(){return this._layer.url}},{key:"pbfSupportedForQuery",value:function(e){return!e.outStatistics&&this._layer&&this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsFormatPBF&&!0===this._layer.capabilities.query.supportsQuantizationEditMode}},{key:"queryPBF",value:function(){var e=Object(o.a)(d.a.mark((function e(t){var r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.quantizationParameters={mode:"edit"},e.next=3,Object(U.executeQueryPBF)(this._layer.parsedUrl,t,new K.b({}));case 3:return r=e.sent,e.abrupt("return",W.default.fromJSON(Object(G.j)(r.data)).unquantize());case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"gdbVersion",get:function(){return this._layer&&this._layer.capabilities&&this._layer.capabilities.data&&this._layer.capabilities.data.isVersioned?this._layer.gdbVersion?this._layer.gdbVersion:"SDE.DEFAULT":""}},{key:"nativeCapabilities",value:function(){return{title:this._layer.title,source:this,canQueryRelated:!0,capabilities:this._layer.capabilities,databaseType:this._databaseType,requestStandardised:this._requestStandardised}}},{key:"executeQuery",value:function(e,t){var r=this,a="execute"===t?B.a:"executeForCount"===t?Q.a:V.a,n="execute"===t&&this.pbfSupportedForQuery(e),i=null;if(this.recentlyUsedQueries){var s=this.convertQueryToLruCacheKey(e);null===(i=this.recentlyUsedQueries.getFromCache(s))&&(i=!0!==n?a(this._layer.parsedUrl.path,e):this.queryPBF(e),this.recentlyUsedQueries.addToCache(s,i),i=i.catch((function(e){throw r.recentlyUsedQueries.removeFromCache(s),e})))}return this.featureSetQueryInterceptor&&this.featureSetQueryInterceptor.preLayerQueryCallback({layer:this._layer,query:e,method:t}),null===i&&(i=!0!==n?a(this._layer.parsedUrl.path,e):this.queryPBF(e)),i}},{key:"_getFilteredSet",value:function(){var e=Object(o.a)(d.a.mark((function e(t,r,a,n,i){var s,u,l,o,c;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.databaseType();case 2:if(s=e.sent,!this.isTable()||!r||null===t||""===t){e.next=5;break}return e.abrupt("return",new k.a([],[],!0,null));case 5:if(!this._canUsePagination()){e.next=7;break}return e.abrupt("return",this._getFilteredSetUsingPaging(t,r,a,n,i));case 7:return u="",l=!1,null!==n&&this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsOrderBy&&(u=n.constructClause(),l=!0),(o=new M.a).where=null===a?null===r?"1=1":"":Object(F.i)(a,s),this._requestStandardised&&(o.sqlFormat="standard"),o.spatialRelationship=this._makeRelationshipEnum(t),o.outSpatialReference=this.spatialReference,o.orderByFields=""!==u?u.split(","):null,o.geometry=null===r?null:r,o.relationParameter=this._makeRelationshipParam(t),e.next=13,this.executeQuery(o,"executeForIds");case 13:return null===(c=e.sent)&&(c=[]),this._checkCancelled(i),e.abrupt("return",new k.a([],c,l,null));case 16:case"end":return e.stop()}}),e,this)})));return function(t,r,a,n,i){return e.apply(this,arguments)}}()},{key:"_expandPagedSet",value:function(e,t,r,a,n){return this._expandPagedSetFeatureSet(e,t,r,a,n)}},{key:"_getFilteredSetUsingPaging",value:function(){var e=Object(o.a)(d.a.mark((function e(t,r,a,n,i){var s,u,l,o,c,h,f,p,y;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s="",u=!1,null!==n&&this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsOrderBy&&(s=n.constructClause(),u=!0),e.next=4,this.databaseType();case 4:return l=e.sent,o=null===a?null===r?"1=1":"":Object(F.i)(a,l),this._layer.definitionExpression&&this._useDefinitionExpression&&(o=""!==o?"(("+this._layer.definitionExpression+") AND ("+o+"))":this._layer.definitionExpression),c=this._maxQueryRate(),void 0!==(h=this._layer.capabilities.query.maxRecordCount)&&h<c&&(c=h),f=null,!0===this._pageJustIds?f=new k.a([],["GETPAGES"],u,{spatialRel:this._makeRelationshipEnum(t),relationParam:this._makeRelationshipParam(t),outFields:this._layer.objectIdField,resultRecordCount:c,resultOffset:0,geometry:null===r?null:r,where:o,orderByFields:s,returnGeometry:!1,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}}):(p=!0,!0===this._removeGeometry&&(p=!1),y=null!==this._overrideFields?this._overrideFields:this._fieldsIncludingObjectId(this._layer.outFields?this._layer.outFields:["*"]),f=new k.a([],["GETPAGES"],u,{spatialRel:this._makeRelationshipEnum(t),relationParam:this._makeRelationshipParam(t),outFields:y.join(","),resultRecordCount:c,resultOffset:0,geometry:null===r?null:r,where:o,orderByFields:s,returnGeometry:p,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}})),e.next=14,this._expandPagedSet(f,c,0,1,i);case 14:return e.abrupt("return",f);case 15:case"end":return e.stop()}}),e,this)})));return function(t,r,a,n,i){return e.apply(this,arguments)}}()},{key:"_clonePageDefinition",value:function(e){return null===e?null:!0!==e.groupbypage?{groupbypage:!1,spatialRel:e.spatialRel,relationParam:e.relationParam,outFields:e.outFields,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,geometry:e.geometry,where:e.where,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}:{groupbypage:!0,spatialRel:e.spatialRel,relationParam:e.relationParam,outFields:e.outFields,resultRecordCount:e.resultRecordCount,useOIDpagination:e.useOIDpagination,generatedOid:e.generatedOid,groupByFieldsForStatistics:e.groupByFieldsForStatistics,resultOffset:e.resultOffset,outStatistics:e.outStatistics,geometry:e.geometry,where:e.where,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}}},{key:"_getPhysicalPage",value:function(){var e=Object(o.a)(d.a.mark((function e(t,r,a){var n,i,s,u,l,o,c;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.pagesDefinition.internal.lastRetrieved,i=n,s=t.pagesDefinition.internal.lastPage,u=new M.a,this._requestStandardised&&(u.sqlFormat="standard"),u.spatialRelationship=t.pagesDefinition.spatialRel,u.relationParameter=t.pagesDefinition.relationParam,u.outFields=t.pagesDefinition.outFields.split(","),u.num=t.pagesDefinition.resultRecordCount,u.start=t.pagesDefinition.internal.lastPage,u.geometry=t.pagesDefinition.geometry,u.where=t.pagesDefinition.where,u.orderByFields=""!==t.pagesDefinition.orderByFields?t.pagesDefinition.orderByFields.split(","):null,u.returnGeometry=t.pagesDefinition.returnGeometry,u.outSpatialReference=this.spatialReference,e.next=4,this.executeQuery(u,"execute");case 4:if(l=e.sent,this._checkCancelled(a),t.pagesDefinition.internal.lastPage===s){e.next=7;break}return e.abrupt("return","done");case 7:for(o=0;o<l.features.length;o++)t.pagesDefinition.internal.set[i+o]=l.features[o].attributes[this._layer.objectIdField];if(!1===this._pageJustIds)for(c=0;c<l.features.length;c++)this._featureCache[l.features[c].attributes[this._layer.objectIdField]]=l.features[c];return e.abrupt("return",((void 0===l.exceededTransferLimit&&l.features.length!==t.pagesDefinition.resultRecordCount||!1===l.exceededTransferLimit)&&(t.pagesDefinition.internal.fullyResolved=!0),t.pagesDefinition.internal.lastRetrieved=n+l.features.length,t.pagesDefinition.internal.lastPage+=t.pagesDefinition.resultRecordCount,"done"));case 10:case"end":return e.stop()}}),e,this)})));return function(t,r,a){return e.apply(this,arguments)}}()},{key:"_fieldsIncludingObjectId",value:function(e){if(null===e)return[this.objectIdField];var t=e.slice(0);if(t.includes("*"))return t;var r,n=!1,i=Object(a.a)(t);try{for(i.s();!(r=i.n()).done;){if(r.value.toUpperCase()===this.objectIdField.toUpperCase()){n=!0;break}}}catch(s){i.e(s)}finally{i.f()}return!1===n&&t.push(this.objectIdField),t}},{key:"_getFeatures",value:function(){var e=Object(o.a)(d.a.mark((function e(t,r,a,n){var i,s,u,l,o,c,h,f,p;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=[],-1!==r&&void 0===this._featureCache[r]&&i.push(r),!0!==this._checkIfNeedToExpandKnownPage(t,this._maxProcessingRate())){e.next=5;break}return e.next=4,this._expandPagedSet(t,this._maxProcessingRate(),0,0,n);case 4:return e.abrupt("return",this._getFeatures(t,r,a,n));case 5:s=0,u=t._lastFetchedIndex;case 7:if(!(u<t._known.length)){e.next=18;break}if(t._lastFetchedIndex+=1,s++,void 0!==this._featureCache[t._known[u]]){e.next=13;break}if(l=!1,null!==this._layer._mode&&void 0!==this._layer._mode&&void 0!==(o=this._layer._mode)._featureMap[t._known[u]]&&null!==(c=o._featureMap[t._known[u]])&&(l=!0,this._featureCache[t._known[u]]=c),!(!1===l&&(t._known[u]!==r&&i.push(t._known[u]),i.length>=this._maxProcessingRate()-1))){e.next=13;break}return e.abrupt("break",18);case 13:if(!(s>=a&&0===i.length)){e.next=15;break}return e.abrupt("break",18);case 15:u++,e.next=7;break;case 18:if(0!==i.length){e.next=20;break}return e.abrupt("return","success");case 20:return h=new M.a,this._requestStandardised&&(h.sqlFormat="standard"),h.objectIds=i,h.outFields=null!==this._overrideFields?this._overrideFields:this._fieldsIncludingObjectId(this._layer.outFields?this._layer.outFields:["*"]),h.returnGeometry=!0,!0===this._removeGeometry&&(h.returnGeometry=!1),h.outSpatialReference=this.spatialReference,e.next=24,this.executeQuery(h,"execute");case 24:if(f=e.sent,this._checkCancelled(n),void 0===f.error){e.next=27;break}throw new Error(f.error);case 27:for(p=0;p<f.features.length;p++)this._featureCache[f.features[p].attributes[this._layer.objectIdField]]=f.features[p];return e.abrupt("return","success");case 29:case"end":return e.stop()}}),e,this)})));return function(t,r,a,n){return e.apply(this,arguments)}}()},{key:"_getDistinctPages",value:function(){var e=Object(o.a)(d.a.mark((function e(t,r,a,n,i,s,u,l,o){var c,h,f,p,y,b,_,v,g,m;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ensureLoaded();case 2:return e.next=4,this.databaseType();case 4:c=e.sent,h=a.parseTree.column,f=0;case 7:if(!(f<this._layer.fields.length)){e.next=14;break}if(this._layer.fields[f].name.toLowerCase()!==h.toLowerCase()){e.next=11;break}return h=this._layer.fields[f].name,e.abrupt("break",14);case 11:f++,e.next=7;break;case 14:return p=new M.a,this._requestStandardised&&(p.sqlFormat="standard"),y=null===s?null===i?"1=1":"":Object(F.i)(s,c),this._layer.definitionExpression&&this._useDefinitionExpression&&(y=""!==y?"(("+this._layer.definitionExpression+") AND ("+y+"))":this._layer.definitionExpression),p.where=y,p.spatialRelationship=this._makeRelationshipEnum(n),p.relationParameter=this._makeRelationshipParam(n),p.geometry=null===i?null:i,p.returnDistinctValues=!0,p.returnGeometry=!1,p.outFields=[h],e.next=20,this.executeQuery(p,"execute");case 20:if(b=e.sent,this._checkCancelled(o),b.hasOwnProperty("features")){e.next=23;break}throw new Error("Unnexected Result querying statistics from layer");case 23:_=!1,v=0;case 25:if(!(v<this._layer.fields.length)){e.next=32;break}if(this._layer.fields[v].name!==h){e.next=29;break}return"date"===this._layer.fields[v].type&&(_=!0),e.abrupt("break",32);case 29:v++,e.next=25;break;case 32:g=0;case 33:if(!(g<b.features.length)){e.next=40;break}if(_?null!==(m=b.features[g].attributes[h])?l.push(new Date(m)):l.push(m):l.push(b.features[g].attributes[h]),!(l.length>=u)){e.next=37;break}return e.abrupt("break",40);case 37:g++,e.next=33;break;case 40:if(0!==b.features.length){e.next=42;break}return e.abrupt("return",l);case 42:if(!(b.features.length===this._layer.capabilities.query.maxRecordCount&&l.length<u)){e.next=48;break}return e.t0=!0,e.next=46,this._getDistinctPages(t+b.features.length,r,a,n,i,s,u,l,o);case 46:return e.t1=e.sent,e.abrupt("return",{calculated:e.t0,result:e.t1});case 48:return e.abrupt("return",l);case 49:case"end":return e.stop()}}),e,this)})));return function(t,r,a,n,i,s,u,l,o){return e.apply(this,arguments)}}()},{key:"_distinctStat",value:function(){var e=Object(o.a)(d.a.mark((function e(t,r,a,n,i,s,u){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=!0,e.next=3,this._getDistinctPages(0,t,r,a,n,i,s,[],u);case 3:return e.t1=e.sent,e.abrupt("return",{calculated:e.t0,result:e.t1});case 5:case"end":return e.stop()}}),e,this)})));return function(t,r,a,n,i,s,u){return e.apply(this,arguments)}}()},{key:"isTable",value:function(){return this._layer.isTable||null===this._layer.geometryType||"table"===this._layer.type||""===this._layer.geometryType}},{key:"_countstat",value:function(){var e=Object(o.a)(d.a.mark((function e(t,r,a,n){var i,s,u;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.databaseType();case 2:if(i=e.sent,s=new M.a,this._requestStandardised&&(s.sqlFormat="standard"),!this.isTable()||!a||null===r||""===r){e.next=6;break}return e.abrupt("return",{calculated:!0,result:0});case 6:return u=null===n?null===a?"1=1":"":Object(F.i)(n,i),this._layer.definitionExpression&&this._useDefinitionExpression&&(u=""!==u?"(("+this._layer.definitionExpression+") AND ("+u+"))":this._layer.definitionExpression),s.where=u,s.where=u,s.spatialRelationship=this._makeRelationshipEnum(r),s.relationParameter=this._makeRelationshipParam(r),s.geometry=null===a?null:a,s.returnGeometry=!1,e.t0=!0,e.next=11,this.executeQuery(s,"executeForCount");case 11:return e.t1=e.sent,e.abrupt("return",{calculated:e.t0,result:e.t1});case 13:case"end":return e.stop()}}),e,this)})));return function(t,r,a,n){return e.apply(this,arguments)}}()},{key:"_stats",value:function(){var e=Object(o.a)(d.a.mark((function e(t,r,a,n,i,s,u){var l,o,c,h,f,p,y,b,_,v,g,m;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ensureLoaded();case 2:if(l=this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsSqlExpression,o=this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsStatistics,c=this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsDistinct,"count"!==t){e.next=5;break}return e.abrupt("return",c?this._countstat(t,a,n,i):{calculated:!1});case 5:if(!1!==o&&(!1!==Object(F.c)(r)||!1!==l)&&!1!==r.isStandardized){e.next=7;break}return e.abrupt("return",""!==a||null!==i?{calculated:!1}:this._manualStat(t,r,s,u));case 7:if("distinct"!==t){e.next=9;break}return e.abrupt("return",!1===c?""!==a||null!==i?{calculated:!1}:this._manualStat(t,r,s,u):this._distinctStat(t,r,a,n,i,s,u));case 9:return e.next=11,this.databaseType();case 11:if(h=e.sent,!this.isTable()||!n||null===a||""===a){e.next=14;break}return e.abrupt("return",{calculated:!0,result:null});case 14:return f=new M.a,this._requestStandardised&&(f.sqlFormat="standard"),p=null===i?null===n?"1=1":"":Object(F.i)(i,h),this._layer.definitionExpression&&this._useDefinitionExpression&&(p=""!==p?"(("+this._layer.definitionExpression+") AND ("+p+"))":this._layer.definitionExpression),f.where=p,f.spatialRelationship=this._makeRelationshipEnum(a),f.relationParameter=this._makeRelationshipParam(a),f.geometry=null===n?null:n,(y=new z.a).statisticType=Object(S.c)(t),y.onStatisticField=Object(F.i)(r,h),y.outStatisticFieldName="ARCADE_STAT_RESULT",f.returnGeometry=!1,b="ARCADE_STAT_RESULT",f.outStatistics=[y],e.next=24,this.executeQuery(f,"execute");case 24:if((_=e.sent).hasOwnProperty("features")&&0!==_.features.length){e.next=27;break}throw new Error("Unnexected Result querying statistics from layer");case 27:v=!1,g=0;case 29:if(!(g<_.fields.length)){e.next=36;break}if("ARCADE_STAT_RESULT"!==_.fields[g].name.toUpperCase()){e.next=33;break}return b=_.fields[g].name,"date"===_.fields[g].type&&(v=!0),e.abrupt("break",36);case 33:g++,e.next=29;break;case 36:if(!v){e.next=39;break}return m=_.features[0].attributes[b],e.abrupt("return",(null!==m&&(m=new Date(_.features[0].attributes[b])),{calculated:!0,result:m}));case 39:return e.abrupt("return",{calculated:!0,result:_.features[0].attributes[b]});case 40:case"end":return e.stop()}}),e,this)})));return function(t,r,a,n,i,s,u){return e.apply(this,arguments)}}()},{key:"_stat",value:function(e,t,r,a,n,i,s){return this._stats(e,t,r,a,n,i,s)}},{key:"_canDoAggregates",value:function(){var e=Object(o.a)(d.a.mark((function e(t,r){var a,n,i;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ensureLoaded();case 2:if(a=!1,n=this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsSqlExpression,void 0!==this._layer.capabilities&&null!==this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsStatistics&&!0===this._layer.capabilities.query.supportsOrderBy&&(a=!0),a)for(i=0;i<r.length-1;i++)null!==r[i].workingexpr&&(!1===r[i].workingexpr.isStandardized||!1===Object(F.c)(r[i].workingexpr)&&!1===n)&&(a=!1);return e.abrupt("return",!1!==a);case 6:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_makeRelationshipEnum",value:function(e){if(e.includes("esriSpatialRelRelation"))return"relation";switch(e){case"esriSpatialRelRelation":return"relation";case"esriSpatialRelIntersects":return"intersects";case"esriSpatialRelContains":return"contains";case"esriSpatialRelOverlaps":return"overlaps";case"esriSpatialRelWithin":return"within";case"esriSpatialRelTouches":return"touches";case"esriSpatialRelCrosses":return"crosses";case"esriSpatialRelEnvelopeIntersects":return"envelope-intersects"}return e}},{key:"_makeRelationshipParam",value:function(e){return e.includes("esriSpatialRelRelation")?e.split(":")[1]:""}},{key:"_getAggregatePagesDataSourceDefinition",value:function(){var e=Object(o.a)(d.a.mark((function e(t,r,a,n,i,s,u){var l,o,c,h,f,p,y,b,_,v;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ensureLoaded();case 2:return e.next=4,this.databaseType();case 4:for(l=e.sent,o="",c=!1,h=!1,null!==s&&this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsOrderBy&&(o=s.constructClause(),h=!0),this._layer.capabilities&&this._layer.capabilities.query&&!1===this._layer.capabilities.query.supportsPagination&&(h=!1,c=!0,o=this._layer.objectIdField),f=[],p=0;p<r.length;p++)(y=new z.a).onStatisticField=null!==r[p].workingexpr?Object(F.i)(r[p].workingexpr,l):"",y.outStatisticFieldName=r[p].field,y.statisticType=r[p].toStatisticsName(),f.push(y);return""===o&&(o=t.join(",")),b=this._maxQueryRate(),void 0!==(_=this._layer.capabilities.query.maxRecordCount)&&_<b&&(b=_),v=null===i?null===n?"1=1":"":Object(F.i)(i,l),this._layer.definitionExpression&&this._useDefinitionExpression&&(v=""!==v?"(("+this._layer.definitionExpression+") AND ("+v+"))":this._layer.definitionExpression),e.abrupt("return",new k.a([],["GETPAGES"],h,{groupbypage:!0,spatialRel:this._makeRelationshipEnum(a),relationParam:this._makeRelationshipParam(a),outFields:["*"],useOIDpagination:c,generatedOid:u,resultRecordCount:b,resultOffset:0,groupByFieldsForStatistics:t,outStatistics:f,geometry:null===n?null:n,where:v,orderByFields:o,returnGeometry:!1,returnIdsOnly:!1,internal:{lastMaxId:-1,set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}}));case 16:case"end":return e.stop()}}),e,this)})));return function(t,r,a,n,i,s,u){return e.apply(this,arguments)}}()},{key:"_getAgregagtePhysicalPage",value:function(){var e=Object(o.a)(d.a.mark((function e(t,r,a){var n,i,s,u,l,o,c,h,f;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.pagesDefinition.where,!0===t.pagesDefinition.useOIDpagination&&(n=""!==n?"("+n+") AND ("+t.pagesDefinition.generatedOid+">"+t.pagesDefinition.internal.lastMaxId.toString()+")":t.pagesDefinition.generatedOid+">"+t.pagesDefinition.internal.lastMaxId.toString()),i=t.pagesDefinition.internal.lastRetrieved,s=i,u=t.pagesDefinition.internal.lastPage,l=new M.a,this._requestStandardised&&(l.sqlFormat="standard"),l.where=n,l.spatialRelationship=t.pagesDefinition.spatialRel,l.relationParameter=t.pagesDefinition.relationParam,l.outFields=t.pagesDefinition.outFields,l.outStatistics=t.pagesDefinition.outStatistics,l.geometry=t.pagesDefinition.geometry,l.groupByFieldsForStatistics=t.pagesDefinition.groupByFieldsForStatistics,l.num=t.pagesDefinition.resultRecordCount,l.start=t.pagesDefinition.internal.lastPage,l.returnGeometry=t.pagesDefinition.returnGeometry,l.orderByFields=""!==t.pagesDefinition.orderByFields?t.pagesDefinition.orderByFields.split(","):null,!(this.isTable()&&l.geometry&&l.spatialRelationship)){e.next=5;break}return e.abrupt("return",[]);case 5:return e.next=7,this.executeQuery(l,"execute");case 7:if(o=e.sent,this._checkCancelled(a),o.hasOwnProperty("features")){e.next=10;break}throw new Error("Unnexected Result querying aggregates from layer");case 10:if(c=[],t.pagesDefinition.internal.lastPage===u){e.next=13;break}return e.abrupt("return",[]);case 13:for(h=0;h<o.features.length;h++)t.pagesDefinition.internal.set[s+h]=o.features[h].attributes[t.pagesDefinition.generatedOid];for(f=0;f<o.features.length;f++)c.push(new b.a({attributes:o.features[f].attributes,geometry:null}));return e.abrupt("return",(!0===t.pagesDefinition.useOIDpagination?0===o.features.length?t.pagesDefinition.internal.fullyResolved=!0:t.pagesDefinition.internal.lastMaxId=o.features[o.features.length-1].attributes[t.pagesDefinition.generatedOid]:(void 0===o.exceededTransferLimit&&o.features.length!==t.pagesDefinition.resultRecordCount||!1===o.exceededTransferLimit)&&(t.pagesDefinition.internal.fullyResolved=!0),t.pagesDefinition.internal.lastRetrieved=i+o.features.length,t.pagesDefinition.internal.lastPage+=t.pagesDefinition.resultRecordCount,c));case 16:case"end":return e.stop()}}),e,this)})));return function(t,r,a){return e.apply(this,arguments)}}()},{key:"relationshipMetaData",value:function(){return this._layer&&this._layer.source&&this._layer.source.sourceJSON&&this._layer.source.sourceJSON.relationships?this._layer.source.sourceJSON.relationships:[]}},{key:"serviceUrl",value:function(){return Object(x.i)(this._layer.parsedUrl.path)}},{key:"queryAttachments",value:function(){var e=Object(o.a)(d.a.mark((function e(t,r,a,n,i){var s,u,l,o=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._layer.capabilities.data.supportsAttachment||!this._layer.capabilities.operations.supportsQueryAttachments){e.next=8;break}return s={objectIds:[t],returnMetadata:i},(r&&r>0||a&&a>0)&&(s.size=[r&&r>0?r:0,a&&a>0?a:r+1]),n&&n.length>0&&(s.attachmentTypes=n),this.featureSetQueryInterceptor&&this.featureSetQueryInterceptor.preLayerQueryCallback({layer:this._layer,query:s,method:"attachments"}),e.next=5,this._layer.queryAttachments(s);case 5:return u=e.sent,l=[],e.abrupt("return",(u&&u[t]&&u[t].forEach((function(e){var r=o._layer.parsedUrl.path+"/"+t.toString()+"/attachments/"+e.id.toString(),a=null;i&&e.exifInfo&&(a=Z.a.convertJsonToArcade(e.exifInfo,!0)),l.push(new L.a(e.id,e.name,e.contentType,e.size,r,a))})),l));case 8:return e.abrupt("return",[]);case 9:case"end":return e.stop()}}),e,this)})));return function(t,r,a,n,i){return e.apply(this,arguments)}}()},{key:"queryRelatedFeatures",value:function(){var e=Object(o.a)(d.a.mark((function e(t){var r,n,i,s,u,l,o,c,h,p,y,_,v,g;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={f:"json",relationshipId:t.relationshipId.toString(),definitionExpression:t.where,outFields:t.outFields.join(","),returnGeometry:t.returnGeometry.toString()},void 0!==t.resultOffset&&null!==t.resultOffset&&(r.resultOffset=t.resultOffset.toString()),void 0!==t.resultRecordCount&&null!==t.resultRecordCount&&(r.resultRecordCount=t.resultRecordCount.toString()),t.orderByFields&&(r.orderByFields=t.orderByFields.join(",")),t.objectIds.length>0&&(r.objectIds=t.objectIds.join(",")),t.outSpatialReference&&(r.outSR=JSON.stringify(t.outSpatialReference.toJSON())),this.featureSetQueryInterceptor&&this.featureSetQueryInterceptor.preRequestCallback({layer:this._layer,queryPayload:r,method:"relatedrecords",url:this._layer.parsedUrl.path+"/queryRelatedRecords"}),e.next=4,Object(f.default)(this._layer.parsedUrl.path+"/queryRelatedRecords",{responseType:"json",query:r});case 4:if(!(n=e.sent).data){e.next=9;break}if(i={},(s=n.data)&&s.relatedRecordGroups){u=s.spatialReference,l=Object(a.a)(s.relatedRecordGroups);try{for(l.s();!(o=l.n()).done;){c=o.value,h=c.objectId,p=[],y=Object(a.a)(c.relatedRecords);try{for(y.s();!(_=y.n()).done;)(v=_.value).geometry&&(v.geometry.spatialReference=u),g=new b.a({geometry:v.geometry?Object(P.a)(v.geometry):null,attributes:v.attributes}),p.push(g)}catch(d){y.e(d)}finally{y.f()}i[h]={features:p,exceededTransferLimit:!0===s.exceededTransferLimit}}}catch(d){l.e(d)}finally{l.f()}}return e.abrupt("return",i);case 9:throw new Error("Invalid Request");case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getFeatureByObjectId",value:function(){var e=Object(o.a)(d.a.mark((function e(t,r){var a,n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(a=new M.a).outFields=r,a.returnGeometry=!1,a.outSpatialReference=this.spatialReference,a.where=this.objectIdField+"="+t.toString(),this.featureSetQueryInterceptor&&this.featureSetQueryInterceptor.preLayerQueryCallback({layer:this._layer,query:a,method:"execute"}),e.next=4,Object(B.a)(this._layer.parsedUrl.path,a);case 4:return n=e.sent,e.abrupt("return",1===n.features.length?n.features[0]:null);case 6:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"getIdentityUser",value:function(){var e=Object(o.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load();case 2:return t=null===h.b||void 0===h.b?void 0:h.b.findCredential(this._layer.url),e.abrupt("return",t?t.userId:null);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getOwningSystemUrl",value:function(){var e=Object(o.a)(d.a.mark((function e(){var t,r,a,n,i;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load();case 2:if(!(t=null===h.b||void 0===h.b?void 0:h.b.findServerInfo(this._layer.url))){e.next=5;break}return e.abrupt("return",t.owningSystemUrl);case 5:if(r=this._layer.url,a=r.toLowerCase().indexOf("/rest/services"),!(r=a>-1?r.substring(0,a):r)){e.next=20;break}return r+="/rest/info",e.prev=9,e.next=12,Object(f.default)(r,{query:{f:"json"}});case 12:return n=e.sent,i="",e.abrupt("return",(n.data&&n.data.owningSystemUrl&&(i=n.data.owningSystemUrl),i));case 17:return e.prev=17,e.t0=e.catch(9),e.abrupt("return","");case 20:return e.abrupt("return","");case 21:case"end":return e.stop()}}),e,this,[[9,17]])})));return function(){return e.apply(this,arguments)}}()},{key:"getDataSourceFeatureSet",value:function(){var e=new r({layer:this._layer,spatialReference:this.spatialReference,outFields:this._overrideFields,includeGeometry:!this._removeGeometry,lrucache:this.recentlyUsedQueries,interceptor:this.featureSetQueryInterceptor});return e._useDefinitionExpression=!1,e}}],[{key:"create",value:function(e,t,a,n,i){return new r({layer:new q.default({url:e,outFields:null===t?["*"]:t}),spatialReference:a,lrucache:n,interceptor:i})}}]),r}(m.a),X=r(1046),Y=function(e){Object(u.a)(r,e);var t=Object(l.a)(r);function r(e){var a;return Object(i.a)(this,r),(a=t.call(this,e)).declaredClass="esri.arcade.featureset.sources.FeatureLayerRelated",a._findObjectId=-1,a._requestStandardised=!1,a._removeGeometry=!1,a._overrideFields=null,a.featureObjectId=null,a.relatedLayer=null,a.relationship=null,e.spatialReference&&(a.spatialReference=e.spatialReference),a._transparent=!0,a._maxProcessing=1e3,a._layer=e.layer,a._wset=null,a._findObjectId=e.objectId,a.featureObjectId=e.objectId,a.relationship=e.relationship,a.relatedLayer=e.relatedLayer,void 0!==e.outFields&&(a._overrideFields=e.outFields),void 0!==e.includeGeometry&&(a._removeGeometry=!1===e.includeGeometry),a}return Object(s.a)(r,[{key:"_maxQueryRate",value:function(){return x.f}},{key:"end",value:function(){return this._layer}},{key:"optimisePagingFeatureQueries",value:function(){}},{key:"loadImpl",value:function(){var e=Object(o.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([this._layer.load(),this.relatedLayer.load()]);case 2:return this._initialiseFeatureSet(),e.abrupt("return",this);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"nativeCapabilities",value:function(){return this.relatedLayer.nativeCapabilities()}},{key:"_initialiseFeatureSet",value:function(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this.relatedLayer.geometryType,this.fields=this.relatedLayer.fields.slice(0),null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{var e,t=[],r=[],n=Object(a.a)(this.fields);try{for(n.s();!(e=n.n()).done;){var i=e.value;if("oid"===i.type)t.push(i),r.push(i.name);else{var s,u=Object(a.a)(this._overrideFields);try{for(u.s();!(s=u.n()).done;){if(s.value.toLowerCase()===i.name.toLowerCase()){t.push(i),r.push(i.name);break}}}catch(o){u.e(o)}finally{u.f()}}}}catch(o){n.e(o)}finally{n.f()}this.fields=t,this._overrideFields=r}var l=this._layer.nativeCapabilities();l&&(this._databaseType=l.databaseType,this._requestStandardised=l.requestStandardised),this.objectIdField=this.relatedLayer.objectIdField,this.globalIdField=this.relatedLayer.globalIdField,this.hasM=this.relatedLayer.supportsM,this.hasZ=this.relatedLayer.supportsZ,this.typeIdField=this.relatedLayer.typeIdField,this.types=this.relatedLayer.types}},{key:"databaseType",value:function(){var e=Object(o.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.relatedLayer.databaseType();case 2:return this._databaseType=this.relatedLayer._databaseType,e.abrupt("return",this._databaseType);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isTable",value:function(){return this.relatedLayer.isTable()}},{key:"_isInFeatureSet",value:function(){return x.b.InFeatureSet}},{key:"_candidateIdTransform",value:function(e){return e}},{key:"_getSet",value:function(){var e=Object(o.a)(d.a.mark((function e(t){var r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==this._wset){e.next=7;break}return e.next=3,this._ensureLoaded();case 3:return e.next=5,this._getFilteredSet("",null,null,null,t);case 5:return r=e.sent,e.abrupt("return",(this._wset=r,r));case 7:return e.abrupt("return",this._wset);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_changeFeature",value:function(e){var t,r={},n=Object(a.a)(this.fields);try{for(n.s();!(t=n.n()).done;){var i=t.value;r[i.name]=e.attributes[i.name]}}catch(s){n.e(s)}finally{n.f()}return new b.a({geometry:!0===this._removeGeometry?null:e.geometry,attributes:r})}},{key:"_getFilteredSet",value:function(){var e=Object(o.a)(d.a.mark((function e(t,r,a,n,i){var s,u,l,o,c,h,f,p,y,b,_,v;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.databaseType();case 2:if(!this.isTable()||!r||null===t||""===t){e.next=4;break}return e.abrupt("return",new k.a([],[],!0,null));case 4:if(!1!==(s=this._layer.nativeCapabilities()).canQueryRelated){e.next=7;break}return e.abrupt("return",new k.a([],[],!0,null));case 7:if(!s.capabilities.queryRelated||!s.capabilities.queryRelated.supportsPagination){e.next=9;break}return e.abrupt("return",this._getFilteredSetUsingPaging(t,r,a,n,i));case 9:return u="",l=!1,null!==n&&s.capabilities&&s.capabilities.queryRelated&&!0===s.capabilities.queryRelated.supportsOrderBy&&(u=n.constructClause(),l=!0),(o=new J.a).objectIds=[this._findObjectId],c=null!==this._overrideFields?this._overrideFields:this._fieldsIncludingObjectId(this.relatedLayer.fields?this.relatedLayer.fields.map((function(e){return e.name})):["*"]),o.outFields=c,o.relationshipId=this.relationship.id,o.where="1=1",h=!0,!0===this._removeGeometry&&(h=!1),o.returnGeometry=h,this._requestStandardised&&(o.sqlFormat="standard"),o.outSpatialReference=this.spatialReference,o.orderByFields=""!==u?u.split(","):null,e.next=19,s.source.queryRelatedFeatures(o);case 19:for(f=e.sent,this._checkCancelled(i),p=f[this._findObjectId]?f[this._findObjectId].features:[],y=[],b=0;b<p.length;b++)this._featureCache[p[b].attributes[this.relatedLayer.objectIdField]]=p[b],y.push(p[b].attributes[this.relatedLayer.objectIdField]);return _=r&&null!==t&&""!==t,v=null!=a,e.abrupt("return",new k.a(_||v?y:[],_||v?[]:y,l,null));case 25:case"end":return e.stop()}}),e,this)})));return function(t,r,a,n,i){return e.apply(this,arguments)}}()},{key:"_fieldsIncludingObjectId",value:function(e){if(null===e)return[this.objectIdField];var t=e.slice(0);if(t.includes("*"))return t;var r,n=!1,i=Object(a.a)(t);try{for(i.s();!(r=i.n()).done;){if(r.value.toUpperCase()===this.objectIdField.toUpperCase()){n=!0;break}}}catch(s){i.e(s)}finally{i.f()}return!1===n&&t.push(this.objectIdField),t}},{key:"_getFilteredSetUsingPaging",value:function(){var e=Object(o.a)(d.a.mark((function e(t,r,a,n,i){var s,u,l,o,c,h,f,p,y,b;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s="",u=!1,l=this._layer.nativeCapabilities(),null!==n&&l&&l.capabilities.queryRelated&&!0===l.capabilities.queryRelated.supportsOrderBy&&(s=n.constructClause(),u=!0),e.next=5,this.databaseType();case 5:return"1=1",o=this._maxQueryRate(),void 0!==(c=l.capabilities.query.maxRecordCount)&&c<o&&(o=c),h=r&&null!==t&&""!==t,f=null!=a,p=null,y=!0,!0===this._removeGeometry&&(y=!1),b=null!==this._overrideFields?this._overrideFields:this._fieldsIncludingObjectId(this.relatedLayer.fields?this.relatedLayer.fields.map((function(e){return e.name})):["*"]),p=new k.a(h||f?["GETPAGES"]:[],h||f?[]:["GETPAGES"],u,{outFields:b.join(","),resultRecordCount:o,resultOffset:0,objectIds:[this._findObjectId],where:"1=1",orderByFields:s,returnGeometry:y,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}}),e.next=16,this._expandPagedSet(p,o,0,0,i);case 16:return e.abrupt("return",p);case 17:case"end":return e.stop()}}),e,this)})));return function(t,r,a,n,i){return e.apply(this,arguments)}}()},{key:"_expandPagedSet",value:function(e,t,r,a,n){return this._expandPagedSetFeatureSet(e,t,r,a,n)}},{key:"_clonePageDefinition",value:function(e){return null===e?null:!0!==e.groupbypage?{groupbypage:!1,outFields:e.outFields,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,where:e.where,objectIds:e.objectIds,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}:{groupbypage:!0,outFields:e.outFields,resultRecordCount:e.resultRecordCount,useOIDpagination:e.useOIDpagination,generatedOid:e.generatedOid,groupByFieldsForStatistics:e.groupByFieldsForStatistics,resultOffset:e.resultOffset,outStatistics:e.outStatistics,geometry:e.geometry,where:e.where,objectIds:e.objectIds,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}}},{key:"_getPhysicalPage",value:function(){var e=Object(o.a)(d.a.mark((function e(t,r,a){var n,i,s,u,l,o,c,h,f,p;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.pagesDefinition.internal.lastRetrieved,i=n,s=t.pagesDefinition.internal.lastPage,u=this._layer.nativeCapabilities(),l=new J.a,!0===this._requestStandardised&&(l.sqlFormat="standard"),l.relationshipId=this.relationship.id,l.objectIds=t.pagesDefinition.objectIds,l.resultOffset=t.pagesDefinition.internal.lastPage,l.resultRecordCount=t.pagesDefinition.resultRecordCount,l.outFields=t.pagesDefinition.outFields.split(","),l.where=t.pagesDefinition.where,l.orderByFields=""!==t.pagesDefinition.orderByFields?t.pagesDefinition.orderByFields.split(","):null,l.returnGeometry=t.pagesDefinition.returnGeometry,l.outSpatialReference=this.spatialReference,e.next=4,u.source.queryRelatedFeatures(l);case 4:if(o=e.sent,this._checkCancelled(a),t.pagesDefinition.internal.lastPage===s){e.next=7;break}return e.abrupt("return",0);case 7:for(c=o[this._findObjectId]?o[this._findObjectId].features:[],h=0;h<c.length;h++)t.pagesDefinition.internal.set[i+h]=c[h].attributes[this.relatedLayer.objectIdField];for(f=0;f<c.length;f++)this._featureCache[c[f].attributes[this.relatedLayer.objectIdField]]=c[f];return p=!o[this._findObjectId]||!1===o[this._findObjectId].exceededTransferLimit,e.abrupt("return",(c.length!==t.pagesDefinition.resultRecordCount&&p&&(t.pagesDefinition.internal.fullyResolved=!0),t.pagesDefinition.internal.lastRetrieved=n+c.length,t.pagesDefinition.internal.lastPage+=t.pagesDefinition.resultRecordCount,c.length));case 12:case"end":return e.stop()}}),e,this)})));return function(t,r,a){return e.apply(this,arguments)}}()},{key:"_getFeatures",value:function(){var e=Object(o.a)(d.a.mark((function e(t,r,a,n){var i,s,u,l;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=[],-1!==r&&void 0===this._featureCache[r]&&i.push(r),s=this._maxQueryRate(),!0!==this._checkIfNeedToExpandKnownPage(t,s)){e.next=7;break}return e.next=6,this._expandPagedSet(t,s,0,0,n);case 6:return e.abrupt("return",this._getFeatures(t,r,a,n));case 7:for(u=0,l=t._lastFetchedIndex;l<t._known.length&&(++u<=a&&(t._lastFetchedIndex+=1),!("GETPAGES"!==t._known[l]&&void 0===this._featureCache[t._known[l]]&&(t._known[l]!==r&&i.push(t._known[l]),i.length>a)))&&!(u>=a&&0===i.length);l++);if(0!==i.length){e.next=11;break}return e.abrupt("return","success");case 11:throw new Error("Unaccounted for Features. Not in Feature Collection");case 12:case"end":return e.stop()}}),e,this)})));return function(t,r,a,n){return e.apply(this,arguments)}}()},{key:"_refineSetBlock",value:function(){var e=Object(o.a)(d.a.mark((function e(t,r,a){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t);case 1:case"end":return e.stop()}}),e)})));return function(t,r,a){return e.apply(this,arguments)}}()},{key:"_stat",value:function(){var e=Object(o.a)(d.a.mark((function e(t,r,a,n,i,s,u){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{calculated:!1});case 1:case"end":return e.stop()}}),e)})));return function(t,r,a,n,i,s,u){return e.apply(this,arguments)}}()},{key:"gdbVersion",get:function(){return this.relatedLayer.gdbVersion}},{key:"_canDoAggregates",value:function(){var e=Object(o.a)(d.a.mark((function e(t,r,a,n,i){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!1);case 1:case"end":return e.stop()}}),e)})));return function(t,r,a,n,i){return e.apply(this,arguments)}}()},{key:"relationshipMetaData",value:function(){return this.relatedLayer.relationshipMetaData()}},{key:"serviceUrl",value:function(){return this.relatedLayer.serviceUrl()}},{key:"queryAttachments",value:function(e,t,r,a,n){return this.relatedLayer.queryAttachments(e,t,r,a,n)}},{key:"getFeatureByObjectId",value:function(e,t){return this.relatedLayer.getFeatureByObjectId(e,t)}},{key:"getOwningSystemUrl",value:function(){return this.relatedLayer.getOwningSystemUrl()}},{key:"getIdentityUser",value:function(){return this.relatedLayer.getIdentityUser()}},{key:"getDataSourceFeatureSet",value:function(){return this.relatedLayer}}]),r}(m.a),$=r(1042),ee=r(276),te=r(434);function re(){null===$.a.applicationCache&&($.a.applicationCache=new $.a)}function ae(e,t){return ne.apply(this,arguments)}function ne(){return(ne=Object(o.a)(d.a.mark((function e(t,r){var a,n,i,s;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!$.a.applicationCache){e.next=22;break}if(!(a=$.a.applicationCache.getLayerInfo(t))){e.next=7;break}return e.next=5,a;case 5:return n=e.sent,e.abrupt("return",new q.default({url:t,outFields:r,sourceJSON:n}));case 7:if(i=new q.default({url:t,outFields:r}),s=Object(o.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.load();case 2:return e.abrupt("return",i.sourceJSON);case 3:case"end":return e.stop()}}),e)})))(),!$.a.applicationCache){e.next=19;break}return $.a.applicationCache.setLayerInfo(t,s),e.prev=10,e.next=13,s;case 13:case 21:return e.abrupt("return",i);case 16:throw e.prev=16,e.t0=e.catch(10),$.a.applicationCache.clearLayerInfo(t),e.t0;case 19:return e.next=21,s;case 22:return e.abrupt("return",new q.default({url:t,outFields:r}));case 23:case"end":return e.stop()}}),e,null,[[10,16]])})))).apply(this,arguments)}function ie(e,t,r,a,n){return se.apply(this,arguments)}function se(){return se=Object(o.a)(d.a.mark((function e(t,r,a,n,i){var s,u=arguments;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=u.length>5&&void 0!==u[5]?u[5]:null,e.t0=ue,e.next=4,ae(t,["*"]);case 4:return e.t1=e.sent,e.t2=r,e.t3=a,e.t4=n,e.t5=i,e.t6=s,e.abrupt("return",(0,e.t0)(e.t1,e.t2,e.t3,e.t4,e.t5,e.t6));case 11:case"end":return e.stop()}}),e)}))),se.apply(this,arguments)}function ue(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;return!0===e._hasMemorySource()?new X.a({layer:e,spatialReference:t,outFields:r,includeGeometry:a,lrucache:n,interceptor:i}):new H({layer:e,spatialReference:t,outFields:r,includeGeometry:a,lrucache:n,interceptor:i})}function le(e){return oe.apply(this,arguments)}function oe(){return(oe=Object(o.a)(d.a.mark((function e(t){var r,a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===$.a.applicationCache){e.next=4;break}if(null===(r=$.a.applicationCache.getLayerInfo(t))){e.next=4;break}return e.abrupt("return",r);case 4:if(a=Object(o.a)(d.a.mark((function e(){var r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(f.default)(t,{responseType:"json",query:{f:"json"}});case 2:return r=e.sent,e.abrupt("return",r.data?r.data:null);case 4:case"end":return e.stop()}}),e)})))(),null===$.a.applicationCache){e.next=16;break}return $.a.applicationCache.setLayerInfo(t,a),e.prev=7,e.next=10,a;case 10:return e.abrupt("return",e.sent);case 13:throw e.prev=13,e.t0=e.catch(7),$.a.applicationCache.clearLayerInfo(t),e.t0;case 16:return e.abrupt("return",a);case 17:case"end":return e.stop()}}),e,null,[[7,13]])})))).apply(this,arguments)}function ce(e,t){return de.apply(this,arguments)}function de(){return(de=Object(o.a)(d.a.mark((function e(t,r){var a,n,i;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a="QUERYDATAELEMTS:"+r.toString()+":"+t,null===$.a.applicationCache){e.next=5;break}if(null===(n=$.a.applicationCache.getLayerInfo(a))){e.next=5;break}return e.abrupt("return",n);case 5:if(i=Object(o.a)(d.a.mark((function e(){var a,n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(f.default)(t+"/queryDataElements",{method:"post",responseType:"json",query:{layers:JSON.stringify([r.toString()]),f:"json"}});case 2:if(!(a=e.sent).data){e.next=7;break}if(!(n=a.data).layerDataElements||!n.layerDataElements[0]){e.next=7;break}return e.abrupt("return",n.layerDataElements[0]);case 7:throw new Error("Not Found");case 8:case"end":return e.stop()}}),e)})))(),null===$.a.applicationCache){e.next=17;break}return $.a.applicationCache.setLayerInfo(a,i),e.prev=8,e.next=11,i;case 11:return e.abrupt("return",e.sent);case 14:throw e.prev=14,e.t0=e.catch(8),$.a.applicationCache.clearLayerInfo(a),e.t0;case 17:return e.abrupt("return",i);case 18:case"end":return e.stop()}}),e,null,[[8,14]])})))).apply(this,arguments)}function he(e){return fe.apply(this,arguments)}function fe(){return(fe=Object(o.a)(d.a.mark((function e(t){var r,a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===$.a.applicationCache){e.next=4;break}if(null===(r=$.a.applicationCache.getLayerInfo(t))){e.next=4;break}return e.abrupt("return",r);case 4:if(a=Object(o.a)(d.a.mark((function e(){var r,a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(f.default)(t,{responseType:"json",query:{f:"json"}});case 2:if(!(r=e.sent).data){e.next=6;break}return a=r.data,e.abrupt("return",(a.layers||(a.layers=[]),a.tables||(a.tables=[]),a));case 6:return e.abrupt("return",{layers:[],tables:[]});case 7:case"end":return e.stop()}}),e)})))(),null===$.a.applicationCache){e.next=16;break}return $.a.applicationCache.setLayerInfo(t,a),e.prev=7,e.next=10,a;case 10:return e.abrupt("return",e.sent);case 13:throw e.prev=13,e.t0=e.catch(7),$.a.applicationCache.clearLayerInfo(t),e.t0;case 16:return e.abrupt("return",a);case 17:case"end":return e.stop()}}),e,null,[[7,13]])})))).apply(this,arguments)}function pe(e,t){return ye.apply(this,arguments)}function ye(){return(ye=Object(o.a)(d.a.mark((function e(t,r){var n,i,s,u,l,o,c,h,f,p,y,b,_,v,g,m,k,w,x,F,S,j,I,C,D,R,T,N,E,A;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={metadata:null,networkId:-1,unVersion:3,terminals:[],queryelem:null,layerNameLkp:{},lkp:null},e.next=3,he(t);case 3:if(i=e.sent,n.metadata=i,!i.controllerDatasetLayers||void 0===i.controllerDatasetLayers.utilityNetworkLayerId||null===i.controllerDatasetLayers.utilityNetworkLayerId){e.next=36;break}if(i.layers){s=Object(a.a)(i.layers);try{for(s.s();!(u=s.n()).done;)l=u.value,n.layerNameLkp[l.id]=l.name}catch(d){s.e(d)}finally{s.f()}}if(i.tables){o=Object(a.a)(i.tables);try{for(o.s();!(c=o.n()).done;)h=c.value,n.layerNameLkp[h.id]=h.name}catch(d){o.e(d)}finally{o.f()}}return f=i.controllerDatasetLayers.utilityNetworkLayerId,n.networkId=f,e.next=11,ce(t,f);case 11:if(!(p=e.sent)){e.next=35;break}n.queryelem=p,n.queryelem&&n.queryelem.dataElement&&void 0!==n.queryelem.dataElement.schemaGeneration&&(n.unVersion=n.queryelem.dataElement.schemaGeneration),n.lkp={},n.queryelem.dataElement.domainNetworks||(n.queryelem.dataElement.domainNetworks=[]),y=Object(a.a)(n.queryelem.dataElement.domainNetworks);try{for(y.s();!(b=y.n()).done;){_=b.value,v=Object(a.a)(_.edgeSources?_.edgeSources:[]);try{for(v.s();!(g=v.n()).done;)m=g.value,(k={layerId:m.layerId,sourceId:m.sourceId,className:n.layerNameLkp[m.layerId]?n.layerNameLkp[m.layerId]:null}).className&&(n.lkp[k.className]=k)}catch(d){v.e(d)}finally{v.f()}w=Object(a.a)(_.junctionSources?_.junctionSources:[]);try{for(w.s();!(x=w.n()).done;)F=x.value,(S={layerId:F.layerId,sourceId:F.sourceId,className:n.layerNameLkp[F.layerId]?n.layerNameLkp[F.layerId]:null}).className&&(n.lkp[S.className]=S)}catch(d){w.e(d)}finally{w.f()}}}catch(d){y.e(d)}finally{y.f()}if(n.queryelem.dataElement.terminalConfigurations){j=Object(a.a)(n.queryelem.dataElement.terminalConfigurations);try{for(j.s();!(I=j.n()).done;){C=I.value,D=Object(a.a)(C.terminals);try{for(D.s();!(R=D.n()).done;)T=R.value,n.terminals.push({terminalId:T.terminalId,terminalName:T.terminalName})}catch(d){D.e(d)}finally{D.f()}}}catch(d){j.e(d)}finally{j.f()}}return e.next=19,le(t+"/"+f);case 19:if(!(N=e.sent).systemLayers||void 0===N.systemLayers.associationsTableId||null===N.systemLayers.associationsTableId){e.next=34;break}return E=[],n.unVersion>=4&&(E.push("STATUS"),E.push("PERCENTALONG")),e.next=25,ie(t+"/"+N.systemLayers.associationsTableId.toString(),r,["OBJECTID","FROMNETWORKSOURCEID","TONETWORKSOURCEID","FROMGLOBALID","TOGLOBALID","TOTERMINALID","FROMTERMINALID","ASSOCIATIONTYPE","ISCONTENTVISIBLE","GLOBALID"].concat(E),!1,null,null);case 25:return A=e.sent,e.next=28,A.load();case 28:if(e.t0=n.unVersion>=4,!e.t0){e.next=33;break}return A=A.filter(O.WhereClause.create("STATUS NOT IN (1, 2, 3, 4, 5, 6, 7, 9, 10, 11, 12, 13, 14, 15, 17, 18, 19, 20, 21, 22, 23, 25, 26, 27, 28, 29, 30, 31, 33, 34, 35, 36, 37, 38, 39, 41, 42, 43, 44, 45, 46, 47, 49, 50, 51, 52, 53, 54, 55, 57, 58, 59, 60, 61, 62,63)",A.getFieldsIndex())),e.next=33,A.load();case 33:return e.abrupt("return",{lkp:n.lkp,associations:A,unVersion:n.unVersion,terminals:n.terminals});case 34:case 35:case 36:return e.abrupt("return",{associations:null,unVersion:n.unVersion,lkp:null,terminals:[]});case 37:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function be(e,t,r){return _e.apply(this,arguments)}function _e(){return _e=Object(o.a)(d.a.mark((function e(t,r,a){var n,i,s,u,l,o,c,h=arguments;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=h.length>3&&void 0!==h[3]?h[3]:null,i=h.length>4&&void 0!==h[4]?h[4]:null,s=!(h.length>5&&void 0!==h[5])||h[5],u=h.length>6&&void 0!==h[6]?h[6]:null,l=h.length>7&&void 0!==h[7]?h[7]:null,o=t.serviceUrl()){e.next=8;break}return e.abrupt("return",null);case 8:return o="/"===o.charAt(o.length-1)?o+r.relatedTableId.toString():o+"/"+r.relatedTableId.toString(),e.next=11,ie(o,n,i,s,u,l);case 11:return c=e.sent,e.abrupt("return",new Y({layer:t,relatedLayer:c,relationship:r,objectId:a,spatialReference:n,outFields:i,includeGeometry:s,lrucache:u,interceptor:l}));case 13:case"end":return e.stop()}}),e)}))),_e.apply(this,arguments)}y.a.registerAction(),N.registerAction(),g.a.registerAction(),E.a.registerAction(),A.a.registerAction();var ve=function(e){Object(u.a)(r,e);var t=Object(l.a)(r);function r(e){var a,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return Object(i.a)(this,r),(a=t.call(this))._map=e,a._overridespref=n,a.lrucache=s,a.interceptor=u,a._instantLayers=[],a}return Object(s.a)(r,[{key:"_makeAndAddFeatureSet",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=ue(e,this._overridespref,null===r?["*"]:r,t,this.lrucache,this.interceptor);return this._instantLayers.push({featureset:a,opitem:e,includeGeometry:t,outFields:JSON.stringify(r)}),a}},{key:"featureSetByName",value:function(){var e=Object(o.a)(d.a.mark((function e(t){var r,a,i,s,u,l,o,c,h=arguments;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=!(h.length>1&&void 0!==h[1])||h[1],a=h.length>2&&void 0!==h[2]?h[2]:null,void 0===this._map.loaded||void 0===this._map.load||!1!==this._map.loaded){e.next=6;break}return e.next=5,this._map.load();case 5:return e.abrupt("return",this.featureSetByName(t,r,a));case 6:null===a&&(a=["*"]),a=(a=a.slice(0)).sort(),i=JSON.stringify(a),s=0;case 9:if(!(s<this._instantLayers.length)){e.next=16;break}if((u=this._instantLayers[s]).opitem.title!==t||u.includeGeometry!==r||u.outFields!==i){e.next=13;break}return e.abrupt("return",this._instantLayers[s].featureset);case 13:s++,e.next=9;break;case 16:if(l=this._map.allLayers.find((function(e){return e instanceof q.default&&e.title===t})),!l){e.next=19;break}return e.abrupt("return",this._makeAndAddFeatureSet(l,r,a));case 19:if(!this._map.tables){e.next=28;break}if(o=this._map.tables.find((function(e){return!!(e.title&&e.title===t||e.title&&e.title===t)})),!o){e.next=28;break}if(!(o instanceof q.default)){e.next=24;break}return e.abrupt("return",this._makeAndAddFeatureSet(o,r,a));case 24:return o._materializedTable||(c=o.outFields?o:Object(n.a)(Object(n.a)({},o),{},{outFields:["*"]}),o._materializedTable=new q.default(c)),e.next=27,o._materializedTable.load();case 27:return e.abrupt("return",this._makeAndAddFeatureSet(o._materializedTable,r,a));case 28:return e.abrupt("return",null);case 29:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"featureSetById",value:function(){var e=Object(o.a)(d.a.mark((function e(t){var r,a,i,s,u,l,o,c,h=arguments;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=!(h.length>1&&void 0!==h[1])||h[1],a=h.length>2&&void 0!==h[2]?h[2]:["*"],void 0===this._map.loaded||void 0===this._map.load||!1!==this._map.loaded){e.next=6;break}return e.next=5,this._map.load();case 5:return e.abrupt("return",this.featureSetById(t,r,a));case 6:null===a&&(a=["*"]),a=(a=a.slice(0)).sort(),i=JSON.stringify(a),s=0;case 9:if(!(s<this._instantLayers.length)){e.next=16;break}if((u=this._instantLayers[s]).opitem.id!==t||u.includeGeometry!==r||u.outFields!==i){e.next=13;break}return e.abrupt("return",this._instantLayers[s].featureset);case 13:s++,e.next=9;break;case 16:if(l=this._map.allLayers.find((function(e){return e instanceof q.default&&e.id===t})),!l){e.next=19;break}return e.abrupt("return",this._makeAndAddFeatureSet(l,r,a));case 19:if(!this._map.tables){e.next=28;break}if(o=this._map.tables.find((function(e){return e.id===t})),!o){e.next=28;break}if(!(o instanceof q.default)){e.next=24;break}return e.abrupt("return",this._makeAndAddFeatureSet(o,r,a));case 24:return o._materializedTable||(c=Object(n.a)(Object(n.a)({},o),{},{outFields:["*"]}),o._materializedTable=new q.default(c)),e.next=27,o._materializedTable.load();case 27:return e.abrupt("return",this._makeAndAddFeatureSet(o._materializedTable,r,a));case 28:return e.abrupt("return",null);case 29:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),r}(p.a),ge=function(e){Object(u.a)(r,e);var t=Object(l.a)(r);function r(e){var a,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return Object(i.a)(this,r),(a=t.call(this))._url=e,a._overridespref=n,a.lrucache=s,a.interceptor=u,a.metadata=null,a._instantLayers=[],a}return Object(s.a)(r,[{key:"url",get:function(){return this._url}},{key:"_makeAndAddFeatureSet",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=ue(e,this._overridespref,null===r?["*"]:r,t,this.lrucache);return this._instantLayers.push({featureset:a,opitem:e,includeGeometry:t,outFields:JSON.stringify(r)}),a}},{key:"_loadMetaData",value:function(){var e=Object(o.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,he(this._url);case 2:return t=e.sent,e.abrupt("return",(this.metadata=t,t));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"load",value:function(){return this._loadMetaData()}},{key:"clone",value:function(){return new r(this._url,this._overridespref,this.lrucache,this.interceptor)}},{key:"featureSetByName",value:function(){var e=Object(o.a)(d.a.mark((function e(t){var r,n,i,s,u,l,o,c,h,f,p,y,b,_,v=arguments;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=!(v.length>1&&void 0!==v[1])||v[1],null===(n=v.length>2&&void 0!==v[2]?v[2]:null)&&(n=["*"]),n=(n=n.slice(0)).sort(),i=JSON.stringify(n),s=0;case 5:if(!(s<this._instantLayers.length)){e.next=12;break}if((u=this._instantLayers[s]).opitem.title!==t||u.includeGeometry!==r||u.outFields!==i){e.next=9;break}return e.abrupt("return",this._instantLayers[s].featureset);case 9:s++,e.next=5;break;case 12:return e.next=14,this._loadMetaData();case 14:l=e.sent,o=null,c=Object(a.a)(l.layers?l.layers:[]);try{for(c.s();!(h=c.n()).done;)(f=h.value).name===t&&(o=f)}catch(d){c.e(d)}finally{c.f()}if(!o){p=Object(a.a)(l.tables?l.tables:[]);try{for(p.s();!(y=p.n()).done;)(b=y.value).name===t&&(o=b)}catch(d){p.e(d)}finally{p.f()}}if(!o){e.next=24;break}return e.next=22,ae(this._url+"/"+o.id,["*"]);case 22:return _=e.sent,e.abrupt("return",this._makeAndAddFeatureSet(_,r,n));case 24:return e.abrupt("return",null);case 25:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"featureSetById",value:function(){var e=Object(o.a)(d.a.mark((function e(t){var r,n,i,s,u,l,o,c,h,f,p,y,b,_,v=arguments;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=!(v.length>1&&void 0!==v[1])||v[1],null===(n=v.length>2&&void 0!==v[2]?v[2]:["*"])&&(n=["*"]),n=(n=n.slice(0)).sort(),i=JSON.stringify(n),t=null!=t?t.toString():"",s=0;case 6:if(!(s<this._instantLayers.length)){e.next=13;break}if((u=this._instantLayers[s]).opitem.id!==t||u.includeGeometry!==r||u.outFields!==i){e.next=10;break}return e.abrupt("return",this._instantLayers[s].featureset);case 10:s++,e.next=6;break;case 13:return e.next=15,this._loadMetaData();case 15:l=e.sent,o=null,c=Object(a.a)(l.layers?l.layers:[]);try{for(c.s();!(h=c.n()).done;)null!==(f=h.value).id&&void 0!==f.id&&f.id.toString()===t&&(o=f)}catch(d){c.e(d)}finally{c.f()}if(!o){p=Object(a.a)(l.tables?l.tables:[]);try{for(p.s();!(y=p.n()).done;)null!==(b=y.value).id&&void 0!==b.id&&b.id.toString()===t&&(o=b)}catch(d){p.e(d)}finally{p.f()}}if(!o){e.next=25;break}return e.next=23,ae(this._url+"/"+o.id,["*"]);case 23:return _=e.sent,e.abrupt("return",this._makeAndAddFeatureSet(_,r,n));case 25:return e.abrupt("return",null);case 26:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),r}(p.a);function me(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return new ve(e,t,r,a)}function ke(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return new ge(e,t,r,a)}function we(e,t){return null===e?t:new ee.a({url:e.field("url")})}function xe(e,t,r){return Fe.apply(this,arguments)}function Fe(){return(Fe=Object(o.a)(d.a.mark((function e(t,r,a){var i,s,u,l;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(h.b.findCredential(t.restUrl)){e.next=2;break}return e.abrupt("return",null);case 2:if("loaded"!==t.loadStatus||""!==r||!t.user||!t.user.sourceJSON||!1!==a){e.next=4;break}return e.abrupt("return",t.user.sourceJSON);case 4:if(""!==r){e.next=13;break}return e.next=7,Object(f.default)(t.restUrl+"/community/self",{responseType:"json",query:Object(n.a)({f:"json"},!1===a?{}:{returnUserLicenseTypeExtensions:!0})});case 7:if(!(i=e.sent).data){e.next=12;break}if(!(s=i.data)||!s.username){e.next=12;break}return e.abrupt("return",s);case 12:case 19:return e.abrupt("return",null);case 13:return e.next=15,Object(f.default)(t.restUrl+"/community/users/"+r,{responseType:"json",query:{f:"json"}});case 15:if(!(u=e.sent).data){e.next=19;break}return l=u.data,e.abrupt("return",l.error?null:l);case 20:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Se(e,t,r,a,n){if(null===e)return null;if(e instanceof q.default){switch(t){case"datasource":return ue(e,n,e.outFields,!0,r,a).getDataSourceFeatureSet();case"parent":case"root":return ue(e,n,e.outFields,!0,r,a)}return null}if(e instanceof m.a)switch(t){case"datasource":return e.getDataSourceFeatureSet();case"parent":return e;case"root":return e.getRootFeatureSet()}return null}function Oe(e,t,r,a,n,i,s){return je.apply(this,arguments)}function je(){return je=Object(o.a)(d.a.mark((function e(t,r,a,n,i,s,u){var l,o,c,h,f,p=arguments;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l=p.length>7&&void 0!==p[7]?p[7]:null,!$.a.applicationCache){e.next=8;break}if(!(o=$.a.applicationCache.getLayerInfo(t+":"+s.url))){e.next=8;break}return e.next=6,o;case 6:return c=e.sent,e.abrupt("return",ue(new q.default({url:Object(x.i)(c.url)+"/"+r,outFields:["*"]}),a,n,i,u,l));case 8:return h=new te.default({id:t,portal:s}).load(),$.a.applicationCache&&$.a.applicationCache.setLayerInfo(t+":"+s.url,h),e.prev=10,e.next=13,h;case 13:return f=e.sent,e.abrupt("return",ue(new q.default({url:Object(x.i)(f.url)+"/"+r,outFields:["*"]}),a,n,i,u,l));case 17:throw e.prev=17,e.t0=e.catch(10),$.a.applicationCache&&$.a.applicationCache.clearLayerInfo(t+":"+s.url),e.t0;case 20:case"end":return e.stop()}}),e,null,[[10,17]])}))),je.apply(this,arguments)}},326:function(e,t,r){"use strict";r.d(t,"a",(function(){return y})),r.d(t,"b",(function(){return a}));var a={Base64:0,Hex:1,String:2,Raw:3};function n(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function i(e){for(var t=[],r=0,a=8*e.length;r<a;r+=8)t[r>>5]|=(255&e.charCodeAt(r/8))<<r%32;return t}function s(e){for(var t=[],r=0,a=32*e.length;r<a;r+=8)t.push(String.fromCharCode(e[r>>5]>>>r%32&255));return t.join("")}function u(e){for(var t="0123456789abcdef",r=[],a=0,n=4*e.length;a<n;a++)r.push(t.charAt(e[a>>2]>>a%4*8+4&15)+t.charAt(e[a>>2]>>a%4*8&15));return r.join("")}function l(e){for(var t=[],r=0,a=4*e.length;r<a;r+=3)for(var n=(e[r>>2]>>r%4*8&255)<<16|(e[r+1>>2]>>(r+1)%4*8&255)<<8|e[r+2>>2]>>(r+2)%4*8&255,i=0;i<4;i++)8*r+6*i>32*e.length?t.push("="):t.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(n>>6*(3-i)&63));return t.join("")}function o(e,t,r,a,i,s){return n(function(e,t){return e<<t|e>>>32-t}(n(n(t,e),n(a,s)),i),r)}function c(e,t,r,a,n,i,s){return o(t&r|~t&a,e,t,n,i,s)}function d(e,t,r,a,n,i,s){return o(t&a|r&~a,e,t,n,i,s)}function h(e,t,r,a,n,i,s){return o(t^r^a,e,t,n,i,s)}function f(e,t,r,a,n,i,s){return o(r^(t|~a),e,t,n,i,s)}function p(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var r=1732584193,a=-271733879,i=-1732584194,s=271733878,u=0;u<e.length;u+=16){var l=r,o=a,p=i,y=s;r=c(r,a,i,s,e[u+0],7,-680876936),s=c(s,r,a,i,e[u+1],12,-389564586),i=c(i,s,r,a,e[u+2],17,606105819),a=c(a,i,s,r,e[u+3],22,-1044525330),r=c(r,a,i,s,e[u+4],7,-176418897),s=c(s,r,a,i,e[u+5],12,1200080426),i=c(i,s,r,a,e[u+6],17,-1473231341),a=c(a,i,s,r,e[u+7],22,-45705983),r=c(r,a,i,s,e[u+8],7,1770035416),s=c(s,r,a,i,e[u+9],12,-1958414417),i=c(i,s,r,a,e[u+10],17,-42063),a=c(a,i,s,r,e[u+11],22,-1990404162),r=c(r,a,i,s,e[u+12],7,1804603682),s=c(s,r,a,i,e[u+13],12,-40341101),i=c(i,s,r,a,e[u+14],17,-1502002290),r=d(r,a=c(a,i,s,r,e[u+15],22,1236535329),i,s,e[u+1],5,-165796510),s=d(s,r,a,i,e[u+6],9,-1069501632),i=d(i,s,r,a,e[u+11],14,643717713),a=d(a,i,s,r,e[u+0],20,-373897302),r=d(r,a,i,s,e[u+5],5,-701558691),s=d(s,r,a,i,e[u+10],9,38016083),i=d(i,s,r,a,e[u+15],14,-660478335),a=d(a,i,s,r,e[u+4],20,-405537848),r=d(r,a,i,s,e[u+9],5,568446438),s=d(s,r,a,i,e[u+14],9,-1019803690),i=d(i,s,r,a,e[u+3],14,-187363961),a=d(a,i,s,r,e[u+8],20,1163531501),r=d(r,a,i,s,e[u+13],5,-1444681467),s=d(s,r,a,i,e[u+2],9,-51403784),i=d(i,s,r,a,e[u+7],14,1735328473),r=h(r,a=d(a,i,s,r,e[u+12],20,-1926607734),i,s,e[u+5],4,-378558),s=h(s,r,a,i,e[u+8],11,-2022574463),i=h(i,s,r,a,e[u+11],16,1839030562),a=h(a,i,s,r,e[u+14],23,-35309556),r=h(r,a,i,s,e[u+1],4,-1530992060),s=h(s,r,a,i,e[u+4],11,1272893353),i=h(i,s,r,a,e[u+7],16,-155497632),a=h(a,i,s,r,e[u+10],23,-1094730640),r=h(r,a,i,s,e[u+13],4,681279174),s=h(s,r,a,i,e[u+0],11,-358537222),i=h(i,s,r,a,e[u+3],16,-722521979),a=h(a,i,s,r,e[u+6],23,76029189),r=h(r,a,i,s,e[u+9],4,-640364487),s=h(s,r,a,i,e[u+12],11,-421815835),i=h(i,s,r,a,e[u+15],16,530742520),r=f(r,a=h(a,i,s,r,e[u+2],23,-995338651),i,s,e[u+0],6,-198630844),s=f(s,r,a,i,e[u+7],10,1126891415),i=f(i,s,r,a,e[u+14],15,-1416354905),a=f(a,i,s,r,e[u+5],21,-57434055),r=f(r,a,i,s,e[u+12],6,1700485571),s=f(s,r,a,i,e[u+3],10,-1894986606),i=f(i,s,r,a,e[u+10],15,-1051523),a=f(a,i,s,r,e[u+1],21,-2054922799),r=f(r,a,i,s,e[u+8],6,1873313359),s=f(s,r,a,i,e[u+15],10,-30611744),i=f(i,s,r,a,e[u+6],15,-1560198380),a=f(a,i,s,r,e[u+13],21,1309151649),r=f(r,a,i,s,e[u+4],6,-145523070),s=f(s,r,a,i,e[u+11],10,-1120210379),i=f(i,s,r,a,e[u+2],15,718787259),a=f(a,i,s,r,e[u+9],21,-343485551),r=n(r,l),a=n(a,o),i=n(i,p),s=n(s,y)}return[r,a,i,s]}function y(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.Hex,r=t||a.Base64,n=p(i(e),8*e.length);switch(r){case a.Raw:return n;case a.Hex:return u(n);case a.String:return s(n);case a.Base64:return l(n)}}},629:function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));var a=r(5),n=r(155),i=r(154),s=r.n(i),u=r(337),l=r(410),o=r(254);function c(e,t,r){return d.apply(this,arguments)}function d(){return d=Object(n.a)(s.a.mark((function e(t,r,n){var i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=Object(u.c)(t),e.abrupt("return",Object(l.executeQueryForCount)(i,o.a.from(r),Object(a.a)({},n)).then((function(e){return e.data.count})));case 2:case"end":return e.stop()}}),e)}))),d.apply(this,arguments)}},630:function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));var a=r(5),n=r(155),i=r(154),s=r.n(i),u=r(337),l=r(410),o=r(254);function c(e,t,r){return d.apply(this,arguments)}function d(){return d=Object(n.a)(s.a.mark((function e(t,r,n){var i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=Object(u.c)(t),e.abrupt("return",Object(l.executeQueryForIds)(i,o.a.from(r),Object(a.a)({},n)).then((function(e){return e.data.objectIds})));case 2:case"end":return e.stop()}}),e)}))),d.apply(this,arguments)}},885:function(e,t,r){"use strict";r.d(t,"a",(function(){return _}));var a=r(155),n=r(142),i=r(143),s=r(144),u=r(145),l=r(154),o=r.n(l),c=r(473),d=r(470),h=r(375),f=r(526),p=r(162),y=r(433),b=r(185),_=function(e){Object(s.a)(r,e);var t=Object(u.a)(r);function r(e){var a;return Object(n.a)(this,r),(a=t.call(this,e)).declaredClass="esri.arcade.featureset.actions.AttributeFilter",a._maxProcessing=1e3,a._parent=e.parentfeatureset,e.whereclause instanceof y.WhereClause?(a._whereclause=e.whereclause,a._whereClauseFunction=null):(a._whereClauseFunction=e.whereclause,a._whereclause=null),a}return Object(i.a)(r,[{key:"_initialiseFeatureSet",value:function(){null!==this._parent?(this.fields=this._parent.fields.slice(0),this.geometryType=this._parent.geometryType,this.objectIdField=this._parent.objectIdField,this.globalIdField=this._parent.globalIdField,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField=this._parent.typeIdField,this.types=this._parent.types):(this.fields=[],this.typeIdField="",this.objectIdField="",this.globalIdField="",this.spatialReference=new b.a({wkid:4326}),this.geometryType=h.m.point)}},{key:"_getSet",value:function(){var e=Object(a.a)(o.a.mark((function e(t){var r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==this._wset){e.next=7;break}return e.next=3,this._ensureLoaded();case 3:return e.next=5,this._parent._getFilteredSet("",null,this._whereclause,null,t);case 5:return r=e.sent,e.abrupt("return",(this._checkCancelled(t),null!==this._whereClauseFunction?this._wset=new d.a(r._candidates.slice(0).concat(r._known.slice(0)),[],r._ordered,this._clonePageDefinition(r.pagesDefinition)):this._wset=new d.a(r._candidates.slice(0),r._known.slice(0),r._ordered,this._clonePageDefinition(r.pagesDefinition)),this._wset));case 7:return e.abrupt("return",this._wset);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_isInFeatureSet",value:function(e){var t=this._parent._isInFeatureSet(e);return t===h.b.NotInFeatureSet?t:void 0===(t=this._idstates[e])?h.b.Unknown:t}},{key:"_getFeature",value:function(e,t,r){return this._parent._getFeature(e,t,r)}},{key:"_getFeatures",value:function(e,t,r,a){return this._parent._getFeatures(e,t,r,a)}},{key:"_featureFromCache",value:function(e){return this._parent._featureFromCache(e)}},{key:"executeWhereClause",value:function(e){return this._whereclause.testFeature(e)}},{key:"executeWhereClauseDeferred",value:function(){var e=Object(a.a)(o.a.mark((function e(t){var r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===this._whereClauseFunction){e.next=3;break}return r=this._whereClauseFunction(t),e.abrupt("return",(Object(p.l)(r),r));case 3:return e.abrupt("return",this.executeWhereClause(t));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_fetchAndRefineFeatures",value:function(){var e=Object(a.a)(o.a.mark((function e(t,r,a){var n,i,s,u,l,c,f,p;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new d.a([],t,!1,null),i=Math.min(r,t.length),e.next=3,this._parent._getFeatures(n,-1,i,a);case 3:if(this._checkCancelled(a),null!=this._whereClauseFunction){e.next=7;break}for(s=0;s<i;s++)u=this._parent._featureFromCache(t[s]),!0===this.executeWhereClause(u)?this._idstates[t[s]]=h.b.InFeatureSet:this._idstates[t[s]]=h.b.NotInFeatureSet;return e.abrupt("return","success");case 7:l=[],c=0;case 9:if(!(c<i)){e.next=19;break}return f=this._parent._featureFromCache(t[c]),e.t0=l,e.next=14,this.executeWhereClauseDeferred(f);case 14:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 16:c++,e.next=9;break;case 19:for(p=0;p<r;p++)!0===l[p]?this._idstates[t[p]]=h.b.InFeatureSet:this._idstates[t[p]]=h.b.NotInFeatureSet;return e.abrupt("return","success");case 21:case"end":return e.stop()}}),e,this)})));return function(t,r,a){return e.apply(this,arguments)}}()},{key:"_getFilteredSet",value:function(){var e=Object(a.a)(o.a.mark((function e(t,r,a,n,i){var s;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null!==this._whereClauseFunction||(null!==a?null!==this._whereclause&&(a=Object(f.a)(this._whereclause,a)):a=this._whereclause),e.next=3,this._ensureLoaded();case 3:return e.next=5,this._parent._getFilteredSet(t,r,a,n,i);case 5:return s=e.sent,e.abrupt("return",(this._checkCancelled(i),null!==this._whereClauseFunction?new d.a(s._candidates.slice(0).concat(s._known.slice(0)),[],s._ordered,this._clonePageDefinition(s.pagesDefinition)):new d.a(s._candidates.slice(0),s._known.slice(0),s._ordered,this._clonePageDefinition(s.pagesDefinition))));case 7:case"end":return e.stop()}}),e,this)})));return function(t,r,a,n,i){return e.apply(this,arguments)}}()},{key:"_stat",value:function(){var e=Object(a.a)(o.a.mark((function e(t,r,a,n,i,s,u){var l,c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===this._whereClauseFunction){e.next=2;break}return e.abrupt("return",null===i&&""===a&&null===n?this._manualStat(t,r,s,u):{calculated:!1});case 2:return l=this._whereclause,null!==i&&null!==this._whereclause&&(l=Object(f.a)(this._whereclause,i)),e.next=6,this._parent._stat(t,r,a,n,l,s,u);case 6:return c=e.sent,e.abrupt("return",!1===c.calculated?null===i&&""===a&&null===n?this._manualStat(t,r,s,u):{calculated:!1}:c);case 8:case"end":return e.stop()}}),e,this)})));return function(t,r,a,n,i,s,u){return e.apply(this,arguments)}}()},{key:"_canDoAggregates",value:function(){var e=Object(a.a)(o.a.mark((function e(t,r,a,n,i){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null===this._whereClauseFunction&&(null!==i?null!==this._whereclause&&(i=Object(f.a)(this._whereclause,i)):i=this._whereclause,null!==this._parent&&this._parent._canDoAggregates(t,r,a,n,i)));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r,a,n,i){return e.apply(this,arguments)}}()},{key:"_getAggregatePagesDataSourceDefinition",value:function(){var e=Object(a.a)(o.a.mark((function e(t,r,a,n,i,s,u){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==this._parent){e.next=2;break}throw new Error("Should never be called");case 2:return e.abrupt("return",(null!==i?null!==this._whereclause&&(i=Object(f.a)(this._whereclause,i)):i=this._whereclause,this._parent._getAggregatePagesDataSourceDefinition(t,r,a,n,i,s,u)));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r,a,n,i,s,u){return e.apply(this,arguments)}}()}],[{key:"registerAction",value:function(){c.a._featuresetFunctions.filter=function(e){if("function"==typeof e)return new r({parentfeatureset:this,whereclause:e});var t=null;return e instanceof y.WhereClause&&(t=e),new r({parentfeatureset:this,whereclause:t})}}}]),r}(c.a)},887:function(e,t,r){"use strict";r.d(t,"a",(function(){return y}));var a=r(60),n=r(155),i=r(142),s=r(143),u=r(144),l=r(145),o=r(154),c=r.n(o),d=r(338),h=r(473),f=r(470),p=r(888),y=function(e){Object(u.a)(r,e);var t=Object(l.a)(r);function r(e){var a;return Object(i.a)(this,r),(a=t.call(this,e))._orderbyclause=null,a.declaredClass="esri.arcade.featureset.actions.OrderBy",a._maxProcessing=100,a._orderbyclause=e.orderbyclause,a._parent=e.parentfeatureset,a}return Object(s.a)(r,[{key:"_getSet",value:function(){var e=Object(n.a)(c.a.mark((function e(t){var r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==this._wset){e.next=7;break}return e.next=3,this._ensureLoaded();case 3:return e.next=5,this._getFilteredSet("",null,null,this._orderbyclause,t);case 5:return r=e.sent,e.abrupt("return",(this._checkCancelled(t),this._wset=r,this._wset));case 7:return e.abrupt("return",this._wset);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"manualOrderSet",value:function(){var e=Object(n.a)(c.a.mark((function e(t,r){var a,n,i;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getIdColumnDictionary(t,[],-1,r);case 2:for(a=e.sent,this._orderbyclause.order(a),n=new f.a([],[],!0,null),i=0;i<a.length;i++)n._known.push(a[i].id);return e.abrupt("return",n);case 7:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"getIdColumnDictionary",value:function(){var e=Object(n.a)(c.a.mark((function e(t,r,n,i){var s,u,l,o,h,f,p;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n<t._known.length-1)){e.next=17;break}if(s=this._maxQueryRate(),"GETPAGES"!==t._known[n+1]){e.next=6;break}return e.next=5,Object(d.y)(this._parent._expandPagedSet(t,s,0,0,i));case 5:return e.abrupt("return",this.getIdColumnDictionary(t,r,n,i));case 6:for(u=n+1,l=[];u<t._known.length&&"GETPAGES"!==t._known[u];)l.push(t._known[u]),u++;return n+=l.length,e.next=12,Object(d.y)(this._parent._getFeatureBatch(l,i));case 12:o=e.sent,this._checkCancelled(i),h=Object(a.a)(o);try{for(h.s();!(f=h.n()).done;)p=f.value,r.push({id:p.attributes[this.objectIdField],feature:p})}catch(c){h.e(c)}finally{h.f()}return e.abrupt("return",this.getIdColumnDictionary(t,r,n,i));case 17:if(!(t._candidates.length>0)){e.next=24;break}return e.next=20,Object(d.y)(this._refineSetBlock(t,this._maxProcessingRate(),i));case 20:this._checkCancelled(i),e.t0=this.getIdColumnDictionary(t,r,n,i),e.next=25;break;case 24:e.t0=r;case 25:return e.abrupt("return",e.t0);case 26:case"end":return e.stop()}}),e,this)})));return function(t,r,a,n){return e.apply(this,arguments)}}()},{key:"_isInFeatureSet",value:function(e){return this._parent._isInFeatureSet(e)}},{key:"_getFeatures",value:function(e,t,r,a){return this._parent._getFeatures(e,t,r,a)}},{key:"_featureFromCache",value:function(e){if(void 0===this._featureCache[e]){var t=this._parent._featureFromCache(e);if(void 0===t)return;return null===t?null:(this._featureCache[e]=t,t)}return this._featureCache[e]}},{key:"_fetchAndRefineFeatures",value:function(){var e=Object(n.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Fetch and Refine should not be called in this featureset");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"_getFilteredSet",value:function(){var e=Object(n.a)(c.a.mark((function e(t,r,a,n,i){var s,u,l,o;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ensureLoaded();case 2:return e.next=4,this._parent._getFilteredSet(t,r,a,null===n?this._orderbyclause:n,i);case 4:if(s=e.sent,this._checkCancelled(i),u=new f.a(s._candidates.slice(0),s._known.slice(0),s._ordered,this._clonePageDefinition(s.pagesDefinition)),l=!0,s._candidates.length>0&&(l=!1),!1!==u._ordered){e.next=13;break}return e.next=11,this.manualOrderSet(u,i);case 11:return o=e.sent,e.abrupt("return",(!1===l&&(null===r&&null===a||(o=new f.a(o._candidates.slice(0).concat(o._known.slice(0)),[],o._ordered,this._clonePageDefinition(o.pagesDefinition)))),o));case 13:return e.abrupt("return",u);case 14:case"end":return e.stop()}}),e,this)})));return function(t,r,a,n,i){return e.apply(this,arguments)}}()}],[{key:"registerAction",value:function(){h.a._featuresetFunctions.orderBy=function(e){return""===e?this:new r({parentfeatureset:this,orderbyclause:new p.a(e)})}}}]),r}(h.a)},888:function(e,t,r){"use strict";r.d(t,"a",(function(){return u}));var a=r(60),n=r(142),i=r(143);function s(e,t){return e===t?0:null===e?-1:null===t?1:e<t?-1:1}var u=function(){function e(t){Object(n.a)(this,e);var r=t.split(",");this._fields=[],this._directions=[];for(var a=0;a<r.length;a++){var i=r[a].match(/\S+/g);this._fields.push(i[0]),2===i.length?"asc"===i[1].toLowerCase()?this._directions.push(1):this._directions.push(0):this._directions.push(1)}}return Object(i.a)(e,[{key:"constructClause",value:function(){for(var e="",t=0;t<this._fields.length;t++)0!==t&&(e+=","),e+=this._fields[t],1===this._directions[t]?e+=" ASC":e+=" DESC";return e}},{key:"order",value:function(e){var t=this;e.sort((function(e,r){for(var a=0;a<t._fields.length;a++){var n,i=t.featureValue(e.feature,t._fields[a],a),u=t.featureValue(r.feature,t._fields[a],a);if(0!==(n=1===t._directions[a]?s(i,u):-1*s(i,u)))return n}return 0}))}},{key:"scanForField",value:function(e){for(var t=0;t<this._fields.length;t++)if(this._fields[t].toLowerCase().trim()===e.toLowerCase().trim())return!0;return!1}},{key:"replaceFields",value:function(t){for(var r="",n=0;n<this._fields.length;n++){0!==n&&(r+=",");var i,s=this._fields[n],u=Object(a.a)(t);try{for(u.s();!(i=u.n()).done;){var l=i.value;if(s.toLowerCase()===l.field.toLowerCase()){s=l.newfield;break}}}catch(o){u.e(o)}finally{u.f()}r+=s,1===this._directions[n]?r+=" ASC":r+=" DESC"}return new e(r)}},{key:"featureValue",value:function(e,t,r){var a=e.attributes[t];if(void 0!==a)return a;for(var n in e.attributes)if(t.toLowerCase()===n.toLowerCase())return this._fields[r]=n,e.attributes[n];return null}}]),e}()}}]);