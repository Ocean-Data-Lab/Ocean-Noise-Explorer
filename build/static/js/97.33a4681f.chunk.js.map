{"version":3,"sources":["../node_modules/@arcgis/core/layers/TileLayer.js","../node_modules/@arcgis/core/layers/support/serviceTileInfoProperty.js","../node_modules/@arcgis/core/layers/support/TilemapCache.js","../node_modules/@arcgis/core/layers/support/Tilemap.js","../node_modules/@arcgis/core/layers/mixins/ArcGISCachedService.js"],"names":["W","I","e","listMode","isReference","operationalLayerType","resampling","sourceJSON","spatialReference","path","sublayers","type","url","r","i","signal","this","addResolvingPromise","loadFromPortal","supportedTypes","catch","a","then","_fetchService","Promise","resolve","parsedUrl","toLowerCase","_getDefaultAttribution","_getMapName","tileInfo","y","fromJSON","t","s","loaded","slice","reverse","flatten","toArray","o","writeSublayerStructure","forEach","write","push","some","Object","keys","length","layers","_getDefaultTileServers","Array","isArray","map","l","getTileUrl","responseType","query","refreshParameters","data","tilemapCache","supportsBlankTile","n","blankTile","customParameters","token","apiKey","tileServers","bandCount","pixelSizeX","U","serverType","f","ssl","replace","read","origin","version","x","_fetchServerVersion","currentVersion","P","reject","match","includes","p","search","fetchTile","__isDefault__","j","R","L","w","T","g","S","_","O","v","b","c","readOnly","prototype","json","Boolean","enabled","overridePolicy","m","String","origins","d","M","u","A","h","C","service","source","reader","minScale","maxScale","minLOD","maxLOD","ignoreMinMaxLOD","lods","filter","level","Math","round","scale","location","left","top","width","height","_allAvailability","byteSize","_tileAvailabilityBitSet","ceil","Uint8Array","request","row","col","details","httpStatus","valid","response","definition","_validateJSON","freeze","_updateFromData","getLogger","z","_pendingTilemapRequests","_availableLevels","levels","cacheByteSize","MEGABYTES","_prefetchingEnabled","_tilemapCache","own","layer","_initializeTilemapDefinition","_initializeAvailableLevels","error","_tmpTilemapDefinition","_tilemapFromCache","fromDefinition","put","getAvailability","fetchTilemap","updateTileInfo","fetchAvailability","upsampleTile","fetchAvailabilityUpsample","_fetchAvailabilityUpsamplePrefetch","id","handles","has","AbortController","abort","remove","add","_prefetches","removeUnordered","_maxPrefetch","clear","size","get","prefetchingEnabled","hasTilemap","initialSize","constructOnly","Number","arguments","copyright","capabilities"],"mappings":"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","file":"static/js/97.33a4681f.chunk.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../chunks/tslib.es6.js\";import r from\"../request.js\";import t from\"../core/Error.js\";import{HandleOwnerMixin as s}from\"../core/HandleOwner.js\";import{isSome as i}from\"../core/maybe.js\";import{MultiOriginJSONMixin as o}from\"../core/MultiOriginJSONSupport.js\";import{throwIfAbortError as a}from\"../core/promiseUtils.js\";import{urlToObject as l,objectToQuery as n,makeAbsolute as p}from\"../core/urlUtils.js\";import{property as c}from\"../core/accessorSupport/decorators/property.js\";import\"../core/arrayUtils.js\";import\"../core/has.js\";import{cast as u}from\"../core/accessorSupport/decorators/cast.js\";import{reader as m}from\"../core/accessorSupport/decorators/reader.js\";import{subclass as h}from\"../core/accessorSupport/decorators/subclass.js\";import{writer as d}from\"../core/accessorSupport/decorators/writer.js\";import y from\"../geometry/SpatialReference.js\";import f from\"./Layer.js\";import{APIKeyMixin as v}from\"./mixins/APIKeyMixin.js\";import{ArcGISCachedService as g}from\"./mixins/ArcGISCachedService.js\";import{ArcGISMapService as S}from\"./mixins/ArcGISMapService.js\";import{ArcGISService as _}from\"./mixins/ArcGISService.js\";import{BlendLayer as j}from\"./mixins/BlendLayer.js\";import{CustomParametersMixin as b}from\"./mixins/CustomParametersMixin.js\";import{OperationalLayer as w}from\"./mixins/OperationalLayer.js\";import{PortalLayer as T}from\"./mixins/PortalLayer.js\";import{RefreshableLayer as O}from\"./mixins/RefreshableLayer.js\";import{ScaleRangeLayer as L}from\"./mixins/ScaleRangeLayer.js\";import{SublayersOwner as R}from\"./mixins/SublayersOwner.js\";import{parse as U,isHostedAgolService as x,isArcGISUrl as P}from\"./support/arcgisLayerUrl.js\";import{url as A}from\"./support/commonProperties.js\";import M from\"./support/Sublayer.js\";const W=[\"Canvas/World_Dark_Gray_Base\",\"Canvas/World_Dark_Gray_Reference\",\"Canvas/World_Light_Gray_Base\",\"Canvas/World_Light_Gray_Reference\",\"Elevation/World_Hillshade\",\"Elevation/World_Hillshade_Dark\",\"Ocean/World_Ocean_Base\",\"Ocean/World_Ocean_Reference\",\"Ocean_Basemap\",\"Reference/World_Boundaries_and_Places\",\"Reference/World_Boundaries_and_Places_Alternate\",\"Reference/World_Transportation\",\"World_Imagery\",\"World_Street_Map\",\"World_Topo_Map\"];let I=class extends(j(R(L(w(T(g(S(_(o(s(O(v(b(f)))))))))))))){constructor(...e){super(...e),this.listMode=\"show\",this.isReference=null,this.operationalLayerType=\"ArcGISTiledMapServiceLayer\",this.resampling=!0,this.sourceJSON=null,this.spatialReference=null,this.path=null,this.sublayers=null,this.type=\"tile\",this.url=null}normalizeCtorArgs(e,r){return\"string\"==typeof e?{url:e,...r}:e}load(e){const r=i(e)?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:[\"Map Service\"]},e).catch(a).then((()=>this._fetchService(r)))),Promise.resolve(this)}get attributionDataUrl(){const e=this.parsedUrl?.path.toLowerCase();return e&&this._getDefaultAttribution(this._getMapName(e))}readSpatialReference(e,r){return(e=e||r.tileInfo&&r.tileInfo.spatialReference)&&y.fromJSON(e)}writeSublayers(e,r,t,s){if(!this.loaded||!e)return;const i=e.slice().reverse().flatten((({sublayers:e})=>e&&e.toArray().reverse())).toArray(),o=[],a={writeSublayerStructure:!1,...s};i.forEach((e=>{const r=e.write({},a);o.push(r)}));o.some((e=>Object.keys(e).length>1))&&(r.layers=o)}get tileServers(){return this._getDefaultTileServers(this.parsedUrl.path)}castTileServers(e){return Array.isArray(e)?e.map((e=>l(e).path)):null}fetchTile(e,t,s,i={}){const{signal:o}=i,a=this.getTileUrl(e,t,s),l={responseType:\"image\",signal:o,query:{...this.refreshParameters}};return r(a,l).then((e=>e.data))}getTileUrl(e,r,t){const s=!this.tilemapCache&&this.supportsBlankTile,i=n({...this.parsedUrl.query,blankTile:!s&&null,...this.customParameters,token:this.apiKey}),o=this.tileServers;return`${o&&o.length?o[r%o.length]:this.parsedUrl.path}/tile/${e}/${r}/${t}${i?\"?\"+i:\"\"}`}_fetchService(e){return new Promise(((s,o)=>{if(this.sourceJSON){if(null!=this.sourceJSON.bandCount&&null!=this.sourceJSON.pixelSizeX)throw new t(\"tile-layer:unsupported-url\",\"use ImageryTileLayer to open a tiled image service\");return void s({data:this.sourceJSON})}if(!this.parsedUrl)throw new t(\"tile-layer:undefined-url\",\"layer's url is not defined\");const a=U(this.parsedUrl.path);if(i(a)&&\"ImageServer\"===a.serverType)throw new t(\"tile-layer:unsupported-url\",\"use ImageryTileLayer to open a tiled image service\");r(this.parsedUrl.path,{query:{f:\"json\",...this.parsedUrl.query,...this.customParameters,token:this.apiKey},responseType:\"json\",signal:e}).then(s,o)})).then((r=>{if(r.ssl&&(this.url=this.url.replace(/^http:/i,\"https:\")),this.sourceJSON=r.data,this.read(r.data,{origin:\"service\",url:this.parsedUrl}),10.1===this.version&&!x(this.url))return this._fetchServerVersion(this.url,e).then((e=>{this.read({currentVersion:e})})).catch((()=>{}))}))}_fetchServerVersion(e,s){if(!P(e))return Promise.reject();const i=e.replace(/(.*\\/rest)\\/.*/i,\"$1\")+\"/info\";return r(i,{query:{f:\"json\",...this.customParameters,token:this.apiKey},responseType:\"json\",signal:s}).then((e=>{if(e.data&&e.data.currentVersion)return e.data.currentVersion;throw new t(\"tile-layer:version-not-available\")}))}_getMapName(e){const r=e.match(/^(?:https?:)?\\/\\/(server\\.arcgisonline\\.com|services\\.arcgisonline\\.com|ibasemaps-api\\.arcgis\\.com)\\/arcgis\\/rest\\/services\\/([^\\/]+(\\/[^\\/]+)*)\\/mapserver/i);return r&&r[2]}_getDefaultAttribution(e){if(!e)return;let r;e=e.toLowerCase();for(let t=0,s=W.length;t<s;t++)if(r=W[t],r.toLowerCase().includes(e))return p(\"//static.arcgis.com/attribution/\"+r)}_getDefaultTileServers(e){const r=-1!==e.search(/^(?:https?:)?\\/\\/server\\.arcgisonline\\.com/i),t=-1!==e.search(/^(?:https?:)?\\/\\/services\\.arcgisonline\\.com/i);return r||t?[e,e.replace(r?/server\\.arcgisonline/i:/services\\.arcgisonline/i,r?\"services.arcgisonline\":\"server.arcgisonline\")]:[]}get hasOverriddenFetchTile(){return!this.fetchTile.__isDefault__}};e([c({readOnly:!0})],I.prototype,\"attributionDataUrl\",null),e([c({type:[\"show\",\"hide\",\"hide-children\"]})],I.prototype,\"listMode\",void 0),e([c({json:{read:!0,write:!0}})],I.prototype,\"blendMode\",void 0),e([c({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],I.prototype,\"isReference\",void 0),e([c({readOnly:!0,type:[\"ArcGISTiledMapServiceLayer\"]})],I.prototype,\"operationalLayerType\",void 0),e([c({type:Boolean})],I.prototype,\"resampling\",void 0),e([c()],I.prototype,\"sourceJSON\",void 0),e([c({type:y})],I.prototype,\"spatialReference\",void 0),e([m(\"spatialReference\",[\"spatialReference\",\"tileInfo\"])],I.prototype,\"readSpatialReference\",null),e([c({type:String,json:{origins:{\"web-scene\":{read:!0,write:!0}},read:!1}})],I.prototype,\"path\",void 0),e([c({readOnly:!0})],I.prototype,\"sublayers\",void 0),e([d(\"sublayers\",{layers:{type:[M]}})],I.prototype,\"writeSublayers\",null),e([c({json:{read:!1,write:!1}})],I.prototype,\"popupEnabled\",void 0),e([c()],I.prototype,\"tileServers\",null),e([u(\"tileServers\")],I.prototype,\"castTileServers\",null),e([c({readOnly:!0,json:{read:!1}})],I.prototype,\"type\",void 0),e([c(A)],I.prototype,\"url\",void 0),I=e([h(\"esri.layers.TileLayer\")],I),I.prototype.fetchTile.__isDefault__=!0;const C=I;export{C as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport e from\"./TileInfo.js\";const r={type:e,json:{origins:{service:{read:{source:[\"tileInfo\",\"minScale\",\"maxScale\",\"minLOD\",\"maxLOD\"],reader:n}}}}};function n(r,n,l,o){if(!r)return null;const{minScale:i,maxScale:t,minLOD:m,maxLOD:s}=n;if(null!=m&&null!=s)return o&&o.ignoreMinMaxLOD?e.fromJSON(r):e.fromJSON({...r,lods:r.lods.filter((({level:e})=>null!=e&&e>=m&&e<=s))});if(0!==i&&0!==t){const n=e=>Math.round(1e4*e)/1e4,l=i?n(i):1/0,o=t?n(t):-1/0;return e.fromJSON({...r,lods:r.lods.filter((e=>{const r=n(e.scale);return r<=l&&r>=o}))})}return e.fromJSON(r)}export{n as readServiceTileInfo,r as serviceTileInfoProperty};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import t from\"../../request.js\";import i from\"../../core/Accessor.js\";import{ByteSizeUnit as r}from\"../../core/byteSizeEstimations.js\";import s from\"../../core/Error.js\";import{HandleOwnerMixin as l}from\"../../core/HandleOwner.js\";import a from\"../../core/Logger.js\";import o from\"../../core/LRUCache.js\";import n from\"../../core/PooledArray.js\";import{onAbort as c,isAbortError as h,isAborted as p,createAbortError as m}from\"../../core/promiseUtils.js\";import{watch as f,syncAndInitial as u}from\"../../core/reactiveUtils.js\";import{waitTicks as v}from\"../../core/scheduling.js\";import{objectToQuery as y}from\"../../core/urlUtils.js\";import{property as b}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/arrayUtils.js\";import\"../../core/has.js\";import{cast as _}from\"../../core/accessorSupport/decorators/cast.js\";import{subclass as d}from\"../../core/accessorSupport/decorators/subclass.js\";import{tilemapDefinitionId as g,Tilemap as w}from\"./Tilemap.js\";var T;const j=a.getLogger(\"esri.layers.support.TilemapCache\");let z=T=class extends(l(i)){constructor(e){super(e),this._pendingTilemapRequests={},this._availableLevels={},this.levels=5,this.cacheByteSize=2*r.MEGABYTES,this.request=t,this._prefetchingEnabled=!0}initialize(){this._tilemapCache=new o(this.cacheByteSize),this.own([f((()=>{const{layer:e}=this;return[e?.parsedUrl,e?.tileServers,e?.apiKey,e?.customParameters]}),(()=>this._initializeTilemapDefinition())),f((()=>this.layer?.tileInfo?.lods),(e=>this._initializeAvailableLevels(e)),u)]),this._initializeTilemapDefinition()}castLevels(e){return e<=2?(j.error(\"Minimum levels for Tilemap is 3, but got \",e),3):e}get size(){return 1<<this.levels}fetchTilemap(e,t,i,r){if(!this._availableLevels[e])return Promise.reject(new s(\"tilemap-cache:level-unavailable\",`Level ${e} is unavailable in the service`));const l=this._tmpTilemapDefinition,a=this._tilemapFromCache(e,t,i,l);if(a)return Promise.resolve(a);const o=r&&r.signal;return r={...r,signal:null},new Promise(((e,t)=>{c(o,(()=>t(m())));const i=g(l);let s=this._pendingTilemapRequests[i];if(!s){s=w.fromDefinition(l,r).then((e=>(this._tilemapCache.put(i,e,e.byteSize),e)));const e=()=>delete this._pendingTilemapRequests[i];this._pendingTilemapRequests[i]=s,s.then(e,e)}s.then(e,t)}))}getAvailability(e,t,i){if(!this._availableLevels[e])return\"unavailable\";const r=this._tilemapFromCache(e,t,i,this._tmpTilemapDefinition);return r?r.getAvailability(t,i):\"unknown\"}fetchAvailability(e,t,i,r){return this._availableLevels[e]?this.fetchTilemap(e,t,i,r).catch((e=>e)).then((r=>{if(r instanceof w){const l=r.getAvailability(t,i);if(\"unavailable\"===l)throw new s(\"tile-map:tile-unavailable\",\"Tile is not available\",{level:e,row:t,col:i});return l}if(h(r))throw r;return\"unknown\"})):Promise.reject(new s(\"tilemap-cache:level-unavailable\",`Level ${e} is unavailable in the service`))}fetchAvailabilityUpsample(e,t,i,r,s){r.level=e,r.row=t,r.col=i;const l=this.layer.tileInfo;l.updateTileInfo(r);const a=this.fetchAvailability(e,t,i,s).catch((e=>{if(h(e))throw e;if(l.upsampleTile(r))return this.fetchAvailabilityUpsample(r.level,r.row,r.col,r);throw e}));return this._fetchAvailabilityUpsamplePrefetch(r.id,e,t,i,s,a),a}async _fetchAvailabilityUpsamplePrefetch(e,t,i,r,s,l){if(!this._prefetchingEnabled)return;const a=`prefetch-${e}`;if(this.handles.has(a))return;const o=new AbortController;l.then((()=>o.abort()),(()=>o.abort()));let n=!1;const c={remove(){n||(n=!0,o.abort())}};if(this.handles.add(c,a),await v(10,o.signal).catch((()=>{})),n||(n=!0,this.handles.remove(a)),p(o))return;const h={id:e,level:t,row:i,col:r},m={...s,signal:o.signal},f=this.layer.tileInfo;for(let p=0;T._prefetches.length<T._maxPrefetch&&f.upsampleTile(h);++p){const e=this.fetchAvailability(h.level,h.row,h.col,m);T._prefetches.push(e);const t=()=>{T._prefetches.removeUnordered(e)};e.then(t,t)}}_initializeTilemapDefinition(){if(!this.layer.parsedUrl)return;const{parsedUrl:e,apiKey:t,customParameters:i}=this.layer;this._tilemapCache.clear(),this._tmpTilemapDefinition={service:{url:e.path,query:y({...e.query,...i,token:t??e.query?.token}),tileServers:this.layer.tileServers,request:this.request,type:this.layer.type},width:this.size,height:this.size,level:0,row:0,col:0}}_tilemapFromCache(e,t,i,r){r.level=e,r.row=t-t%this.size,r.col=i-i%this.size;const s=g(r);return this._tilemapCache.get(s)}_initializeAvailableLevels(e){this._availableLevels={},e&&e.forEach((e=>this._availableLevels[e.level]=!0))}get test(){const e=this;return{get prefetchingEnabled(){return e._prefetchingEnabled},set prefetchingEnabled(t){e._prefetchingEnabled=t},hasTilemap:(t,i,r)=>!!e._tilemapFromCache(t,i,r,e._tmpTilemapDefinition)}}};z._maxPrefetch=4,z._prefetches=new n({initialSize:T._maxPrefetch}),e([b({constructOnly:!0,type:Number})],z.prototype,\"levels\",void 0),e([_(\"levels\")],z.prototype,\"castLevels\",null),e([b({readOnly:!0,type:Number})],z.prototype,\"size\",null),e([b({constructOnly:!0,type:Number})],z.prototype,\"cacheByteSize\",void 0),e([b({constructOnly:!0})],z.prototype,\"layer\",void 0),e([b({constructOnly:!0})],z.prototype,\"request\",void 0),z=T=e([d(\"esri.layers.support.TilemapCache\")],z);export{z as TilemapCache};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport t from\"../../request.js\";import{constant as i}from\"../../core/arrayUtils.js\";import e from\"../../core/Error.js\";import{clone as a}from\"../../core/lang.js\";class l{constructor(){this.location={left:0,top:0,width:0,height:0},this._allAvailability=\"unknown\",this.byteSize=40}getAvailability(t,i){if(\"unknown\"!==this._allAvailability)return this._allAvailability;const e=(t-this.location.top)*this.location.width+(i-this.location.left),a=e%8,l=e>>3,o=this._tileAvailabilityBitSet;return l<0||l>o.length?\"unknown\":o[l]&1<<a?\"available\":\"unavailable\"}_updateFromData(t){const i=this.location.width,e=this.location.height;let a=!0,l=!0;const o=Math.ceil(i*e/8),n=new Uint8Array(o);let r=0;for(let s=0;s<t.length;s++){const i=s%8;t[s]?(l=!1,n[r]|=1<<i):a=!1,7===i&&++r}l?this._allAvailability=\"unavailable\":a?this._allAvailability=\"available\":(this._allAvailability=\"unknown\",this._tileAvailabilityBitSet=n,this.byteSize+=n.length)}static fromDefinition(a,o){const r=a.service.request||t,{row:s,col:h,width:c,height:m}=a,d={query:{f:\"json\"}};return o=o?{...d,...o}:d,r(n(a),o).then((t=>t.data)).catch((t=>{if(t&&t.details&&422===t.details.httpStatus)return{location:{top:s,left:h,width:c,height:m},valid:!0,data:i(c*m,0)};throw t})).then((t=>{if(t.location&&(t.location.top!==s||t.location.left!==h||t.location.width!==c||t.location.height!==m))throw new e(\"tilemap:location-mismatch\",\"Tilemap response for different location than requested\",{response:t,definition:{top:s,left:h,width:c,height:m}});return l.fromJSON(t)}))}static fromJSON(t){l._validateJSON(t);const i=new l;return i.location=Object.freeze(a(t.location)),i._updateFromData(t.data),Object.freeze(i)}static _validateJSON(t){if(!t||!t.location)throw new e(\"tilemap:missing-location\",\"Location missing from tilemap response\");if(!1===t.valid)throw new e(\"tilemap:invalid\",\"Tilemap response was marked as invalid\");if(!t.data)throw new e(\"tilemap:missing-data\",\"Data missing from tilemap response\");if(!Array.isArray(t.data))throw new e(\"tilemap:data-mismatch\",\"Data must be an array of numbers\");if(t.data.length!==t.location.width*t.location.height)throw new e(\"tilemap:data-mismatch\",\"Number of data items does not match width/height of tilemap\")}}function o(t){return`${t.level}/${t.row}/${t.col}/${t.width}/${t.height}`}function n(t){let i;if(\"vector-tile\"===t.service.type)i=`${t.service.url}/tilemap/${t.level}/${t.row}/${t.col}/${t.width}/${t.height}`;else{const e=t.service.tileServers;i=`${e&&e.length?e[t.row%e.length]:t.service.url}/tilemap/${t.level}/${t.row}/${t.col}/${t.width}/${t.height}`}const e=t.service.query;return e&&(i=`${i}?${e}`),i}export{l as Tilemap,o as tilemapDefinitionId};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import\"../../geometry.js\";import{property as r}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/arrayUtils.js\";import\"../../core/has.js\";import\"../../core/accessorSupport/ensureType.js\";import{reader as o}from\"../../core/accessorSupport/decorators/reader.js\";import{subclass as t}from\"../../core/accessorSupport/decorators/subclass.js\";import{serviceTileInfoProperty as i}from\"../support/serviceTileInfoProperty.js\";import{TilemapCache as p}from\"../support/TilemapCache.js\";import a from\"../../geometry/SpatialReference.js\";const s=s=>{let l=class extends s{constructor(){super(...arguments),this.copyright=null,this.minScale=0,this.maxScale=0,this.spatialReference=null,this.tileInfo=null,this.tilemapCache=null}readMinScale(e,r){return null!=r.minLOD&&null!=r.maxLOD?e:0}readMaxScale(e,r){return null!=r.minLOD&&null!=r.maxLOD?e:0}get supportsBlankTile(){return this.version>=10.2}readTilemapCache(e,r){return r.capabilities&&r.capabilities.includes(\"Tilemap\")?new p({layer:this}):null}};return e([r({json:{read:{source:\"copyrightText\"}}})],l.prototype,\"copyright\",void 0),e([r()],l.prototype,\"minScale\",void 0),e([o(\"service\",\"minScale\")],l.prototype,\"readMinScale\",null),e([r()],l.prototype,\"maxScale\",void 0),e([o(\"service\",\"maxScale\")],l.prototype,\"readMaxScale\",null),e([r({type:a})],l.prototype,\"spatialReference\",void 0),e([r({readOnly:!0})],l.prototype,\"supportsBlankTile\",null),e([r(i)],l.prototype,\"tileInfo\",void 0),e([r()],l.prototype,\"tilemapCache\",void 0),e([o(\"service\",\"tilemapCache\",[\"capabilities\"])],l.prototype,\"readTilemapCache\",null),e([r()],l.prototype,\"version\",void 0),l=e([t(\"esri.layers.mixins.ArcGISCachedService\")],l),l};export{s as ArcGISCachedService};\n"],"sourceRoot":""}