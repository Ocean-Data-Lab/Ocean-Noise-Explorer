(this["webpackJsonpmatx-react-pro"]=this["webpackJsonpmatx-react-pro"]||[]).push([[66],{1393:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return P}));var n=r(60),i=r(155),a=r(142),s=r(143),c=r(144),o=r(145),u=r(154),l=r.n(u),h=r(148),f=r(221),v=(r(159),r(147),r(156)),d=r(146),y=r(162),p=(r(150),r(152),r(234),r(149)),b=r(374),m=r(185),_=r(212),x=r(398),g=r(399),O=r(328),j=r(396),k=r(316),M=r(890),w=r(5),S=function(){function e(t){Object(a.a)(this,e),this._remoteClient=t,this._resourceMap=new Map,this._inFlightResourceMap=new Map,this.geometryEngine=null}return Object(s.a)(e,[{key:"destroy",value:function(){}},{key:"fetchResource",value:function(){var e=Object(i.a)(l.a.mark((function e(t,r){var n,i,a,s=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this._resourceMap,!(i=n.get(t))){e.next=3;break}return e.abrupt("return",i);case 3:if(!(a=this._inFlightResourceMap.get(t))){e.next=6;break}return e.abrupt("return",a);case 6:e.prev=6,a=this._remoteClient.invoke("tileRenderer.fetchResource",{url:t},Object(w.a)({},r)),this._inFlightResourceMap.set(t,a),a.then((function(e){return s._inFlightResourceMap.delete(t),n.set(t,e),e})),e.next=13;break;case 10:return e.prev=10,e.t0=e.catch(6),e.abrupt("return",Object(y.j)(e.t0)?null:{width:0,height:0});case 13:return e.abrupt("return",a);case 14:case"end":return e.stop()}}),e,this,[[6,10]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"getResource",value:function(e){var t;return null!==(t=this._resourceMap.get(e))&&void 0!==t?t:null}}]),e}();function L(e,t){return(!e.minScale||e.minScale>=t)&&(!e.maxScale||e.maxScale<=t)}function T(e){var t=e.message,r={message:{data:{},tileKey:t.tileKey,tileKeyOrigin:t.tileKeyOrigin,version:t.version},transferList:new Array};for(var n in t.data){var i=t.data[n];if(r.message.data[n]=null,Object(d.k)(i)){var a=i.stride,s=i.indices.slice(0),c=i.vertices.slice(0),o=i.records.slice(0),u={stride:a,indices:s,vertices:c,records:o,metrics:Object(d.b)(i.metrics,(function(e){return e.slice(0)}))};r.transferList.push(s,c,o),r.message.data[n]=u}}return r}v.a.getLogger("esri.views.2d.layers.features.processors.SymbolProcessor");var z=function(e){Object(c.a)(r,e);var t=Object(o.a)(r);function r(){var e;return Object(a.a)(this,r),(e=t.apply(this,arguments)).type="symbol",e._matchers={feature:null,aggregate:null},e._bufferData=new Map,e._bufferIds=new Map,e}return Object(s.a)(r,[{key:"initialize",value:function(){this.handles.add([this.tileStore.on("update",this.onTileUpdate.bind(this))]),this._resourceManagerProxy=new S(this.remoteClient)}},{key:"destroy",value:function(){this._resourceManagerProxy.destroy()}},{key:"supportsTileUpdates",get:function(){return!0}},{key:"forEachBufferId",value:function(e){this._bufferIds.forEach((function(t){t.forEach(e)}))}},{key:"update",value:function(){var e=Object(i.a)(l.a.mark((function e(t,r){var n,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("symbol"===(n=r.schema.processors[0]).type){e.next=3;break}return e.abrupt("return");case 3:i=Object(b.a)(this._schema,n),Object(b.b)(i,"mesh")&&(t.mesh=!0,t.why.mesh.push("Symbology changed"),this._schema=n,this._factory=this._createFactory(n),this._factory.update(n,this.tileStore.tileScheme.tileInfo));case 5:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"onTileMessage",value:function(e,t,r,n){return Object(y.p)(n),this._onTileData(e,t,r,n)}},{key:"onTileClear",value:function(e){return this._bufferData.delete(e.key.id),this._bufferIds.delete(e.key.id),this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:e.id,data:{clear:!0}})}},{key:"onTileError",value:function(e,t,r){var n=r.signal,i={tileKey:e.id,error:t};return this.remoteClient.invoke("tileRenderer.onTileError",i,{signal:n})}},{key:"onTileUpdate",value:function(e){var t,r=this,i=Object(n.a)(e.removed);try{for(i.s();!(t=i.n()).done;){var a=t.value;this._bufferData.has(a.key.id)&&this._bufferData.delete(a.key.id),this._bufferIds.has(a.key.id)&&this._bufferIds.delete(a.key.id)}}catch(u){i.e(u)}finally{i.f()}var s,c=Object(n.a)(e.added);try{var o=function(){var e=s.value;r._bufferData.forEach((function(t){var i,a=Object(n.a)(t);try{for(a.s();!(i=a.n()).done;){var s=i.value;s.message.tileKey===e.id&&r._updateTileMesh("append",e,T(s),[],!1,!1,null)}}catch(u){a.e(u)}finally{a.f()}}))};for(c.s();!(s=c.n()).done;)o()}catch(u){c.e(u)}finally{c.f()}}},{key:"_addBufferData",value:function(e,t){this._bufferData.has(e)||this._bufferData.set(e,[]),this._bufferData.get(e).push(T(t))}},{key:"_createFactory",value:function(e){var t=this,r=this.service,n=r.geometryType,i=r.objectIdField,a={geometryType:n,fields:r.fields,spatialReference:m.a.fromJSON(this.spatialReference)},s=new O.a((function(e,r){return t.remoteClient.invoke("tileRenderer.getMaterialItems",e,r)}),this.tileStore.tileScheme.tileInfo),c=e.mesh,o=c.matcher,u=c.aggregateMatcher;return this._store=s,this._matchers.feature=Object(j.a)(o,s,a,this._resourceManagerProxy),this._matchers.aggregate=Object(d.b)(u,(function(e){return Object(j.a)(e,s,a,t._resourceManagerProxy)})),new g.a(n,i,s)}},{key:"_onTileData",value:function(){var e=Object(i.a)(l.a.mark((function e(t,r,i,a){var s,c,o,u,h,f,v,p,b,m,_,x,g,O,j,k,M,w,S,L,T,z,P,I=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(y.p)(a),s=r.type,c=r.addOrUpdate,o=r.remove,u=r.clear,h=r.end,f=!!this._schema.mesh.sortKey,c){e.next=5;break}return v={type:s,addOrUpdate:null,remove:o,clear:u,end:h,sort:f},e.abrupt("return",this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:t.id,data:v},a));case 5:return p=this._processFeatures(t,c,i,a,r.status.version),e.prev=6,e.next=9,p;case 9:if(b=e.sent,!Object(d.j)(b)){e.next=13;break}return m={type:s,addOrUpdate:null,remove:o,clear:u,end:h,sort:f},e.abrupt("return",this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:t.id,data:m},a));case 13:_=[],x=Object(n.a)(b),e.prev=15,x.s();case 17:if((g=x.n()).done){e.next=41;break}if(O=g.value,j=!1,k=O.message.bufferIds,M=t.key.id,w=O.message.tileKey,M===w||!Object(d.k)(k)){e.next=38;break}if(this.tileStore.get(w)){e.next=25;break}return this._addBufferData(M,O),_.push(O),e.abrupt("continue",39);case 25:(S=this._bufferIds.get(w))||(S=new Set,this._bufferIds.set(w,S)),L=Array.from(k),T=0,z=L;case 29:if(!(T<z.length)){e.next=38;break}if(P=z[T],!S.has(P)){e.next=34;break}return j=!0,e.abrupt("break",38);case 34:S.add(P);case 35:T++,e.next=29;break;case 38:j||(this._addBufferData(M,O),_.push(O));case 39:e.next=17;break;case 41:e.next=46;break;case 43:e.prev=43,e.t0=e.catch(15),x.e(e.t0);case 46:return e.prev=46,x.f(),e.finish(46);case 49:return e.next=51,Promise.all(_.map((function(e){var n=t.key.id===e.message.tileKey,i=n?r.remove:[],c=n&&r.end;return I._updateTileMesh(s,t,e,i,c,r.clear,a.signal)})));case 51:e.next=56;break;case 53:e.prev=53,e.t1=e.catch(6),this._handleError(t,e.t1,a);case 56:case"end":return e.stop()}}),e,this,[[6,53],[15,43,46,49]])})));return function(t,r,n,i){return e.apply(this,arguments)}}()},{key:"_updateTileMesh",value:function(){var e=Object(i.a)(l.a.mark((function e(t,r,n,i,a,s,c){var o,u,h,f,v,p,b;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t,u=n.message.tileKey,h=!!this._schema.mesh.sortKey,u!==r.key.id&&(a=!1),f=Object(d.b)(n,(function(e){return e.message})),v=Object(d.b)(n,(function(e){return e.transferList}))||[],p={type:o,addOrUpdate:f,remove:i,clear:s,end:a,sort:h},b={transferList:Object(d.q)(v)||[],signal:c},e.abrupt("return",(Object(y.p)(b),this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:u,data:p},b)));case 4:case"end":return e.stop()}}),e,this)})));return function(t,r,n,i,a,s,c){return e.apply(this,arguments)}}()},{key:"_processFeatures",value:function(){var e=Object(i.a)(l.a.mark((function e(t,r,n,i,a){var s,c,o,u,h,f;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Object(d.j)(r)&&r.hasFeatures){e.next=2;break}return e.abrupt("return",null);case 2:return s={transform:t.transform,hasZ:!1,hasM:!1},c=this._factory,o={viewingMode:"",scale:t.scale},e.next=7,this._matchers.feature;case 7:return u=e.sent,e.next=10,this._matchers.aggregate;case 10:return h=e.sent,Object(y.p)(i),f=this._getLabelInfos(t,r),e.next=15,c.analyze(r.getCursor(),this._resourceManagerProxy,u,h,s,o);case 15:return Object(y.p)(i),e.abrupt("return",this._writeFeatureSet(t,r,s,f,c,n,a));case 17:case"end":return e.stop()}}),e,this)})));return function(t,r,n,i,a){return e.apply(this,arguments)}}()},{key:"_writeFeatureSet",value:function(e,t,r,n,i,a,s){for(var c=t.getSize(),o=new x.a(e.key.id,{features:c,records:c,metrics:0},this._schema.mesh.matcher.symbologyType,a,!0,s),u={viewingMode:"",scale:e.scale},l=t.getCursor();l.next();)try{var h=l.getDisplayId(),f=Object(d.k)(n)?n.get(h):null;i.writeCursor(o,l,r,u,e.level,f,this._resourceManagerProxy)}catch(y){}var v=e.tileInfoView.tileInfo.isWrappable;return o.serialize(v)}},{key:"_handleError",value:function(e,t,r){if(!Object(y.j)(t)){var n={tileKey:e.id,error:t.message};return this.remoteClient.invoke("tileRenderer.onTileError",n,{signal:r.signal})}}},{key:"_getLabelingSchemaForScale",value:function(e){var t=this._schema.mesh.labels;if(Object(d.j)(t))return null;if("subtype"===t.type){var r={type:"subtype",classes:{}},n=!1;for(var i in t.classes){var a=t.classes[i].filter((function(t){return L(t,e.scale)}));n=n||!!a.length,r.classes[i]=a}return n?r:null}var s=t.classes.filter((function(t){return L(t,e.scale)}));return s.length?{type:"simple",classes:s}:null}},{key:"_getLabels",value:function(e,t){if("subtype"===t.type){var r,n=this.service.subtypeField,i=Object(d.s)(n,"Expected to find subtype Field"),a=e.readAttribute(i);return null==a?[]:null!==(r=t.classes[a])&&void 0!==r?r:[]}return t.classes}},{key:"_getLabelInfos",value:function(e,t){var r=this,i=this._getLabelingSchemaForScale(e);if(Object(d.j)(i))return null;for(var a=new Map,s=t.getCursor(),c=function(){var e,t=s.getDisplayId(),c=[],o=Object(_.h)(t),u=o&&1!==s.readAttribute("cluster_count")?"aggregate":"feature",l=r._getLabels(s,i),h=Object(n.a)(l);try{var v=function(){var n=e.value;if(n.target!==u)return"continue";var i=s.getStorage(),a=o&&"feature"===u?i.getComputedStringAtIndex(s.readAttribute("referenceId"),n.fieldIndex):i.getComputedStringAtIndex(t,n.fieldIndex);if(!a)return"continue";var l=Object(f.a)(a.toString()),h=l[0],v=l[1];r._store.getMosaicItem(n.symbol,Object(k.a)(h)).then((function(e){c[n.index]={glyphs:e.glyphMosaicItems,rtl:v,index:n.index}}))};for(h.s();!(e=h.n()).done;)v()}catch(d){h.e(d)}finally{h.f()}a.set(t,c)};s.next();)c();return a}}]),r}(M.a),P=z=Object(h.a)([Object(p.a)("esri.views.2d.layers.features.processors.SymbolProcessor")],z)},166:function(e,t,r){"use strict";r.d(t,"a",(function(){return M})),r.d(t,"b",(function(){return T})),r.d(t,"c",(function(){return S})),r.d(t,"d",(function(){return w})),r.d(t,"e",(function(){return x})),r.d(t,"f",(function(){return L})),r.d(t,"g",(function(){return m})),r.d(t,"h",(function(){return b})),r.d(t,"i",(function(){return p})),r.d(t,"j",(function(){return _})),r.d(t,"k",(function(){return y}));var n=r(164),i=r(163),a=r(144),s=r(145),c=r(142),o=r(143),u=r(7),l=r(5),h=r(159),f=r(218),v=r(157);var d=Object.keys(v.e).filter((function(e){return"number"==typeof v.e[e]})).reduce((function(e,t){return Object(l.a)(Object(l.a)({},e),{},Object(u.a)({},t,v.e[t]))}),{});function y(e){return e===v.e.OUTLINE_FILL||e===v.e.OUTLINE_FILL_SIMPLE}function p(e){return function(e){return e===v.e.SIMPLE||e===v.e.OUTLINE_FILL_SIMPLE}(e.symbologyType)}function b(e){return y(e.symbologyType)}function m(e,t){switch(e){case v.d.FILL:return M.from(t);case v.d.LINE:return S.from(t);case v.d.MARKER:return w.from(t);case v.d.TEXT:return L.from(t);case v.d.LABEL:return T.from(t);default:throw new Error("Unable to createMaterialKey for unknown geometryType ".concat(e))}}function _(e){switch(x.load(e).geometryType){case v.d.MARKER:return new w(e);case v.d.FILL:return new M(e);case v.d.LINE:return new S(e);case v.d.TEXT:return new L(e);case v.d.LABEL:return new T(e)}}var x=function(){function e(t){Object(c.a)(this,e),this._data=0,this._data=t}return Object(o.a)(e,[{key:"data",get:function(){return this._data},set:function(e){this._data=e}},{key:"geometryType",get:function(){return this.bits(8,11)},set:function(e){this.setBits(e,8,11)}},{key:"mapAligned",get:function(){return!!this.bit(20)},set:function(e){this.setBit(20,e)}},{key:"sdf",get:function(){return!!this.bit(11)},set:function(e){this.setBit(11,e)}},{key:"pattern",get:function(){return!!this.bit(12)},set:function(e){this.setBit(12,e)}},{key:"textureBinding",get:function(){return this.bits(0,8)},set:function(e){this.setBits(e,0,8)}},{key:"symbologyType",get:function(){return this.bits(21,26)},set:function(e){this.setBits(e,21,26)}},{key:"geometryTypeString",get:function(){switch(this.geometryType){case v.d.FILL:return"fill";case v.d.MARKER:return"marker";case v.d.LINE:return"line";case v.d.TEXT:return"text";case v.d.LABEL:return"label";default:throw new h.a("Unable to handle unknown geometryType: ".concat(this.geometryType))}}},{key:"setBit",value:function(e,t){var r=1<<e;t?this._data|=r:this._data&=~r}},{key:"bit",value:function(e){return(this._data&1<<e)>>e}},{key:"setBits",value:function(e,t,r){for(var n=t,i=0;n<r;n++,i++)this.setBit(n,0!=(e&1<<i))}},{key:"bits",value:function(e,t){for(var r=0,n=e,i=0;n<t;n++,i++)r|=this.bit(n)<<i;return r}},{key:"hasVV",value:function(){return!1}},{key:"setVV",value:function(e,t){}},{key:"getVariation",value:function(){return{mapAligned:this.mapAligned,pattern:this.pattern,sdf:this.sdf,symbologyType:{value:v.e[this.symbologyType],options:d,namespace:"SYMBOLOGY_TYPE"}}}},{key:"getVariationHash",value:function(){return this._data&~(7&this.textureBinding)}}],[{key:"load",value:function(e){var t=this.shared;return t.data=e,t}}]),e}();x.shared=new x(0);var g=function(e){return function(e){Object(a.a)(r,e);var t=Object(s.a)(r);function r(){return Object(c.a)(this,r),t.apply(this,arguments)}return Object(o.a)(r,[{key:"vvSizeMinMaxValue",get:function(){return 0!==this.bit(16)},set:function(e){this.setBit(16,e)}},{key:"vvSizeScaleStops",get:function(){return 0!==this.bit(17)},set:function(e){this.setBit(17,e)}},{key:"vvSizeFieldStops",get:function(){return 0!==this.bit(18)},set:function(e){this.setBit(18,e)}},{key:"vvSizeUnitValue",get:function(){return 0!==this.bit(19)},set:function(e){this.setBit(19,e)}},{key:"hasVV",value:function(){return Object(n.a)(Object(i.a)(r.prototype),"hasVV",this).call(this)||this.vvSizeMinMaxValue||this.vvSizeScaleStops||this.vvSizeFieldStops||this.vvSizeUnitValue}},{key:"setVV",value:function(e,t){Object(n.a)(Object(i.a)(r.prototype),"setVV",this).call(this,e,t);var a=function(e,t,r){var n=v.f.SIZE_FIELD_STOPS|v.f.SIZE_MINMAX_VALUE|v.f.SIZE_SCALE_STOPS|v.f.SIZE_UNIT_VALUE,i=(t&(v.g.FIELD_TARGETS_OUTLINE|v.g.MINMAX_TARGETS_OUTLINE|v.g.SCALE_TARGETS_OUTLINE|v.g.UNIT_TARGETS_OUTLINE))>>>4;return e===v.d.LINE&&r.isOutline||e===v.d.FILL&&y(r.symbologyType)?n&i:n&~i}(this.geometryType,e,t)&e;this.vvSizeMinMaxValue=!!(a&v.f.SIZE_MINMAX_VALUE),this.vvSizeFieldStops=!!(a&v.f.SIZE_FIELD_STOPS),this.vvSizeUnitValue=!!(a&v.f.SIZE_UNIT_VALUE),this.vvSizeScaleStops=!!(a&v.f.SIZE_SCALE_STOPS)}}]),r}(e)},O=function(e){return function(e){Object(a.a)(r,e);var t=Object(s.a)(r);function r(){return Object(c.a)(this,r),t.apply(this,arguments)}return Object(o.a)(r,[{key:"vvRotation",get:function(){return 0!==this.bit(15)},set:function(e){this.setBit(15,e)}},{key:"hasVV",value:function(){return Object(n.a)(Object(i.a)(r.prototype),"hasVV",this).call(this)||this.vvRotation}},{key:"setVV",value:function(e,t){Object(n.a)(Object(i.a)(r.prototype),"setVV",this).call(this,e,t),this.vvRotation=!t.isOutline&&!!(e&v.f.ROTATION)}}]),r}(e)},j=function(e){return function(e){Object(a.a)(r,e);var t=Object(s.a)(r);function r(){return Object(c.a)(this,r),t.apply(this,arguments)}return Object(o.a)(r,[{key:"vvColor",get:function(){return 0!==this.bit(13)},set:function(e){this.setBit(13,e)}},{key:"hasVV",value:function(){return Object(n.a)(Object(i.a)(r.prototype),"hasVV",this).call(this)||this.vvColor}},{key:"setVV",value:function(e,t){Object(n.a)(Object(i.a)(r.prototype),"setVV",this).call(this,e,t),this.vvColor=!t.isOutline&&!!(e&v.f.COLOR)}}]),r}(e)},k=function(e){return function(e){Object(a.a)(r,e);var t=Object(s.a)(r);function r(){return Object(c.a)(this,r),t.apply(this,arguments)}return Object(o.a)(r,[{key:"vvOpacity",get:function(){return 0!==this.bit(14)},set:function(e){this.setBit(14,e)}},{key:"hasVV",value:function(){return Object(n.a)(Object(i.a)(r.prototype),"hasVV",this).call(this)||this.vvOpacity}},{key:"setVV",value:function(e,t){Object(n.a)(Object(i.a)(r.prototype),"setVV",this).call(this,e,t),this.vvOpacity=!t.isOutline&&!!(e&v.f.OPACITY)}}]),r}(e)},M=function(e){Object(a.a)(r,e);var t=Object(s.a)(r);function r(){return Object(c.a)(this,r),t.apply(this,arguments)}return Object(o.a)(r,[{key:"getVariation",value:function(){return Object(l.a)(Object(l.a)({},Object(n.a)(Object(i.a)(r.prototype),"getVariation",this).call(this)),{},{vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue})}}],[{key:"load",value:function(e){var t=this.shared;return t.data=e,t}},{key:"from",value:function(e){var t=e.symbologyType,r=e.vvFlags,n=this.load(0);return n.geometryType=v.d.FILL,n.symbologyType=t,t!==v.e.DOT_DENSITY&&n.setVV(r,e),n.data}}]),r}(j(k(g(x))));M.shared=new M(0);var w=function(e){Object(a.a)(r,e);var t=Object(s.a)(r);function r(){return Object(c.a)(this,r),t.apply(this,arguments)}return Object(o.a)(r,[{key:"getVariation",value:function(){return Object(l.a)(Object(l.a)({},Object(n.a)(Object(i.a)(r.prototype),"getVariation",this).call(this)),{},{vvColor:this.vvColor,vvRotation:this.vvRotation,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue})}}],[{key:"load",value:function(e){var t=this.shared;return t.data=e,t}},{key:"from",value:function(e){var t=e.symbologyType,r=e.vvFlags,n=this.load(0);return n.geometryType=v.d.MARKER,n.symbologyType=t,t!==v.e.HEATMAP&&n.setVV(r,e),n.data}}]),r}(j(k(O(g(x)))));w.shared=new w(0);var S=function(e){Object(a.a)(r,e);var t=Object(s.a)(r);function r(){return Object(c.a)(this,r),t.apply(this,arguments)}return Object(o.a)(r,[{key:"getVariation",value:function(){return Object(l.a)(Object(l.a)({},Object(n.a)(Object(i.a)(r.prototype),"getVariation",this).call(this)),{},{vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue})}}],[{key:"load",value:function(e){var t=this.shared;return t.data=e,t}},{key:"from",value:function(e){var t=this.load(0);return t.geometryType=v.d.LINE,t.symbologyType=e.symbologyType,t.setVV(e.vvFlags,e),t.data}}]),r}(j(k(g(x))));S.shared=new S(0);var L=function(e){Object(a.a)(r,e);var t=Object(s.a)(r);function r(){return Object(c.a)(this,r),t.apply(this,arguments)}return Object(o.a)(r,[{key:"getVariation",value:function(){return Object(l.a)(Object(l.a)({},Object(n.a)(Object(i.a)(r.prototype),"getVariation",this).call(this)),{},{vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvRotation:this.vvRotation,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue})}}],[{key:"load",value:function(e){var t=this.shared;return t.data=e,t}},{key:"from",value:function(e){var t=this.load(0);return t.geometryType=v.d.TEXT,t.symbologyType=e.symbologyType,t.setVV(e.vvFlags,e),t.data}}]),r}(j(k(O(g(x)))));L.shared=new L(0);var T=function(e){Object(a.a)(r,e);var t=Object(s.a)(r);function r(){return Object(c.a)(this,r),t.apply(this,arguments)}return Object(o.a)(r,[{key:"getVariation",value:function(){return Object(l.a)(Object(l.a)({},Object(n.a)(Object(i.a)(r.prototype),"getVariation",this).call(this)),{},{vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue})}}],[{key:"load",value:function(e){var t=this.shared;return t.data=e,t}},{key:"from",value:function(e){var t=this.load(0);return t.geometryType=v.d.LABEL,t.symbologyType=e.symbologyType,t.setVV(e.vvFlags,e),t.mapAligned=Object(f.i)(e.placement),t.data}}]),r}(g(x));T.shared=new T(0)},199:function(e,t,r){"use strict";r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return n})),r.d(t,"c",(function(){return o})),r.d(t,"d",(function(){return l})),r.d(t,"e",(function(){return h})),r.d(t,"f",(function(){return u})),r.d(t,"g",(function(){return c})),r.d(t,"h",(function(){return a}));var n=0,i=100;function a(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function s(e,t){return Math.sqrt(e*e+t*t)}function c(e){var t=s(e[0],e[1]);e[0]/=t,e[1]/=t}function o(e,t){return s(e[0]-t[0],e[1]-t[1])}function u(e){return"function"==typeof e}function l(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;return 1/Math.max(e,1)}function h(e,t){return[!!e.minScale&&t.scaleToZoom(e.minScale)||n,!!e.maxScale&&t.scaleToZoom(e.maxScale)||i]}},218:function(e,t,r){"use strict";var n,i;function a(e){switch(e){case"left":return n.Left;case"right":return n.Right;case"center":return n.Center}}function s(e){switch(e){case"top":return i.Top;case"middle":return i.Center;case"baseline":return i.Baseline;case"bottom":return i.Bottom}}function c(e){switch(e){case"above-left":case"esriServerPointLabelPlacementAboveLeft":return[n.Right,i.Bottom];case"above-center":case"above-along":case"esriServerPointLabelPlacementAboveCenter":case"esriServerLinePlacementAboveAlong":return[n.Center,i.Bottom];case"above-right":case"esriServerPointLabelPlacementAboveRight":return[n.Left,i.Bottom];case"center-left":case"esriServerPointLabelPlacementCenterLeft":return[n.Right,i.Center];case"center-center":case"center-along":case"esriServerPointLabelPlacementCenterCenter":case"esriServerLinePlacementCenterAlong":case"always-horizontal":case"esriServerPolygonPlacementAlwaysHorizontal":return[n.Center,i.Center];case"center-right":case"esriServerPointLabelPlacementCenterRight":return[n.Left,i.Center];case"below-left":case"esriServerPointLabelPlacementBelowLeft":return[n.Right,i.Top];case"below-center":case"below-along":case"esriServerPointLabelPlacementBelowCenter":case"esriServerLinePlacementBelowAlong":return[n.Center,i.Top];case"below-right":case"esriServerPointLabelPlacementBelowRight":return[n.Left,i.Top];default:return console.debug("Found invalid placement type ".concat(e)),[n.Center,i.Center]}}function o(e){switch(e){case n.Right:return-1;case n.Center:return 0;case n.Left:return 1;default:return console.debug("Found invalid horizontal alignment ".concat(e)),0}}function u(e){switch(e){case i.Top:return 1;case i.Center:return 0;case i.Bottom:case i.Baseline:return-1;default:return console.debug("Found invalid vertical alignment ".concat(e)),0}}function l(e){switch(e){case"left":return n.Left;case"right":return n.Right;case"center":return n.Center}}function h(e){switch(e){case"above-along":case"below-along":case"center-along":case"esriServerLinePlacementAboveAlong":case"esriServerLinePlacementBelowAlong":case"esriServerLinePlacementCenterAlong":return!0;default:return!1}}r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return i})),r.d(t,"c",(function(){return c})),r.d(t,"d",(function(){return l})),r.d(t,"e",(function(){return a})),r.d(t,"f",(function(){return o})),r.d(t,"g",(function(){return s})),r.d(t,"h",(function(){return u})),r.d(t,"i",(function(){return h})),function(e){e[e.Left=-1]="Left",e[e.Center=0]="Center",e[e.Right=1]="Right"}(n||(n={})),function(e){e[e.Top=1]="Top",e[e.Center=0]="Center",e[e.Bottom=-1]="Bottom",e[e.Baseline=2]="Baseline"}(i||(i={}))},230:function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));var n=r(142),i=r(143),a=r(146),s=r(323),c=function(){function e(){Object(n.a)(this,e)}return Object(i.a)(e,[{key:"bindFeature",value:function(e,t,r){}},{key:"write",value:function(e,t,r,n){var i;if(Object(a.j)(this._effects)||0===(null===(i=this._effects)||void 0===i?void 0:i.length))return this._write(e,t,n);for(var c=s.a.executeEffects(this._effects,t.readLegacyGeometryForDisplay(),n.geometryEngine),o=s.a.next(c);o;)this._write(e,t,n,o),o=s.a.next(c)}},{key:"_write",value:function(e,t,r,n){}}]),e}()},232:function(e,t,r){"use strict";r.d(t,"a",(function(){return z})),r.d(t,"b",(function(){return T}));var n=r(155),i=r(154),a=r.n(i),s=r(292),c=r(60),o=r(142),u=r(143),l=r(157),h=r(166),f={marker:l.d.MARKER,fill:l.d.FILL,line:l.d.LINE,text:l.d.TEXT},v=function(){function e(t,r,n,i){Object(o.a)(this,e);var a={minScale:null===r||void 0===r?void 0:r.minScale,maxScale:null===r||void 0===r?void 0:r.maxScale},s=function(e){return e.minScale||e.maxScale?e.minScale+"-"+e.maxScale:""}(a);this.layers=t,this.data=r,this.hash=this._createHash()+s,this.rendererKey=n;var u,v={isOutline:!1,placement:null,symbologyType:l.e.DEFAULT,vvFlags:n},d=Object(c.a)(t);try{for(d.s();!(u=d.n()).done;){var y=u.value,p=f[y.type];v.isOutline="line"===y.type&&y.isOutline,y.materialKey=Object(h.g)(p,v),y.maxVVSize=i,y.scaleInfo=a,y.templateHash+=s}}catch(b){d.e(b)}finally{d.f()}}return Object(u.a)(e,[{key:"type",get:function(){return"expanded-cim"}},{key:"_createHash",value:function(){var e,t="",r=Object(c.a)(this.layers);try{for(r.s();!(e=r.n()).done;){t+=e.value.templateHash}}catch(n){r.e(n)}finally{r.f()}return t}}]),e}();var d=r(291),y=r(159),p=r(146),b=r(162),m=r(183),_=r(276),x=r(287),g=r(407);function O(e,t,r){return j.apply(this,arguments)}function j(){return(j=Object(n.a)(a.a.mark((function e(t,r,n){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.name){e.next=2;break}throw new y.a("style-symbol-reference-name-missing","Missing name in style symbol reference");case 2:if(!t.styleName||"Esri2DPointSymbolsStyle"!==t.styleName){e.next=4;break}return e.abrupt("return",k(t,n));case 4:return e.prev=4,e.t0=w,e.next=8,Object(g.b)(t,r,n);case 8:return e.t1=e.sent,e.t2=t.name,e.t3=r,e.t4=n,e.abrupt("return",(0,e.t0)(e.t1,e.t2,e.t3,e.t4));case 15:return e.prev=15,e.t5=e.catch(4),e.abrupt("return",(Object(b.p)(e.t5),null));case 18:case"end":return e.stop()}}),e,null,[[4,15]])})))).apply(this,arguments)}function k(e,t){return M.apply(this,arguments)}function M(){return(M=Object(n.a)(a.a.mark((function e(t,r){var n,i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=g.a.replace(/\{SymbolName\}/gi,t.name),e.prev=1,e.next=4,Object(g.d)(n,r);case 4:return i=e.sent,e.abrupt("return",Object(g.c)(i.data));case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",(Object(b.p)(e.t0),null));case 11:case"end":return e.stop()}}),e,null,[[1,8]])})))).apply(this,arguments)}function w(e,t,r,n){return S.apply(this,arguments)}function S(){return(S=Object(n.a)(a.a.mark((function e(t,r,n,i){var s,c,o,u,l;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=t.data,c={portal:n&&Object(p.k)(n.portal)?n.portal:_.a.getDefault(),url:Object(m.M)(t.baseUrl),origin:"portal-item"},o=s.items.find((function(e){return e.name===r}))){e.next=3;break}throw new y.a("symbolstyleutils:symbol-name-not-found","The symbol name '".concat(r,"' could not be found"),{symbolName:r});case 3:return u=Object(x.c)(Object(g.e)(o,"cimRef"),c),Object(d.b)()&&(u=Object(d.a)(u)),e.prev=5,e.next=8,Object(g.d)(u,i);case 8:return l=e.sent,e.abrupt("return",Object(g.c)(l.data));case 12:return e.prev=12,e.t0=e.catch(5),e.abrupt("return",(Object(b.p)(e.t0),null));case 15:case"end":return e.stop()}}),e,null,[[5,12]])})))).apply(this,arguments)}var L=function(){var e=Object(n.a)(a.a.mark((function e(t,r,n){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=v,e.next=3,Object(s.b)(t.data,r,n);case 3:return e.t1=e.sent,e.t2=t.data,e.t3=t.rendererKey,e.t4=t.maxVVSize,e.abrupt("return",new e.t0(e.t1,e.t2,e.t3,e.t4));case 8:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),T=function(){var e=Object(n.a)(a.a.mark((function e(t,r,n,i){var s;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",null);case 2:if("cim"!==t.type){e.next=4;break}return e.abrupt("return",L(t,r,n));case 4:if("web-style"!==t.type){e.next=12;break}return e.next=7,O(t,null,i);case 7:return e.t0=e.sent,e.t1=t.rendererKey,e.t2=t.maxVVSize,s={type:"cim",data:e.t0,rendererKey:e.t1,maxVVSize:e.t2},e.abrupt("return",L(s,r,n));case 12:return e.abrupt("return",t);case 13:case"end":return e.stop()}}),e)})));return function(t,r,n,i){return e.apply(this,arguments)}}();function z(e){if(!e)return null;var t=e.type,r=e.cim,n=e.url,i={cim:r,type:t,mosaicHash:e.materialHash,url:n,size:null,dashTemplate:null,path:null,text:null,fontName:null,animatedSymbolProperties:null};switch(t){case"marker":i.size=e.size,i.path=e.path,i.animatedSymbolProperties=e.animatedSymbolProperties;break;case"line":i.dashTemplate=e.dashTemplate;break;case"text":i.text=e.text,i.fontName=e.fontName}return i}},246:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var n=r(159);function i(e,t){if(e&&"name"in e){var r=e;return t&&t.error(new n.a(r.name,r.message,r.details)),!1}return!0}},280:function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return s}));var n,i=r(142),a=r(143),s=function(){function e(t,r){Object(i.a)(this,e),this.x=t,this.y=r}return Object(a.a)(e,[{key:"clone",value:function(){return new e(this.x,this.y)}},{key:"equals",value:function(e,t){return e===this.x&&t===this.y}},{key:"isEqual",value:function(e){return e.x===this.x&&e.y===this.y}},{key:"setCoords",value:function(e,t){this.x=e,this.y=t}},{key:"normalize",value:function(){var e=this.x,t=this.y,r=Math.sqrt(e*e+t*t);this.x/=r,this.y/=r}},{key:"rightPerpendicular",value:function(){var e=this.x;this.x=this.y,this.y=-e}},{key:"move",value:function(e,t){this.x+=e,this.y+=t}},{key:"assign",value:function(e){this.x=e.x,this.y=e.y}},{key:"assignAdd",value:function(e,t){this.x=e.x+t.x,this.y=e.y+t.y}},{key:"assignSub",value:function(e,t){this.x=e.x-t.x,this.y=e.y-t.y}},{key:"rotate",value:function(e,t){var r=this.x,n=this.y;this.x=r*e-n*t,this.y=r*t+n*e}},{key:"scale",value:function(e){this.x*=e,this.y*=e}},{key:"length",value:function(){var e=this.x,t=this.y;return Math.sqrt(e*e+t*t)}}],[{key:"distance",value:function(e,t){var r=t.x-e.x,n=t.y-e.y;return Math.sqrt(r*r+n*n)}},{key:"add",value:function(t,r){return new e(t.x+r.x,t.y+r.y)}},{key:"sub",value:function(t,r){return new e(t.x-r.x,t.y-r.y)}}]),e}();!function(e){e[e.Unknown=0]="Unknown",e[e.Point=1]="Point",e[e.LineString=2]="LineString",e[e.Polygon=3]="Polygon"}(n||(n={}))},284:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r(142),i=r(143),a=function(){function e(t,r){Object(n.a)(this,e),this._pos=0;var i=r?this._roundToNearest(r,t.BYTES_PER_ELEMENT):40;this._array=new ArrayBuffer(i),this._buffer=new t(this._array),this._ctor=t,this._i16View=new Int16Array(this._array)}return Object(i.a)(e,[{key:"length",get:function(){return this._pos}},{key:"_roundToNearest",value:function(e,t){var r=Math.round(e);return r+(t-r%t)}},{key:"_ensureSize",value:function(e){if(this._pos+e>=this._buffer.length){var t=this._roundToNearest(1.25*(this._array.byteLength+e*this._buffer.BYTES_PER_ELEMENT),this._buffer.BYTES_PER_ELEMENT),r=new ArrayBuffer(t),n=new this._ctor(r);n.set(this._buffer,0),this._array=r,this._buffer=n,this._i16View=new Int16Array(this._array)}}},{key:"ensureSize",value:function(e){this._ensureSize(e)}},{key:"writeF32",value:function(e){this._ensureSize(1);var t=this._pos;return new Float32Array(this._array,4*this._pos,1)[0]=e,this._pos++,t}},{key:"push",value:function(e){this._ensureSize(1);var t=this._pos;return this._buffer[this._pos++]=e,t}},{key:"writeFixed",value:function(e){this._buffer[this._pos++]=e}},{key:"setValue",value:function(e,t){this._buffer[e]=t}},{key:"i1616Add",value:function(e,t,r){this._i16View[2*e]+=t,this._i16View[2*e+1]+=r}},{key:"getValue",value:function(e){return this._buffer[e]}},{key:"incr",value:function(e){if(this._buffer.length<e)throw new Error("Increment index overflows the target buffer");this._buffer[e]++}},{key:"decr",value:function(e){this._buffer[e]--}},{key:"writeRegion",value:function(e){this._ensureSize(e.length);var t=this._pos;return this._buffer.set(e,this._pos),this._pos+=e.length,t}},{key:"writeManyFrom",value:function(e,t,r){this._ensureSize(r-t);for(var n=t;n!==r;n++)this.writeFixed(e._buffer[n])}},{key:"buffer",value:function(){var e=this._array.slice(0,4*this._pos);return this.destroy(),e}},{key:"toArray",value:function(){for(var e=this._array,t=[],r=0;r<e.byteLength/4;r++)t.push(e[r]);return t}},{key:"seek",value:function(e){this._pos=e}},{key:"destroy",value:function(){this._array=null,this._buffer=null}}]),e}()},291:function(e,t,r){"use strict";function n(e){return e=e||globalThis.location.hostname,u.some((function(t){var r;return null!=(null===(r=e)||void 0===r?void 0:r.match(t))}))}function i(e,t){return e&&(t=t||globalThis.location.hostname)?null!=t.match(a)||null!=t.match(c)?e.replace("static.arcgis.com","staticdev.arcgis.com"):null!=t.match(s)||null!=t.match(o)?e.replace("static.arcgis.com","staticqa.arcgis.com"):e:e}r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return n}));var a=/^devext.arcgis.com$/,s=/^qaext.arcgis.com$/,c=/^[\w-]*\.mapsdevext.arcgis.com$/,o=/^[\w-]*\.mapsqa.arcgis.com$/,u=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local.esri.com$/,a,s,/^jsapps.esri.com$/,c,o]},316:function(e,t,r){"use strict";function n(e){for(var t=new Array(e.length),r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}r.d(t,"a",(function(){return n}))},320:function(e,t,r){"use strict";r.d(t,"a",(function(){return _}));var n=r(14),i=r(142),a=r(143),s=r(144),c=r(145),o=r(221),u=r(167),l=r(170),h=r(218),f=r(195),v=r(158),d=r(171),y=r(166),p=r(199),b=r(321),m=r(230),_=function(e){Object(s.a)(r,e);var t=Object(c.a)(r);function r(e,n,a,s,c,o,f,p,b,m,_,x,g,O,j,k,M,w){var S,L=arguments.length>18&&void 0!==arguments[18]&&arguments[18],T=arguments.length>19?arguments[19]:void 0,z=arguments.length>20?arguments[20]:void 0;Object(i.a)(this,r),(S=t.call(this))._xOffset=Object(u.c)(g),S._yOffset=Object(u.c)(O),S._decoration=m||"none",S._color=c,S._haloColor=o,S._haloSize=Math.min(Math.floor(5*Object(u.c)(Object(u.e)(a))),127),S._size=Math.min(Math.round(Object(u.c)(n)),127);var P=Math.min(Math.round(Object(u.c)(s||n)),127);S._referenceSize=Math.round(Math.sqrt(256*P)),S._scale=S._size/v.u,S._angle=x,S._justify=Object(h.d)(f||"center"),S._xAlignD=Object(h.e)(f||"center"),S._yAlignD=Object(h.g)(p||"baseline"),S._baseline="baseline"===(p||"baseline"),S._bitset=(b===l.a.MAP?1:0)|(_?1:0)<<1;var I=y.e.load(e);return I.sdf=!0,S._materialKey=I.data,S._lineWidth=Object(u.c)(j)||512,S._lineHeight=k||1,S._textPlacement=M,S._effects=w,S._isCIM=L,S._minMaxZoom=Object(d.a)(Math.round(T*v.z),Math.round(z*v.z)),S}return Object(a.a)(r,null,[{key:"fromText",value:function(e,t){var i=new r(e.materialKey,e.font.size,e.haloSize||0,e.font.size,e.color&&Object(f.d)(e.color)||0,e.haloColor&&Object(f.d)(e.haloColor)||0,e.horizontalAlignment,e.verticalAlignment,l.a.SCREEN,e.font.decoration,!1,e.angle||0,e.xoffset,e.yoffset,e.lineWidth,e.lineHeight,null,null,!1,p.b,p.a),a=Object(o.a)(e.text),s=Object(n.a)(a,2)[1];return i.bindTextInfo(t,s),i._vertexBoundsScale=e.maxVVSize?e.maxVVSize/e.font.size:1,i}},{key:"fromCIMText",value:function(e,t,i){var a=e.scaleFactor||1,s=e.size*e.sizeRatio*a,c=Object(p.e)(e.scaleInfo,i),u=Object(n.a)(c,2),l=u[0],h=u[1],v=new r(e.materialKey,s,e.outlineSize*e.sizeRatio,e.referenceSize,Object(f.c)(e.color),Object(f.c)(e.outlineColor),e.horizontalAlignment,e.verticalAlignment,e.alignment,e.decoration,e.colorLocked,e.angle,e.offsetX*e.sizeRatio*a,e.offsetY*e.sizeRatio*a,512,1,e.markerPlacement,e.effects,!0,l,h),d=Object(o.a)(e.text),y=Object(n.a)(d,2)[1];return v.bindTextInfo(t,y),v._vertexBoundsScale=e.maxVVSize?e.maxVVSize/s:1,v}}]),r}(Object(b.a)(m.a))},321:function(e,t,r){"use strict";r.d(t,"a",(function(){return m}));var n=r(60),i=r(14),a=r(142),s=r(143),c=r(144),o=r(145),u=r(146),l=r(167),h=r(189),f=r(322),v=r(158),d=r(157),y=r(171),p=r(166),b=r(233),m=function(e){return function(e){Object(c.a)(r,e);var t=Object(o.a)(r);function r(){var e;Object(a.a)(this,r);for(var n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];return(e=t.call.apply(t,[this].concat(i)))._isCIM=!1,e._vertexBoundsScale=1,e.geometryType=d.d.TEXT,e._aux=Object(y.b)(0,0,e._referenceSize,e._bitset),e}return Object(s.a)(r,[{key:"bindTextInfo",value:function(e,t){var r=this;e&&e.length?this._shapingInfo=Object(u.b)(e,(function(e){return Object(b.a)(e,t,{scale:r._scale,angle:r._angle,xOffset:r._xOffset,yOffset:r._yOffset,hAlign:r._xAlignD,vAlign:r._yAlignD,maxLineWidth:Math.max(32,Math.min(r._lineWidth,512)),lineHeight:v.x*Math.max(.25,Math.min(r._lineHeight,4)),decoration:r._decoration,isCIM:r._isCIM})})):this._shapingInfo=null}},{key:"_write",value:function(e,t,r,n){var i=t.getDisplayId();this._writeGeometry(e,t,i,r,n)}},{key:"_writeGeometry",value:function(e,t,r,n,a){var s=this,c=this._shapingInfo;if(!Object(u.j)(c)){if(Object(u.k)(this._textPlacement)){var o=null!==a&&void 0!==a?a:t.readLegacyGeometryForDisplay();return this._writePlacedText(e,r,o,c,n)}var l=a?Object(h.p)(Object(h.d)(a),2):"esriGeometryPolygon"===t.geometryType?t.readCentroid():t.readGeometryForDisplay();if(!Object(u.j)(l)){if(l.isPoint){var f=Object(i.a)(l.coords,2),v=f[0],d=f[1];if(!e.hasAggregates&&e.hasPixelBufferEnabled&&(v<0||v>=512||d<0||d>=512))return;return this._writeGlyphs(e,r,{x:v,y:d},c)}l.forEachVertex((function(t,n){return s._writeGlyphs(e,r,{x:t,y:n},c)}))}}}},{key:"_writePlacedText",value:function(e,t,r,n,i){var a=Object(u.q)(this._textPlacement),s=f.a.getPlacement(r,a,Object(l.c)(1),i.geometryEngine);if(s)for(var c=s.next();null!=c;){var o=-c.getAngle();n.setRotation(o);var h=c.tx,v=-c.ty;h<0||h>=512||v<0||v>=512||(this._writeGlyphs(e,t,{x:h,y:v},n),n.setRotation(-o)),c=s.next()}}},{key:"_writeGlyphs",value:function(e,t,r,i){var a,s=p.e.load(this._materialKey),c=Object(y.a)(Math.round(8*r.x),Math.round(8*r.y)),o=this._vertexBoundsScale,u=i.bounds,l=2*Math.max(u.width,u.height),h=Object(n.a)(i.glyphs);try{for(h.s();!(a=h.n()).done;){var f=a.value;s.textureBinding=f.textureBinding,e.recordStart(t,s.data,this.geometryType,!0),e.vertexBounds(r.x+u.x+this._xOffset,r.y+u.y-this._yOffset,l*o,l*o),this._writeVertices(e,t,c,f),e.recordEnd()}}catch(v){h.e(v)}finally{h.f()}}},{key:"_writeGlyph",value:function(e,t,r,n,i){var a=p.e.load(this._materialKey),s=Object(y.a)(Math.round(8*r),Math.round(8*n));a.textureBinding=i.textureBinding,e.recordStart(t,a.data,this.geometryType,!0);var c=i.bounds,o=this._vertexBoundsScale;e.vertexBounds(r+c.x*o,n+c.y*o,c.width*o,c.height*o),this._writeVertices(e,t,s,i),e.recordEnd()}},{key:"_writeVertices",value:function(e,t,r,n){var i=e.vertexCount();this._writeVertexCommon(e,t,r,n),e.vertexWrite(n.offsets.upperLeft),e.vertexWrite(n.texcoords.upperLeft),e.vertexEnd(),this._writeVertexCommon(e,t,r,n),e.vertexWrite(n.offsets.upperRight),e.vertexWrite(n.texcoords.upperRight),e.vertexEnd(),this._writeVertexCommon(e,t,r,n),e.vertexWrite(n.offsets.lowerLeft),e.vertexWrite(n.texcoords.lowerLeft),e.vertexEnd(),this._writeVertexCommon(e,t,r,n),e.vertexWrite(n.offsets.lowerRight),e.vertexWrite(n.texcoords.lowerRight),e.vertexEnd(),e.indexWrite(i+0),e.indexWrite(i+1),e.indexWrite(i+2),e.indexWrite(i+1),e.indexWrite(i+3),e.indexWrite(i+2)}},{key:"_writeVertexCommon",value:function(e,t,r,n){var i=this._color,a=this._haloColor,s=Object(y.b)(0,0,this._referenceSize,this._bitset),c=Object(y.b)(0,0,this._size,this._haloSize);e.vertexWrite(r),e.vertexWrite(t),e.vertexWrite(i),e.vertexWrite(a),e.vertexWrite(c),e.vertexWrite(s),e.vertexWrite(this._minMaxZoom)}}]),r}(e)}},322:function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));var n=r(142),i=r(143),a=r(173),s=r(263),c=function(){function e(){Object(n.a)(this,e)}return Object(i.a)(e,null,[{key:"getPlacement",value:function(e,t,r,n){var i=Object(s.b)(t);if(!i)return null;var c=Object(a.c)(e);return i.execute(c,t,r,n)}}]),e}()},324:function(e,t,r){"use strict";r.d(t,"a",(function(){return g}));var n=r(14),i=r(142),a=r(143),s=r(144),c=r(145),o=r(146),u=r(167),l=r(255),h=r(184),f=r(170),v=r(195),d=r(158),y=r(157),p=r(171),b=r(166),m=r(199),_=r(325),x=r(230),g=function(e){Object(s.a)(r,e);var t=Object(c.a)(r);function r(e,n,a,s,c,o,u,v,m,_,x,g,O,j,k,M,w,S,L,T,z,P,I){var E;Object(i.a)(this,r),(E=t.call(this)).angle=s,E.height=u,E.width=o,E.xOffset=n*L,E.yOffset=a*L,E._markerPlacement=T,E._effects=z,E._anchorX=.5-(.5+M)*k.width/k.width,E._anchorY=.5-(.5+w)*k.height/k.height,E._minMaxZoom=Object(p.a)(Math.round(P*d.z),Math.round(I*d.z));var C=(j===f.a.MAP?d.k:d.l)|(x?d.i:0)|(O?d.m:0)|(g?d.n:0),V=k&&k.sdf,A=b.d.load(e);A.sdf=V,A.pattern=!0,A.textureBinding=k.textureBinding,E._materialKey=A.data,E._fillColor=c,E._outlineColor=m,E._sizeOutlineWidth=Object(p.b)(Math.round(Math.min(Math.sqrt(128*o),255)),Math.round(Math.min(Math.sqrt(128*u),255)),Math.round(Math.min(Math.sqrt(128*_),255)),Math.round(Math.min(Math.sqrt(128*v),255)));var R=k.rect.x+d.E,W=k.rect.y+d.E,F=R+k.width,B=W+k.height;E._offsets.xUpperLeft=R,E._offsets.yUpperLeft=W,E._offsets.xUpperRight=F,E._offsets.yUpperRight=W,E._offsets.xBottomLeft=R,E._offsets.yBottomLeft=B,E._offsets.xBottomRight=F,E._offsets.yBottomRight=B,A.symbologyType===y.e.PIE_CHART?(E._texUpperLeft=Object(p.a)(0,1),E._texUpperRight=Object(p.a)(1,1),E._texBottomLeft=Object(p.a)(0,0),E._texBottomRight=Object(p.a)(1,0)):(E._texUpperLeft=Object(p.a)(R,W),E._texUpperRight=Object(p.a)(F,W),E._texBottomLeft=Object(p.a)(R,B),E._texBottomRight=Object(p.a)(F,B)),o*=S,u*=S,o*=L,u*=L;var D=Math.round(64*S);E._bitestAndDistRatio=Object(p.a)(C,D),E._computedWidth=o,E._computedHeight=u;var K=Object(h.a)(),G=Object(l.a)();return E._applyTransformation(G,K),E}return Object(a.a)(r,null,[{key:"fromCIMMarker",value:function(e,t,i){var a=t&&t.width||1,s=t&&t.height||1,c=e.size,l=a/s*e.scaleX,h=e.scaleSymbolsProportionally&&e.frameHeight?c/e.frameHeight:1,d=Object(v.c)(e.color),y=Object(v.c)(e.outlineColor),p=Object(u.c)(c),b=p*l,_=Object(u.c)(e.offsetX||0),x=Object(u.c)(e.offsetY||0),g=Object(u.c)(e.outlineWidth||0)*h,O=e.alignment||f.a.SCREEN,j=Object(u.c)(e.referenceSize),k=Object(m.e)(e.scaleInfo,i),M=Object(n.a)(k,2),w=M[0],S=M[1];t.sdf||0!==d||(d=-1);var L=e.rotation||0;e.rotateClockwise||(L=-L);var T=0,z=0,P=e.anchorPoint;P&&(e.isAbsoluteAnchorPoint?c&&(T=-P.x/(c*l),z=P.y/c):(T=P.x,z=P.y));var I=new r(e.materialKey,_,x,L,d,b,p,j,y,g,e.colorLocked,e.scaleSymbolsProportionally,!1,O,t,T,z,e.sizeRatio,Object(o.r)(e.scaleFactor,1),e.markerPlacement,e.effects,w,S);return I._vertexBoundsScaleX=e.maxVVSize?e.maxVVSize/b:1,I._vertexBoundsScaleY=e.maxVVSize?e.maxVVSize/p:1,I}},{key:"fromPictureMarker",value:function(e,t){var n=Math.round(Object(u.c)(e.width)),i=Math.round(Object(u.c)(e.height)),a=d.C,s=Math.round(Object(u.c)(e.xoffset||0)),c=Math.round(Object(u.c)(e.yoffset||0)),o=new r(e.materialKey,s,c,e.angle,a,n,i,i,0,0,!1,!1,!1,f.a.SCREEN,t,0,0,1,1,null,null,m.b,m.a);return o._vertexBoundsScaleX=e.maxVVSize?e.maxVVSize/e.width:1,o._vertexBoundsScaleY=e.maxVVSize?e.maxVVSize/e.height:1,o}},{key:"fromSimpleMarker",value:function(e,t){var n=Object(v.d)(e.color),i=Math.round(Object(u.c)(e.size)),a=i,s=Math.round(Object(u.c)(e.xoffset||0)),c=Math.round(Object(u.c)(e.yoffset||0)),o=e.style,l=e.outline,h=0|(l&&l.color&&Object(v.d)(l.color)),d=0|(l&&l.width&&Math.round(Object(u.c)(l.width))),y=new r(e.materialKey,s,c,e.angle,n,i,a,a,h,d,!1,!1,"esriSMSCross"===o||"esriSMSX"===o,f.a.SCREEN,t,0,0,126/64,1,null,null,m.b,m.a);return y.boundsType="esriSMSCircle"===o?"circle":"square",y._vertexBoundsScaleX=e.maxVVSize?e.maxVVSize/e.size:1,y._vertexBoundsScaleY=e.maxVVSize?e.maxVVSize/e.size:1,y}},{key:"fromLineSymbolMarker",value:function(e,t){var n,i=Object(v.d)(e.color),a=Math.round(Object(u.c)(6*e.lineWidth)),s=a,c="cross"===e.style||"x"===e.style;switch(e.placement){case"begin-end":n=f.f.Both;break;case"begin":n=f.f.JustBegin;break;case"end":n=f.f.JustEnd;break;default:n=f.f.None}var o={type:"CIMMarkerPlacementAtExtremities",angleToLine:!0,offset:0,extremityPlacement:n,offsetAlongLine:0},l=new r(e.materialKey,0,0,0,i,a,s,s/6,i,c?Math.round(Object(u.c)(e.lineWidth)):0,!1,!1,c,f.a.MAP,t,0,0,126/64,1,o,null,m.b,m.a);return l.boundsType="circle"===e.style?"circle":"square",l}}]),r}(Object(_.a)(x.a))},325:function(e,t,r){"use strict";r.d(t,"a",(function(){return g}));var n=r(14),i=r(142),a=r(143),s=r(144),c=r(145),o=r(146),u=r(167),l=r(290),h=r(255),f=r(223),v=r(184),d=r(189),y=r(322),p=r(158),b=r(157),m=r(171),_=r(166),x=3.14159265359/180,g=function(e){return function(e){Object(s.a)(r,e);var t=Object(c.a)(r);function r(){var e;Object(i.a)(this,r);for(var n=arguments.length,a=new Array(n),s=0;s<n;s++)a[s]=arguments[s];return(e=t.call.apply(t,[this].concat(a))).angle=0,e.xOffset=0,e.yOffset=0,e.width=0,e.height=0,e.boundsType="square",e._anchorX=0,e._anchorY=0,e._computedWidth=0,e._computedHeight=0,e._vertexBoundsScaleX=1,e._vertexBoundsScaleY=1,e._offsets={xUpperLeft:0,yUpperLeft:0,xUpperRight:0,yUpperRight:0,xBottomLeft:0,yBottomLeft:0,xBottomRight:0,yBottomRight:0},e.geometryType=b.d.MARKER,e}return Object(a.a)(r,[{key:"_write",value:function(e,t,r,n){var i=t.getDisplayId();e.recordStart(i,this._materialKey,this.geometryType,!0),this._writeGeometry(e,t,i,r,n),e.recordEnd()}},{key:"_writeGeometry",value:function(e,t,r,i,a){var s=this;if(Object(o.k)(this._markerPlacement))return this._writePlacedMarkers(e,t,i,a);if(!a&&"esriGeometryPoint"===t.geometryType){var c=t.getX(),u=t.getY();if(!e.hasAggregates&&e.hasPixelBufferEnabled&&(c<0||c>=513||u<0||u>=513))return;return this._writeVertices(e,r,this._getPos(c,u),c,u)}var l=a?Object(d.p)(Object(d.d)(a),2):"esriGeometryPolygon"===t.geometryType?t.readCentroid():t.readGeometryForDisplay();if(!Object(o.j)(l)){if(l.isPoint){var h=Object(n.a)(l.coords,2),f=h[0],v=h[1];if(!e.hasAggregates&&e.hasPixelBufferEnabled&&(f<0||f>=512||v<0||v>=512))return;return this._writeVertices(e,r,this._getPos(f,v),f,v)}l.forEachVertex((function(t,n){var i=2*p.V;t<-i||t>=i||n<-i||n>=i||s._writeVertices(e,r,s._getPos(t,n),t,n)}))}}},{key:"_writePlacedMarkers",value:function(e,t,r,n){var i=null!==n&&void 0!==n?n:t.readLegacyGeometryForDisplay(),a=y.a.getPlacement(i,Object(o.q)(this._markerPlacement),Object(u.c)(1),r.geometryEngine);if(a)for(var s=t.getDisplayId(),c=Object(v.a)(),l=Object(h.a)(),f=a.next();null!=f;){var d=f.tx,p=-f.ty;d>=-128&&d<=640&&p>=-128&&p<=640&&(this._applyTransformation(l,c,-f.getAngle()/x),this._writeVertices(e,s,this._getPos(d,p),d,p)),f=a.next()}}},{key:"_writeVertices",value:function(e,t,r,n,i){var a=_.d.load(this._materialKey);return a.symbologyType===b.e.HEATMAP?this._writeHeatmapVertices(e,t,r,n,i):this._writeMarkerVertices(e,t,a,r,n,i)}},{key:"_writeMarkerVertices",value:function(e,t,r,n,i,a){var s=r.vvRotation,c=e.vertexCount(),o=this._computedWidth*this._vertexBoundsScaleX,u=this._computedHeight*this._vertexBoundsScaleY;if(this.angle){var l=Math.max(o,u);o=l,u=l}if(s){var h=Math.max(this.xOffset,this.yOffset);o+=h,u+=h}e.vertexBounds(i+this.xOffset,a-this.yOffset,o,u),e.vertexWrite(n),e.vertexWrite(this._offsetUpperLeft),e.vertexWrite(this._texUpperLeft),e.vertexWrite(this._bitestAndDistRatio),e.vertexWrite(t),e.vertexWrite(this._fillColor),e.vertexWrite(this._outlineColor),e.vertexWrite(this._sizeOutlineWidth),e.vertexWrite(this._minMaxZoom),e.vertexEnd(),e.vertexWrite(n),e.vertexWrite(this._offsetUpperRight),e.vertexWrite(this._texUpperRight),e.vertexWrite(this._bitestAndDistRatio),e.vertexWrite(t),e.vertexWrite(this._fillColor),e.vertexWrite(this._outlineColor),e.vertexWrite(this._sizeOutlineWidth),e.vertexWrite(this._minMaxZoom),e.vertexEnd(),e.vertexWrite(n),e.vertexWrite(this._offsetBottomLeft),e.vertexWrite(this._texBottomLeft),e.vertexWrite(this._bitestAndDistRatio),e.vertexWrite(t),e.vertexWrite(this._fillColor),e.vertexWrite(this._outlineColor),e.vertexWrite(this._sizeOutlineWidth),e.vertexWrite(this._minMaxZoom),e.vertexEnd(),e.vertexWrite(n),e.vertexWrite(this._offsetBottomRight),e.vertexWrite(this._texBottomRight),e.vertexWrite(this._bitestAndDistRatio),e.vertexWrite(t),e.vertexWrite(this._fillColor),e.vertexWrite(this._outlineColor),e.vertexWrite(this._sizeOutlineWidth),e.vertexWrite(this._minMaxZoom),e.vertexEnd(),this._writeIndices(e,c)}},{key:"_writeHeatmapVertices",value:function(e,t,r,n,i){var a=e.vertexCount();e.vertexBounds(n+this.xOffset,i-this.yOffset,this.width,this.height),e.vertexWrite(r),e.vertexWrite(this._offsetUpperLeft),e.vertexWrite(t),e.vertexEnd(),e.vertexWrite(r),e.vertexWrite(this._offsetUpperRight),e.vertexWrite(t),e.vertexEnd(),e.vertexWrite(r),e.vertexWrite(this._offsetBottomLeft),e.vertexWrite(t),e.vertexEnd(),e.vertexWrite(r),e.vertexWrite(this._offsetBottomRight),e.vertexWrite(t),e.vertexEnd(),this._writeIndices(e,a)}},{key:"_writeIndices",value:function(e,t){e.indexWrite(t+0),e.indexWrite(t+1),e.indexWrite(t+2),e.indexWrite(t+1),e.indexWrite(t+3),e.indexWrite(t+2)}},{key:"_applyTransformation",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Object(l.a)(e,Object(v.b)(this.xOffset,-this.yOffset)),this.angle+r!==0&&Object(l.g)(e,e,x*(this.angle+r));var n=this._computedWidth,i=this._computedHeight,a=(this._anchorX-.5)*n,s=(this._anchorY-.5)*i;Object(f.a)(t,a,s),Object(f.n)(t,t,e),this._offsetUpperLeft=Object(m.a)(16*t[0],16*t[1]),this._offsets.xUpperLeft=t[0],this._offsets.yUpperLeft=t[1],Object(f.a)(t,a+n,s),Object(f.n)(t,t,e),this._offsetUpperRight=Object(m.a)(16*t[0],16*t[1]),this._offsets.xUpperRight=t[0],this._offsets.yUpperRight=t[1],Object(f.a)(t,a,s+i),Object(f.n)(t,t,e),this._offsetBottomLeft=Object(m.a)(16*t[0],16*t[1]),this._offsets.xBottomLeft=t[0],this._offsets.yBottomLeft=t[1],Object(f.a)(t,a+n,s+i),Object(f.n)(t,t,e),this._offsetBottomRight=Object(m.a)(16*t[0],16*t[1]),this._offsets.xBottomRight=t[0],this._offsets.yBottomRight=t[1]}},{key:"_getPos",value:function(e,t){return Object(m.a)(Math.round(8*e),Math.round(8*t))}}]),r}(e)}},328:function(e,t,r){"use strict";r.d(t,"a",(function(){return rt})),r.d(t,"b",(function(){return tt}));var n=r(155),i=r(60),a=r(142),s=r(143),c=r(5),o=r(154),u=r.n(o),l=r(159),h=r(156),f=r(162),v=r(365),d=r(157),y=r(166),p=r(14),b=r(418),m=r(144),_=r(145),x=r(146),g=r(167),O=r(195),j=r(158),k=r(219),M=r(171),w=r(199),S=r(189),L=r(165),T=(r(242),r(300)),z=r(216),P=r(280),I=r(379);function E(e,t,r,n,i,a,s){ne=0;var c,o,u,l,h,f=(n-r)*a,v=i&&i.length,d=v?(i[0]-r)*a:f,y=C(t,r,n,0,d,a,!0);if(y&&y.next!==y.prev){if(v&&(y=function(e,t,r,n,i,a){for(var s=new Array,c=0,o=n.length;c<o;c++){var u=C(e,t,r,n[c]*a,c<o-1?n[c+1]*a:r*a,a,!1);u===u.next&&(u.steiner=!0),s.push(D(u))}s.sort(Y);for(var l=0,h=s;l<h.length;l++){K(h[l],i),i=V(i,i.next)}return i}(t,r,n,i,y,a)),f>80*a){c=u=t[0+r*a],o=l=t[1+r*a];for(var p=a;p<d;p+=a){var b=t[p+r*a],m=t[p+1+r*a];c=Math.min(c,b),o=Math.min(o,m),u=Math.max(u,b),l=Math.max(l,m)}h=0!==(h=Math.max(u-c,l-o))?1/h:0}A(y,e,a,c,o,h,s,0)}}function C(e,t,r,n,i,a,s){var c;if(s===function(e,t,r,n,i,a){for(var s=0,c=n,o=i-a;c<i;c+=a)s+=(e[o+t*a]-e[c+t*a])*(e[c+1+t*a]+e[o+1+t*a]),o=c;return s}(e,t,0,n,i,a)>0)for(var o=n;o<i;o+=a)c=F(o+t*a,e[o+t*a],e[o+1+t*a],c);else for(var u=i-a;u>=n;u-=a)c=F(u+t*a,e[u+t*a],e[u+1+t*a],c);return c&&H(c,c.next)&&(B(c),c=c.next),c}function V(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;if(!e)return e;var r,n=e;do{if(r=!1,n.steiner||!H(n,n.next)&&0!==Z(n.prev,n,n.next))n=n.next;else{if(B(n),(n=t=n.prev)===n.next)break;r=!0}}while(r||n!==t);return t}function A(e,t,r,n,i,a,s,c){if(e){!c&&a&&(e=G(e,n,i,a));for(var o=e;e.prev!==e.next;){var u=e.prev,l=e.next;if(a?W(e,n,i,a):R(e))t.push(u.index/r+s),t.push(e.index/r+s),t.push(l.index/r+s),B(e),e=l.next,o=l.next;else if((e=l)===o){c?1===c?A(e=Q(e,t,r,s),t,r,n,i,a,s,2):2===c&&J(e,t,r,n,i,a,s):A(V(e),t,r,n,i,a,s,1);break}}}}function R(e){var t=e.prev,r=e,n=e.next;if(Z(t,r,n)>=0)return!1;for(var i=e.next.next,a=i,s=0;i!==e.prev&&(0===s||i!==a);){if(s++,N(t.x,t.y,r.x,r.y,n.x,n.y,i.x,i.y)&&Z(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function W(e,t,r,n){var i=e.prev,a=e,s=e.next;if(Z(i,a,s)>=0)return!1;for(var c=i.x<a.x?i.x<s.x?i.x:s.x:a.x<s.x?a.x:s.x,o=i.y<a.y?i.y<s.y?i.y:s.y:a.y<s.y?a.y:s.y,u=i.x>a.x?i.x>s.x?i.x:s.x:a.x>s.x?a.x:s.x,l=i.y>a.y?i.y>s.y?i.y:s.y:a.y>s.y?a.y:s.y,h=q(c,o,t,r,n),f=q(u,l,t,r,n),v=e.prevZ,d=e.nextZ;v&&v.z>=h&&d&&d.z<=f;){if(v!==e.prev&&v!==e.next&&N(i.x,i.y,a.x,a.y,s.x,s.y,v.x,v.y)&&Z(v.prev,v,v.next)>=0)return!1;if(v=v.prevZ,d!==e.prev&&d!==e.next&&N(i.x,i.y,a.x,a.y,s.x,s.y,d.x,d.y)&&Z(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(;v&&v.z>=h;){if(v!==e.prev&&v!==e.next&&N(i.x,i.y,a.x,a.y,s.x,s.y,v.x,v.y)&&Z(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;d&&d.z<=f;){if(d!==e.prev&&d!==e.next&&N(i.x,i.y,a.x,a.y,s.x,s.y,d.x,d.y)&&Z(d.prev,d,d.next)>=0)return!1;d=d.nextZ}return!0}function F(e,t,r,n){var i=te.create(e,t,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function B(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function D(e){var t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function K(e,t){if(t=function(e,t){var r,n=t,i=e.x,a=e.y,s=-1/0;do{if(a<=n.y&&a>=n.next.y&&n.next.y!==n.y){var c=n.x+(a-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(c<=i&&c>s){if(s=c,c===i){if(a===n.y)return n;if(a===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!r)return null;if(i===s)return r.prev;var o,u=r,l=r.x,h=r.y,f=1/0;for(n=r.next;n!==u;)i>=n.x&&n.x>=l&&i!==n.x&&N(a<h?i:s,a,l,h,a<h?s:i,a,n.x,n.y)&&(((o=Math.abs(a-n.y)/(i-n.x))<f||o===f&&n.x>r.x)&&X(n,e)&&(r=n,f=o)),n=n.next;return r}(e,t)){var r=ee(t,e);V(r,r.next)}}function G(e,t,r,n){for(var i;i!==e;i=i.next){if(null===(i=i||e).z&&(i.z=q(i.x,i.y,t,r,n)),i.prev.next!==i||i.next.prev!==i)return i.prev.next=i,i.next.prev=i,G(e,t,r,n);i.prevZ=i.prev,i.nextZ=i.next}return e.prevZ.nextZ=null,e.prevZ=null,function(e){for(var t,r=1;;){var n=void 0,i=e;e=null,t=null;for(var a=0;i;){a++,n=i;for(var s=0;s<r&&n;s++)n=n.nextZ;for(var c=r;s>0||c>0&&n;){var o=void 0;0===s?(o=n,n=n.nextZ,c--):0!==c&&n?i.z<=n.z?(o=i,i=i.nextZ,s--):(o=n,n=n.nextZ,c--):(o=i,i=i.nextZ,s--),t?t.nextZ=o:e=o,o.prevZ=t,t=o}i=n}if(t.nextZ=null,r*=2,a<2)return e}}(e)}function Z(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function U(e,t,r,n){return!!(H(e,t)&&H(r,n)||H(e,n)&&H(r,t))||Z(e,t,r)>0!=Z(e,t,n)>0&&Z(r,n,e)>0!=Z(r,n,t)>0}function N(e,t,r,n,i,a,s,c){return(i-s)*(t-c)-(e-s)*(a-c)>=0&&(e-s)*(n-c)-(r-s)*(t-c)>=0&&(r-s)*(a-c)-(i-s)*(n-c)>=0}function X(e,t){return Z(e.prev,e,e.next)<0?Z(e,t,e.next)>=0&&Z(e,e.prev,t)>=0:Z(e,t,e.prev)<0||Z(e,e.next,t)<0}function q(e,t,r,n,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function H(e,t){return e.x===t.x&&e.y===t.y}function Y(e,t){return e.x-t.x}function Q(e,t,r,n){var i=e;do{var a=i.prev,s=i.next.next;!H(a,s)&&U(a,i,i.next,s)&&X(a,s)&&X(s,a)&&(t.push(a.index/r+n),t.push(i.index/r+n),t.push(s.index/r+n),B(i),B(i.next),i=e=s),i=i.next}while(i!==e);return i}function J(e,t,r,n,i,a,s){var c=e;do{for(var o=c.next.next;o!==c.prev;){if(c.index!==o.index&&$(c,o)){var u=ee(c,o);return c=V(c,c.next),u=V(u,u.next),A(c,t,r,n,i,a,s,0),void A(u,t,r,n,i,a,s,0)}o=o.next}c=c.next}while(c!==e)}function $(e,t){return e.next.index!==t.index&&e.prev.index!==t.index&&!function(e,t){var r=e;do{if(r.index!==e.index&&r.next.index!==e.index&&r.index!==t.index&&r.next.index!==t.index&&U(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&X(e,t)&&X(t,e)&&function(e,t){var r=e,n=!1,i=(e.x+t.x)/2,a=(e.y+t.y)/2;do{r.y>a!=r.next.y>a&&r.next.y!==r.y&&i<(r.next.x-r.x)*(a-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==e);return n}(e,t)}function ee(e,t){var r=te.create(e.index,e.x,e.y),n=te.create(t.index,t.x,t.y),i=e.next,a=t.prev;return e.next=t,t.prev=e,r.next=i,i.prev=r,n.next=r,r.prev=n,a.next=n,n.prev=a,n}for(var te=function(){function e(){Object(a.a)(this,e),this.index=0,this.x=0,this.y=0,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}return Object(s.a)(e,null,[{key:"create",value:function(t,r,n){var i=ne<re.length?re[ne++]:new e;return i.index=t,i.x=r,i.y=n,i.prev=null,i.next=null,i.z=null,i.prevZ=null,i.nextZ=null,i.steiner=!1,i}}]),e}(),re=new Array,ne=0,ie=0;ie<8096;ie++)re.push(new te);var ae=new I.b(0,0,0,1,0),se=new I.b(0,0,0,1,0);function ce(e,t,r){for(var n=0,i=1;i<r;i++){var a=e[2*(t+i-1)],s=e[2*(t+i-1)+1];n+=(e[2*(t+i)]-a)*(e[2*(t+i)+1]+s)}return n}function oe(e,t,r,n,i){for(var a=0,s=r;s<n;s+=3){var c=2*(e[s]-i),o=2*(e[s+1]-i),u=2*(e[s+2]-i);a+=Math.abs((t[c]-t[u])*(t[o+1]-t[c+1])-(t[c]-t[o])*(t[u+1]-t[c+1]))}return a}ae.setExtent(j.V),se.setExtent(j.V);var ue=r(170),le=r(378),he=16,fe=function(e){return function(e){Object(m.a)(r,e);var t=Object(_.a)(r);function r(){var e;Object(a.a)(this,r);for(var n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];return(e=t.call.apply(t,[this].concat(i))).tessellationProperties={},e._tessellationOptions={halfWidth:0,pixelCoordRatio:1,offset:0},e.geometryType=d.d.LINE,e}return Object(s.a)(r,[{key:"writeGeometry",value:function(e,t,r,n){this._writeGeometry(e,t,r,n)}},{key:"_initializeTessellator",value:function(e){var t=y.c.load(this._materialKey),r=y.a.load(this._materialKey),n=this._tessellationOptions,i=t.vvSizeFieldStops||t.vvSizeMinMaxValue||t.vvSizeScaleStops||t.vvSizeUnitValue,a=this.tessellationProperties._halfWidth<j.U&&!e&&!i;this.tessellationProperties.minMaxZoom=this._minMaxZoom,n.wrapDistance=65535,n.textured=this._isDashed||this._hasPattern,n.offset=this.tessellationProperties.offset,n.halfWidth=this.tessellationProperties._halfWidth;var s=a?0:1,c=Object(y.h)(r)?de:ve;this._lineTessellator=new le.a(c(this.tessellationProperties,s,s),ye(this.tessellationProperties),a)}},{key:"_write",value:function(e,t,r,n){var i="esriGeometryPoint"===t.geometryType;e.recordStart(t.getDisplayId(),this._materialKey,this.geometryType,i),this._writeGeometry(e,t,n,i),e.recordEnd()}},{key:"_writeGeometry",value:function(e,t,r,n){var i=null!==r&&void 0!==r?r:t.readLegacyGeometryForDisplay(),a=this._getLines(i,n);Object(x.j)(a)||this._writeVertices(e,t,a)}},{key:"_getLines",value:function(e,t){if(Object(x.j)(e))return null;var r=e.paths||e.rings;return Object(x.j)(r)?null:function(e,t){se.setPixelMargin(t);for(var r=se,n=-t,a=j.V+t,s=[],c=!1,o=0;o<e.length;){var u=[],l=e[o];if(!l)return null;r.reset(P.a.LineString);var h=Object(p.a)(l[0],2),f=h[0],v=h[1];if(c)r.moveTo(f,v);else{if(f<n||f>a||v<n||v>a){c=!0;continue}u.push({x:f,y:v})}for(var d=!1,y=l.length,b=1;b<y;++b)if(f+=l[b][0],v+=l[b][1],c)r.lineTo(f,v);else{if(f<n||f>a||v<n||v>a){d=!0;break}u.push({x:f,y:v})}if(d)c=!0;else{if(c){var m=r.resultWithStarts();if(m){var _,x=Object(i.a)(m);try{for(x.s();!(_=x.n()).done;){var g=_.value;s.push(g)}}catch(O){x.e(O)}finally{x.f()}}}else s.push({line:u,start:0});o++,c=!1}}return s=s.filter((function(e){return e.line.length>1})),0===s.length?null:s}(r,t?256:16)}},{key:"_writeVertices",value:function(e,t,r){var n=t.getDisplayId(),a=e.vertexCount(),s=this.tessellationProperties,c=this._tessellationOptions;s.out=e,s.id=n,s.indexCount=0,s.vertexCount=0,s.offset=a,c.capType=this._capType,c.joinType=this._joinType;var o=y.a.load(this._materialKey);this.tessellationProperties.key=Object(y.h)(o)?o:y.c.load(this._materialKey);var u,l=Object(i.a)(r);try{for(l.s();!(u=l.n()).done;){var h=u.value,f=h.line,v=h.start;c.initialDistance=v%65535,this._lineTessellator.tessellate(f,c)}}catch(d){l.e(d)}finally{l.f()}}}]),r}(e)},ve=function(e,t,r){return function(n,i,a,s,c,o,u,l,h,f,v){var d=Object(M.a)(v,Math.ceil(he*e._halfWidth)),y=Object(M.b)(Math.round(he*u),Math.round(he*l),Math.round(he*h),Math.round(he*f)),p=Object(M.b)(he*c,he*o,0,e._bitset),b=e.out;return b.vertexBounds(n,i,t,r),b.vertexWrite(Object(M.a)(8*n,8*i)),b.vertexWrite(e.id),b.vertexWrite(e._fillColor),b.vertexWrite(y),b.vertexWrite(d),b.vertexWrite(e._tl),b.vertexWrite(e._br),b.vertexWrite(p),b.vertexWrite(Object(M.a)(Math.ceil(he*e._halfReferenceWidth),0)),b.vertexWrite(e.minMaxZoom),b.vertexEnd(),e.offset+e.vertexCount++}},de=function(e,t,r){return function(n,i,a,s,c,o,u,l,h,f,v){var d=Object(M.a)(he*e._halfWidth,he*e._halfReferenceWidth),p=Object(M.b)(he*u+128,he*l+128,he*h+128,he*f+128),b=e.out,m=e._bitset<<24|e.id;b.vertexBounds(n,i,t,r),b.vertexWrite(Object(M.a)(8*n,8*i)),b.vertexWrite(m),b.vertexWrite(e._fillColor);var _=Object(y.i)(e.key);return _||(b.vertexWrite(0),b.vertexWrite(0)),b.vertexWrite(0),b.vertexWrite(d),b.vertexWrite(p),_||b.vertexWrite(e.minMaxZoom),b.vertexEnd(),e.offset+e.vertexCount++}},ye=function(e){return function(t,r,n){var i=e.out;i.indexWrite(t),i.indexWrite(r),i.indexWrite(n),e.indexCount+=3}},pe=r(230),be=h.a.getLogger("esri.views.2d.engine.webgl.WGLLineTemplate"),me=function(e){Object(m.a)(r,e);var t=Object(_.a)(r);function r(e,n,i,s,c,o,u,l,h,f,v,d,p,b,m,_,x,g,O,k){var S;Object(a.a)(this,r),S=t.call(this);var L=y.c.load(e);n&&(L.sdf=n.sdf,L.pattern=!0,L.textureBinding=n.textureBinding),S._capType=s,S._joinType=c,S._miterLimitCosine=Object(w.d)(o),S.tessellationProperties._fillColor=u,S.tessellationProperties._tl=l,S.tessellationProperties._br=h,S._hasPattern=f,S._isDashed=v,S._zOrder=x,S._effects=g,S._minMaxZoom=Object(M.a)(Math.round(O*j.z),Math.round(k*j.z)),S._materialKey=L.data;var T=(p?j.i:0)|(b?j.o:0)|(d?j.j:0)|(m?j.h:0);return S.tessellationProperties._bitset=T,S.tessellationProperties._halfWidth=.5*i,S.tessellationProperties._halfReferenceWidth=.5*_,S.tessellationProperties.offset=0,S._initializeTessellator(!1),S}return Object(s.a)(r,null,[{key:"fromCIMLine",value:function(e,t,n){var i=e.color,a=e.scaleFactor||1,s=!!e.dashTemplate,c=e.cap;s&&c===ue.e.ROUND&&(c=ue.e.SQUARE);var o=e.join,u=Object(g.c)(e.width)*a,l=Object(g.c)(e.referenceWidth),h=Object(g.c)(e.miterLimit),f=i&&Object(O.c)(i)||0,v=Object(w.e)(e.scaleInfo,n),d=Object(p.a)(v,2),y=d[0],b=d[1];if(!t)return new r(e.materialKey,t,u,c,o,h,f,0,0,!1,s,e.scaleDash,e.colorLocked,!1,e.sampleAlphaOnly,l,e.zOrder,e.effects,y,b);var m=t.rect,_=t.width,x=t.height,k=m.x+j.E,S=m.y+j.E,L=k+_,T=S+x,z=Object(M.a)(k,S),P=Object(M.a)(L,T);return new r(e.materialKey,t,u,c,o,h,f,z,P,!0,s,e.scaleDash,e.colorLocked,!1,e.sampleAlphaOnly,l,e.zOrder,e.effects,y,b)}},{key:"fromFillOutline",value:function(e){var t,n=y.a.load(e.materialKey);return Object(y.h)(n)&&e.outline&&"esriSLSSolid"===(null===(t=e.outline)||void 0===t?void 0:t.style)?r.fromSimpleLine(Object(c.a)({hash:"",materialKey:e.materialKey},e.outline),null,!0):null}},{key:"fromSimpleLine",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=e.color,a="esriSLSSolid"!==e.style&&"esriSLSNull"!==e.style,s=Object(L.i)(e.cap||"round"),c=Object(L.j)(e.join||"round"),o=i&&"esriSLSNull"!==e.style&&Object(O.d)(i)||0;"esriSLSNull"===e.style&&(o=0);var u=Object(g.c)(e.width),l=e.miterLimit;if(!t)return new r(e.materialKey,t,u,s,c,l,o,0,0,!1,a,!0,!1,n,!1,u,0,null,w.b,w.a);var h=t.rect,f=t.width,v=t.height,d=h.x+j.E,y=h.y+j.E,p=d+f,b=y+v,m=Object(M.a)(d,y),_=Object(M.a)(p,b);return new r(e.materialKey,t,u,s,c,l,o,m,_,!0,a,!0,!1,n,!1,u,0,null,w.b,w.a)}},{key:"fromPictureLineSymbol",value:function(e,t,r,n){return be.error("PictureLineSymbol support does not exist!"),null}}]),r}(fe(pe.a)),_e=function(e){return function(e){Object(m.a)(r,e);var t=Object(_.a)(r);function r(){var e;Object(a.a)(this,r);for(var n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];return(e=t.call.apply(t,[this].concat(i))).forceLibtess=!1,e._bitset=0,e._lineTemplate=null,e.geometryType=d.d.FILL,e}return Object(s.a)(r,[{key:"_maybeAddLineTemplate",value:function(e){this._lineTemplate=me.fromFillOutline(e)}},{key:"_write",value:function(e,t,r,n){var i="esriGeometryPoint"===t.geometryType,a=y.a.load(this._materialKey);e.recordStart(t.getDisplayId(),this._materialKey,this.geometryType,i),this._writeGeometry(e,t,a,n,i),Object(y.h)(a)&&Object(x.k)(this._lineTemplate)&&this._lineTemplate.writeGeometry(e,t,n,i),e.recordEnd()}},{key:"_writeGeometry",value:function(e,t,r,n,i){var a=this._getGeometry(t,n,i);if(!Object(x.j)(a)){var s=[];if(a.maxLength>100||this.forceLibtess||!function(e,t){var r=t.coords,n=t.lengths,i=e;if(t.hasIndeterminateRingOrder)return!1;for(var a=0,s=0;s<n.length;){for(var c=s,o=n[s],u=ce(r,a,o),l=[];++c<n.length;){var h=n[c],f=ce(r,a+o,h);if(!(f>0))break;u+=f,l.push(a+o),o+=h}var v=i.length;E(i,r,a,a+o,l,2,0);var d=oe(i,r,v,i.length,0),y=Math.abs(u);if(Math.abs((d-y)/Math.max(1e-7,y))>1e-5)return i.length=0,!1;s=c,a+=o}return!0}(s,a)){var c=function(e){var t=e.coords,r=e.lengths;return Object(T.b)(t,r).buffer}(a);this._writeVertices(e,t,c,[c.length/2],r)}else s.length&&this._writeVertices(e,t,a.coords,a.lengths,r,s)}}},{key:"_writeVertex",value:function(e,t,r,n,i,a){var s=Object(M.a)(1*n,1*i);if(e.vertexBounds(n,i,0,0),e.vertexWrite(s),e.vertexWrite(t),r.symbologyType===d.e.DOT_DENSITY)e.vertexWriteF32(1/Math.abs(a.readGeometryArea()));else{e.vertexWrite(this.fillColor);var c=Object(y.i)(r);c||(e.vertexWrite(this.tl),e.vertexWrite(this.br)),e.vertexWrite(this.aux2_1),e.vertexWrite(this.aux2_2),e.vertexWrite(this.aux3),c||e.vertexWrite(this._minMaxZoom)}}},{key:"_writeVertices",value:function(e,t,r,n,a,s){var c=t.getDisplayId(),o=this._bitset<<24|c,u=n.reduce((function(e,t){return e+t})),l=Object(L.n)(a.geometryType,a.symbologyType).geometry/4,h=e.vertexCount();e.vertexEnsureSize(l*u);var f=0;if(s){var v,d=Object(i.a)(s);try{for(d.s();!(v=d.n()).done;){var y=v.value,p=r[2*y],b=r[2*y+1];this._writeVertex(e,o,a,p,b,t),f++}}catch(O){d.e(O)}finally{d.f()}}else for(var m=0;m<r.length;m+=2){var _=Math.round(r[m]),x=Math.round(r[m+1]);this._writeVertex(e,o,a,_,x,t),f++}e.indexEnsureSize(f);for(var g=0;g<f;g++)e.indexWrite(g+h)}},{key:"_getGeometry",value:function(e,t,r){var n=t?Object(S.p)(Object(S.d)(t),2):e.readGeometryForDisplay();return n?function(e,t){if(Object(x.j)(e))return null;if(!function(e,t,r){for(var n=0,i=0;i<e.lengths.length;i++){for(var a=e.lengths[i],s=0;s<a;s++){var c=e.coords[2*(s+n)],o=e.coords[2*(s+n)+1];if(c<t||c>r||o<t||o>r)return!0}n+=a}return!1}(e,-128,j.V+128))return e;ae.setPixelMargin(t),ae.reset(P.a.Polygon);for(var r=0,n=0;n<e.lengths.length;n++){var a=e.lengths[n],s=e.coords[2*(0+r)],c=e.coords[2*(0+r)+1];ae.moveTo(s,c);for(var o=1;o<a;o++)s=e.coords[2*(o+r)],c=e.coords[2*(o+r)+1],ae.lineTo(s,c);ae.close(),r+=a}var u=ae.result(!1);if(!u)return null;var l,h=[],f=[],v=Object(i.a)(u);try{for(v.s();!(l=v.n()).done;){var d,y=l.value,p=0,b=Object(i.a)(y);try{for(b.s();!(d=b.n()).done;){var m=d.value;f.push(m.x),f.push(m.y),p++}}catch(_){b.e(_)}finally{b.f()}h.push(p)}}catch(_){v.e(_)}finally{v.f()}return new z.a(h,f)}(n,r?256:8):null}}]),r}(e)},xe=r(292),ge=r(289),Oe=h.a.getLogger("esri.views.2d.engine.webgl.WGLDynamicMeshTemplate"),je=function(e){Object(m.a)(r,e);var t=Object(_.a)(r);function r(e){var n;return Object(a.a)(this,r),(n=t.call(this))._ongoingMaterialRequestMap=new Map,n._materialCache=new Map,n._dynamicPropertyMap=new Map,n._cimLayer=e,n}return Object(s.a)(r,[{key:"analyze",value:function(e,t,r,n,i){var a=this;if(i&&0===i.length)return null;var s=i&&i.length>0,c=t.readLegacyFeature(),o=t.getObjectId(),u=this._materialCache,l=this._cimLayer.materialHash;if(!l)return Oe.error("A Dynamic mesh template must have a material hash value or function!"),Promise.reject(null);var h="function"==typeof l?l(c,r,n,o):l;if(u.has(h)){var f=u.get(h);return Promise.resolve(f)}var v=this._ongoingMaterialRequestMap.get(h);if(v)return v;var d=this._cimLayer,y=Object(xe.a)(d.cim,this._cimLayer.materialOverrides);y.mosaicHash=h;var p=d.type,b=d.url,m={cim:y,type:p,mosaicHash:h,url:b,size:null,dashTemplate:null,text:null,fontName:null,objectId:o,animatedSymbolProperties:null};switch(p){case"marker":m.size=Object(ge.d)(d.size,c,r,n),m.animatedSymbolProperties=Object(ge.d)(d.animatedSymbolProperties,c,r,n);break;case"line":m.dashTemplate=d.dashTemplate;break;case"text":m.text=Object(ge.d)(d.text,c,r,n),m.fontName=Object(ge.d)(d.fontName,c,r,n)}var _=e.getMosaicItem(m,i).then((function(e){return s||(a._ongoingMaterialRequestMap.delete(h),u.set(h,e)),e})).catch((function(e){return a._ongoingMaterialRequestMap.delete(h),Oe.error(".analyze()",e.message),null}));return s||this._ongoingMaterialRequestMap.set(h,_),_}}]),r}(pe.a),ke=r(246),Me=function(e){Object(m.a)(r,e);var t=Object(_.a)(r);function r(e,n,i){var s,c;if(Object(a.a)(this,r),(c=t.call(this,e))._minMaxZoom=Object(M.a)(Math.round(n*j.z),Math.round(i*j.z)),Object(w.f)(e.color)){c._dynamicPropertyMap.set("fillColor",(function(t,r,n){var i=e.color(t,r,n);return i&&Object(O.c)(i)||0}))}else{var o=e.color;c.fillColor=o&&Object(O.c)(o)||0}var u="CIMMarkerPlacementInsidePolygon"===(null===(s=e.cim.placement)||void 0===s?void 0:s.type)&&e.cim.placement.shiftOddRows?2:1,l=e.height;if(Object(w.f)(l)){c._dynamicPropertyMap.set("_height",(function(e,t,r){return l(e,t,r)*u}))}else c._height=(l||0)*u;var h=e.offsetX;if(Object(w.f)(h)){c._dynamicPropertyMap.set("_offsetX",(function(e,t,r){return Object(g.c)(h(e,t,r))}))}else c._offsetX=Object(g.c)(h||0);var f=e.offsetY;if(Object(w.f)(f)){c._dynamicPropertyMap.set("_offsetY",(function(e,t,r){return Object(g.c)(-f(e,t,r))}))}else c._offsetY=Object(g.c)(-f||0);var v=e.scaleX;Object(w.f)(v)?c._dynamicPropertyMap.set("_scaleX",v):c._scaleX=v||1;var d=e.angle;if(Object(w.f)(d)){c._dynamicPropertyMap.set("_angle",(function(e,t,r){return Object(k.d)(d(e,t,r))}))}else c._angle=Object(k.d)(d)||0;if(Object(x.k)(e.effects)){var p=e.effects;Object(w.f)(p)?c._dynamicPropertyMap.set("_effects",p):c._effects=p}return c._cimFillLayer=e,c._bitset=(e.colorLocked?j.i:0)|(e.applyRandomOffset?j.g:0)|(e.sampleAlphaOnly?j.h:0),c._fillMaterialKey=y.a.load(e.materialKey),Object(b.a)(c)}return Object(s.a)(r,[{key:"bindFeature",value:function(e,t,r){var n=this,i=e.readLegacyFeature();this._dynamicPropertyMap.forEach((function(e,a){n[a]=e(i,t,r)}));var a=this._fillMaterialKey,s=this._materialCache,c=(0,this._cimFillLayer.materialHash)(i,t,r),o=s.get(c),u=null;if(o&&Object(ke.a)(o.spriteMosaicItem)&&(u=o.spriteMosaicItem),u){var l=u,h=l.rect,f=l.width,v=l.height,d=h.x+j.E,y=h.y+j.E,p=d+f,b=y+v,m=Math.round(Object(g.c)(this._height));m<=0&&(m=b-y);var _=Math.round(Object(g.c)(this._height/v*f||0));_<=0&&(_=p-d);var x=this._scaleX;this.tl=Object(M.a)(d,y),this.br=Object(M.a)(p,b),this.aux2_1=Object(M.a)(_,m),this.aux2_2=Object(M.a)(this._offsetX,this._offsetY),this.aux3=Object(M.b)(x,1,this._angle,0),a.sdf=u.sdf,a.pattern=!0,a.textureBinding=u.textureBinding}else this.tl=0,this.br=0,this.aux2_1=0,this.aux2_2=0,this.aux3=0,a.sdf=!1,a.pattern=!1,a.textureBinding=0;this._materialKey=a.data}}],[{key:"fromCIMFill",value:function(e,t){var n=Object(w.e)(e.scaleInfo,t),i=Object(p.a)(n,2);return new r(e,i[0],i[1])}}]),r}(_e(je)),we=function(e){Object(m.a)(r,e);var t=Object(_.a)(r);function r(e,n,i){var s;Object(a.a)(this,r),(s=t.call(this,e))._minMaxZoom=Object(M.a)(Math.round(n*j.z),Math.round(i*j.z)),s._cimLineLayer=e;var c=0;Object(w.f)(e.width)||(c=.5*Object(g.c)(e.width));s._dynamicPropertyMap.set("_halfWidth",(function(t,r,n){return Object(w.f)(e.width)?.5*Object(g.c)(e.width(t,r,n)):c})),Object(w.f)(e.cap)?s._dynamicPropertyMap.set("_capType",e.cap):s._capType=e.cap,Object(w.f)(e.join)?s._dynamicPropertyMap.set("_joinType",e.join):s._joinType=e.join;var o=e.color;if(Object(w.f)(o)){s._dynamicPropertyMap.set("_fillColor",(function(e,t,r){return Object(O.c)(o(e,t,r))}))}else s._fillColor=o&&Object(O.c)(o)||0;var u=e.miterLimit;if(Object(w.f)(u)){s._dynamicPropertyMap.set("_miterLimitCosine",(function(e,t,r){return Object(w.d)(u(e,t,r))}))}else s._miterLimitCosine=Object(w.d)(u);if(Object(x.k)(e.effects)){var l=e.effects;Object(w.f)(l)?s._dynamicPropertyMap.set("_effects",l):s._effects=l}s._scaleFactor=e.scaleFactor||1,s._isDashed=null!=e.dashTemplate;var h=e.colorLocked?j.i:0,f=e.scaleDash?j.j:0,v=e.sampleAlphaOnly?j.h:0;return s.tessellationProperties._bitset=h|f|v,s._materialKey=e.materialKey,s._initializeTessellator(!0),s}return Object(s.a)(r,[{key:"bindFeature",value:function(e,t,r){var n=this,i=e.readLegacyFeature();this._dynamicPropertyMap.forEach((function(e,a){n[a]=e(i,t,r)})),this._halfWidth*=this._scaleFactor;var a=this._materialCache,s=(0,this._cimLineLayer.materialHash)(i,t,r),c=a.get(s),o=null;if(c&&Object(ke.a)(c.spriteMosaicItem)&&(o=c.spriteMosaicItem),o){this._hasPattern=!0;var u=o,l=u.rect,h=u.width,f=u.height,v=l.x+j.E,d=l.y+j.E,p=v+h,b=d+f;this.tessellationProperties._tl=Object(M.a)(v,d),this.tessellationProperties._br=Object(M.a)(p,b)}else this._hasPattern=!1,this.tessellationProperties._tl=0,this.tessellationProperties._br=0;this.tessellationProperties._fillColor=this._fillColor,this.tessellationProperties._halfWidth=this._halfWidth,this.tessellationProperties.offset=0,this.tessellationProperties._halfReferenceWidth=this.tessellationProperties._halfWidth;var m=y.c.load(this._materialKey);o&&(m.sdf=o.sdf,m.pattern=!0,m.textureBinding=o.textureBinding),this._materialKey=m.data}}],[{key:"fromCIMLine",value:function(e,t){var n=Object(w.e)(e.scaleInfo,t),i=Object(p.a)(n,2);return new r(e,i[0],i[1])}}]),r}(fe(je)),Se=r(255),Le=r(184),Te=r(325),ze=Object(Le.a)(),Pe=Object(Se.a)(),Ie=h.a.getLogger("esri.views.2d.engine.webgl.WGLDynamicMarkerTemplate"),Ee=function(e){Object(m.a)(r,e);var t=Object(_.a)(r);function r(e,n,i){var s;Object(a.a)(this,r),(s=t.call(this,e))._cimMarkerLayer=e,s._minMaxZoom=Object(M.a)(Math.round(n*j.z),Math.round(i*j.z));var c=e.color;if(Object(w.f)(c)){s._dynamicPropertyMap.set("_fillColor",(function(e,t,r){return Object(O.c)(c(e,t,r))}))}else s._fillColor=Object(O.c)(c);var o=e.outlineColor;if(Object(w.f)(o)){s._dynamicPropertyMap.set("_outlineColor",(function(e,t,r){return Object(O.c)(o(e,t,r))}))}else s._outlineColor=Object(O.c)(o);var u=e.size;if(Object(w.f)(u)){s._dynamicPropertyMap.set("_size",(function(e,t,r){return Object(g.c)(u(e,t,r))}))}else s._size=Object(g.c)(u)||0;var l=e.scaleX;Object(w.f)(l)?s._dynamicPropertyMap.set("_scaleX",l):s._scaleX=l||1;var h=e.offsetX;if(Object(w.f)(h)){s._dynamicPropertyMap.set("xOffset",(function(e,t,r){return Object(g.c)(h(e,t,r))}))}else s.xOffset=Object(g.c)(h)||0;var f=e.offsetY;if(Object(w.f)(f)){s._dynamicPropertyMap.set("yOffset",(function(e,t,r){return Object(g.c)(f(e,t,r))}))}else s.yOffset=Object(g.c)(f)||0;var v=e.outlineWidth;if(Object(w.f)(v)){s._dynamicPropertyMap.set("_outlineWidth",(function(e,t,r){return Object(g.c)(v(e,t,r))}))}else s._outlineWidth=Object(g.c)(v)||0;var d=e.rotation;if(Object(w.f)(d)?s._dynamicPropertyMap.set("_angle",d):s._angle=d||0,Object(x.k)(e.effects)){var y=e.effects;Object(w.f)(y)?s._dynamicPropertyMap.set("_effects",y):s._effects=y}if(Object(x.k)(e.markerPlacement)){var p=e.markerPlacement;Object(w.f)(p)?s._dynamicPropertyMap.set("_markerPlacement",p):s._markerPlacement=p}return s._scaleFactor=Object(x.r)(e.scaleFactor,1),s._bitSet=(e.alignment===ue.a.MAP?1:0)|(e.colorLocked?1:0)<<1|(e.scaleSymbolsProportionally?1:0)<<3,s._materialKey=e.materialKey,s}return Object(s.a)(r,[{key:"bindFeature",value:function(e,t,r){var n=this,i=e.readLegacyFeature(),a=e.getObjectId();this._dynamicPropertyMap.forEach((function(e,a){n[a]=e(i,t,r)}));var s=this._cimMarkerLayer.materialHash,c="function"==typeof s?s(i,t,r,a):s,o=this._materialCache.get(c);if(o&&Object(ke.a)(o.spriteMosaicItem)&&o.spriteMosaicItem){var u=o.spriteMosaicItem,h=this._cimMarkerLayer.sizeRatio,f=u.width/u.height*this._scaleX,v=this._cimMarkerLayer.rotateClockwise?this._angle:-this._angle,d=this._size,p=d*f,b=this.xOffset,m=this.yOffset;this.xOffset*=this._scaleFactor,this.yOffset*=this._scaleFactor;var _=this._cimMarkerLayer.scaleSymbolsProportionally&&this._cimMarkerLayer.frameHeight?this._size/Object(g.c)(this._cimMarkerLayer.frameHeight):1,x=this._outlineWidth*_,O=Object(g.c)(this._cimMarkerLayer.referenceSize),k=0,w=0,S=this._cimMarkerLayer.anchorPoint;S&&(this._cimMarkerLayer.isAbsoluteAnchorPoint?this._size&&(k=-S.x/(this._size*f),w=S.y/this._size):(k=S.x,w=S.y)),this._sizeOutlineWidth=Object(M.b)(Math.round(Math.min(Math.sqrt(128*p),255)),Math.round(Math.min(Math.sqrt(128*d),255)),Math.round(Math.min(Math.sqrt(128*x),255)),Math.round(Math.min(Math.sqrt(128*O),255))),this.angle=v;var L=Math.round(64*h);this._bitestAndDistRatio=Object(M.a)(this._bitSet,L);var T=u.rect.x+j.E,z=u.rect.y+j.E,P=T+u.width,I=z+u.height;this._texUpperLeft=Object(M.a)(T,z),this._texUpperRight=Object(M.a)(P,z),this._texBottomLeft=Object(M.a)(T,I),this._texBottomRight=Object(M.a)(P,I);var E=y.d.load(this._materialKey);E.sdf=u.sdf,E.pattern=!0,E.textureBinding=u.textureBinding,this._materialKey=E.data,this._anchorX=.5-(.5+k)*u.width/u.width,this._anchorY=.5-(.5+w)*u.height/u.height,p*=h,d*=h,p*=this._scaleFactor,d*=this._scaleFactor,p*=u.rect.width/u.width,d*=u.rect.height/u.height,this._computedWidth=p,this._computedHeight=d,this._applyTransformation(Pe,ze),this.xOffset=b,this.yOffset=m}else Ie.error(new l.a("mapview-cim","Encountered an error when binding feature"))}}],[{key:"fromCIMMarker",value:function(e,t){var n=Object(w.e)(e.scaleInfo,t),i=Object(p.a)(n,2);return new r(e,i[0],i[1])}}]),r}(Object(Te.a)(je)),Ce=r(164),Ve=r(163),Ae=r(218),Re=r(321),We=r(316);function Fe(e,t,r,n){return"string"==typeof e.text?e.text:"function"==typeof e.text?e.text(t,r,n):""}var Be=function(e){Object(m.a)(r,e);var t=Object(_.a)(r);function r(e,n,i){var s;Object(a.a)(this,r),(s=t.call(this,e))._horizontalAlignment="center",s._verticalAlignment="middle",s._textToGlyphs=new Map,s._minMaxZoom=Object(M.a)(Math.round(n*j.z),Math.round(i*j.z));var c=e.scaleFactor||1;s._cimTextLayer=e;var o=e.color;if(Object(w.f)(o)){s._dynamicPropertyMap.set("_color",(function(e,t,r){return Object(O.c)(o(e,t,r))}))}else s._color=Object(O.c)(o);var u,l=e.outlineColor;if(Object(w.f)(l)){s._dynamicPropertyMap.set("_haloColor",(function(e,t,r){return Object(O.c)(l(e,t,r))}))}else s._haloColor=Object(O.c)(l);Object(w.f)(e.size)||(u=Math.min(Math.round(Object(g.c)(e.size*e.sizeRatio)),127));var h;if(s._dynamicPropertyMap.set("_size",(function(t,r,n){return Object(w.f)(e.size)?Math.min(Math.round(Object(g.c)(e.size(t,r,n)*e.sizeRatio)),127):u})),Object(w.f)(e.outlineSize)){s._dynamicPropertyMap.set("_haloSize",(function(t,r,n){return Math.min(Math.floor(5*Object(g.c)(e.outlineSize(t,r,n)*e.sizeRatio)),127)}))}else s._haloSize=Math.min(Math.floor(5*Object(g.c)(e.outlineSize*e.sizeRatio)),127);Object(w.f)(e.offsetX)||(h=Math.round(Object(g.c)(e.offsetX*e.sizeRatio)));var f;s._dynamicPropertyMap.set("_xOffset",(function(t,r,n){return Object(w.f)(e.offsetX)?Math.round(Object(g.c)(e.offsetX(t,r,n)*e.sizeRatio)):h})),Object(w.f)(e.offsetY)||(f=Math.round(Object(g.c)(e.offsetY*e.sizeRatio)));if(s._dynamicPropertyMap.set("_yOffset",(function(t,r,n){return Object(w.f)(e.offsetY)?Math.round(Object(g.c)(e.offsetY(t,r,n)*e.sizeRatio)):f})),Object(w.f)(e.angle)?s._dynamicPropertyMap.set("_angle",e.angle):s._angle=e.angle,Object(w.f)(e.horizontalAlignment)?s._dynamicPropertyMap.set("_horizontalAlignment",e.horizontalAlignment):s._horizontalAlignment=e.horizontalAlignment,Object(w.f)(e.verticalAlignment)?s._dynamicPropertyMap.set("_verticalAlignment",e.verticalAlignment):s._verticalAlignment=e.verticalAlignment,Object(x.k)(e.effects)){var v=e.effects;Object(w.f)(v)?s._dynamicPropertyMap.set("_effects",v):s._effects=v}if(Object(x.k)(e.markerPlacement)){var d=e.markerPlacement;Object(w.f)(d)?s._dynamicPropertyMap.set("_markerPlacement",d):s._textPlacement=d}Object(w.f)(e.text)?s._dynamicPropertyMap.set("_text",e.text):s._text=e.text,s._scaleFactor=c;var p=Math.min(Math.round(Object(g.c)(e.referenceSize*e.sizeRatio)),127);s._referenceSize=Math.round(Math.sqrt(256*p)),s._materialKey=e.materialKey;var b=y.f.load(s._materialKey);return b.sdf=!0,s._bitset=(e.alignment===ue.a.MAP?1:0)|(e.colorLocked?1:0)<<1,s._materialKey=b.data,s._decoration="none",s._lineHeight=1,s._lineWidth=512,s._isCIM=!0,s}return Object(s.a)(r,[{key:"analyze",value:function(){var e=Object(n.a)(u.a.mark((function e(t,n,i,a){var s,c,o;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=n.readLegacyFeature(),c=Fe(this._cimTextLayer,s,i,a),e.next=4,Object(Ce.a)(Object(Ve.a)(r.prototype),"analyze",this).call(this,t,n,i,a,Object(We.a)(c));case 4:return o=e.sent,e.abrupt("return",(o&&o.glyphMosaicItems&&this._textToGlyphs.set(c,o.glyphMosaicItems),o));case 6:case"end":return e.stop()}}),e,this)})));return function(t,r,n,i){return e.apply(this,arguments)}}()},{key:"bindFeature",value:function(e,t,r){var n=this,i=e.readLegacyFeature();if(this._dynamicPropertyMap.forEach((function(e,a){n[a]=e(i,t,r)})),this._text&&0!==this._text.length){this._size*=this._scaleFactor,this._scale=this._size/j.u,this._xOffset*=this._scaleFactor,this._yOffset*=this._scaleFactor,this._xAlignD=Object(Ae.e)(Object(x.r)(this._horizontalAlignment,"center")),this._yAlignD=Object(Ae.g)(Object(x.r)(this._verticalAlignment,"baseline"));var a=this._textToGlyphs.get(this._text);this.bindTextInfo(a,!1)}else this._shapingInfo=null}}],[{key:"fromCIMText",value:function(e,t){var n=Object(w.e)(e.scaleInfo,t),i=Object(p.a)(n,2);return new r(e,i[0],i[1])}}]),r}(Object(Re.a)(je)),De=128,Ke=function(e){Object(m.a)(r,e);var t=Object(_.a)(r);function r(e,n,i,s,c,o,u,l,h,f,v,d,p,b,m,_){var x;Object(a.a)(this,r),(x=t.call(this))._effects=b;var g=y.a.load(e);return n&&(g.sdf=n.sdf,g.pattern=!0,g.textureBinding=n.textureBinding),x.fillColor=i,x.tl=s,x.br=c,x.aux2_1=Object(M.a)(o,u),x.aux2_2=Object(M.a)(l,h),x.aux3=Object(M.b)(f,v,d,0),x._bitset=p,x._minMaxZoom=Object(M.a)(Math.round(m*j.z),Math.round(_*j.z)),x._materialKey=g.data,x}return Object(s.a)(r,null,[{key:"fromCIMFill",value:function(e,t,n){var i=e.color,a=i&&Object(O.c)(i)||0,s=e.materialKey,c=Object(w.e)(e.scaleInfo,n),o=Object(p.a)(c,2),u=o[0],l=o[1],h=(e.colorLocked?j.i:0)|(e.applyRandomOffset?j.g:0)|(e.sampleAlphaOnly?j.h:0);if(!t)return new r(s,null,a,0,0,0,0,0,0,0,0,0,h,e.effects,u,l);var f=t.rect,v=t.width,d=t.height,y=e.scaleX||1,b=f.x+j.E,m=f.y+j.E,_=b+v,x=m+d,S=e.height,L=y*S,T=Math.round(S);T<=0&&(T=x-m);var z=Math.round(L);z<=0&&(z=_-b);var P=Object(g.c)(e.offsetX||0),I=Object(g.c)(-e.offsetY||0);return new r(s,t,a,Object(M.a)(b,m),Object(M.a)(_,x),z,T,P,I,De,De,Object(k.b)(e.angle),h,e.effects,u,l)}},{key:"fromSimpleFill",value:function(e,t){var n,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=e.color,s=a&&"esriSFSNull"!==e.style&&Object(O.d)(a)||0,c=i?j.i:0,o=e.materialKey;if(t){var u=t.rect,l=t.width,h=t.height,f=u.x+j.E,v=u.y+j.E,d=f+l,y=v+h,p=Object(M.a)(f,v),b=Object(M.a)(d,y);n=new r(o,t,s,p,b,l,h,0,0,De,De,0,c,null,w.b,w.a)}else n=new r(o,null,s,0,0,0,0,0,0,0,0,0,c,null,w.b,w.a);return n._maybeAddLineTemplate(e),n}},{key:"fromPictureFill",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=j.C,a=t.rect,s=t.width,c=t.height,o=a.x+j.E,u=a.y+j.E,l=o+s,h=u+c,f=Object(M.a)(o,u),v=Object(M.a)(l,h),d=Math.round(Object(g.c)(e.width)),y=Math.round(Object(g.c)(e.height)),p=Object(g.c)(e.xoffset),b=Object(g.c)(-e.yoffset),m=e.materialKey,_=n?j.i:0,x=new r(m,t,i,f,v,d,y,p,b,De*e.xscale,De*e.yscale,0,_,null,w.b,w.a);return x._maybeAddLineTemplate(e),x}}]),r}(_e(pe.a)),Ge=r(324),Ze=r(320),Ue=function(){function e(){Object(a.a)(this,e),this._resolver=null}return Object(s.a)(e,[{key:"isHeld",value:function(){return!!this._resolver}},{key:"acquire",value:function(){var e=Object(n.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._resolver){e.next=7;break}return e.next=3,this._resolver.promise;case 3:return e.next=5,this.acquire();case 5:e.next=8;break;case 7:this._resolver=Object(f.d)();case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"release",value:function(){var e=this._resolver;this._resolver=null,e.resolve()}}]),e}();function Ne(){return(Ne=Object(n.a)(u.a.mark((function e(t,r,n){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.acquire();case 3:return e.next=5,r(n);case 5:t.release(),e.next=11;break;case 8:throw e.prev=8,e.t0=e.catch(0),t.release(),e.t0;case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))).apply(this,arguments)}var Xe=r(232),qe=h.a.getLogger("esri.views.2d.engine.webgl.mesh.templates.WGLTemplateStore"),He=new Array,Ye={isOutline:!1,placement:null,symbologyType:d.e.DEFAULT,vvFlags:0},Qe=Object(c.a)(Object(c.a)({},v.e),{},{hash:JSON.stringify(v.e),materialKey:Object(y.g)(d.d.MARKER,Ye)}),Je=Object(c.a)(Object(c.a)({},v.g),{},{hash:JSON.stringify(v.g),materialKey:Object(y.g)(d.d.LINE,Ye)}),$e=Object(c.a)(Object(c.a)({},v.f),{},{hash:JSON.stringify(v.f),materialKey:Object(y.g)(d.d.FILL,Ye)});function et(e,t){var r=e.length;return e.push(null),t.then((function(t){return e[r]=t})),e}function tt(e){return!!(1&e)}var rt=function(){function e(t,r){Object(a.a)(this,e),this._idCounter=1,this._templateIdCounter=1,this._idToTemplateGroup=new Map,this._symbolToTemplate=new Map,this._fetchQueue=[],this._idToResolver=new Map,this._cimTemplateCache=new Map,this._cimAnalyses=[],this._lock=new Ue,this._fetchResource=t,this._tileInfo=r}return Object(s.a)(e,[{key:"_markerError",get:function(){return this._errorTemplates.marker[0]}},{key:"_fillError",get:function(){return this._errorTemplates.fill[0]}},{key:"_lineError",get:function(){return this._errorTemplates.line[0]}},{key:"_textError",get:function(){return this._errorTemplates.line[0]}},{key:"createTemplateGroup",value:function(e,t){this._initErrorTemplates();var r=e.hash;if(this._symbolToTemplate.has(r))return this._symbolToTemplate.get(r);var n=new Array;t&&this._createMeshTemplates(n,t,!0),this._createMeshTemplates(n,e,!1);var i=this._createGroupId("expanded-cim"===e.type&&nt(e));return this._idToTemplateGroup.set(i,n),this._symbolToTemplate.set(r,i),i}},{key:"getTemplateGroup",value:function(e){return this._idToTemplateGroup.has(e)?this._idToTemplateGroup.get(e):He}},{key:"getDynamicTemplateGroup",value:function(e){return this._idToTemplateGroup.has(e)?(tt(e)||qe.error("mapview-template-store","Id ".concat(e," does not refer to a dynamic template")),this._idToTemplateGroup.get(e)):He}},{key:"getMosaicItem",value:function(e,t){var r=this,n=this._createTemplateId(),i=new Promise((function(e){return r._idToResolver.set(n,e)}));return this._fetchQueue.push({symbol:e,id:n,glyphIds:t}),i}},{key:"finalize",value:function(e){return this._fetchQueue.length||this._lock.isHeld()?function(e,t,r){return Ne.apply(this,arguments)}(this._lock,this._fetchAllQueuedResources.bind(this),e):Promise.resolve()}},{key:"_initErrorTemplates",value:function(){this._errorTemplates||(this._errorTemplates={fill:this._createMeshTemplates([],$e,!1),marker:this._createMeshTemplates([],Qe,!1),line:this._createMeshTemplates([],Je,!1)})}},{key:"_fetchAllQueuedResources",value:function(e){var t=this;if(!this._fetchQueue.length)return Promise.resolve();var r=this._fetchQueue,n=this._cimAnalyses;return this._fetchQueue=[],this._cimAnalyses=[],Promise.all(n).then((function(){return t._fetchResource(r,e).then((function(e){var r,n=Object(i.a)(e);try{for(n.s();!(r=n.n()).done;){var a=r.value,s=a.id,c=a.mosaicItem;t._idToResolver.get(s)(c),t._idToResolver.delete(s)}}catch(o){n.e(o)}finally{n.f()}}))})).catch((function(e){Object(f.j)(e)?t._fetchQueue=t._fetchQueue.concat(r):"worker:port-closed"===e.name||qe.error(new l.a("mapview-template-store","Unable to fetch requested texture resources",e))}))}},{key:"_createGroupId",value:function(e){return this._idCounter++<<1|(e?1:0)}},{key:"_createTemplateId",value:function(){return this._templateIdCounter++}},{key:"_createSMS",value:function(){var e=Object(n.a)(u.a.mark((function e(t){var r,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMosaicItem(t);case 2:return r=e.sent,n=r.spriteMosaicItem,e.abrupt("return",Object(ke.a)(n,qe)?Ge.a.fromSimpleMarker(t,n):this._markerError);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createPMS",value:function(){var e=Object(n.a)(u.a.mark((function e(t){var r,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMosaicItem(t);case 2:return r=e.sent,n=r.spriteMosaicItem,e.abrupt("return",Object(ke.a)(n,qe)?Ge.a.fromPictureMarker(t,n):this._markerError);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createSFS",value:function(){var e=Object(n.a)(u.a.mark((function e(t,r){var n,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMosaicItem(t);case 2:return n=e.sent,i=n.spriteMosaicItem,e.abrupt("return",Object(ke.a)(i,qe)?Ke.fromSimpleFill(t,i,r):this._fillError);case 5:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_createPFS",value:function(){var e=Object(n.a)(u.a.mark((function e(t,r){var n,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMosaicItem(t);case 2:return n=e.sent,i=n.spriteMosaicItem,e.abrupt("return",Object(ke.a)(i,qe)?Ke.fromPictureFill(t,i,r):this._fillError);case 5:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_createSLS",value:function(){var e=Object(n.a)(u.a.mark((function e(t,r){var n,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMosaicItem(t);case 2:return n=e.sent,i=n.spriteMosaicItem,e.abrupt("return",Object(ke.a)(i,qe)?me.fromSimpleLine(t,i):this._lineError);case 5:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_createLMS",value:function(){var e=Object(n.a)(u.a.mark((function e(t){var r,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMosaicItem(t);case 2:return r=e.sent,n=r.spriteMosaicItem,e.abrupt("return",Object(ke.a)(n,qe)?Ge.a.fromLineSymbolMarker(t,n):this._markerError);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createTS",value:function(){var e=Object(n.a)(u.a.mark((function e(t){var r,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMosaicItem(t);case 2:return r=e.sent,n=r.glyphMosaicItems,e.abrupt("return",Ze.a.fromText(t,n));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createCIMText",value:function(){var e=Object(n.a)(u.a.mark((function e(t){var r,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMosaicItem(Object(Xe.a)(t),Object(We.a)(t.text));case 2:return r=e.sent,n=r.glyphMosaicItems,e.abrupt("return",Object(ke.a)(n,qe)?Ze.a.fromCIMText(t,n,this._tileInfo):this._textError);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createCIMFill",value:function(){var e=Object(n.a)(u.a.mark((function e(t){var r,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMosaicItem(Object(Xe.a)(t));case 2:return r=e.sent,n=r.spriteMosaicItem,e.abrupt("return",Object(ke.a)(n,qe)?Ke.fromCIMFill(t,n,this._tileInfo):this._fillError);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createCIMLine",value:function(){var e=Object(n.a)(u.a.mark((function e(t){var r,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMosaicItem(Object(Xe.a)(t));case 2:return r=e.sent,n=r.spriteMosaicItem,e.abrupt("return",Object(ke.a)(n,qe)?me.fromCIMLine(t,n,this._tileInfo):this._lineError);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createCIMMarker",value:function(){var e=Object(n.a)(u.a.mark((function e(t){var r,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMosaicItem(Object(Xe.a)(t));case 2:return r=e.sent,n=r.spriteMosaicItem,e.abrupt("return",Object(ke.a)(n,qe)?Ge.a.fromCIMMarker(t,n,this._tileInfo):this._markerError);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createCIM",value:function(){var e=Object(n.a)(u.a.mark((function e(t){var r,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.templateHash,!this._cimTemplateCache.has(r)){e.next=3;break}return e.abrupt("return",this._cimTemplateCache.get(r));case 3:e.t0=t.type,e.next="marker"===e.t0?6:"line"===e.t0?10:"fill"===e.t0?14:"text"===e.t0?18:21;break;case 6:return e.next=8,this._createCIMMarker(t);case 8:return n=e.sent,e.abrupt("break",21);case 10:return e.next=12,this._createCIMLine(t);case 12:return n=e.sent,e.abrupt("break",21);case 14:return e.next=16,this._createCIMFill(t);case 16:return n=e.sent,e.abrupt("break",21);case 18:return e.next=20,this._createCIMText(t);case 20:n=e.sent;case 21:return e.abrupt("return",(this._cimTemplateCache.set(r,n),n));case 22:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createDynamicCIM",value:function(){var e=Object(n.a)(u.a.mark((function e(t){var r,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.templateHash,!this._cimTemplateCache.has(r)){e.next=3;break}return e.abrupt("return",this._cimTemplateCache.get(r));case 3:e.t0=t.type,e.next="marker"===e.t0?6:"line"===e.t0?8:"fill"===e.t0?10:"text"===e.t0?12:13;break;case 6:return n=Ee.fromCIMMarker(t,this._tileInfo),e.abrupt("break",13);case 8:return n=we.fromCIMLine(t,this._tileInfo),e.abrupt("break",13);case 10:return n=Me.fromCIMFill(t,this._tileInfo),e.abrupt("break",13);case 12:n=Be.fromCIMText(t,this._tileInfo);case 13:return e.abrupt("return",(this._cimTemplateCache.set(r,n),n));case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createPrimitiveMeshTemplates",value:function(e,t,r){switch(t.type){case"esriSMS":return et(e,this._createSMS(t));case"esriPMS":return et(e,this._createPMS(t));case"esriSFS":return et(e,this._createSFS(t,r));case"line-marker":return et(e,this._createLMS(t));case"esriPFS":return et(e,this._createPFS(t,r));case"esriSLS":return et(e,this._createSLS(t,!1));case"esriTS":return et(e,this._createTS(t));default:return qe.error("Unable to create mesh template for unknown symbol type {: $ }{symbol.type}"),e}}},{key:"_createMeshTemplates",value:function(e,t,r){if(t.type.includes("3d"))return qe.error("3D symbols are not supported with MapView"),e;if("expanded-cim"===t.type){var n,a=Object(i.a)(t.layers);try{for(a.s();!(n=a.n()).done;){var s=n.value;"function"==typeof s.materialHash?et(e,this._createDynamicCIM(s)):et(e,this._createCIM(s))}}catch(l){a.e(l)}finally{a.f()}return e}if("composite-symbol"===t.type){var c,o=Object(i.a)(t.layers);try{for(o.s();!(c=o.n()).done;){var u=c.value;this._createPrimitiveMeshTemplates(e,u,r)}}catch(l){o.e(l)}finally{o.f()}return e}return"cim"===t.type||"label"===t.type||"web-style"===t.type?e:this._createPrimitiveMeshTemplates(e,t,r)}}]),e}(),nt=function(e){if(!e.layers)return!1;var t,r=Object(i.a)(e.layers);try{for(r.s();!(t=r.n()).done;){if("function"==typeof t.value.materialHash)return!0}}catch(n){r.e(n)}finally{r.f()}return!1}},368:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));r(467);function n(e,t,r,n){var i=e.clone(),a=1<<i.level,s=i.col+t,c=i.row+r;return n&&s<0?(i.col=s+a,i.world-=1):s>=a?(i.col=s-a,i.world+=1):i.col=s,i.row=c,i}},396:function(e,t,r){"use strict";r.d(t,"a",(function(){return O}));var n=r(14),i=r(5),a=r(60),s=r(164),c=r(163),o=r(144),u=r(145),l=r(142),h=r(143),f=r(155),v=r(154),d=r.n(v),y=r(159),p=r(156),b=r(409),m=r(261),_=r(326),x=r(232),g=p.a.getLogger("esri/views/2d/engine/webgl/util/Matcher");function O(e,t,r,n){return j.apply(this,arguments)}function j(){return(j=Object(f.a)(d.a.mark((function e(t,r,n,i){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.type,e.next="simple"===e.t0||"heatmap"===e.t0?3:"map"===e.t0?4:"interval"===e.t0?5:"dictionary"===e.t0?6:"pie-chart"===e.t0?7:"subtype"===e.t0?8:9;break;case 3:return e.abrupt("return",M.fromBasicRenderer(t,r,n,i));case 4:return e.abrupt("return",L.fromUVRenderer(t,r,n,i));case 5:return e.abrupt("return",S.fromCBRenderer(t,r,n,i));case 6:return e.abrupt("return",E.fromDictionaryRenderer(t,r,n,i));case 7:return e.abrupt("return",w.fromPieChartRenderer(t,r,n,i));case 8:return e.abrupt("return",w.fromSubtypes(t,r,n,i));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var k,M=function(){function e(){Object(l.a)(this,e),this.type="feature",this._defaultResult=null}return Object(h.a)(e,[{key:"size",value:function(){return 1}},{key:"getDefault",value:function(){return this._defaultResult}},{key:"setDefault",value:function(e){this._defaultResult=e}},{key:"match",value:function(e,t,r,n,i){return this.getDefault()}},{key:"analyze",value:function(){var e=Object(f.a)(d.a.mark((function e(t,r,n,i,a,s){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null);case 1:case"end":return e.stop()}}),e)})));return function(t,r,n,i,a,s){return e.apply(this,arguments)}}()}],[{key:"fromBasicRenderer",value:function(){var t=Object(f.a)(d.a.mark((function t(r,n,i,a){var s,c,o;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(s=new e,!r.symbol){t.next=7;break}return t.next=4,Object(x.b)(r.symbol,i,a);case 4:c=t.sent,o=n.createTemplateGroup(c,null),s.setDefault(o);case 7:return t.abrupt("return",s);case 8:case"end":return t.stop()}}),t)})));return function(e,r,n,i){return t.apply(this,arguments)}}()},{key:"fromPieChartRenderer",value:function(){var t=Object(f.a)(d.a.mark((function t(r,n,i,a){var s,c,o,u;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(s=new e,!r.markerSymbol){t.next=12;break}return t.next=4,Object(x.b)(r.markerSymbol,i,a);case 4:if(c=t.sent,t.t0=r.fillSymbol,!t.t0){t.next=10;break}return t.next=9,Object(x.b)(r.fillSymbol,i,a);case 9:o=t.sent;case 10:u=n.createTemplateGroup(c,o),s.setDefault(u);case 12:return t.abrupt("return",s);case 13:case"end":return t.stop()}}),t)})));return function(e,r,n,i){return t.apply(this,arguments)}}()}]),e}(),w=function(e){Object(o.a)(r,e);var t=Object(u.a)(r);function r(e,n){var i;return Object(l.a)(this,r),(i=t.call(this))._subMatchers=e,i._subtypeField=n,i}return Object(h.a)(r,[{key:"match",value:function(e,t,r,n,i){var a=t.readAttribute(this._subtypeField),s=this._subMatchers.get(a);return s?s.match(e,t,r,n,i):null}}],[{key:"fromSubtypes",value:function(){var e=Object(f.a)(d.a.mark((function e(t,n,i,a){var s,c,o,u;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(u in s=new Map,c=[],o=function(e){var r=parseInt(e,10),o=O(t.renderers[e],n,i,a).then((function(e){return s.set(r,e)}));c.push(o)},t.renderers)o(u);return e.next=5,Promise.all(c);case 5:return e.abrupt("return",new r(s,t.subtypeField));case 6:case"end":return e.stop()}}),e)})));return function(t,r,n,i){return e.apply(this,arguments)}}()}]),r}(M),S=function(e){Object(o.a)(r,e);var t=Object(u.a)(r);function r(e,n,i,a){var s;return Object(l.a)(this,r),(s=t.call(this)).type="interval",s._intervals=[],s._isMaxInclusive=n,s._fieldIndex=a,s._field=e,s._normalizationInfo=i,s}return Object(h.a)(r,[{key:"add",value:function(e,t){this._intervals.push({interval:e,result:t}),this._intervals.sort((function(e,t){return e.interval.min-t.interval.min}))}},{key:"size",value:function(){return Object(s.a)(Object(c.a)(r.prototype),"size",this).call(this)+this._intervals.length}},{key:"match",value:function(e,t,r,n,i){if(null==this._fieldIndex&&!this._field)return this.getDefault();var a=null!=this._fieldIndex?t.getComputedNumericAtIndex(this._fieldIndex):this._getValueFromField(t);if(!a&&(null==a||isNaN(a)))return this.getDefault();for(var s=0;s<this._intervals.length;s++){var c=this._intervals[s],o=c.interval,u=c.result,l=a>=o.min,h=this._isMaxInclusive?a<=o.max:a<o.max;if(l&&h)return u}return this.getDefault()}},{key:"_needsNormalization",value:function(){var e=this._normalizationInfo;return e&&(e.normalizationField||e.normalizationTotal||e.normalizationType)}},{key:"_getValueFromField",value:function(e){var t=e.readAttribute(this._field);if(!this._needsNormalization()||null==t)return t;var r=this._normalizationInfo,n=r.normalizationField,i=r.normalizationTotal,a=r.normalizationType,s=!!n&&e.readAttribute(n);if(a)switch(a){case"esriNormalizeByField":return s?t/s:void 0;case"esriNormalizeByLog":return Math.log(t)*Math.LOG10E;case"esriNormalizeByPercentOfTotal":return t/i*100;default:return void g.error("Found unknown normalization type: ".concat(a))}else g.error("Normalization is required, but no type was set!")}}],[{key:"fromCBRenderer",value:function(){var e=Object(f.a)(d.a.mark((function e(t,n,i,a){var s,c,o,u,l,h,v,y,p;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.isMaxInclusive,c=t.normalizationField,o=t.normalizationTotal,u=t.normalizationType,l=t.field,h=new r(l,s,{normalizationField:c,normalizationTotal:o,normalizationType:u},t.fieldIndex),e.next=8,Object(x.b)(t.backgroundFillSymbol,i,a);case 8:return v=e.sent,e.next=11,Promise.all(t.intervals.map(function(){var e=Object(f.a)(d.a.mark((function e(t){var r,s,c;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(x.b)(t.symbol,i,a);case 2:return r=e.sent,e.next=5,n.createTemplateGroup(r,v);case 5:s=e.sent,c={min:t.min,max:t.max},h.add(c,s);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 11:return e.next=13,Object(x.b)(t.defaultSymbol,i,a);case 13:if(!(y=e.sent)){e.next=19;break}return e.next=17,n.createTemplateGroup(y,v);case 17:p=e.sent,h.setDefault(p);case 19:return e.abrupt("return",h);case 20:case"end":return e.stop()}}),e)})));return function(t,r,n,i){return e.apply(this,arguments)}}()}]),r}(M),L=function(e){Object(o.a)(r,e);var t=Object(u.a)(r);function r(e,n,i){var a;return Object(l.a)(this,r),(a=t.call(this)).type="map",a._nullResult=null,a._resultsMap=new Map,a._fieldsIndex=i,a._fields=e,a._seperator=n||"",a}return Object(h.a)(r,[{key:"setNullResult",value:function(e){this._nullResult=e}},{key:"add",value:function(e,t){this._resultsMap.set(e.toString(),t)}},{key:"size",value:function(){return Object(s.a)(Object(c.a)(r.prototype),"size",this).call(this)+this._resultsMap.size}},{key:"match",value:function(e,t,r,n,i){if(null==this._fieldsIndex&&!this._fields)return this.getDefault();var a=null!=this._fieldsIndex?t.getComputedStringAtIndex(this._fieldsIndex):this._getValueFromFields(t);if(null!==this._nullResult&&(null==a||""===a||"<Null>"===a))return this._nullResult;if(!a&&null==a)return this.getDefault();var s=a.toString();return this._resultsMap.has(s)?this._resultsMap.get(s):this.getDefault()}},{key:"_getValueFromFields",value:function(e){var t,r=[],n=Object(a.a)(this._fields);try{for(n.s();!(t=n.n()).done;){var i=t.value,s=e.readAttribute(i);null==s||""===s?r.push("<Null>"):r.push(s)}}catch(c){n.e(c)}finally{n.f()}return r.join(this._seperator)}}],[{key:"fromUVRenderer",value:function(){var e=Object(f.a)(d.a.mark((function e(t,n,i,a){var s,c,o,u,l,h;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.fieldDelimiter,c=[t.field],t.field2&&c.push(t.field2),t.field3&&c.push(t.field3),e.next=4,Object(x.b)(t.backgroundFillSymbol,i,a);case 4:return o=e.sent,u=new r(c,s,t.fieldIndex),e.next=8,Promise.all(t.map.map(function(){var e=Object(f.a)(d.a.mark((function e(t){var r,s;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(x.b)(t.symbol,i,a);case 2:return r=e.sent,e.next=5,n.createTemplateGroup(r,o);case 5:s=e.sent,"<Null>"===t.value?u.setNullResult(s):u.add(t.value,s);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 8:return e.next=10,Object(x.b)(t.defaultSymbol,i,a);case 10:if(!(l=e.sent)){e.next=16;break}return e.next=14,n.createTemplateGroup(l,o);case 14:h=e.sent,u.setDefault(h);case 16:return e.abrupt("return",u);case 17:case"end":return e.stop()}}),e)})));return function(t,r,n,i){return e.apply(this,arguments)}}()}]),r}(M);function T(e,t){return z.apply(this,arguments)}function z(){return(z=Object(f.a)(d.a.mark((function e(t,r){var n,i;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("number"!=typeof(n=t||1)){e.next=3;break}return e.abrupt("return",(function(e,t,r){return n}));case 3:return e.next=5,Object(m.d)(n,r.spatialReference,r.fields);case 5:return i=e.sent,e.abrupt("return",(function(e,t,n){return Object(_.a)(i,e,{$view:n},r.geometryType,t)||1}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function P(){return I.apply(this,arguments)}function I(){return(I=Object(f.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(k||(k=r.e(196).then(r.bind(null,214))),k));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var E=function(e){Object(o.a)(s,e);var t=Object(u.a)(s);function s(e,r,n,i,a,c){var o;return Object(l.a)(this,s),(o=t.call(this)).type="dictionary",o._groupIdCache=new b.a(100),o._loader=e,o._fieldMap=e.fieldMap,o._symbolFields=e.getSymbolFields(),o._templates=r,o._info=n,o._scaleFn=i,o._schemaUtilsModule=a,o._symbolOptions=c,o}return Object(h.a)(s,[{key:"_analyzeFeature",value:function(){var e=Object(f.a)(d.a.mark((function e(t,r,n,s,c){var o,u,l,h,f,v,p,b,m=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=t.readLegacyFeature(),u=this._scaleFn(o,n,s),l=this._attributeHash(o)+"-"+u,!(h=this._groupIdCache.get(l))){e.next=3;break}return e.abrupt("return",h);case 3:return f=Object(i.a)(Object(i.a)({},s),{},{spatialReference:this._info.spatialReference,abortOptions:c,fields:this._info.fields}),e.next=6,this._loader.getSymbolAsync(o,f);case 6:return v=e.sent,p=this._schemaUtilsModule.createSymbolSchema(v,this._symbolOptions),b=Object(x.b)(p,this._info,r,c).then((function(e){if("expanded-cim"!==e.type)return g.error(new y.a("mapview-bad-type","Found unexpected type ".concat(e.type," in dictionary response"))),null;e.hash+="-"+u;var t,r=Object(a.a)(e.layers);try{for(r.s();!(t=r.n()).done;){var n=t.value;n.scaleFactor=u,n.templateHash+="-"+u}}catch(i){r.e(i)}finally{r.f()}return m._templates.createTemplateGroup(e,null)})),e.abrupt("return",(this._groupIdCache.put(l,b,1),b));case 10:case"end":return e.stop()}}),e,this)})));return function(t,r,n,i,a){return e.apply(this,arguments)}}()},{key:"analyze",value:function(){var e=Object(f.a)(d.a.mark((function e(t,r,n,i,a,s){var c,o;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(c=r.getCursor(),o=[];c.next();)o.push(this._analyzeFeature(c,n,i,a,s));return e.abrupt("return",Promise.all(o));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r,n,i,a,s){return e.apply(this,arguments)}}()},{key:"match",value:function(e,t,r,n,i){return null}},{key:"_attributeHash",value:function(e){var t,r="",n=Object(a.a)(this._symbolFields);try{for(n.s();!(t=n.n()).done;){var i=t.value,s=this._fieldMap[i];s&&(r+=e.attributes[s]+"-")}}catch(c){n.e(c)}finally{n.f()}return r}}],[{key:"fromDictionaryRenderer",value:function(){var e=Object(f.a)(d.a.mark((function e(t,i,a,c){var o,u,l,h,f,v;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([Promise.resolve().then(r.bind(null,479)),P()]);case 2:return o=e.sent,u=Object(n.a)(o,2),l=u[0].DictionaryLoader,h=u[1],f=new l(t.url,t.config,t.fieldMap),e.next=9,f.fetchResources({spatialReference:a.spatialReference,fields:a.fields});case 9:return e.next=11,T(t.scaleExpression,a);case 11:return v=e.sent,e.abrupt("return",new s(f,i,a,v,h,t.symbolOptions));case 13:case"end":return e.stop()}}),e)})));return function(t,r,n,i){return e.apply(this,arguments)}}()}]),s}(M)},398:function(e,t,r){"use strict";r.d(t,"a",(function(){return m}));var n=r(7),i=r(142),a=r(143),s=(r(447),r(359),r(241)),c=(r(412),r(424),r(158)),o=r(212),u=r(157),l=r(165),h=new Map;h.set(u.d.MARKER,{multiplier:1,indicesPerRecord:6,verticesPerRecord:4}),h.set(u.d.LINE,{multiplier:1,indicesPerRecord:24,verticesPerRecord:8}),h.set(u.d.FILL,{multiplier:1,indicesPerRecord:10,verticesPerRecord:10}),h.set(u.d.TEXT,{multiplier:8,indicesPerRecord:6,verticesPerRecord:4}),h.set(u.d.LABEL,{multiplier:8,indicesPerRecord:6,verticesPerRecord:4});var f=r(284),v=function(){function e(t,r,n){Object(i.a)(this,e),this._start={index:0,vertex:0};var a=function(e,t,r){var n=h.get(e),i=n.indicesPerRecord,a=n.multiplier,s=n.verticesPerRecord;return{recordBytes:r*c.q*Uint32Array.BYTES_PER_ELEMENT,indexBytes:a*i*r*Uint32Array.BYTES_PER_ELEMENT,vertexBytes:a*s*r*t}}(t,r,n),s=r/4;this.geometryType=t,this._records=new f.a(Int32Array,a.recordBytes),this._indices=new f.a(Uint32Array,a.indexBytes),this._vertices=new f.a(Uint32Array,a.vertexBytes),this._metrics=new f.a(Float32Array,0),this._strideInt=s}return Object(a.a)(e,[{key:"serialize",value:function(e){var t=this._records.buffer(),r=this._indices.buffer(),n=this._vertices.buffer(),i=this._metrics.length?this._metrics.buffer():null,a=4*this._strideInt;return e.push(t,r,n),{stride:a,records:t,indices:r,vertices:n,metrics:i}}},{key:"strideInt",get:function(){return this._strideInt}},{key:"recordCount",get:function(){return this._records.length/c.q}},{key:"vertexCount",get:function(){return this._vertices.length/this._strideInt}},{key:"indexCount",get:function(){return this._indices.length}},{key:"indexWriter",get:function(){return this._indices}},{key:"vertexWriter",get:function(){return this._vertices}},{key:"metricWriter",get:function(){return this._metrics}},{key:"vertexEnsureSize",value:function(e){this._vertices.ensureSize(e)}},{key:"indexEnsureSize",value:function(e){this._indices.ensureSize(e)}},{key:"recordStart",value:function(){this._start.index=this._indices.length,this._start.vertex=this._vertices.length}},{key:"recordEnd",value:function(e,t,r,n,i,a,s,c){this._records.push(e),this._records.push(t),this._records.push(r),this._records.push(n),this._records.push(i),this._records.push(a),this._records.push(s),this._records.writeF32(c)}},{key:"writeIndex",value:function(e){this._indices.push(e)}},{key:"writeVertex",value:function(e){this._vertices.push(e)}},{key:"writeVertexF32",value:function(e){this._vertices.writeF32(e)}},{key:"copyLastFrom",value:function(e,t,r){for(var n=e._records.length-c.q,i=e._records.getValue(n),a=e._records.getValue(n+1),s=e._records.getValue(n+2),o=e._records.getValue(n+4),u=e._records.getValue(n+6),l=e._records.getValue(n+7),h=this._vertices.length,f=(e._start.vertex-this._vertices.length)/this._strideInt,v=this._indices.length,d=this.vertexCount,y=e._start.index;y!==e._indices.length;y++){var p=e._indices.getValue(y);this._indices.push(p-f)}for(var b=e._start.vertex;b!==e._vertices.length;b++){var m=e._vertices.getValue(b);this._vertices.push(m)}for(var _=h;_<=this._vertices.length;_+=this._strideInt)this._vertices.i1616Add(_,t,r);this._records.push(i),this._records.push(a),this._records.push(s),this._records.push(v),this._records.push(o),this._records.push(d),this._records.push(u),this._records.push(l)}}]),e}(),d=r(368),y=128;function p(e){switch(e){case 1:case 8:case 32:return-1;case 2:case 64:return 0;case 4:case 16:case y:return 1}}function b(e){switch(e){case 1:case 2:case 4:return-1;case 8:case 16:return 0;case 32:case 64:case y:return 1}}var m=function(){function e(t,r,n,a,s){var c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;Object(i.a)(this,e),this._hasAggregate=!1,this.hasRecords=!1,this._data={self:new Map,neighbors:new Array},this._version=0,this._current={geometryType:0,writer:null,overlaps:0,start:0,insertAfter:0,sortKey:0,id:0,materialKey:0,indexStart:0,vertStart:0,isDotDensity:!1,bufferingEnabled:!1,metricBoxLenPointer:0},this.hint=r,this.tileKey=t,this._hasAggregate=a,this._pixelBufferEnabled=s,this._version=c,this._symbologyType=n}return Object(a.a)(e,[{key:"hasAggregates",get:function(){return this._hasAggregate}},{key:"hasPixelBufferEnabled",get:function(){return this._pixelBufferEnabled}},{key:"serialize",value:function(e){var t=this,r=[];return r.push(this._serializeTileVertexData(this.tileKey,this.tileKey,this._data.self)),this._data.neighbors.forEach((function(n,i){var a=1<<i,c=p(a),o=b(a),u=Object(d.a)(new s.a(t.tileKey),c,o,e),l=t._serializeTileVertexData(t.tileKey,u.id,n.vertexData);l.message.bufferIds=n.displayIds,r.push(l)})),r}},{key:"_serializeTileVertexData",value:function(e,t,r){var i,a,s,c,o,l,h=new Array;return{message:{tileKeyOrigin:e,tileKey:t,data:(l={},Object(n.a)(l,u.d.MARKER,null===(i=r.get(u.d.MARKER))||void 0===i?void 0:i.serialize(h)),Object(n.a)(l,u.d.FILL,null===(a=r.get(u.d.FILL))||void 0===a?void 0:a.serialize(h)),Object(n.a)(l,u.d.LINE,null===(s=r.get(u.d.LINE))||void 0===s?void 0:s.serialize(h)),Object(n.a)(l,u.d.TEXT,null===(c=r.get(u.d.TEXT))||void 0===c?void 0:c.serialize(h)),Object(n.a)(l,u.d.LABEL,null===(o=r.get(u.d.LABEL))||void 0===o?void 0:o.serialize(h)),l),version:this._version},transferList:h}}},{key:"featureStart",value:function(e,t){this._current.insertAfter=e,this._current.sortKey=t}},{key:"featureEnd",value:function(){}},{key:"recordStart",value:function(e,t,r,n){this._current.writer=this._getVertexWriter(r),this._current.overlaps=0,this._current.indexStart=this._current.writer.indexCount,this._current.vertStart=this._current.writer.vertexCount,this._current.bufferingEnabled=n,this._current.id=e,this._current.materialKey=t,this._current.geometryType=r,this._current.isDotDensity=!1,this._current.writer.recordStart()}},{key:"recordCount",value:function(){return this._current.writer.recordCount}},{key:"vertexCount",value:function(){return this._current.writer.vertexCount}},{key:"indexCount",value:function(){return this._current.writer.indexCount}},{key:"vertexEnsureSize",value:function(e){this._current.writer.vertexEnsureSize(e)}},{key:"indexEnsureSize",value:function(e){this._current.writer.indexEnsureSize(e)}},{key:"vertexBounds",value:function(e,t,r,n){this._current.bufferingEnabled&&this._addOverlap(e,t,r,n)}},{key:"vertexWrite",value:function(e){this._current.writer.writeVertex(e)}},{key:"vertexWriteF32",value:function(e){this._current.writer.writeVertexF32(e)}},{key:"vertexEnd",value:function(){}},{key:"vertexWriter",value:function(){return this._current.writer.vertexWriter}},{key:"indexWrite",value:function(e){this._current.writer.writeIndex(e)}},{key:"indexWriter",value:function(){return this._current.writer.indexWriter}},{key:"metricWriter",value:function(){return this._current.writer.metricWriter}},{key:"metricStart",value:function(e,t,r,n,i,a,s,c){this._current.writer=this._getVertexWriter(u.d.LABEL);var l=this._current.writer.metricWriter;l.push(Object(o.f)(e)),l.push(t),l.push(r),l.push(n),l.push(i),l.push(a),l.push(s),l.push(c),l.push(255),this._current.metricBoxLenPointer=l.push(0)}},{key:"metricEnd",value:function(){var e=this._current.writer.metricWriter;0===e.getValue(this._current.metricBoxLenPointer)&&e.seek(e.length-10)}},{key:"metricBoxWrite",value:function(e,t,r,n){var i=this._current.writer.metricWriter;i.incr(this._current.metricBoxLenPointer),i.push(0),i.push(0),i.push(e),i.push(t),i.push(r),i.push(n)}},{key:"recordEnd",value:function(){var e=this._current.vertStart,t=this._current.writer.vertexCount-e;if(!t)return!1;this.hasRecords=!0;var r=this._current.indexStart,n=this._current.writer.indexCount-r;if(this._current.writer.recordEnd(this._current.id,this._current.materialKey,this._current.insertAfter,r,n,e,t,this._current.sortKey),!this._pixelBufferEnabled||this._hasAggregate||0===this._current.overlaps||this._current.geometryType===u.d.LABEL)return!0;for(var i=this._current.writer,a=0;a<8;a++){var s=1<<a;if(this._current.overlaps&s){this._data.neighbors[a]||(this._data.neighbors[a]={vertexData:new Map,displayIds:new Set});var o=this._data.neighbors[a],h=this._current.geometryType;if(!o.vertexData.has(h)){var f=Object(l.n)(h,this._symbologyType).geometry,d=new v(h,f,c.B);o.vertexData.set(h,d)}var y=o.vertexData.get(this._current.geometryType),m=512*-p(s)*8,_=512*-b(s)*8;y.copyLastFrom(i,m,_),o.displayIds.add(this._current.id)}}return!0}},{key:"_addOverlap",value:function(e,t,r,n){var i=255^((e<0+r?148:e>=c.V-r?41:189)|(t<0+n?224:t>=c.V-n?7:231));this._current.overlaps|=i}},{key:"_getVertexWriter",value:function(e){if(!this._data.self.has(e)){var t=this._data.self,r=Object(l.n)(e,this._symbologyType).geometry;t.set(e,new v(e,r,this.hint.records))}return this._data.self.get(e)}}]),e}()},399:function(e,t,r){"use strict";r.d(t,"a",(function(){return Z}));var n=r(155),i=r(60),a=r(142),s=r(143),c=r(154),o=r.n(c),u=(r(147),r(146)),l=r(162),h=r(300),f=r(212),v=r(14),d=r(144),y=r(145),p=r(159),b=r(156),m=r(188),_=r(167),x=r(170),g=r(218),O=r(195),j=r(158),k=r(157),M=r(171),w=r(166),S=r(199);function L(e,t){return e[t+1]}function T(e){return e.length-1}function z(e){for(var t=0,r=0;r<T(e);r++)t+=P(e,r);return t}function P(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=L(e,t),i=Object(v.a)(n,2),a=i[0],s=i[1];return Math.sqrt(a*a+s*s)*r}var I=function(){function e(t,r,n,i,s){Object(a.a)(this,e),this._segments=t,this._index=r,this._distance=n,this._xStart=i,this._yStart=s,this._done=!1}return Object(s.a)(e,[{key:"clone",value:function(){return new e(this._segments,this._index,this._distance,this.xStart,this.yStart)}},{key:"equals",value:function(e){return this._index===e._index||e._index===this._index-1&&(0===this._distance||1===e._distance)||e._index===this._index+1&&(1===this._distance||0===e._distance)}},{key:"leq",value:function(e){return this._index<e._index||this._index===e._index&&this._distance<=e._distance}},{key:"geq",value:function(e){return this._index>e._index||this._index===e._index&&this._distance>=e._distance}},{key:"_segment",get:function(){return this._segments[this._index+1]}},{key:"angle",get:function(){var e=this.dy,t=(0*e+-1*-this.dx)/(1*this.length),r=Math.acos(t);return e>0&&(r=2*Math.PI-r),r}},{key:"xStart",get:function(){return this._xStart}},{key:"yStart",get:function(){return this._yStart}},{key:"x",get:function(){return this.xStart+this.distance*this.dx}},{key:"y",get:function(){return this.yStart+this.distance*this.dy}},{key:"dx",get:function(){return this._segment[0]}},{key:"dy",get:function(){return this._segment[1]}},{key:"xMidpoint",get:function(){return this.xStart+.5*this.dx}},{key:"yMidpoint",get:function(){return this.yStart+.5*this.dy}},{key:"xEnd",get:function(){return this.xStart+this.dx}},{key:"yEnd",get:function(){return this.yStart+this.dy}},{key:"length",get:function(){var e=this.dx,t=this.dy;return Math.sqrt(e*e+t*t)}},{key:"remainingLength",get:function(){return this.length*(1-this._distance)}},{key:"backwardLength",get:function(){return this.length*this._distance}},{key:"distance",get:function(){return this._distance}},{key:"done",get:function(){return this._done}},{key:"hasPrev",value:function(){return this._index-1>=0}},{key:"hasNext",value:function(){return this._index+1<T(this._segments)}},{key:"next",value:function(){return this.hasNext()?(this._xStart+=this.dx,this._yStart+=this.dy,this._distance=0,this._index+=1,this):null}},{key:"prev",value:function(){return this.hasPrev()?(this._index-=1,this._xStart-=this.dx,this._yStart-=this.dy,this._distance=1,this):(this._done=!0,null)}},{key:"_seekBackwards",value:function(e,t){var r=this.backwardLength;if(e<=r)return this._distance=(r-e)/this.length,this;for(var n=this.backwardLength;this.prev();){if(n+this.length>e)return this._seekBackwards(e-n);n+=this.length}return this._distance=0,t?this:null}},{key:"seek",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e<0)return this._seekBackwards(Math.abs(e),t);if(e<=this.remainingLength)return this._distance=(this.backwardLength+e)/this.length,this;for(var r=this.remainingLength;this.next();){if(r+this.length>e)return this.seek(e-r,t);r+=this.length}return this._distance=1,t?this:null}}],[{key:"create",value:function(t){return new e(t,0,0,t[0][0],t[0][1])}}]),e}();function E(e,t,r){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=z(e),a=I.create(e),s=i/2;if(!n)return a.seek(s),void r(a.clone(),0,s+0*t,i);var c=Math.max((i-t)/2,0),o=Math.floor(c/t),u=s-o*t;a.seek(u);for(var l=-o;l<=o;l++)a.x<512&&a.x>=0&&a.y<512&&a.y>=0&&r(a.clone(),l,s+l*t,i),a.seek(t)}function C(e,t){var r=1e-6;if(!(t<=0)){var n=e.length;if(!(n<3)){var i=[],a=0;i.push(0);for(var s=1;s<n;s++)a+=Object(S.c)(e[s],e[s-1]),i.push(a);t=Math.min(t,.2*a);var c=[];c.push(e[0][0]),c.push(e[0][1]);var o=e[n-1][0],u=e[n-1][1],l=Object(S.h)([0,0],e[0],e[1]);Object(S.g)(l),e[0][0]+=t*l[0],e[0][1]+=t*l[1],Object(S.h)(l,e[n-1],e[n-2]),Object(S.g)(l),e[n-1][0]+=t*l[0],e[n-1][1]+=t*l[1];for(var h=1;h<n;h++)i[h]+=t;i[n-1]+=t;for(var f=.5*t,v=1;v<n-1;v++){for(var d=0,y=0,p=0,b=v-1;b>=0&&!(i[b+1]<i[v]-f);b--){var m=f+i[b+1]-i[v],_=i[b+1]-i[b],x=i[v]-i[b]<f?1:m/_;if(Math.abs(x)<r)break;var g=x*x,O=x*m-.5*g*_,j=x*_/t,k=e[b+1],M=e[b][0]-k[0],w=e[b][1]-k[1];d+=j/O*(k[0]*x*m+.5*g*(m*M-_*k[0])-g*x*_*M/3),y+=j/O*(k[1]*x*m+.5*g*(m*w-_*k[1])-g*x*_*w/3),p+=j}for(var L=v+1;L<n&&!(i[L-1]>i[v]+f);L++){var T=f-i[L-1]+i[v],z=i[L]-i[L-1],P=i[L]-i[v]<f?1:T/z;if(Math.abs(P)<r)break;var I=P*P,E=P*T-.5*I*z,C=P*z/t,V=e[L-1],A=e[L][0]-V[0],R=e[L][1]-V[1];d+=C/E*(V[0]*P*T+.5*I*(T*A-z*V[0])-I*P*z*A/3),y+=C/E*(V[1]*P*T+.5*I*(T*R-z*V[1])-I*P*z*R/3),p+=C}c.push(d/p),c.push(y/p)}c.push(o),c.push(u);for(var W=0,F=0;W<n;W++)e[W][0]=c[F++],e[W][1]=c[F++]}}}var V=r(320),A=b.a.getLogger("esri.views.2d.engine.webgl.WGLLabelTemplate");var R=function(e){var t=new Map;return function(r){return t.has(r)||t.set(r,e(r)),t.get(r)}}((function(e){var t=0;if(0===e)return 1/0;for(;!(e%2);)t++,e/=2;return t})),W=function(e){return Math.floor(127*e+127)},F=function(e){return Math.floor(10*e)},B=function(e){return Math.round(e*(254/360))},D=function(e){Object(d.a)(r,e);var t=Object(y.a)(r);function r(e,n,i,s){var c,o,u,l;Object(a.a)(this,r),(l=t.call(this,e,i.font.size,i.haloSize||0,i.font.size,i.color&&Object(O.d)(i.color)||0,i.haloColor&&Object(O.d)(i.haloColor)||0,i.horizontalAlignment,i.verticalAlignment,Object(g.i)(n.labelPlacement)?x.a.MAP:x.a.SCREEN,i.font.decoration,!1,i.angle||0,i.xoffset,i.yoffset,i.lineWidth,i.lineHeight,null,null,null,null,null))._outLineLabelAngle=0,l._refPlacementPadding=0,l._refPlacementDirX=0,l._refPlacementDirY=0,l._refOffsetX=0,l._refOffsetY=0,l._zoomLevel=0,l.geometryType=k.d.LABEL,l._allowOverrun=null!==(c=n.allowOverrun)&&void 0!==c&&c,l._repeatLabel=null===(o=n.repeatLabel)||void 0===o||o,l._labelPosition=null!==(u=n.labelPosition)&&void 0!==u?u:"curved";var h=function(e,t){var r=!!e.minScale&&t.scaleToZoom(e.minScale)||0;return Object(m.d)(r,0,25.5)}(n,s),f=function(e,t){var r=!!e.maxScale&&t.scaleToZoom(e.maxScale)||255;return Object(m.d)(r,0,25.5)}(n,s),d=n.labelPlacement,y=Object(g.c)(d),p=Object(v.a)(y,2),b=p[0],M=p[1];l._xAlignD=b,l._yAlignD=M,l._minZoom=h,l._maxZoom=f,l._refPlacementPadding=Object(_.c)(i.haloSize)+j.T,l._repeatLabelDistance=n.repeatLabelDistance?Object(_.c)(n.repeatLabelDistance):128;var S=w.b.load(e);return S.sdf=!0,l._materialKey=S.data,l}return Object(s.a)(r,[{key:"_shapedBox",get:function(){return Object(u.q)(this._shapingInfo).bounds}},{key:"setZoomLevel",value:function(e){this._zoomLevel=e}},{key:"bindReferenceTemplate",value:function(e){var t=Object(g.f)(this._xAlignD),r=Object(g.h)(this._yAlignD);if(this._refOffsetX=0,this._refOffsetY=0,Object(u.j)(e))this._refSymbolAndPlacementOffset=Object(M.b)(0,0,W(t),W(r));else{if("circle"===e.boundsType&&(t||r)){var n=Math.sqrt(t*t+r*r);t/=n,r/=n}var i=Math.max(e.height,e.width),a=4*this._refPlacementPadding;this._refSymbolAndPlacementOffset=Object(M.b)(a,i,W(t),W(r)),this._referenceSize=i,this._refPlacementDirX=t,this._refPlacementDirY=r,this._refOffsetX=e.xOffset,this._refOffsetY=e.yOffset}}},{key:"_write",value:function(e,t){if(!Object(u.j)(this._shapingInfo)){var r=this._shapingInfo,n=t.getDisplayId(),i="esriGeometryPolygon"===t.geometryType?t.readLegacyCentroid():t.readLegacyGeometry();if(i)switch(this.current={out:e,inId:n,inShaping:r,zoomLevel:this._zoomLevel},t.geometryType){case"esriGeometryPolyline":this._placeLineLabels(i);break;case"esriGeometryPoint":case"esriGeometryPolygon":this._placePointLabels(i);break;default:!function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"mapview-labeling";A.error(new p.a(t,e))}("mapview-labeling","Geometry of type ".concat(t.geometryType," is not supported"))}}}},{key:"_isVisible",value:function(e,t){var r=F(this.current.zoomLevel);return F(e)<=r&&r<=F(t)}},{key:"_placePointLabels",value:function(e){var t=this.current,r=t.out,n=t.inId,i=t.inShaping;this._writeGlyphs(r,n,e,i)}},{key:"_placeLineLabels",value:function(e){var t,r=function(e,t){for(var r=t,n=0;n<e.length;n++){var i=e[n],a=[];a.push(i[0]);for(var s=1;s<i.length;s++){var c=Object(v.a)(a[s-1],2),o=c[0],u=c[1];o+=i[s][0],u+=i[s][1],a.push([o,u])}C(a,r);var l=[];l.push(a[0]);for(var h=1;h<a.length;h++){var f=Object(v.a)(a[h-1],2),d=f[0],y=f[1],p=Object(v.a)(a[h],2),b=p[0],m=p[1],_=Math.round(b-d),x=Math.round(m-y);l.push([_,x])}e[n]=l,i=l}return e}(e.paths,this.current.inShaping.bounds.width),n=this._placeSubdivGlyphs.bind(this),a=(this._shapedBox.width+this._repeatLabelDistance)/2,s=Object(i.a)(r);try{for(s.s();!(t=s.n()).done;){E(t.value,a,n,this._repeatLabel)}}catch(c){s.e(c)}finally{s.f()}}},{key:"_placeSubdivGlyphs",value:function(e,t,r,n){var i=R(t),a=this._shapedBox.width/2,s=Math.sqrt(this._repeatLabelDistance)/2,c=Math.min(r,n-r),o=this.current.inShaping.isMultiline?25:Math.log2(c/(s+a/2)),u=0===t?o:Math.min(i,o),l=Math.max(this._minZoom,this.current.zoomLevel+1-u),h=this.current.zoomLevel-l,f=this._shapedBox.width/2*Math.pow(2,h);this.current.inShaping.isMultiline?0===t&&this._placeStraight(e,l):this._allowOverrun&&h<0?this._placeStraightAlong(e,this._minZoom):"parallel"===this._labelPosition?this._placeStraightAlong(e,l):"curved"===this._labelPosition&&this._placeCurved(e,l,f)}},{key:"_placeStraight",value:function(e,t){var r=this.current,n=r.out,i=r.inId,a=r.inShaping,s=Math.ceil(e.angle*(180/Math.PI)%360),c=Math.ceil((e.angle*(180/Math.PI)+180)%360);this._outLineLabelAngle=B(s),this._writeGlyphs(n,i,e,a,t),this._outLineLabelAngle=B(c),this._writeGlyphs(n,i,e,a,t)}},{key:"_placeCurved",value:function(e,t,r){var n=this.current,i=n.out,a=n.inId;i.metricStart(a,t,e.x,e.y,0,0,0,0);var s=e.clone(),c=e.angle*(180/Math.PI)%360,o=(e.angle*(180/Math.PI)+180)%360;this._outLineLabelAngle=B(c),this._placeFirst(s,t,1),this._placeBack(e,s,t,r,1),this._placeForward(e,s,t,r,1),this._outLineLabelAngle=B(o),this._placeFirst(s,t,0),this._placeBack(e,s,t,r,0),this._placeForward(e,s,t,r,0),i.metricEnd()}},{key:"_placeStraightAlong",value:function(e,t){var r=this.current,n=r.out,i=r.inId;n.metricStart(i,t,e.x,e.y,0,0,0,0);var a=e.clone(),s=e.angle*(180/Math.PI)%360,c=(e.angle*(180/Math.PI)+180)%360;this._outLineLabelAngle=B(s),this._placeFirst(a,t,1,!0),this._outLineLabelAngle=B(c),this._placeFirst(a,t,0,!0),n.metricEnd()}},{key:"_placeBack",value:function(e,t,r,n,i){for(var a=e.clone(),s=e.backwardLength+0;a.prev()&&!(s>=n);)this._placeOnSegment(a,t,s,r,-1,i),s+=a.length+0}},{key:"_placeForward",value:function(e,t,r,n,i){for(var a=e.clone(),s=e.remainingLength+0;a.next()&&!(s>=n);)this._placeOnSegment(a,t,s,r,1,i),s+=a.length+0}},{key:"_placeFirst",value:function(e,t,r){var n,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=e,c=this.current.inShaping,o=c.glyphs,u=this.current.zoomLevel,l=this.current,h=l.out,f=l.inId,v=Object(i.a)(o);try{for(v.s();!(n=v.n()).done;){var d=n.value,y=d.x>c.bounds.x?r:1-r,p=y*e.remainingLength+(1-y)*e.backwardLength,b=Math.abs(d.x+d.width/2-c.bounds.x),m=Math.max(0,u+Math.log2(b/(p+0))),_=Math.max(t,a?0:m);if(d.maxZoom=25,d.angle=e.angle+(1-r)*Math.PI,d.minZoom=_,this._writeGlyph(h,f,s.x,s.y,d),r&&this._isVisible(d.minZoom,d.maxZoom)){var x=d.bounds;h.metricBoxWrite(x.center[0],x.center[1],x.width,x.height)}}}catch(g){v.e(g)}finally{v.f()}}},{key:"_placeOnSegment",value:function(e,t,r,n,a,s){var c,o=this.current.inShaping.glyphs,u=this.current,l=u.out,h=u.inId,f=this.current.inShaping,v=this.current.zoomLevel,d=e.dx/e.length,y=e.dy/e.length,p={x:e.x+r*-a*d,y:e.y+r*-a*y},b=Object(i.a)(o);try{for(b.s();!(c=b.n()).done;){var m=c.value,_=m.x>f.bounds.x?s:1-s;if(_&&1===a||!_&&-1===a){var x=Math.abs(m.x+m.width/2-f.bounds.x),g=Math.max(0,v+Math.log2(x/r)-.1),O=Math.max(n,v+Math.log2(x/(r+e.length+0)));if(0!==g&&(m.angle=e.angle+(1-s)*Math.PI,m.minZoom=O,m.maxZoom=g,this._writeGlyph(l,h,p.x,p.y,m),s&&this._isVisible(m.minZoom,m.maxZoom))){var j=m.bounds,k=e.x-t.x,M=e.y-t.y;l.metricBoxWrite(j.center[0]+k,j.center[1]+M,j.width,j.height)}}}}catch(w){b.e(w)}finally{b.f()}}},{key:"_writeGlyphs",value:function(e,t,r,n){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this._minZoom;if(!(r.x<0||r.x>=512||r.y<0||r.y>=512)){var s,c=r.x+this._refOffsetX,o=r.y-this._refOffsetY,u=Object(i.a)(n.glyphs);try{for(u.s();!(s=u.n()).done;){var l=s.value;l.minZoom=a,l.maxZoom=this._maxZoom,this._writeGlyph(e,t,c,o,l)}}catch(d){u.e(d)}finally{u.f()}var h=this._refPlacementDirX,f=this._refPlacementDirY,v=n.boundsT;e.metricStart(t,a,c,o,h,f,this._referenceSize,this._materialKey),e.metricBoxWrite(v.center[0],v.center[1],v.width,v.height),e.metricEnd()}}},{key:"_writeVertexCommon",value:function(e,t,r,n){var i=this._color,a=this._haloColor,s=Object(M.b)(0,0,this._size,this._haloSize),c=Math.max(n.minZoom,this._minZoom),o=Math.min(n.maxZoom,this._maxZoom),u=Object(M.b)(F(c),F(o),this._outLineLabelAngle,0);e.vertexWrite(r),e.vertexWrite(t),e.vertexWrite(i),e.vertexWrite(a),e.vertexWrite(s),e.vertexWrite(this._refSymbolAndPlacementOffset),e.vertexWrite(u)}}],[{key:"fromLabelClass",value:function(e,t){if("esriServerLinePlacementCenterAlong"===e.labelPlacement){var n=e.symbol;n.xoffset=0,n.yoffset=0,n.angle=0,n.font.decoration="none"}return new r(e.materialKey,e,e.symbol,t)}}]),r}(V.a),K=r(324),G=r(328),Z=function(){function e(t,r,n){Object(a.a)(this,e),this._loadPromise=Object(h.a)(),this._geometryType=t,this._idField=r,this._templateStore=n}return Object(s.a)(e,[{key:"update",value:function(e,t){Object(u.k)(e.mesh.labels)&&(this._labelTemplates=this._createLabelTemplates(e.mesh.labels,t)),this._schema=e}},{key:"_createLabelTemplates",value:function(e,t){var r=new Map;if("simple"===e.type){var n,a=Object(i.a)(e.classes);try{for(a.s();!(n=a.n()).done;){var s=n.value,c=D.fromLabelClass(s,t);r.set(s.index,c)}}catch(d){a.e(d)}finally{a.f()}return r}for(var o in e.classes){var u,l=e.classes[o],h=Object(i.a)(l);try{for(h.s();!(u=h.n()).done;){var f=u.value,v=D.fromLabelClass(f,t);r.set(f.index,v)}}catch(d){h.e(d)}finally{h.f()}}return r}},{key:"templates",get:function(){return this._templateStore}},{key:"analyze",value:function(){var e=Object(n.a)(o.a.mark((function e(t,r,n,a,s,c,h){var v,d,y,p,b,m,_;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Object(l.k)(h)){e.next=2;break}return e.abrupt("return");case 2:if(e.t0="dictionary"===n.type,!e.t0){e.next=7;break}return e.next=6,n.analyze(this._idField,t.copy(),r,s,c,h);case 6:v=e.sent;case 7:for(d=0;t.next();)if(void 0,y=v?v[d++]:Object(u.k)(a)&&Object(f.h)(t.getDisplayId())&&1!==t.readAttribute("cluster_count")?a.match(this._idField,t,this._geometryType,s,c):n.match(this._idField,t,this._geometryType,s,c),t.setGroupId(y),Object(G.b)(y)){p=this._templateStore.getDynamicTemplateGroup(y),b=Object(i.a)(p);try{for(b.s();!(m=b.n()).done;)(_=m.value)&&_.analyze&&_.analyze(this._templateStore,t,s,c)}catch(o){b.e(o)}finally{b.f()}}return e.next=11,this._loadPromise;case 11:return e.abrupt("return",this._templateStore.finalize(h));case 12:case"end":return e.stop()}}),e,this)})));return function(t,r,n,i,a,s,c){return e.apply(this,arguments)}}()},{key:"analyzeGraphics",value:function(){var e=Object(n.a)(o.a.mark((function e(t,r,n,a,s,c){var u,h,f,v,d,y;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Object(l.k)(c)){e.next=2;break}return e.abrupt("return");case 2:if(u=t.getCursor(),e.t0=n,!e.t0){e.next=7;break}return e.next=7,n.analyze(this._idField,u.copy(),r,a,s,c);case 7:if(!u.next()){e.next=13;break}if(null!=(h=u.getGroupId())&&-1!==h||(h=n.match(this._idField,u,u.geometryType,a,s),u.setGroupId(h)),Object(G.b)(h)){f=this._templateStore.getDynamicTemplateGroup(h),v=Object(i.a)(f);try{for(v.s();!(d=v.n()).done;)(y=d.value)&&y.analyze&&y.analyze(this._templateStore,u,a,s)}catch(o){v.e(o)}finally{v.f()}}u.setGroupId(h);case 11:e.next=7;break;case 13:return e.next=15,this._loadPromise;case 15:return e.abrupt("return",this._templateStore.finalize(c));case 16:case"end":return e.stop()}}),e,this)})));return function(t,r,n,i,a,s){return e.apply(this,arguments)}}()},{key:"writeGraphic",value:function(e,t,r,n){var a=t.getGroupId(),s=t.getDisplayId(),c=this._templateStore.getTemplateGroup(a);if(e.featureStart(t.insertAfter,0),null!=s){if(Object(G.b)(a)){var o,u=Object(i.a)(c);try{for(u.s();!(o=u.n()).done;){var l=o.value;l&&l.bindFeature(t,null,null)}}catch(d){u.e(d)}finally{u.f()}}if(c){var h,f=Object(i.a)(c);try{for(f.s();!(h=f.n()).done;){var v=h.value;v&&v.write(e,t,r,n)}}catch(d){f.e(d)}finally{f.f()}e.featureEnd()}}}},{key:"writeCursor",value:function(e,t,r,n,a,s,c){var o=t.getGroupId(),l=t.getDisplayId(),h=this._templateStore.getTemplateGroup(o),f=this._schema.mesh.sortKey,v=0;if(Object(u.k)(f)&&(v=null!=f.fieldIndex?t.getComputedNumericAtIndex(f.fieldIndex):null!=f.field?t.readAttribute(f.field):t.readAttribute(this._idField),v*="asc"===f.order?1:-1),e.featureStart(0,null==v||isNaN(v)?0:v),null!=l&&h){if(Object(G.b)(o)){var d,y=Object(i.a)(h);try{for(y.s();!(d=y.n()).done;){d.value.bindFeature(t,r,n)}}catch(_){y.e(_)}finally{y.f()}}var p,b=Object(i.a)(h);try{for(b.s();!(p=b.n()).done;){p.value.write(e,t,a,c)}}catch(_){b.e(_)}finally{b.f()}if(Object(u.k)(s)&&e.hasRecords){var m=s&&this._findLabelRef(h);this._writeLabels(e,t,s,m,a,c)}e.featureEnd()}}},{key:"_findLabelRef",value:function(e){var t,r=Object(i.a)(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;if(n instanceof K.a)return n}}catch(a){r.e(a)}finally{r.f()}return null}},{key:"_writeLabels",value:function(e,t,r,n,a,s){var c,o=Object(i.a)(r);try{for(o.s();!(c=o.n()).done;){var l=c.value;if(Object(u.k)(l)&&l){var h=l.glyphs,f=l.rtl,v=l.index,d=this._labelTemplates.get(v);d.setZoomLevel(a),d.bindReferenceTemplate(n),d.bindTextInfo(h,f),d.write(e,t,null,s)}}}catch(y){o.e(y)}finally{o.f()}}}]),e}()},890:function(e,t,r){"use strict";r.d(t,"a",(function(){return f}));var n=r(142),i=r(143),a=r(144),s=r(145),c=r(148),o=r(215),u=r(151),l=(r(152),r(147),r(150),r(149)),h=function(e){Object(a.a)(r,e);var t=Object(s.a)(r);function r(){return Object(n.a)(this,r),t.apply(this,arguments)}return Object(i.a)(r,[{key:"initialize",value:function(){}},{key:"destroy",value:function(){}},{key:"supportsTileUpdates",get:function(){return!1}},{key:"spatialReference",get:function(){var e=this.get("tileStore.tileScheme.spatialReference");return e&&e.toJSON()||null}}]),r}(o.a);Object(c.a)([Object(u.b)({readOnly:!0})],h.prototype,"supportsTileUpdates",null),Object(c.a)([Object(u.b)({constructOnly:!0})],h.prototype,"remoteClient",void 0),Object(c.a)([Object(u.b)({constructOnly:!0})],h.prototype,"service",void 0),Object(c.a)([Object(u.b)()],h.prototype,"spatialReference",null),Object(c.a)([Object(u.b)({constructOnly:!0})],h.prototype,"tileInfo",void 0),Object(c.a)([Object(u.b)({constructOnly:!0})],h.prototype,"tileStore",void 0);var f=h=Object(c.a)([Object(l.a)("esri.views.2d.layers.features.processors.BaseProcessor")],h)}}]);
//# sourceMappingURL=66.e26981e8.chunk.js.map