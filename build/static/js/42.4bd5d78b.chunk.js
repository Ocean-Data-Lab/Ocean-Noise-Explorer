(this["webpackJsonpmatx-react-pro"]=this["webpackJsonpmatx-react-pro"]||[]).push([[42],{1269:function(e,t,r){"use strict";r.r(t),r.d(t,"save",(function(){return Z})),r.d(t,"saveAll",(function(){return te})),r.d(t,"saveAs",(function(){return re}));var a=r(16),n=r(60),u=r(155),c=r(154),o=r.n(c),s=r(152),i=r(159),l=r(156),p=r(146),f=r(162),d=r(695),y=r(404),b=r(1196),m=r(372),v=r(802),h=r(276),x=r(434),w=r(627),O=r(622),j=l.a.getLogger("esri.layers.FeatureLayer"),k="Feature Service";function I(e,t){return"Layer (title: ".concat(e.title,", id: ").concat(e.id,") of type '").concat(e.declaredClass,"' ").concat(t)}function S(e,t){if(t.type!==k)throw new i.a("feature-layer:portal-item-wrong-type",I(e,'should have portal item of type "'.concat(k,'"')))}function g(e){return J.apply(this,arguments)}function J(){return(J=Object(u.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.load();case 2:if(!Object(v.a)(t)){e.next=4;break}throw new i.a("feature-layer:save",I(t,"using an in-memory source cannot be saved to a portal item"));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function P(e,t){var r=e.messages.filter((function(e){return"error"===e.type})).map((function(e){var t=e.name,r=e.message,a=e.details;return new i.a(t,r,a)}));if(null!==t&&void 0!==t&&t.ignoreUnsupported&&(r=r.filter((function(e){var t=e.name;return"layer:unsupported"!==t&&"symbol:unsupported"!==t&&"symbol-layer:unsupported"!==t&&"property:unsupported"!==t&&"url:unsupported"!==t}))),r.length>0)throw new i.a("feature-layer:save","Failed to save feature layer due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:r})}function A(e,t,r){return N.apply(this,arguments)}function N(){return(N=Object(u.a)(o.a.mark((function e(t,r,a){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0="beforeSave"in t&&"function"==typeof t.beforeSave,!e.t0){e.next=4;break}return e.next=4,t.beforeSave();case 4:return n=t.write({},r),e.abrupt("return",(P(r,a),n));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(e){var t=e.layer,r=e.layerJSON;return t.isTable?{layers:[],tables:[r]}:{layers:[r],tables:[]}}function E(e){Object(O.b)(e,O.a.JSAPI),e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter((function(e,t,r){return r.indexOf(e)===t})))}function L(e){var t=e.portalItem;if(!t)throw j.error("save: requires the portalItem property to be set"),new i.a("feature-layer:portal-item-not-set",I(e,"requires the portalItem property to be set"));if(!t.loaded)throw new i.a("feature-layer:portal-item-not-loaded",I(e,"cannot be saved to a portal item that does not exist or is inaccessible"));S(e,t)}function K(e,t){return D.apply(this,arguments)}function D(){return(D=Object(u.a)(o.a.mark((function e(t,r){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",/\/\d+\/?$/.test(t.url)?T(r[0]):F(t,r));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function F(e,t){return R.apply(this,arguments)}function R(){return(R=Object(u.a)(o.a.mark((function e(t,r){var a,u,c,s,i,l,p,f;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r[0].layer,u=a.url,c=a.customParameters,s=a.apiKey,e.next=3,t.fetchData("json");case 3:if(i=e.sent,e.t0=i&&null!=i.layers&&null!=i.tables,e.t0){e.next=9;break}return e.next=8,U(i,{url:u,customParameters:c,apiKey:s},r.map((function(e){return e.layer.layerId})));case 8:i=e.sent;case 9:l=Object(n.a)(r);try{for(l.s();!(p=l.n()).done;)Y((f=p.value).layer,f.layerJSON,i)}catch(o){l.e(o)}finally{l.f()}return e.abrupt("return",i);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function U(e,t,r){return M.apply(this,arguments)}function M(){return(M=Object(u.a)(o.a.mark((function e(t,r,n){var u,c,s,i,l,p,f,d,y,m,v,h;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t||(t={}),(u=t).layers||(u.layers=[]),(c=t).tables||(c.tables=[]),s=r.url,i=r.customParameters,l=r.apiKey,e.next=6,Object(b.fetchFeatureService)(s,{customParameters:i,apiKey:l});case 6:return p=e.sent,f=p.serviceJSON,d=p.layersJSON,y=_(t.layers,f.layers,n),m=_(t.tables,f.tables,n),t.layers=y.itemResources,t.tables=m.itemResources,v=[].concat(Object(a.a)(y.added),Object(a.a)(m.added)),h=d?[].concat(Object(a.a)(d.layers),Object(a.a)(d.tables)):[],e.next=15,q(t,v,s,h);case 15:return e.abrupt("return",t);case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _(e,t,r){var a=Object(s.c)(e,t,(function(e,t){return e.id===t.id}));e=e.filter((function(e){return!a.removed.some((function(t){return t.id===e.id}))}));var n=a.added.map((function(e){return{id:e.id}}));return n.forEach((function(t){var r=t.id;e.push({id:r})})),{itemResources:e,added:n.filter((function(e){var t=e.id;return!r.includes(t)}))}}function q(e,t,r,a){return z.apply(this,arguments)}function z(){return(z=Object(u.a)(o.a.mark((function e(t,r,a,n){var u;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=r.map((function(e){var t=e.id;return new y.default({url:a,layerId:t,sourceJSON:n.find((function(e){return e.id===t}))})})),e.next=3,Object(f.g)(u.map((function(e){return e.load()})));case 3:u.forEach((function(e){var r=e.layerId,a=e.loaded,n=e.defaultPopupTemplate;a&&!Object(p.j)(n)&&Y(e,{id:r,popupInfo:n.toJSON()},t)}));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Y(e,t,r){e.isTable?B(r.tables,t):B(r.layers,t)}function B(e,t){var r=e.findIndex((function(e){return e.id===t.id}));-1===r?e.push(t):e[r]=t}function C(e){var t=e.portalItem;return Object(v.b)(e)&&!e.dynamicDataSource&&!(null===t||void 0===t||!t.loaded)&&t.type===k}function G(e){return $.apply(this,arguments)}function $(){return($=Object(u.a)(o.a.mark((function e(t){var r,a,u,c,s;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==t&&void 0!==t&&t.length){e.next=2;break}throw new i.a("feature-layer-utils-saveall:missing-parameters","'layers' array should contain at least one feature layer");case 2:return e.next=4,Promise.all(t.map((function(e){return e.load()})));case 4:r=Object(n.a)(t),e.prev=5,r.s();case 7:if((a=r.n()).done){e.next=13;break}if(C(u=a.value)){e.next=11;break}throw new i.a("feature-layer-utils-saveall:invalid-parameters","'layers' array should only contain layers or tables in a feature service loaded from 'Feature Service' item. ".concat(I(u,"does not conform")),{layer:u});case 11:e.next=7;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(5),r.e(e.t0);case 18:return e.prev=18,r.f(),e.finish(18);case 21:if(c=t.map((function(e){return e.portalItem.id})),!(new Set(c).size>1)){e.next=24;break}throw new i.a("feature-layer-utils-saveall:invalid-parameters","All layers in the 'layers' array should be loaded from the same portal item");case 24:if(s=t.map((function(e){return e.layerId})),new Set(s).size===s.length){e.next=27;break}throw new i.a("feature-layer-utils-saveall:invalid-parameters","'layers' array should contain only one instance each of layer or table in a feature service");case 27:case"end":return e.stop()}}),e,null,[[5,15,18,21]])})))).apply(this,arguments)}function H(e,t){var r,a,n,u,c=x.default.from(t);return c.id&&((c=c.clone()).id=null),null!==(r=(n=c).type)&&void 0!==r||(n.type=k),null!==(a=(u=c).portal)&&void 0!==a||(u.portal=h.a.getDefault()),S(e,c),c}function Q(e,t){return V.apply(this,arguments)}function V(){return(V=Object(u.a)(o.a.mark((function e(t,r){var a,n,u,c,s,i,l;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.url,n=t.layerId,u=t.title,c=t.fullExtent,s=t.isTable,i=Object(m.f)(a),l=Object(p.k)(i)&&"FeatureServer"===i.serverType,r.url=l?a:"".concat(a,"/").concat(n),r.title||(r.title=u),r.extent=null,e.t0=!s&&Object(p.k)(c),!e.t0){e.next=9;break}return e.next=8,Object(O.c)(c);case 8:r.extent=e.sent;case 9:Object(O.e)(r,O.a.METADATA),Object(O.e)(r,O.a.MULTI_LAYER),Object(O.b)(r,O.a.SINGLE_LAYER),s&&Object(O.b)(r,O.a.TABLE),E(r);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function W(e,t,r){return X.apply(this,arguments)}function X(){return(X=Object(u.a)(o.a.mark((function e(t,r,a){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.portal,e.next=3,n._signIn();case 3:return e.next=5,n.user.addItem({item:t,data:r,folder:null===a||void 0===a?void 0:a.folder});case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Z=Object(f.f)((function(e,t){return ee.apply(this,arguments)}));function ee(){return(ee=Object(u.a)(o.a.mark((function e(t,r){var a,n,u,c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g(t);case 2:return L(t),a=t.portalItem,n=Object(w.b)(a),e.next=7,A(t,n,r);case 7:return u=e.sent,e.next=10,K(a,[{layer:t,layerJSON:u}]);case 10:return c=e.sent,E(a),e.next=14,a.update({data:c});case 14:return Object(d.a)(n),e.abrupt("return",a);case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var te=Object(f.f)(function(){var e=Object(u.a)(o.a.mark((function e(t,r){var a,n,u,c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,G(t);case 2:return a=t[0].portalItem,n=Object(w.b)(a),e.next=6,Promise.all(t.map((function(e){return A(e,n,r)})));case 6:return u=e.sent,e.next=9,K(a,t.map((function(e,t){return{layer:e,layerJSON:u[t]}})));case 9:return c=e.sent,E(a),e.next=13,a.update({data:c});case 13:return e.next=15,Promise.all(t.slice(1).map((function(e){return e.portalItem.reload()})));case 15:return Object(d.a)(n),e.abrupt("return",a.clone());case 17:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()),re=Object(f.f)((function(e,t,r){return ae.apply(this,arguments)}));function ae(){return(ae=Object(u.a)(o.a.mark((function e(t,r,a){var n,u,c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g(t);case 2:return n=H(t,r),u=Object(w.b)(n),e.t0=T,e.t1=t,e.next=8,A(t,u,a);case 8:return e.t2=e.sent,e.t3={layer:e.t1,layerJSON:e.t2},c=(0,e.t0)(e.t3),e.next=13,Q(t,n);case 13:return e.next=15,W(n,c,a);case 15:return t.portalItem=n,Object(d.a)(u),e.abrupt("return",n);case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},627:function(e,t,r){"use strict";r.d(t,"a",(function(){return u})),r.d(t,"b",(function(){return c}));var a=r(183),n=r(276);function u(e){return{origin:"portal-item",url:Object(a.M)(e.itemUrl),portal:e.portal||n.a.getDefault(),portalItem:e,readResourcePaths:[]}}function c(e){return{origin:"portal-item",messages:[],writtenProperties:[],url:e.itemUrl?Object(a.M)(e.itemUrl):null,portal:e.portal||n.a.getDefault(),portalItem:e}}}}]);