(this["webpackJsonpmatx-react-pro"]=this["webpackJsonpmatx-react-pro"]||[]).push([[9],{1019:function(e,t,r){"use strict";r.d(t,"a",(function(){return h}));var n=r(60),i=r(142),a=r(143),s=r(147),u=r(851),c=r(180),o={minX:0,minY:0,maxX:0,maxY:0};function l(e,t,r){(function(e){o.minX=e[0],o.minY=e[1],o.maxX=e[2],o.maxY=e[3]})(t),e.search(o,r)}var h=function(){function e(){var t=this;Object(i.a)(this,e),this._indexInvalid=!1,this._boundsToLoad=[],this._boundsById=new Map,this._idByBounds=new Map,this._index=new u.a(9,Object(s.a)("esri-csp-restrictions")?function(e){return{minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}}:["[0]","[1]","[2]","[3]"]),this._loadIndex=function(){if(t._indexInvalid){var e=new Array(t._idByBounds.size),r=0;t._idByBounds.forEach((function(t,n){e[r++]=n})),t._indexInvalid=!1,t._index.clear(),t._index.load(e)}else t._boundsToLoad.length&&(t._index.load(t._boundsToLoad.filter((function(e){return t._idByBounds.has(e)}))),t._boundsToLoad.length=0)}}return Object(a.a)(e,[{key:"fullBounds",get:function(){if(!this._boundsById.size)return null;var e,t=Object(c.h)(),r=Object(n.a)(this._boundsById.values());try{for(r.s();!(e=r.n()).done;){var i=e.value;i&&(t[0]=Math.min(i[0],t[0]),t[1]=Math.min(i[1],t[1]),t[2]=Math.max(i[2],t[2]),t[3]=Math.max(i[3],t[3]))}}catch(a){r.e(a)}finally{r.f()}return t}},{key:"valid",get:function(){return!this._indexInvalid}},{key:"clear",value:function(){this._indexInvalid=!1,this._boundsToLoad.length=0,this._boundsById.clear(),this._idByBounds.clear(),this._index.clear()}},{key:"delete",value:function(e){var t=this._boundsById.get(e);this._boundsById.delete(e),t&&(this._idByBounds.delete(t),this._indexInvalid||this._index.remove(t))}},{key:"forEachInBounds",value:function(e,t){var r=this;this._loadIndex(),l(this._index,e,(function(e){return t(r._idByBounds.get(e))}))}},{key:"get",value:function(e){return this._boundsById.get(e)}},{key:"has",value:function(e){return this._boundsById.has(e)}},{key:"invalidateIndex",value:function(){this._indexInvalid||(this._indexInvalid=!0,this._boundsToLoad.length=0)}},{key:"set",value:function(e,t){if(!this._indexInvalid){var r=this._boundsById.get(e);r&&(this._index.remove(r),this._idByBounds.delete(r))}this._boundsById.set(e,t),t&&(this._idByBounds.set(t,e),this._indexInvalid||(this._boundsToLoad.push(t),this._boundsToLoad.length>5e4&&this._loadIndex()))}}]),e}()},390:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var n={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsTopFeaturesQuery:!1,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,supportsDefaultSpatialReference:!1,supportsCompactGeometry:!1,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0}},551:function(e,t,r){"use strict";r.d(t,"a",(function(){return T}));var n=r(5),i=r(60),a=r(155),s=r(143),u=r(142),c=r(154),o=r.n(c),l=r(152),h=r(159),f=r(161),d=r(146),p=r(717),y=r(250),m=r(420),b=r(180),v=r(206),x=r(168),g=r(285),_=r(182),j=r(189),O=r(677),k=r(278),S=r(390),w=r(774),I=r(666),R=r(639),B=r(485),F=r(330),M=r(261),Q=r(907);var E="feature-store:unsupported-query",A=new p.b(2e6),C=0,T=function(){function e(t){var r=this;Object(u.a)(this,e),this.capabilities={query:S.a},this.geometryType=t.geometryType,this.hasM=t.hasM,this.hasZ=t.hasZ,this.objectIdField=t.objectIdField,this.spatialReference=t.spatialReference,this.definitionExpression=t.definitionExpression,this.featureStore=t.featureStore,this.aggregateAdapter=t.aggregateAdapter,this._changeHandle=this.featureStore.events.on("changed",(function(){return r.clearCache()})),this.timeInfo=t.timeInfo,t.cacheSpatialQueries&&(this._geometryQueryCache=new p.a(C+++"$$",A)),this.fieldsIndex=new F.a(t.fields),t.scheduler&&t.priority&&(this._frameTask=t.scheduler.registerTask(t.priority))}return Object(s.a)(e,[{key:"destroy",value:function(){this._frameTask=Object(d.p)(this._frameTask),this.clearCache(),Object(d.d)(this._geometryQueryCache),this._changeHandle=Object(d.p)(this._changeHandle),Object(d.d)(this.fieldsIndex)}},{key:"featureAdapter",get:function(){return this.featureStore.featureAdapter}},{key:"fullExtent",get:function(){var e=this.featureStore.fullBounds;return Object(d.j)(e)?null:{xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:Object(B.b)(this.spatialReference)}}},{key:"timeExtent",get:function(){return this.timeInfo?(this._timeExtent||(this._timeExtent=Object(R.a)(this.timeInfo,this.featureStore)),this._timeExtent):null}},{key:"clearCache",value:function(){var e;null!==(e=this._geometryQueryCache)&&void 0!==e&&e.clear(),this._allItems=null,this._timeExtent=null}},{key:"executeQuery",value:function(){var e=Object(a.a)(o.a.mark((function e(t,r){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._executeQuery(t,{},r);case 3:return e.abrupt("return",e.sent.createQueryResponse());case 6:if(e.prev=6,e.t0=e.catch(0),e.t0===B.a){e.next=10;break}throw e.t0;case 10:return e.abrupt("return",new w.a([],t,this).createQueryResponse());case 11:case"end":return e.stop()}}),e,this,[[0,6]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"executeQueryForCount",value:function(){var e=Object(a.a)(o.a.mark((function e(){var t,r,n=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},r=n.length>1?n[1]:void 0,e.prev=2,e.next=5,this._executeQuery(t,{returnGeometry:!1,returnCentroid:!1,outSR:null},r);case 5:return e.abrupt("return",e.sent.createQueryResponseForCount());case 8:if(e.prev=8,e.t0=e.catch(2),e.t0===B.a){e.next=12;break}throw e.t0;case 12:return e.abrupt("return",0);case 13:case"end":return e.stop()}}),e,this,[[2,8]])})));return function(){return e.apply(this,arguments)}}()},{key:"executeQueryForExtent",value:function(){var e=Object(a.a)(o.a.mark((function e(t,r){var n,i,a,s,u,c,l,h;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.outSR,e.prev=1,e.next=4,this._executeQuery(t,{returnGeometry:!0,returnCentroid:!1,outSR:null},r);case 4:if(i=e.sent,a=i.size){e.next=8;break}return e.abrupt("return",{count:0,extent:null});case 8:return Object(m.j)(X,m.a),this.featureStore.forEachBounds(i.items,(function(e){return Object(m.e)(X,e)}),Y),s={xmin:X[0],ymin:X[1],xmax:X[3],ymax:X[4],spatialReference:Object(B.b)(this.spatialReference)},this.hasZ&&isFinite(X[2])&&isFinite(X[5])&&(s.zmin=X[2],s.zmax=X[5]),(u=Object(k.b)(s,i.spatialReference,n)).spatialReference=Object(B.b)(n||this.spatialReference),u.xmax-u.xmin==0&&(c=Object(y.c)(u.spatialReference),u.xmin-=c,u.xmax+=c),u.ymax-u.ymin==0&&(l=Object(y.c)(u.spatialReference),u.ymin-=l,u.ymax+=l),this.hasZ&&null!=u.zmin&&null!=u.zmax&&u.zmax-u.zmin==0&&(h=Object(y.c)(u.spatialReference),u.zmin-=h,u.zmax+=h),e.abrupt("return",{count:a,extent:u});case 18:if(e.prev=18,e.t0=e.catch(1),e.t0!==B.a){e.next=22;break}return e.abrupt("return",{count:0,extent:null});case 22:throw e.t0;case 23:case"end":return e.stop()}}),e,this,[[1,18]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"executeQueryForIds",value:function(){var e=Object(a.a)(o.a.mark((function e(t,r){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.executeQueryForIdSet(t,r).then((function(e){return Array.from(e)})));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"executeQueryForIdSet",value:function(){var e=Object(a.a)(o.a.mark((function e(t,r){var n,a,s;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._executeQuery(t,{returnGeometry:!0,returnCentroid:!1,outSR:null},r);case 3:return n=e.sent,a=n.items,s=new Set,e.next=8,this._reschedule((function(){var e,t=Object(i.a)(a);try{for(t.s();!(e=t.n()).done;){var r=e.value;s.add(n.featureAdapter.getObjectId(r))}}catch(u){t.e(u)}finally{t.f()}}),r);case 8:return e.abrupt("return",s);case 11:if(e.prev=11,e.t0=e.catch(0),e.t0!==B.a){e.next=15;break}return e.abrupt("return",new Set);case 15:throw e.t0;case 16:case"end":return e.stop()}}),e,this,[[0,11]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"executeQueryForSnapping",value:function(){var e=Object(a.a)(o.a.mark((function e(t,r){var i,a,s,u,c,l,h,f,p,y,m,b,v,j,O=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.point,a=t.distance,t.types!==w.b.NONE){e.next=3;break}return e.abrupt("return",{candidates:[]});case 3:return e.next=5,this._reschedule((function(){return O._checkQuerySupport(t.query)}),r);case 5:if(s=e.sent,u=!Object(_.d)(i.spatialReference,this.spatialReference),e.t0=u,!e.t0){e.next=11;break}return e.next=11,Object(k.a)(i.spatialReference,this.spatialReference);case 11:if(c="number"==typeof a?a:a.x,l="number"==typeof a?a:a.y,h={xmin:i.x-c,xmax:i.x+c,ymin:i.y-l,ymax:i.y+l,spatialReference:i.spatialReference},f=u?Object(k.b)(h,this.spatialReference):h){e.next=14;break}return e.abrupt("return",{candidates:[]});case 14:return e.next=16,Object(g.a)(Object(x.a)(i),null,{signal:r});case 16:return p=e.sent[0],e.next=19,Object(g.a)(Object(x.a)(f),null,{signal:r});case 19:if(y=e.sent[0],!Object(d.j)(p)&&!Object(d.j)(y)){e.next=22;break}return e.abrupt("return",{candidates:[]});case 22:return m=new w.a(this._searchFeatures(this._getQueryBBoxes(y.toJSON())),s,this),e.next=25,this._reschedule((function(){return O._executeObjectIdsQuery(m)}),r);case 25:return e.next=27,this._reschedule((function(){return O._executeTimeQuery(m)}),r);case 27:return e.next=29,this._reschedule((function(){return O._executeAttributesQuery(m)}),r);case 29:return b=p.toJSON(),v=u?Object(k.b)(b,this.spatialReference):b,j=u?Math.max(f.xmax-f.xmin,f.ymax-f.ymin)/2:a,e.abrupt("return",m.createSnappingResponse(Object(n.a)(Object(n.a)({},t),{},{point:v,distance:j}),i.spatialReference));case 31:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"executeQueryForLatestObservations",value:function(){var e=Object(a.a)(o.a.mark((function e(t,r){var n,i=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.timeInfo&&this.timeInfo.trackIdField){e.next=2;break}throw new h.a(E,"Missing timeInfo or timeInfo.trackIdField",{query:t,timeInfo:this.timeInfo});case 2:return e.prev=2,e.next=5,this._executeQuery(t,{},r);case 5:return n=e.sent,e.next=8,this._reschedule((function(){return i._filterLatest(n)}),r);case 8:return e.abrupt("return",n.createQueryResponse());case 11:if(e.prev=11,e.t0=e.catch(2),e.t0===B.a){e.next=15;break}throw e.t0;case 15:return e.abrupt("return",new w.a([],t,this).createQueryResponse());case 16:case"end":return e.stop()}}),e,this,[[2,11]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"executeQueryForSummaryStatistics",value:function(){var e=Object(a.a)(o.a.mark((function e(){var t,r,n,i,a,s,u=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=u.length>0&&void 0!==u[0]?u[0]:{},r=u.length>1?u[1]:void 0,n=u.length>2?u[2]:void 0,i=r.field,a=r.normalizationField,s=r.valueExpression,e.next=6,this._getQueryEngineResultForStats(t,{field:i,normalizationField:a,valueExpression:s},n);case 6:return e.abrupt("return",e.sent.createSummaryStatisticsResponse(r));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"executeQueryForUniqueValues",value:function(){var e=Object(a.a)(o.a.mark((function e(){var t,r,n,i,a,s=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.length>0&&void 0!==s[0]?s[0]:{},r=s.length>1?s[1]:void 0,n=s.length>2?s[2]:void 0,i=r.field,a=r.valueExpression,e.next=6,this._getQueryEngineResultForStats(t,{field:i,valueExpression:a},n);case 6:return e.abrupt("return",e.sent.createUniqueValuesResponse(r));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"executeQueryForClassBreaks",value:function(){var e=Object(a.a)(o.a.mark((function e(){var t,r,n,i,a,s,u=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=u.length>0&&void 0!==u[0]?u[0]:{},r=u.length>1?u[1]:void 0,n=u.length>2?u[2]:void 0,i=r.field,a=r.normalizationField,s=r.valueExpression,e.next=6,this._getQueryEngineResultForStats(t,{field:i,normalizationField:a,valueExpression:s},n);case 6:return e.abrupt("return",e.sent.createClassBreaksResponse(r));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"executeQueryForHistogram",value:function(){var e=Object(a.a)(o.a.mark((function e(){var t,r,n,i,a,s,u=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=u.length>0&&void 0!==u[0]?u[0]:{},r=u.length>1?u[1]:void 0,n=u.length>2?u[2]:void 0,i=r.field,a=r.normalizationField,s=r.valueExpression,e.next=6,this._getQueryEngineResultForStats(t,{field:i,normalizationField:a,valueExpression:s},n);case 6:return e.abrupt("return",e.sent.createHistogramResponse(r));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_schedule",value:function(){var e=Object(a.a)(o.a.mark((function e(t,r){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(d.k)(this._frameTask)?this._frameTask.schedule(t,r):t(Q.c));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_reschedule",value:function(){var e=Object(a.a)(o.a.mark((function e(t,r){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(d.k)(this._frameTask)?this._frameTask.reschedule(t,r):t(Q.c));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_getAll",value:function(e){return Object(d.j)(this._allItems)&&(this._allItems=this.featureStore.toArray()),new w.a(this._allItems,e,this)}},{key:"_executeQuery",value:function(){var e=Object(a.a)(o.a.mark((function e(t,r,i){var a,s,u=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Object(f.a)(t),e.next=3,this._schedule((function(){return Object(B.d)(t,u.definitionExpression,u.spatialReference)}),i);case 3:return t=e.sent,e.next=6,this._reschedule((function(){return u._checkQuerySupport(t)}),i);case 6:return t=e.sent,t=Object(n.a)(Object(n.a)({},t),r),e.next=10,this._reschedule((function(){return u._executeSceneFilterQuery(t,i)}),i);case 10:return a=e.sent,e.next=13,this._reschedule((function(){return u._executeGeometryQuery(t,a,i)}),i);case 13:return s=e.sent,e.next=16,this._reschedule((function(){return u._executeAggregateIdsQuery(s)}),i);case 16:return e.next=18,this._reschedule((function(){return u._executeObjectIdsQuery(s)}),i);case 18:return e.next=20,this._reschedule((function(){return u._executeTimeQuery(s)}),i);case 20:return e.next=22,this._reschedule((function(){return u._executeAttributesQuery(s)}),i);case 22:return e.abrupt("return",s);case 23:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_executeSceneFilterQuery",value:function(){var e=Object(a.a)(o.a.mark((function e(t,r){var n,s,u,c,l,h,f,p,y,m,b,v,x,g,j,O,S,R,B=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Object(d.j)(t.sceneFilter)){e.next=2;break}return e.abrupt("return",null);case 2:if(n=t.outSR,s=t.returnGeometry,u=t.returnCentroid,c=this.featureStore.featureSpatialReference,l=t.sceneFilter.geometry,h=Object(d.j)(c)||Object(_.d)(c,l.spatialReference)?l:Object(k.b)(l,c)){e.next=5;break}return e.abrupt("return",null);case 5:if(f=s||u,p=Object(_.l)(n)&&!Object(_.d)(this.spatialReference,n)&&f?function(){var e=Object(a.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",B._project(t,n));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}():function(e){return e},y=this.featureAdapter,m=this._searchFeatures(this._getQueryBBoxes(h)),"disjoint"!==t.sceneFilter.spatialRelationship){e.next=19;break}if(m.length){e.next=9;break}return e.abrupt("return",null);case 9:b=new Set,v=Object(i.a)(m);try{for(v.s();!(x=v.n()).done;)g=x.value,b.add(y.getObjectId(g))}catch(F){v.e(F)}finally{v.f()}return e.next=14,this._reschedule((function(){return B.featureStore.toArray()}),r);case 14:return j=e.sent,e.next=17,this._reschedule(Object(a.a)(o.a.mark((function e(){var n,i,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(I.c)("esriSpatialRelDisjoint",h,B.geometryType,B.hasZ,B.hasM);case 2:return n=e.sent,i=function(e){return!b.has(y.getObjectId(e))||n(y.getGeometry(e))},e.next=6,B._runSpatialFilter(j,i,r);case 6:return a=e.sent,e.abrupt("return",new w.a(a,t,B));case 8:case"end":return e.stop()}}),e)}))),r);case 17:return O=e.sent,e.abrupt("return",p(O));case 19:if(m.length){e.next=21;break}return e.abrupt("return",new w.a([],t,this));case 21:if(!this._canExecuteSinglePass(h,t)){e.next=23;break}return e.abrupt("return",p(new w.a(m,t,this)));case 23:return e.next=25,Object(I.c)("esriSpatialRelContains",h,this.geometryType,this.hasZ,this.hasM);case 25:return S=e.sent,e.next=28,this._runSpatialFilter(m,(function(e){return S(y.getGeometry(e))}),r);case 28:return R=e.sent,e.abrupt("return",p(new w.a(R,t,this)));case 30:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_executeGeometryQuery",value:function(){var e=Object(a.a)(o.a.mark((function e(t,r,n){var s,u,c,h,f,p,y,m,b,v,x,g,j,O,S,R,B,F,M,Q,E,A,C,T,Y,X=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Object(d.k)(r)||0!==r.items.length){e.next=2;break}return e.abrupt("return",r);case 2:if(t=Object(d.k)(r)?r.query:t,u=(s=t).geometry,c=s.outSR,h=s.spatialRel,f=s.returnGeometry,p=s.returnCentroid,y=this.featureStore.featureSpatialReference,m=!u||Object(d.j)(y)||Object(_.d)(y,u.spatialReference)?u:Object(k.b)(u,y),b=f||p,v=Object(_.l)(c)&&!Object(_.d)(this.spatialReference,c),x=this._geometryQueryCache&&Object(d.j)(r)?v&&b?JSON.stringify({originalFilterGeometry:u,spatialRelationship:h,outSpatialReference:c}):JSON.stringify({originalFilterGeometry:u,spatialRelationship:h}):null,g=x?this._geometryQueryCache.get(x):null,!Object(d.k)(g)){e.next=6;break}return e.abrupt("return",new w.a(g,t,this));case 6:if(j=function(){var e=Object(a.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=v&&b,!e.t0){e.next=4;break}return e.next=4,X._project(t,c);case 4:return x&&X._geometryQueryCache.put(x,t.items,t.items.length+1),e.abrupt("return",t);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),m){e.next=9;break}return e.abrupt("return",j(Object(d.k)(r)?r:this._getAll(t)));case 9:if(O=this.featureAdapter,S=this._searchFeatures(this._getQueryBBoxes(u)),"esriSpatialRelDisjoint"!==h){e.next=29;break}if(S.length){e.next=14;break}return e.abrupt("return",j(Object(d.k)(r)?r:this._getAll(t)));case 14:R=new Set,B=Object(i.a)(S);try{for(B.s();!(F=B.n()).done;)M=F.value,R.add(O.getObjectId(M))}catch(P){B.e(P)}finally{B.f()}if(!Object(d.k)(r)){e.next=21;break}e.t0=r.items,e.next=24;break;case 21:return e.next=23,this._reschedule((function(){return X.featureStore.toArray()}),n);case 23:e.t0=e.sent;case 24:return Q=e.t0,e.next=27,this._reschedule(Object(a.a)(o.a.mark((function e(){var r,i,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(I.c)(h,m,X.geometryType,X.hasZ,X.hasM);case 2:return r=e.sent,i=function(e){return!R.has(O.getObjectId(e))||r(O.getGeometry(e))},e.next=6,X._runSpatialFilter(Q,i,n);case 6:return a=e.sent,e.abrupt("return",new w.a(a,t,X));case 8:case"end":return e.stop()}}),e)}))),n);case 27:return E=e.sent,e.abrupt("return",j(E));case 29:if(Object(d.k)(r)&&(A=new l.a,S=S.filter((function(e){return Object(l.f)(r.items,e,r.items.length,A)>=0}))),S.length){e.next=33;break}return C=new w.a([],t,this),e.abrupt("return",(x&&this._geometryQueryCache.put(x,C.items,1),C));case 33:if(!this._canExecuteSinglePass(m,t)){e.next=35;break}return e.abrupt("return",j(new w.a(S,t,this)));case 35:return e.next=37,Object(I.c)(h,m,this.geometryType,this.hasZ,this.hasM);case 37:return T=e.sent,e.next=40,this._runSpatialFilter(S,(function(e){return T(O.getGeometry(e))}),n);case 40:return Y=e.sent,e.abrupt("return",j(new w.a(Y,t,this)));case 42:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_executeAggregateIdsQuery",value:function(e){if(0!==e.items.length&&e.query.aggregateIds&&e.query.aggregateIds.length&&!Object(d.j)(this.aggregateAdapter)){var t,r=new Set,n=Object(i.a)(e.query.aggregateIds);try{for(n.s();!(t=n.n()).done;){var a=t.value;this.aggregateAdapter.getFeatureObjectIds(a).forEach((function(e){return r.add(e)}))}}catch(u){n.e(u)}finally{n.f()}var s=this.featureAdapter.getObjectId;e.items=e.items.filter((function(e){return r.has(s(e))}))}}},{key:"_executeObjectIdsQuery",value:function(e){if(0!==e.items.length&&e.query.objectIds&&e.query.objectIds.length){var t=new Set(e.query.objectIds),r=this.featureAdapter.getObjectId;e.items=e.items.filter((function(e){return t.has(r(e))}))}}},{key:"_executeTimeQuery",value:function(e){if(0!==e.items.length){var t=Object(R.b)(this.timeInfo,e.query.timeExtent,this.featureAdapter);Object(d.j)(t)||(e.items=e.items.filter(t))}}},{key:"_executeAttributesQuery",value:function(e){var t=this;if(0!==e.items.length){var r=Object(O.c)(e.query.where,this.fieldsIndex);if(r){if(!r.isStandardized)throw new TypeError("Where clause is not standardized");e.items=e.items.filter((function(e){return r.testFeature(e,t.featureAdapter)}))}}}},{key:"_runSpatialFilter",value:function(){var e=Object(a.a)(o.a.mark((function e(t,r,n){var i,s,u,c=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=2;break}return e.abrupt("return",t);case 2:if(!Object(d.j)(this._frameTask)){e.next=4;break}return e.abrupt("return",t.filter((function(e){return r(e)})));case 4:return i=0,s=new Array,u=function(){var e=Object(a.a)(o.a.mark((function e(a){var l;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(i<t.length)){e.next=9;break}if(l=t[i++],r(l)&&(s.push(l),a.madeProgress()),e.t0=a.done,!e.t0){e.next=7;break}return e.next=7,c._reschedule((function(e){return u(e)}),n);case 7:e.next=0;break;case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.abrupt("return",this._reschedule((function(e){return u(e)}),n).then((function(){return s})));case 7:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_filterLatest",value:function(e){var t,r=this.timeInfo,n=r.trackIdField,a=r.startTimeField,s=r.endTimeField||a,u=new Map,c=this.featureAdapter.getAttribute,o=Object(i.a)(e.items);try{for(o.s();!(t=o.n()).done;){var l=t.value,h=c(l,n),f=c(l,s),d=u.get(h);(!d||f>c(d,s))&&u.set(h,l)}}catch(p){o.e(p)}finally{o.f()}e.items=Array.from(u.values())}},{key:"_canExecuteSinglePass",value:function(e,t){var r=t.spatialRel;return Object(I.a)(e)&&("esriSpatialRelEnvelopeIntersects"===r||"esriGeometryPoint"===this.geometryType&&("esriSpatialRelIntersects"===r||"esriSpatialRelContains"===r||"esriSpatialRelWithin"===r))}},{key:"_project",value:function(){var e=Object(a.a)(o.a.mark((function e(t,r){var n,i,a=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r&&!Object(_.d)(this.spatialReference,r)){e.next=2;break}return e.abrupt("return",t);case 2:return n=this.featureAdapter,e.next=5,Object(k.c)(t.items.map((function(e){return Object(B.c)(a.geometryType,a.hasZ,a.hasM,n.getGeometry(e))})),this.spatialReference,r);case 5:return i=e.sent,e.abrupt("return",(t.items=i.map((function(e,r){return n.cloneWithGeometry(t.items[r],Object(j.d)(e,a.hasZ,a.hasM))})),t));case 7:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_getQueryBBoxes",value:function(e){if(Object(I.a)(e)){if(Object(x.d)(e))return[Object(b.m)(e.xmin,e.ymin,e.xmax,e.ymax)];if(Object(x.g)(e))return e.rings.map((function(e){return Object(b.m)(Math.min(e[0][0],e[2][0]),Math.min(e[0][1],e[2][1]),Math.max(e[0][0],e[2][0]),Math.max(e[0][1],e[2][1]))}))}return[Object(v.a)(Object(b.g)(),e)]}},{key:"_searchFeatures",value:function(e){var t,r=Object(i.a)(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;this.featureStore.forEachInBounds(n,(function(e){return P.add(e)}))}}catch(s){r.e(s)}finally{r.f()}var a=Array.from(P.values());return P.clear(),a}},{key:"_checkStatisticsSupport",value:function(){var e=Object(a.a)(o.a.mark((function e(t,r){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.distance<0||null!=t.geometryPrecision||t.multipatchOption||t.pixelSize||t.relationParam||t.text||t.outStatistics||t.groupByFieldsForStatistics||t.having||t.orderByFields)){e.next=2;break}throw new h.a(E,"Unsupported query options",{query:t});case 2:return e.abrupt("return",(this._checkAttributesQuerySupport(t),Promise.all([this._checkStatisticsParamsSupport(r),Object(I.b)(t,this.geometryType,this.spatialReference),Object(k.a)(this.spatialReference,t.outSR)]).then((function(){return t}))));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_checkStatisticsParamsSupport",value:function(){var e=Object(a.a)(o.a.mark((function e(t){var r,n,i;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=[],!t.valueExpression){e.next=7;break}return e.next=4,Object(M.e)();case 4:n=e.sent,i=n.arcadeUtils,r=i.extractFieldNames(t.valueExpression);case 7:if(t.field&&r.push(t.field),t.normalizationField&&r.push(t.normalizationField),r.length){e.next=9;break}throw new h.a(E,"params should have at least a field or valueExpression",{params:t});case 9:Object(O.e)(this.fieldsIndex,r,"params contains missing fields");case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_checkQuerySupport",value:function(){var e=Object(a.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.distance<0||null!=t.geometryPrecision||t.multipatchOption||t.pixelSize||t.relationParam||t.text)){e.next=2;break}throw new h.a(E,"Unsupported query options",{query:t});case 2:return e.abrupt("return",(this._checkAttributesQuerySupport(t),this._checkStatisticsQuerySupport(t),Promise.all([Object(I.b)(t,this.geometryType,this.spatialReference),Object(k.a)(this.spatialReference,t.outSR)]).then((function(){return t}))));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_checkAttributesQuerySupport",value:function(e){var t=e.outFields,r=e.orderByFields,n=e.returnDistinctValues,i=e.outStatistics,a=i?i.map((function(e){return e.outStatisticFieldName&&e.outStatisticFieldName.toLowerCase()})).filter(Boolean):[];if(r&&r.length>0){var s=" asc",u=" desc",c=r.map((function(e){var t=e.toLowerCase();return t.includes(s)?t.split(s)[0]:t.includes(u)?t.split(u)[0]:e})).filter((function(e){return!a.includes(e)}));Object(O.e)(this.fieldsIndex,c,"orderByFields contains missing fields")}if(t&&t.length>0)Object(O.e)(this.fieldsIndex,t,"outFields contains missing fields");else if(n)throw new h.a(E,"outFields should be specified for returnDistinctValues",{query:e});Object(O.g)(this.fieldsIndex,e.where)}},{key:"_checkStatisticsQuerySupport",value:function(e){var t=e.outStatistics,r=e.groupByFieldsForStatistics,n=e.having,a=r&&r.length,s=t&&t.length;if(n){if(!a||!s)throw new h.a(E,"outStatistics and groupByFieldsForStatistics should be specified with having",{query:e});Object(O.f)(this.fieldsIndex,n,t)}if(s){if(!function(e){return e.every((function(e){return"exceedslimit"!==e.statisticType}))}(t))return;var u=t.map((function(e){return e.onStatisticField})).filter(Boolean);Object(O.e)(this.fieldsIndex,u,"onStatisticFields contains missing fields"),a&&Object(O.e)(this.fieldsIndex,r,"groupByFieldsForStatistics contains missing fields");var c,o=Object(i.a)(t);try{for(o.s();!(c=o.n()).done;){var l=c.value,f=l.onStatisticField,d=l.statisticType;if("percentile_disc"!==d&&"percentile_cont"!==d||!("statisticParameters"in l)){if("count"!==d&&f&&Object(O.d)(f,this.fieldsIndex))throw new h.a(E,"outStatistics contains non-numeric fields",{definition:l,query:e})}else if(!l.statisticParameters)throw new h.a(E,"statisticParamters should be set for percentile type",{definition:l,query:e})}}catch(p){o.e(p)}finally{o.f()}}}},{key:"_getQueryEngineResultForStats",value:function(){var e=Object(a.a)(o.a.mark((function e(t,r,n){var i,a,s=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Object(f.a)(t),e.prev=1,e.next=4,this._schedule((function(){return Object(B.d)(t,s.definitionExpression,s.spatialReference)}),n);case 4:return t=e.sent,e.next=7,this._reschedule((function(){return s._checkStatisticsSupport(t,r)}),n);case 7:return t=e.sent,e.next=10,this._reschedule((function(){return s._executeSceneFilterQuery(t,n)}),n);case 10:return i=e.sent,e.next=13,this._reschedule((function(){return s._executeGeometryQuery(t,i,n)}),n);case 13:return a=e.sent,e.next=16,this._reschedule((function(){return s._executeAggregateIdsQuery(a)}),n);case 16:return e.next=18,this._reschedule((function(){return s._executeObjectIdsQuery(a)}),n);case 18:return e.next=20,this._reschedule((function(){return s._executeTimeQuery(a)}),n);case 20:return e.next=22,this._reschedule((function(){return s._executeAttributesQuery(a)}),n);case 22:return e.abrupt("return",a);case 25:if(e.prev=25,e.t0=e.catch(1),e.t0===B.a){e.next=29;break}throw e.t0;case 29:return e.abrupt("return",new w.a([],t,this));case 30:case"end":return e.stop()}}),e,this,[[1,25]])})));return function(t,r,n){return e.apply(this,arguments)}}()}]),e}(),Y=Object(m.b)(),X=Object(m.b)(),P=new Set},639:function(e,t,r){"use strict";function n(e,t){if(!e)return null;var r=t.featureAdapter,n=e.startTimeField,i=e.endTimeField,a=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;if(n&&i)t.forEach((function(e){var t=r.getAttribute(e,n),u=r.getAttribute(e,i);null==t||isNaN(t)||(a=Math.min(a,t)),null==u||isNaN(u)||(s=Math.max(s,u))}));else{var u=n||i;t.forEach((function(e){var t=r.getAttribute(e,u);null==t||isNaN(t)||(a=Math.min(a,t),s=Math.max(s,t))}))}return{start:a,end:s}}function i(e,t,r){if(!t||!e)return null;var n=e.startTimeField,i=e.endTimeField;if(!n&&!i)return null;var a=t.start,s=t.end;return null===a&&null===s?null:void 0===a&&void 0===s?function(){return!1}:n&&i?function(e,t,r,n,i){return null!=n&&null!=i?function(a){var s=e.getAttribute(a,t),u=e.getAttribute(a,r);return(null==s||s<=i)&&(null==u||u>=n)}:null!=n?function(t){var i=e.getAttribute(t,r);return null==i||i>=n}:null!=i?function(r){var n=e.getAttribute(r,t);return null==n||n<=i}:void 0}(r,n,i,a,s):function(e,t,r,n){return null!=r&&null!=n&&r===n?function(n){return e.getAttribute(n,t)===r}:null!=r&&null!=n?function(i){var a=e.getAttribute(i,t);return a>=r&&a<=n}:null!=r?function(n){return e.getAttribute(n,t)>=r}:null!=n?function(r){return e.getAttribute(r,t)<=n}:void 0}(r,n||i,a,s)}r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return i}))},666:function(e,t,r){"use strict";r.d(t,"a",(function(){return F})),r.d(t,"b",(function(){return R})),r.d(t,"c",(function(){return I}));var n=r(60),i=r(155),a=r(154),s=r.n(a),u=r(159),c=r(494),o=r(268);var l=r(168),h=r(182);function f(e,t){return e?t?4:3:t?3:2}function d(e,t,r,i,a){if(!e)return!1;var s,u=f(t,r),c=e.coords,o=e.lengths,l=!1,h=0,d=Object(n.a)(o);try{for(d.s();!(s=d.n()).done;){var y=s.value;l=p(l,c,u,h,y,i,a),h+=y*u}}catch(m){d.e(m)}finally{d.f()}return l}function p(e,t,r,n,i,a,s){for(var u=e,c=n,o=n,l=n+i*r;o<l;o+=r){(c=o+r)===l&&(c=n);var h=t[o],f=t[o+1],d=t[c],p=t[c+1];(f<s&&p>=s||p<s&&f>=s)&&h+(s-f)/(p-f)*(d-h)<a&&(u=!u)}return u}var y=r(189),m=r(216),b=r(278),v=r(485),x="feature-store:unsupported-query",g={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},_={esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},j={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},O={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1};function k(e){return!0===_[e]}function S(e){return!0===j[Object(l.c)(e)]}function w(e){return!0===O[e]}function I(e,t,n,i,a){if(Object(l.g)(t)&&"esriGeometryPoint"===n&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e)){var s=Object(y.g)(new m.a,t,!1,!1);return Promise.resolve((function(e){return function(e,t,r,n){return d(e,t,r,n.coords[0],n.coords[1])}(s,!1,!1,e)}))}if(Object(l.g)(t)&&"esriGeometryMultipoint"===n){var u=Object(y.g)(new m.a,t,!1,!1);if("esriSpatialRelContains"===e)return Promise.resolve((function(e){return function(e,t,r,n,i,a){var s=f(i,a),u=n.coords,c=n.lengths;if(!c)return!1;for(var o=0,l=0;o<c.length;o++,l+=s)if(!d(e,t,r,u[l],u[l+1]))return!1;return!0}(u,!1,!1,e,i,a)}))}if(Object(l.d)(t)&&"esriGeometryPoint"===n&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e))return Promise.resolve((function(e){return Object(c.e)(t,Object(v.c)(n,i,a,e))}));if(Object(l.d)(t)&&"esriGeometryMultipoint"===n&&"esriSpatialRelContains"===e)return Promise.resolve((function(e){return Object(c.d)(t,Object(v.c)(n,i,a,e))}));if(Object(l.d)(t)&&"esriSpatialRelIntersects"===e){var h=function(e){return"mesh"===e?o.a:Object(o.b)(e)}(n);return Promise.resolve((function(e){return h(t,Object(v.c)(n,i,a,e))}))}return Promise.all([r.e(6),r.e(16)]).then(r.bind(null,528)).then((function(r){var s=r[g[e]].bind(null,t.spatialReference,t);return function(e){return s(Object(v.c)(n,i,a,e))}}))}function R(e,t,r){return B.apply(this,arguments)}function B(){return(B=Object(i.a)(s.a.mark((function e(t,r,n){var i,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.spatialRel,!(a=t.geometry)){e.next=11;break}if(k(i)){e.next=4;break}throw new u.a(x,"Unsupported query spatial relationship",{query:t});case 4:if(!Object(h.l)(a.spatialReference)||!Object(h.l)(n)){e.next=11;break}if(S(a)){e.next=7;break}throw new u.a(x,"Unsupported query geometry type",{query:t});case 7:if(w(r)){e.next=9;break}throw new u.a(x,"Unsupported layer geometry type",{query:t});case 9:if(!t.outSR){e.next=11;break}return e.abrupt("return",Object(b.a)(t.geometry&&t.geometry.spatialReference,t.outSR));case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function F(e){if(Object(l.d)(e))return!0;if(Object(l.g)(e)){var t,r=Object(n.a)(e.rings);try{for(r.s();!(t=r.n()).done;){var i=t.value;if(5!==i.length)return!1;if(i[0][0]!==i[1][0]||i[0][0]!==i[4][0]||i[2][0]!==i[3][0]||i[0][1]!==i[3][1]||i[0][1]!==i[4][1]||i[1][1]!==i[2][1])return!1}}catch(a){r.e(a)}finally{r.f()}return!0}return!1}},674:function(e,t,r){"use strict";r.d(t,"a",(function(){return v}));var n=r(60),i=r(142),a=r(143),s=r(159),u=r(252),c=r(156),o=r(146),l=r(420),h=r(180),f=r(189),d=r(1019),p=r(346),y=r(351),m=r(216),b={getObjectId:function(e){return e.objectId},getAttributes:function(e){return e.attributes},getAttribute:function(e,t){return e.attributes[t]},cloneWithGeometry:function(e,t){return new y.a(t,e.attributes,null,e.objectId)},getGeometry:function(e){return e.geometry},getCentroid:function(e,t){return Object(o.j)(e.centroid)&&(e.centroid=Object(p.a)(new m.a,e.geometry,t.hasZ,t.hasM)),e.centroid}},v=function(){function e(t){Object(i.a)(this,e),this.geometryInfo=t,this._boundsStore=new d.a,this._featuresById=new Map,this._markedIds=new Set,this.events=new u.a,this.featureAdapter=b}return Object(a.a)(e,[{key:"geometryType",get:function(){return this.geometryInfo.geometryType}},{key:"hasM",get:function(){return this.geometryInfo.hasM}},{key:"hasZ",get:function(){return this.geometryInfo.hasZ}},{key:"numFeatures",get:function(){return this._featuresById.size}},{key:"fullBounds",get:function(){return this._boundsStore.fullBounds}},{key:"storeStatistics",get:function(){var e=0;return this._featuresById.forEach((function(t){Object(o.k)(t.geometry)&&t.geometry.coords&&(e+=t.geometry.coords.length)})),{featureCount:this._featuresById.size,vertexCount:e/(this.hasZ?this.hasM?4:3:this.hasM?3:2)}}},{key:"add",value:function(e){this._add(e),this._emitChanged()}},{key:"addMany",value:function(e){var t,r=Object(n.a)(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;this._add(i)}}catch(a){r.e(a)}finally{r.f()}this._emitChanged()}},{key:"clear",value:function(){this._featuresById.clear(),this._boundsStore.clear(),this._emitChanged()}},{key:"removeById",value:function(e){var t=this._featuresById.get(e);return t?(this._remove(t),this._emitChanged(),t):null}},{key:"removeManyById",value:function(e){this._boundsStore.invalidateIndex();var t,r=Object(n.a)(e);try{for(r.s();!(t=r.n()).done;){var i=t.value,a=this._featuresById.get(i);a&&this._remove(a)}}catch(s){r.e(s)}finally{r.f()}this._emitChanged()}},{key:"forEachBounds",value:function(e,t,r){var i,a=Object(n.a)(e);try{for(a.s();!(i=a.n()).done;){var s=i.value,u=this._boundsStore.get(s.objectId);u&&t(Object(l.h)(r,u))}}catch(c){a.e(c)}finally{a.f()}}},{key:"getFeature",value:function(e){return this._featuresById.get(e)}},{key:"has",value:function(e){return this._featuresById.has(e)}},{key:"toArray",value:function(){return Array.from(this._featuresById.values())}},{key:"forEach",value:function(e){this._featuresById.forEach((function(t){return e(t)}))}},{key:"forEachInBounds",value:function(e,t){var r=this;this._boundsStore.forEachInBounds(e,(function(e){t(r._featuresById.get(e))}))}},{key:"startMarkingUsedFeatures",value:function(){this._boundsStore.invalidateIndex(),this._markedIds.clear()}},{key:"sweep",value:function(){var e=this,t=!1;this._featuresById.forEach((function(r,n){e._markedIds.has(n)||(t=!0,e._remove(r))})),this._markedIds.clear(),t&&this._emitChanged()}},{key:"_emitChanged",value:function(){this.events.emit("changed",void 0)}},{key:"_add",value:function(e){if(e){var t=e.objectId;if(null!=t){var r,n=this._featuresById.get(t);if(this._markedIds.add(t),n?(e.displayId=n.displayId,r=this._boundsStore.get(t),this._boundsStore.delete(t)):Object(o.k)(this.onFeatureAdd)&&this.onFeatureAdd(e),Object(o.j)(e.geometry)||!e.geometry.coords||!e.geometry.coords.length)return this._boundsStore.set(t,null),void this._featuresById.set(t,e);r=Object(f.r)(Object(o.k)(r)?r:Object(h.g)(),e.geometry,this.geometryInfo.hasZ,this.geometryInfo.hasM),Object(o.k)(r)&&this._boundsStore.set(t,r),this._featuresById.set(t,e)}else c.a.getLogger("esri.layers.graphics.data.FeatureStore").error(new s.a("featurestore:invalid-feature","feature id is missing",{feature:e}))}}},{key:"_remove",value:function(e){return Object(o.k)(this.onFeatureRemove)&&this.onFeatureRemove(e),this._markedIds.delete(e.objectId),this._boundsStore.delete(e.objectId),this._featuresById.delete(e.objectId),e}}]),e}()},851:function(e,t,r){"use strict";r.d(t,"a",(function(){return f}));var n=r(144),i=r(145),a=r(60),s=r(142),u=r(143),c=r(152),o=r(146),l=r(457),h=r(838),f=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:9,r=arguments.length>1?arguments[1]:void 0;Object(s.a)(this,e),this.compareMinX=m,this.compareMinY=b,this._toBBox=function(e){return e},this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),r&&("function"==typeof r?this._toBBox=r:this._initFormat(r)),this.clear()}return Object(u.a)(e,[{key:"destroy",value:function(){this.clear(),S.prune(),w.prune(),I.prune(),R.prune()}},{key:"all",value:function(e){this._all(this.data,e)}},{key:"search",value:function(e,t){var r=this.data,n=this._toBBox;if(O(e,r))for(S.clear();r;){for(var i=0,a=r.children.length;i<a;i++){var s=r.children[i],u=r.leaf?n(s):s;O(e,u)&&(r.leaf?t(s):j(e,u)?this._all(s,t):S.push(s))}r=S.pop()}}},{key:"collides",value:function(e){var t=this.data,r=this._toBBox;if(!O(e,t))return!1;for(S.clear();t;){for(var n=0,i=t.children.length;n<i;n++){var a=t.children[n],s=t.leaf?r(a):a;if(O(e,s)){if(t.leaf||j(e,s))return!0;S.push(a)}}t=S.pop()}return!1}},{key:"load",value:function(e){if(!e.length)return this;if(e.length<this._minEntries){for(var t=0,r=e.length;t<r;t++)this.insert(e[t]);return this}var n=this._build(e.slice(0,e.length),0,e.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var i=this.data;this.data=n,n=i}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this}},{key:"insert",value:function(e){return e&&this._insert(e,this.data.height-1),this}},{key:"clear",value:function(){return this.data=new F([]),this}},{key:"remove",value:function(e){if(!e)return this;var t,r=this.data,n=null,i=0,a=!1,s=this._toBBox(e);for(I.clear(),R.clear();r||I.length>0;){var u;if(r||(r=Object(o.c)(I.pop()),n=I.data[I.length-1],i=null!==(u=R.pop())&&void 0!==u?u:0,a=!0),r.leaf&&-1!==(t=Object(c.f)(r.children,e,r.children.length,r.indexHint)))return r.children.splice(t,1),I.push(r),this._condense(I),this;a||r.leaf||!j(r,s)?n?(i++,r=n.children[i],a=!1):r=null:(I.push(r),R.push(i),i=0,n=r,r=r.children[0])}return this}},{key:"toJSON",value:function(){return this.data}},{key:"fromJSON",value:function(e){return this.data=e,this}},{key:"_all",value:function(e,t){var r=e;for(w.clear();r;){var n;if(!0===r.leaf){var i,s=Object(a.a)(r.children);try{for(s.s();!(i=s.n()).done;){t(i.value)}}catch(u){s.e(u)}finally{s.f()}}else w.pushArray(r.children);r=null!==(n=w.pop())&&void 0!==n?n:null}}},{key:"_build",value:function(e,t,r,n){var i=r-t+1,a=this._maxEntries;if(i<=a){var s=new F(e.slice(t,r+1));return d(s,this._toBBox),s}n||(n=Math.ceil(Math.log(i)/Math.log(a)),a=Math.ceil(i/Math.pow(a,n-1)));var u=new M([]);u.height=n;var c=Math.ceil(i/a),o=c*Math.ceil(Math.sqrt(a));k(e,t,r,o,this.compareMinX);for(var l=t;l<=r;l+=o){var h=Math.min(l+o-1,r);k(e,l,h,c,this.compareMinY);for(var f=l;f<=h;f+=c){var p=Math.min(f+c-1,h);u.children.push(this._build(e,f,p,n-1))}}return d(u,this._toBBox),u}},{key:"_chooseSubtree",value:function(e,t,r,n){for(;n.push(t),!0!==t.leaf&&n.length-1!==r;){for(var i=void 0,a=1/0,s=1/0,u=0,c=t.children.length;u<c;u++){var o=t.children[u],l=v(o),h=g(e,o)-l;h<s?(s=h,a=l<a?l:a,i=o):h===s&&l<a&&(a=l,i=o)}t=i||t.children[0]}return t}},{key:"_insert",value:function(e,t,r){var n=this._toBBox,i=r?e:n(e);I.clear();var a=this._chooseSubtree(i,this.data,t,I);for(a.children.push(e),y(a,i);t>=0&&I.data[t].children.length>this._maxEntries;)this._split(I,t),t--;this._adjustParentBBoxes(i,I,t)}},{key:"_split",value:function(e,t){var r=e.data[t],n=r.children.length,i=this._minEntries;this._chooseSplitAxis(r,i,n);var a=this._chooseSplitIndex(r,i,n);if(a){var s=r.children.splice(a,r.children.length-a),u=r.leaf?new F(s):new M(s);u.height=r.height,d(r,this._toBBox),d(u,this._toBBox),t?e.data[t-1].children.push(u):this._splitRoot(r,u)}else console.log("  Error: assertion failed at PooledRBush._split: no valid split index")}},{key:"_splitRoot",value:function(e,t){this.data=new M([e,t]),this.data.height=e.height+1,d(this.data,this._toBBox)}},{key:"_chooseSplitIndex",value:function(e,t,r){var n,i,a;n=i=1/0;for(var s=t;s<=r-t;s++){var u=p(e,0,s,this._toBBox),c=p(e,s,r,this._toBBox),o=_(u,c),l=v(u)+v(c);o<n?(n=o,a=s,i=l<i?l:i):o===n&&l<i&&(i=l,a=s)}return a}},{key:"_chooseSplitAxis",value:function(e,t,r){var n=e.leaf?this.compareMinX:m,i=e.leaf?this.compareMinY:b;this._allDistMargin(e,t,r,n)<this._allDistMargin(e,t,r,i)&&e.children.sort(n)}},{key:"_allDistMargin",value:function(e,t,r,n){e.children.sort(n);for(var i=this._toBBox,a=p(e,0,t,i),s=p(e,r-t,r,i),u=x(a)+x(s),c=t;c<r-t;c++){var o=e.children[c];y(a,e.leaf?i(o):o),u+=x(a)}for(var l=r-t-1;l>=t;l--){var h=e.children[l];y(s,e.leaf?i(h):h),u+=x(s)}return u}},{key:"_adjustParentBBoxes",value:function(e,t,r){for(var n=r;n>=0;n--)y(t.data[n],e)}},{key:"_condense",value:function(e){for(var t=e.length-1;t>=0;t--){var r=e.data[t];if(0===r.children.length)if(t>0){var n=e.data[t-1],i=n.children;i.splice(Object(c.f)(i,r,i.length,n.indexHint),1)}else this.clear();else d(r,this._toBBox)}}},{key:"_initFormat",value:function(e){var t=["return a"," - b",";"];this.compareMinX=new Function("a","b",t.join(e[0])),this.compareMinY=new Function("a","b",t.join(e[1])),this._toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}}]),e}();function d(e,t){p(e,0,e.children.length,t,e)}function p(e,t,r,n,i){i||(i=new F([])),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(var a,s=t;s<r;s++)a=e.children[s],y(i,e.leaf?n(a):a);return i}function y(e,t){e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY)}function m(e,t){return e.minX-t.minX}function b(e,t){return e.minY-t.minY}function v(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function x(e){return e.maxX-e.minX+(e.maxY-e.minY)}function g(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function _(e,t){var r=Math.max(e.minX,t.minX),n=Math.max(e.minY,t.minY),i=Math.min(e.maxX,t.maxX),a=Math.min(e.maxY,t.maxY);return Math.max(0,i-r)*Math.max(0,a-n)}function j(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function O(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function k(e,t,r,n,i){for(var a=[t,r];a.length;){var s=Object(o.c)(a.pop()),u=Object(o.c)(a.pop());if(!(s-u<=n)){var c=u+Math.ceil((s-u)/n/2)*n;Object(h.a)(e,c,u,s,i),a.push(u,c,c,s)}}}var S=new l.a,w=new l.a,I=new l.a,R=new l.a({deallocator:void 0}),B=function(e){Object(n.a)(r,e);var t=Object(i.a)(r);function r(){var e;return Object(s.a)(this,r),(e=t.apply(this,arguments)).height=1,e.indexHint=new c.a,e}return Object(u.a)(r)}(Object(u.a)((function e(){Object(s.a)(this,e),this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}))),F=function(e){Object(n.a)(r,e);var t=Object(i.a)(r);function r(e){var n;return Object(s.a)(this,r),(n=t.call(this)).children=e,n.leaf=!0,n}return Object(u.a)(r)}(B),M=function(e){Object(n.a)(r,e);var t=Object(i.a)(r);function r(e){var n;return Object(s.a)(this,r),(n=t.call(this)).children=e,n.leaf=!1,n}return Object(u.a)(r)}(B)}}]);
//# sourceMappingURL=9.c22bdbef.chunk.js.map